
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Mybatis · eternal-heathens个人文档</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism-okaidia.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-accordion/accordion.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-lightbox/css/lightbox.min.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-mermaid-gb3/mermaid/mermaid.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    


    

        
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    

    
        <link rel="shortcut icon" href='../asset/img/favicon.ico' type="image/x-icon">
    
    
        <link rel="bookmark" href='../asset/img/favicon.ico' type="image/x-icon">
    
    
        <link rel="apple-touch-icon" href='../asset/img/favicon.ico'>
    
    
        
        <link rel="apple-touch-icon" sizes="120x120" href="../asset/img/favicon.ico">
        
        <link rel="apple-touch-icon" sizes="180x180" href="../asset/img/favicon.ico">
        
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Asset</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                        <b>1.1.</b>
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Docs</li>
        
        
    
        <li class="chapter " data-level="2.1" >
            
                <span>
            
                    
                        <b>2.1.</b>
                    
                    Asset
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" >
            
                <span>
            
                    
                        <b>2.2.</b>
                    
                    Gitbook
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1" >
            
                <span>
            
                    
                        <b>2.2.1.</b>
                    
                    Fonts
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1.1" >
            
                <span>
            
                    
                        <b>2.2.1.1.</b>
                    
                    Fontawesome
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2.2" >
            
                <span>
            
                    
                        <b>2.2.2.</b>
                    
                    Gitbook Plugin Accordion
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.3" >
            
                <span>
            
                    
                        <b>2.2.3.</b>
                    
                    Gitbook Plugin Anchor Navigation Ex
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.3.1" >
            
                <span>
            
                    
                        <b>2.2.3.1.</b>
                    
                    Lib
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.3.2" >
            
                <span>
            
                    
                        <b>2.2.3.2.</b>
                    
                    Style
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2.4" >
            
                <span>
            
                    
                        <b>2.2.4.</b>
                    
                    Gitbook Plugin Back To Top Button
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.5" >
            
                <span>
            
                    
                        <b>2.2.5.</b>
                    
                    Gitbook Plugin Chapter Fold
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.6" >
            
                <span>
            
                    
                        <b>2.2.6.</b>
                    
                    Gitbook Plugin Copy Code Button
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.7" >
            
                <span>
            
                    
                        <b>2.2.7.</b>
                    
                    Gitbook Plugin Edit Link
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.8" >
            
                <span>
            
                    
                        <b>2.2.8.</b>
                    
                    Gitbook Plugin Expandable Chapters
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.9" >
            
                <span>
            
                    
                        <b>2.2.9.</b>
                    
                    Gitbook Plugin Fontsettings
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.10" >
            
                <span>
            
                    
                        <b>2.2.10.</b>
                    
                    Gitbook Plugin Github
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.11" >
            
                <span>
            
                    
                        <b>2.2.11.</b>
                    
                    Gitbook Plugin Hide Element
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.12" >
            
                <span>
            
                    
                        <b>2.2.12.</b>
                    
                    Gitbook Plugin Highlight
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.13" >
            
                <span>
            
                    
                        <b>2.2.13.</b>
                    
                    Gitbook Plugin Lightbox
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.13.1" >
            
                <span>
            
                    
                        <b>2.2.13.1.</b>
                    
                    Css
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.13.2" >
            
                <span>
            
                    
                        <b>2.2.13.2.</b>
                    
                    Images
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.13.3" >
            
                <span>
            
                    
                        <b>2.2.13.3.</b>
                    
                    Js
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2.14" >
            
                <span>
            
                    
                        <b>2.2.14.</b>
                    
                    Gitbook Plugin Livereload
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.15" >
            
                <span>
            
                    
                        <b>2.2.15.</b>
                    
                    Gitbook Plugin Lunr
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.16" >
            
                <span>
            
                    
                        <b>2.2.16.</b>
                    
                    Gitbook Plugin Mermaid Gb3
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.16.1" >
            
                <span>
            
                    
                        <b>2.2.16.1.</b>
                    
                    Book
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.16.2" >
            
                <span>
            
                    
                        <b>2.2.16.2.</b>
                    
                    Mermaid
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2.17" >
            
                <span>
            
                    
                        <b>2.2.17.</b>
                    
                    Gitbook Plugin Prism
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.18" >
            
                <span>
            
                    
                        <b>2.2.18.</b>
                    
                    Gitbook Plugin Search Pro
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.19" >
            
                <span>
            
                    
                        <b>2.2.19.</b>
                    
                    Gitbook Plugin Search
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.20" >
            
                <span>
            
                    
                        <b>2.2.20.</b>
                    
                    Gitbook Plugin Sharing
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.21" >
            
                <span>
            
                    
                        <b>2.2.21.</b>
                    
                    Gitbook Plugin Splitter
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.22" >
            
                <span>
            
                    
                        <b>2.2.22.</b>
                    
                    Gitbook Plugin Tbfed Pagefooter
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.23" >
            
                <span>
            
                    
                        <b>2.2.23.</b>
                    
                    Images
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.3" >
            
                <span>
            
                    
                        <b>2.3.</b>
                    
                    数据库
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.3.1" data-path="../docs/数据库/Hibernate.md">
            
                <span>
            
                    
                        <b>2.3.1.</b>
                    
                    Hibernate
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.2" data-path="../docs/数据库/mybaties与Redies简介.md">
            
                <span>
            
                    
                        <b>2.3.2.</b>
                    
                    Mybaties与Redies简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.3" >
            
                <span>
            
                    
                        <b>2.3.3.</b>
                    
                    Mybatis.Assets
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.4" data-path="../docs/数据库/mybatis.md">
            
                <span>
            
                    
                        <b>2.3.4.</b>
                    
                    Mybatis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.5" >
            
                <span>
            
                    
                        <b>2.3.5.</b>
                    
                    MybatisPlus.Assets
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.6" data-path="../docs/数据库/mybatisPlus.md">
            
                <span>
            
                    
                        <b>2.3.6.</b>
                    
                    MybatisPlus
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.7" data-path="../docs/数据库/mysql.md">
            
                <span>
            
                    
                        <b>2.3.7.</b>
                    
                    Mysql
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.4" >
            
                <span>
            
                    
                        <b>2.4.</b>
                    
                    配置中心
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.4.1" data-path="../docs/配置中心/disConf.md">
            
                <span>
            
                    
                        <b>2.4.1.</b>
                    
                    DisConf
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.5" >
            
                <span>
            
                    
                        <b>2.5.</b>
                    
                    项目结构
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.5.1" data-path="../docs/项目结构/ccs项目结构.md">
            
                <span>
            
                    
                        <b>2.5.1.</b>
                    
                    Ccs项目结构
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Gitbook</li>
        
        
    
        <li class="chapter " data-level="3.1" >
            
                <span>
            
                    
                        <b>3.1.</b>
                    
                    Fonts
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" >
            
                <span>
            
                    
                        <b>3.1.1.</b>
                    
                    Fontawesome
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.2" >
            
                <span>
            
                    
                        <b>3.2.</b>
                    
                    Gitbook Plugin Fontsettings
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" >
            
                <span>
            
                    
                        <b>3.3.</b>
                    
                    Gitbook Plugin Highlight
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" >
            
                <span>
            
                    
                        <b>3.4.</b>
                    
                    Gitbook Plugin Lunr
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="3.5" >
            
                <span>
            
                    
                        <b>3.5.</b>
                    
                    Gitbook Plugin Search
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="3.6" >
            
                <span>
            
                    
                        <b>3.6.</b>
                    
                    Gitbook Plugin Sharing
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="3.7" >
            
                <span>
            
                    
                        <b>3.7.</b>
                    
                    Images
            
                </span>
            

            
        </li>
    

    
        
        <li class="header">数据库</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="Hibernate.html">
            
                <a href="Hibernate.html">
            
                    
                        <b>4.1.</b>
                    
                    Hibernate
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" >
            
                <span>
            
                    
                        <b>4.2.</b>
                    
                    Mybaties与Redies简介.Assets
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="mybaties与Redies简介.html">
            
                <a href="mybaties与Redies简介.html">
            
                    
                        <b>4.3.</b>
                    
                    Mybaties与Redies简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4" >
            
                <span>
            
                    
                        <b>4.4.</b>
                    
                    Mybatis.Assets
            
                </span>
            

            
        </li>
    
        <li class="chapter active" data-level="4.5" data-path="mybatis.html">
            
                <a href="mybatis.html">
            
                    
                        <b>4.5.</b>
                    
                    Mybatis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6" >
            
                <span>
            
                    
                        <b>4.6.</b>
                    
                    MybatisPlus.Assets
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="4.7" data-path="mybatisPlus.html">
            
                <a href="mybatisPlus.html">
            
                    
                        <b>4.7.</b>
                    
                    MybatisPlus
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.8" >
            
                <span>
            
                    
                        <b>4.8.</b>
                    
                    Mysql.Assets
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="4.9" data-path="mysql.html">
            
                <a href="mysql.html">
            
                    
                        <b>4.9.</b>
                    
                    Mysql
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.10" >
            
                <span>
            
                    
                        <b>4.10.</b>
                    
                    索引.Assets
            
                </span>
            

            
        </li>
    

    
        
        <li class="header">配置中心</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../配置中心/disConf.html">
            
                <a href="../配置中心/disConf.html">
            
                    
                        <b>5.1.</b>
                    
                    DisConf
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">项目结构</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../项目结构/ccs项目结构.html">
            
                <a href="../项目结构/ccs项目结构.html">
            
                    
                        <b>6.1.</b>
                    
                    Ccs项目结构
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Mybatis</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-navicon"></i><ul><ul><li><span class="title-icon "></span><a href="#mybatis--&#x7684;&#x4F18;&#x7F3A;&#x70B9;"><b></b>mybatis  &#x7684;&#x4F18;&#x7F3A;&#x70B9;</a></li><li><span class="title-icon "></span><a href="#&#x5165;&#x95E8;&#x6848;&#x4F8B;"><b></b>&#x5165;&#x95E8;&#x6848;&#x4F8B;</a></li><li><span class="title-icon "></span><a href="#curd"><b></b>CURD</a></li></ul><li><span class="title-icon "></span><a href="#&#x5B9E;&#x4F53;&#x7C7B;&#x5C5E;&#x6027;&#xFF1A;-&#x8BFB;&#x53D6;&#x5B9E;&#x4F53;&#x7C7B;&#x7684;&#x5C5E;&#x6027;"><b></b>{&#x5B9E;&#x4F53;&#x7C7B;&#x5C5E;&#x6027;}&#xFF1A; &#x8BFB;&#x53D6;&#x5B9E;&#x4F53;&#x7C7B;&#x7684;&#x5C5E;&#x6027;</a></li><li><span class="title-icon "></span><a href="#&#x9700;&#x8981;&#x5728;&#x6D4B;&#x8BD5;&#x7C7B;&#x4E2D;&#x81EA;&#x5DF1;&#x5BB6;&#x7B49;&#x901A;&#x914D;&#x7B26;&#xFF0C;&#x50CF;preparedstatement-&#xFF0C;&#x53EF;&#x4EE5;&#x6709;&#x6548;&#x9632;&#x6B62;sql&#x6CE8;&#x5165;&#xFF0C;&#x5219;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;sql&#x6CE8;&#x5165;&#x6210;&#x529F;&#x3002;"><b></b>{} &#x9700;&#x8981;&#x5728;&#x6D4B;&#x8BD5;&#x7C7B;&#x4E2D;&#x81EA;&#x5DF1;&#x5BB6;%&#x7B49;&#x901A;&#x914D;&#x7B26;&#xFF0C;&#x50CF;PreparedStatement &#xFF0C;#{}&#x53EF;&#x4EE5;&#x6709;&#x6548;&#x9632;&#x6B62;sql&#x6CE8;&#x5165;&#xFF0C;${}&#x5219;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;sql&#x6CE8;&#x5165;&#x6210;&#x529F;&#x3002;</a></li><ul><ul><li><span class="title-icon "></span><a href="#&#x5B9E;&#x73B0;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x4E00;&#x5BF9;&#x4E00;&#x3001;&#x4E00;&#x5BF9;&#x591A;"><b></b>&#x5B9E;&#x73B0;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;(&#x4E00;&#x5BF9;&#x4E00;&#x3001;&#x4E00;&#x5BF9;&#x591A;)</a></li><li><span class="title-icon "></span><a href="#&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x539F;&#x7406;"><b></b>&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x539F;&#x7406;</a></li><li><span class="title-icon "></span><a href="#&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x6E90;&#x7801;&#x89E3;&#x6790;"><b></b>&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x6E90;&#x7801;&#x89E3;&#x6790;</a></li></ul><li><span class="title-icon "></span><a href="#&#x7F13;&#x5B58;"><b></b>&#x7F13;&#x5B58;</a></li><li><span class="title-icon "></span><a href="#&#x6CE8;&#x89E3;&#x5F00;&#x53D1;"><b></b>&#x6CE8;&#x89E3;&#x5F00;&#x53D1;</a></li><ul><li><span class="title-icon "></span><a href="#mybatis-&#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x5B9E;&#x73B0;&#x5355;&#x8868;-curd"><b></b>Mybatis &#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x5B9E;&#x73B0;&#x5355;&#x8868; CURD</a></li><li><span class="title-icon "></span><a href="#mybatis-&#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x5B9E;&#x73B0;&#x591A;&#x5BF9;&#x4E00;&#xFF08;&#x4E00;&#x5BF9;&#x4E00;&#xFF09;"><b></b>Mybatis &#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x5B9E;&#x73B0;&#x591A;&#x5BF9;&#x4E00;&#xFF08;&#x4E00;&#x5BF9;&#x4E00;&#xFF09;</a></li><li><span class="title-icon "></span><a href="#mybatis-&#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x5B9E;&#x73B0;&#x4E00;&#x5BF9;&#x591A;"><b></b>Mybatis &#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x5B9E;&#x73B0;&#x4E00;&#x5BF9;&#x591A;</a></li><li><span class="title-icon "></span><a href="#mybatis-&#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x5B9E;&#x73B0;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;"><b></b>Mybatis &#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x5B9E;&#x73B0;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;</a></li></ul><li><span class="title-icon "></span><a href="#mybatis&#x5206;&#x9875;&#x529F;&#x80FD;"><b></b>Mybatis&#x5206;&#x9875;&#x529F;&#x80FD;</a></li><li><span class="title-icon "></span><a href="#spring&#x4E0E;mybatis-&#x4E8B;&#x52A1;&#x7BA1;&#x7406;"><b></b>spring&#x4E0E;MyBatis &#x4E8B;&#x52A1;&#x7BA1;&#x7406;</a></li><li><span class="title-icon "></span><a href="#spring-&#x4E0E;-mybatis"><b></b>Spring &#x4E0E; MyBatis</a></li></ul></ul></div><h2 id="mybatis--&#x7684;&#x4F18;&#x7F3A;&#x70B9;"><a name="mybatis--&#x7684;&#x4F18;&#x7F3A;&#x70B9;" class="anchor-navigation-ex-anchor" href="#mybatis--&#x7684;&#x4F18;&#x7F3A;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>mybatis  &#x7684;&#x4F18;&#x7F3A;&#x70B9;</h2>
<p>MyBatis &#x907F;&#x514D;&#x4E86;&#x51E0;&#x4E4E;&#x6240;&#x6709;&#x7684; JDBC &#x4EE3;&#x7801;&#x548C;&#x624B;&#x52A8;&#x8BBE;&#x7F6E;&#x53C2;&#x6570;&#x4EE5;&#x53CA;&#x83B7;&#x53D6;&#x7ED3;&#x679C;&#x96C6;&#x3002;MyBatis &#x53EF;&#x4EE5;&#x5BF9;&#x914D;&#x7F6E;&#x548C;&#x539F;&#x751F;Map&#x4F7F;&#x7528;&#x7B80;&#x5355;&#x7684; XML &#x6216;&#x6CE8;&#x89E3;&#xFF08;&#x5B9E;&#x4F53;&#x548C;&#x6570;&#x636E;&#x5E93;&#x7684;&#x6620;&#x5C04;&#x53EF;&#x4EE5;&#x5728;XML&#x4E2D;&#x95F4;&#x4E2D;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#xFF09;&#xFF0C;&#x5C06;&#x63A5;&#x53E3;&#x548C; Java &#x7684; POJOs(Plain Old Java Objects,&#x666E;&#x901A;&#x7684; Java&#x5BF9;&#x8C61;)&#x6620;&#x5C04;&#x6210;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;&#x8BB0;&#x5F55;&#x3002;</p>
<p><strong>&#x4E00;&#x3001;MyBatis&#x6846;&#x67B6;&#x7684;&#x4F18;&#x70B9;&#xFF1A;</strong></p>
<p>&#x3000;&#x3000;1. &#x4E0E;JDBC&#x76F8;&#x6BD4;&#xFF0C;&#x51CF;&#x5C11;&#x4E86;50%&#x4EE5;&#x4E0A;&#x7684;&#x4EE3;&#x7801;&#x91CF;&#x3002;&#xFF08;Mybatis&#x4E2D;Connection&#x7684;commit&#x7B49;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x4E5F;&#x662F;jdbc&#x5B9E;&#x73B0;&#x7684;&#xFF09;</p>
<p>&#x3000;&#x3000;2. MyBatis&#x8BED;&#x6CD5;&#x8F83;&#x4E3A;&#x7B80;&#x5355;&#xFF0C;&#x5C0F;&#x5DE7;&#x5E76;&#x4E14;&#x7B80;&#x5355;&#x6613;&#x5B66;&#x3002;</p>
<p>&#x3000;&#x3000;3. sql&#x5B9E;&#x73B0;&#x7075;&#x6D3B;&#xFF0C;SQL&#x5199;&#x5728;XML&#x91CC;&#xFF0C;&#x4ECE;&#x7A0B;&#x5E8F;&#x4EE3;&#x7801;&#x4E2D;&#x5F7B;&#x5E95;&#x5206;&#x79BB;&#xFF0C;&#x964D;&#x4F4E;&#x8026;&#x5408;&#x5EA6;&#xFF0C;&#x4FBF;&#x4E8E;&#x7EDF;&#x4E00;&#x7BA1;&#x7406;&#x548C;&#x4F18;&#x5316;&#xFF0C;&#x53EF;&#x91CD;&#x7528;&#x3002;</p>
<p>&#x3000;&#x3000;<strong>4. &#x63D0;&#x4F9B;XML&#x6807;&#x7B7E;&#xFF0C;&#x652F;&#x6301;&#x7F16;&#x5199;&#x52A8;&#x6001;SQL&#x8BED;&#x53E5;&#xFF08;XML&#x4E2D;&#x4F7F;&#x7528;if, else&#xFF09;&#x3002;</strong></p>
<p>&#x3000;&#x3000;5. &#x63D0;&#x4F9B;&#x6620;&#x5C04;&#x6807;&#x7B7E;&#xFF0C;&#x652F;&#x6301;&#x5BF9;&#x8C61;&#x4E0E;<a href="http://lib.csdn.net/base/mysql" target="_blank">&#x6570;&#x636E;&#x5E93;</a>&#x7684;ORM&#x5B57;&#x6BB5;&#x5173;&#x7CFB;&#x6620;&#x5C04;&#xFF08;&#x5728;XML&#x4E2D;&#x914D;&#x7F6E;&#x6620;&#x5C04;&#x5173;&#x7CFB;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#xFF09;&#x3002;</p>
<p><strong>&#x4E8C;&#x3001;MyBatis&#x6846;&#x67B6;&#x7684;&#x7F3A;&#x70B9;&#xFF1A;</strong></p>
<p>&#x3000;&#x3000;<strong>1. SQL&#x8BED;&#x53E5;&#x7684;&#x7F16;&#x5199;&#x5DE5;&#x4F5C;&#x91CF;&#x8F83;&#x5927;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x5B57;&#x6BB5;&#x591A;&#x3001;&#x5173;&#x8054;&#x8868;&#x591A;&#x65F6;&#xFF0C;&#x66F4;&#x662F;&#x5982;&#x6B64;&#xFF0C;&#x5BF9;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x7F16;&#x5199;SQL&#x8BED;&#x53E5;&#x7684;&#x529F;&#x5E95;&#x6709;&#x4E00;&#x5B9A;&#x8981;&#x6C42;&#x3002;</strong></p>
<p>&#x3000;&#x3000;<strong>2. SQL&#x8BED;&#x53E5;&#x4F9D;&#x8D56;&#x4E8E;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x5BFC;&#x81F4;&#x6570;&#x636E;&#x5E93;&#x79FB;&#x690D;&#x6027;&#x5DEE;&#xFF0C;&#x4E0D;&#x80FD;&#x968F;&#x610F;&#x66F4;&#x6362;&#x6570;&#x636E;&#x5E93;&#x3002;</strong></p>
<h2 id="&#x5165;&#x95E8;&#x6848;&#x4F8B;"><a name="&#x5165;&#x95E8;&#x6848;&#x4F8B;" class="anchor-navigation-ex-anchor" href="#&#x5165;&#x95E8;&#x6848;&#x4F8B;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5165;&#x95E8;&#x6848;&#x4F8B;</h2>
<p><a href="F:\Typora&#x6570;&#x636E;&#x50A8;&#x5B58;\&#x6570;&#x636E;&#x5E93;\mybatis.assets\image-20200718213831059.png" data-lightbox="a09b6622-4f04-4757-abe7-7839d57a1b7a" data-title="image-20200718213831059" target="_blank"><img src="F:\Typora&#x6570;&#x636E;&#x50A8;&#x5B58;\&#x6570;&#x636E;&#x5E93;\mybatis.assets\image-20200718213831059.png" alt="image-20200718213831059"></a></p>
<ul>
<li>&#x5B9E;&#x4F53;&#x7C7B;&#x5C5E;&#x6027;&#x548C;&#x8868;&#x7684;&#x5217;&#x540D;&#x9700;&#x8981;&#x4FDD;&#x6301;&#x4E00;&#x81F4;&#x7684;&#x539F;&#x56E0;&#x662F;excutor&#x4E2D;&#x6267;&#x884C;&#x5B8C;sql&#x8BED;&#x53E5;&#x540E;&#x8FD4;&#x56DE;&#x7684;&#x5217;&#x540D;&#x9700;&#x8981;&#x548C;&#x4F60;&#x63A5;&#x6536;&#x7684;&#x5B9E;&#x4F53;&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#x4E00;&#x81F4;&#x624D;&#x80FD;&#x6210;&#x529F;&#x7ED9;&#x5B9E;&#x4F53;&#x7C7B;&#x8D4B;&#x503C;&#x3002;</li>
</ul>
<blockquote>
<ul>
<li><strong>&#x7531;&#x4E8E;&#x5728; Windows &#x73AF;&#x5883;&#x4E0B; MySQL &#x4E0D;&#x533A;&#x5206;&#x5927;&#x5C0F;&#xFF0C;&#x6240;&#x4EE5; <code>userName</code> &#x7B49;&#x540C; <code>username</code> &#xFF0C;&#x4E0D;&#x8FC7;&#x8981;&#x6CE8;&#x610F;&#x5728; Linux &#x73AF;&#x5883;&#x4E0B; MySQL &#x4E25;&#x683C;&#x533A;&#x522B;&#x5927;&#x5C0F;&#x5199;&#x3002;</strong></li>
<li><p><strong>&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x5B9E;&#x4F53;&#x7C7B;&#x5C5E;&#x6027;&#x540D;&#x4E0E;&#x6570;&#x636E;&#x5E93;&#x8868;&#x5217;&#x540D;&#x4E0D;&#x4E00;&#x81F4;&#xFF0C;&#x6709;&#x4EE5;&#x4E0B;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#xFF1A;</strong></p>
</li>
<li><p><strong>&#x5728; SQL &#x8BED;&#x53E5;&#x4E2D;&#x4E3A;&#x6240;&#x6709;&#x5217;&#x8D77;&#x522B;&#x540D;&#xFF0C;&#x4F7F;&#x522B;&#x540D;&#x4E0E;&#x5B9E;&#x4F53;&#x7C7B;&#x5C5E;&#x6027;&#x540D;&#x4E00;&#x81F4;&#xFF08;&#x6267;&#x884C;&#x6548;&#x7387;&#x76F8;&#x5BF9;&#x9AD8;&#xFF0C;&#x5F00;&#x53D1;&#x6548;&#x7387;&#x4F4E;&#xFF09;</strong></p>
</li>
</ul>
<pre class="language-"><code class="lang-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>listAllUsers<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.ykf.pojo.User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre>
<ol>
<li><strong>&#x4F7F;&#x7528; resultMap &#x5B8C;&#x6210;&#x7ED3;&#x679C;&#x96C6;&#x5230;&#x5B9E;&#x4F53;&#x7C7B;&#x7684;&#x6620;&#x5C04;&#xFF08;&#x6267;&#x884C;&#x6548;&#x7387;&#x76F8;&#x5BF9;&#x4F4E;&#xFF0C;&#x5F00;&#x53D1;&#x6548;&#x7387;&#x9AD8;&#xFF09;</strong><pre class="language-"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.ykf.mapper.UserMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
 <span class="token comment">&lt;!-- &#x914D;&#x7F6E; resultMap &#xFF0C;&#x5B8C;&#x6210;&#x5B9E;&#x4F53;&#x7C7B;&#x4E0E;&#x6570;&#x636E;&#x5E93;&#x8868;&#x7684;&#x6620;&#x5C04; --&gt;</span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userMap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.ykf.pojo.User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userBirthday<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>birthday<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userAddress<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>address<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userSex<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sex<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>
 <span class="token comment">&lt;!-- &#x914D;&#x7F6E;&#x67E5;&#x8BE2;&#x6240;&#x6709;&#x7528;&#x6237; --&gt;</span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>listAllUsers<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userMap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    SELECT * FROM user
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre></li>
</ol>
</blockquote>
<p><a href="F:\Typora&#x6570;&#x636E;&#x50A8;&#x5B58;\&#x6570;&#x636E;&#x5E93;\mybatis.assets\image-20200718222122318.png![image-20200719121634547](F:\Typora&#x6570;&#x636E;&#x50A8;&#x5B58;\&#x6570;&#x636E;&#x5E93;\mybatis.assets\image-20200719121634547.png" data-lightbox="d023956f-0bd4-4b94-9e9b-4b7af8ec98a8" data-title="image-20200718222122318" target="_blank"><img src="F:\Typora&#x6570;&#x636E;&#x50A8;&#x5B58;\&#x6570;&#x636E;&#x5E93;\mybatis.assets\image-20200718222122318.png![image-20200719121634547](F:\Typora&#x6570;&#x636E;&#x50A8;&#x5B58;\&#x6570;&#x636E;&#x5E93;\mybatis.assets\image-20200719121634547.png" alt="image-20200718222122318"></a></p>
<h5 id="&#x6240;&#x7528;&#x6A21;&#x5F0F;"><a name="&#x6240;&#x7528;&#x6A21;&#x5F0F;" class="anchor-navigation-ex-anchor" href="#&#x6240;&#x7528;&#x6A21;&#x5F0F;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6240;&#x7528;&#x6A21;&#x5F0F;</h5>
<p><a href="F:\Typora&#x6570;&#x636E;&#x50A8;&#x5B58;\&#x6570;&#x636E;&#x5E93;\mybatis.assets\image-20200719131042766.png" data-lightbox="dc4a10e8-3adc-48a7-ba4f-ce7b7701bdc0" data-title="image-20200719131042766" target="_blank"><img src="F:\Typora&#x6570;&#x636E;&#x50A8;&#x5B58;\&#x6570;&#x636E;&#x5E93;\mybatis.assets\image-20200719131042766.png" alt="image-20200719131042766"></a></p>
<p><strong>Mybatis &#x5728;&#x4F7F;&#x7528;&#x4EE3;&#x7406; Mapper &#x7684;&#x65B9;&#x5F0F;&#xFF08;session.getMapper(xxx.class)&#xFF09;&#x5B9E;&#x73B0;&#x589E;&#x5220;&#x67E5;&#x6539;&#x7684;&#x65F6;&#x5019;&#x53EA;&#x505A;&#x4E86;&#x4EE5;&#x4E0B;&#x4E24;&#x4EF6;&#x4E8B;&#xFF08;&#x5212;&#x91CD;&#x70B9;&#xFF09;</strong></p>
<ul>
<li>&#x521B;&#x5EFA;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;</li>
<li>&#x5728;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#x4E2D;&#x8C03;&#x7528; selectList</li>
</ul>
<p><a href="https://img-blog.csdnimg.cn/20200127102223857.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ExMDkyODgyNTgw,size_16,color_FFFFFF,t_70#pic_center" data-lightbox="ade007d8-6428-4ac9-9e0d-bca825c39135" data-title="img" target="_blank"><img src="https://img-blog.csdnimg.cn/20200127102223857.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ExMDkyODgyNTgw,size_16,color_FFFFFF,t_70#pic_center" alt="img"></a></p>
<h5 id="&#x81EA;&#x5B9A;&#x4E49;mybatis&#x6D41;&#x7A0B;"><a name="&#x81EA;&#x5B9A;&#x4E49;mybatis&#x6D41;&#x7A0B;" class="anchor-navigation-ex-anchor" href="#&#x81EA;&#x5B9A;&#x4E49;mybatis&#x6D41;&#x7A0B;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x81EA;&#x5B9A;&#x4E49;mybatis&#x6D41;&#x7A0B;</h5>
<ul>
<li><a href="https://blog.csdn.net/a1092882580/article/details/104086181" target="_blank">https://blog.csdn.net/a1092882580/article/details/104086181</a></li>
<li>day01_eesy_04mybatis</li>
</ul>
<p><a href="F:\Typora&#x6570;&#x636E;&#x50A8;&#x5B58;\&#x6570;&#x636E;&#x5E93;\mybatis.assets\image-20200720083531672.png" data-lightbox="b931452d-0a41-49d1-b31b-6652f206eea7" data-title="image-20200720083531672" target="_blank"><img src="F:\Typora&#x6570;&#x636E;&#x50A8;&#x5B58;\&#x6570;&#x636E;&#x5E93;\mybatis.assets\image-20200720083531672.png" alt="image-20200720083531672"></a></p>
<p><a href="F:\Typora&#x6570;&#x636E;&#x50A8;&#x5B58;\&#x6570;&#x636E;&#x5E93;\mybatis.assets\image-20200720083645169.png" data-lightbox="3a199e07-75e3-4ba1-b340-5eda02d86a8a" data-title="image-20200720083645169" target="_blank"><img src="F:\Typora&#x6570;&#x636E;&#x50A8;&#x5B58;\&#x6570;&#x636E;&#x5E93;\mybatis.assets\image-20200720083645169.png" alt="image-20200720083645169"></a></p>
<ul>
<li><p><strong>sqlsessionfactoryBuilder&#x7684;&#x4F5C;&#x7528;&#x662F;&#x5C06;xml&#x7684;&#x89E3;&#x6790;&#x90E8;&#x5206;&#x4E0E;factory&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x62FF;&#x51FA;&#x6765;&#xFF0C;&#x4FBF;&#x4E8E;xml&#x89E3;&#x6790;&#x5668;&#x7EF4;&#x62A4;&#x548C;&#x4F7F;&#x5F97;factory&#x522B;&#x592A;&#x81C3;&#x80BF;</strong></p>
</li>
<li><p>&#x7F16;&#x5199;&#x8BFB;&#x53D6;&#x914D;&#x7F6E;&#x6587;&#x4EF6;Resource&#x7C7B;&#xFF0C;&#x83B7;&#x5F97;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x5B57;&#x8282;&#x6D41;&#xFF08;XMLConfigBuilder&#x5F62;&#x53C2;&#xFF09;</p>
</li>
<li>&#x7F16;&#x5199;SqlsessionFactoryBuilder&#x7C7B;</li>
<li>&#x51C6;&#x5907;&#x5DE5;&#x5177;&#x7C7B;XMLConfigBuilder,&#x7528;&#x4E8E;&#x89E3;&#x6790;XML&#x6587;&#x4EF6;&#xFF08;SqlsessionfactoryBuilder&#x4F7F;&#x7528;&#xFF09;</li>
<li>&#x51C6;&#x5907;&#x81EA;&#x5B9A;&#x4E49;&#x6CE8;&#x89E3;&#x63A5;&#x53E3;&#x3001;&#x914D;&#x7F6E;&#x7C7B;Configuration&#x3001;&#x5C01;&#x88C5;Sql&#x8BED;&#x53E5;&#x548C;&#x7ED3;&#x679C;&#x7C7B;&#x578B;&#x7684;Mapper&#x7C7B;&#xFF08;XMLConfigBuilder&#x4FDD;&#x5B58;&#x89E3;&#x6790;&#x4FE1;&#x606F;&#xFF09;</li>
<li>&#x7F16;&#x5199;SqlsessionFactory&#x63A5;&#x53E3;&#x3001;&#x5B9E;&#x73B0;SqlsessionFacatory&#xFF08;SqlsessionFactoryBuilder&#x751F;&#x6210;&#x5BF9;&#x8C61;&#xFF09;</li>
<li>&#x7F16;&#x5199;Sqlsession&#x63A5;&#x53E3;&#xFF0C;&#x5B9E;&#x73B0;Sqlsession&#xFF08;SqlsessionFactory&#x751F;&#x6210;&#x5BF9;&#x8C61;&#xFF09;</li>
<li>&#x7F16;&#x5199;&#x94FE;&#x63A5;&#x6570;&#x636E;&#x5E93;&#x7684;&#x5DE5;&#x5177;&#x7C7B;DataSourceUtil&#xFF0C;&#x7F16;&#x5199;&#x4EE3;&#x7406;&#x7C7B;MapperProxy(Implements InvocationHandler&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x8C03;&#x7528;Executor&#x7684;selectList&#x65B9;&#x6CD5;)&#xFF08;sqlSession&#x7C7B;&#x4F7F;&#x7528;&#xFF09;</li>
<li>&#x7F16;&#x5199;Exector&#x7C7B;&#xFF0C;&#x7528;&#x4E8E;&#x6267;&#x884C;jdbc&#x64CD;&#x4F5C;&#xFF08;MapperProxy&#x4F7F;&#x7528;&#xFF09;</li>
</ul>
<h2 id="curd"><a name="curd" class="anchor-navigation-ex-anchor" href="#curd"><i class="fa fa-link" aria-hidden="true"></i></a>CURD</h2>
<ul>
<li><p>&#x83B7;&#x53D6;&#x53C2;&#x6570;&#x65F6;</p>
</li>
<li><p>parameterType = &quot;&#x4E0E;&#x8868;&#x5BF9;&#x5E94;&#x7684;&#x5B9E;&#x4F53;&#x7C7B;&quot;</p>
</li>
<li><h1 id="&#x5B9E;&#x4F53;&#x7C7B;&#x5C5E;&#x6027;&#xFF1A;-&#x8BFB;&#x53D6;&#x5B9E;&#x4F53;&#x7C7B;&#x7684;&#x5C5E;&#x6027;"><a name="&#x5B9E;&#x4F53;&#x7C7B;&#x5C5E;&#x6027;&#xFF1A;-&#x8BFB;&#x53D6;&#x5B9E;&#x4F53;&#x7C7B;&#x7684;&#x5C5E;&#x6027;" class="anchor-navigation-ex-anchor" href="#&#x5B9E;&#x4F53;&#x7C7B;&#x5C5E;&#x6027;&#xFF1A;-&#x8BFB;&#x53D6;&#x5B9E;&#x4F53;&#x7C7B;&#x7684;&#x5C5E;&#x6027;"><i class="fa fa-link" aria-hidden="true"></i></a>{&#x5B9E;&#x4F53;&#x7C7B;&#x5C5E;&#x6027;}&#xFF1A; &#x8BFB;&#x53D6;&#x5B9E;&#x4F53;&#x7C7B;&#x7684;&#x5C5E;&#x6027;</h1>
</li>
</ul>
<h4 id="&#x6A21;&#x7CCA;&#x67E5;&#x8BE2;"><a name="&#x6A21;&#x7CCA;&#x67E5;&#x8BE2;" class="anchor-navigation-ex-anchor" href="#&#x6A21;&#x7CCA;&#x67E5;&#x8BE2;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6A21;&#x7CCA;&#x67E5;&#x8BE2;</h4>
<ul>
<li><h1 id="&#x9700;&#x8981;&#x5728;&#x6D4B;&#x8BD5;&#x7C7B;&#x4E2D;&#x81EA;&#x5DF1;&#x5BB6;&#x7B49;&#x901A;&#x914D;&#x7B26;&#xFF0C;&#x50CF;preparedstatement-&#xFF0C;&#x53EF;&#x4EE5;&#x6709;&#x6548;&#x9632;&#x6B62;sql&#x6CE8;&#x5165;&#xFF0C;&#x5219;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;sql&#x6CE8;&#x5165;&#x6210;&#x529F;&#x3002;"><a name="&#x9700;&#x8981;&#x5728;&#x6D4B;&#x8BD5;&#x7C7B;&#x4E2D;&#x81EA;&#x5DF1;&#x5BB6;&#x7B49;&#x901A;&#x914D;&#x7B26;&#xFF0C;&#x50CF;preparedstatement-&#xFF0C;&#x53EF;&#x4EE5;&#x6709;&#x6548;&#x9632;&#x6B62;sql&#x6CE8;&#x5165;&#xFF0C;&#x5219;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;sql&#x6CE8;&#x5165;&#x6210;&#x529F;&#x3002;" class="anchor-navigation-ex-anchor" href="#&#x9700;&#x8981;&#x5728;&#x6D4B;&#x8BD5;&#x7C7B;&#x4E2D;&#x81EA;&#x5DF1;&#x5BB6;&#x7B49;&#x901A;&#x914D;&#x7B26;&#xFF0C;&#x50CF;preparedstatement-&#xFF0C;&#x53EF;&#x4EE5;&#x6709;&#x6548;&#x9632;&#x6B62;sql&#x6CE8;&#x5165;&#xFF0C;&#x5219;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;sql&#x6CE8;&#x5165;&#x6210;&#x529F;&#x3002;"><i class="fa fa-link" aria-hidden="true"></i></a>{} &#x9700;&#x8981;&#x5728;&#x6D4B;&#x8BD5;&#x7C7B;&#x4E2D;&#x81EA;&#x5DF1;&#x5BB6;%&#x7B49;&#x901A;&#x914D;&#x7B26;&#xFF0C;<strong>&#x50CF;PreparedStatement &#xFF0C;#{}&#x53EF;&#x4EE5;&#x6709;&#x6548;&#x9632;&#x6B62;sql&#x6CE8;&#x5165;&#xFF0C;${}&#x5219;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;sql&#x6CE8;&#x5165;&#x6210;&#x529F;&#x3002;</strong></h1>
<pre class="language-"><code>public void testListUsersByName() {
List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>User</span><span class="token punctuation">&gt;</span></span> users = mapper.listUsersByName(&quot;%&#x738B;%&quot;);
// &#x4F7F;&#x7528; Stream &#x6D41; + &#x65B9;&#x6CD5;&#x5F15;&#x7528;&#xFF0C;&#x9700;&#x8981;&#x81F3;&#x5C11;jdk8
users.forEach(System.out::println);
}
&#x7531;&#x4E8E;&#x6620;&#x5C04;&#x6587;&#x4EF6;&#x4E2D;&#x7684; SQL &#x8BED;&#x53E5;&#x5E76;&#x6CA1;&#x6709;&#x5BF9;&#x53C2;&#x6570;&#x8FDB;&#x884C;&#x6A21;&#x7CCA;&#x67E5;&#x8BE2;&#x5904;&#x7406;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x8C03;&#x7528;&#x65B9;&#x6CD5;&#x7684;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x624B;&#x52A8;&#x4E3A;&#x67E5;&#x8BE2;&#x7684;&#x5173;&#x952E;&#x5B57;&#x8FDB;&#x884C;%&#x62FC;&#x63A5;&#xFF0C;&#x8FD9;&#x6837;&#x5F88;&#x4E0D;&#x65B9;&#x4FBF;&#x3002;&#x5982;&#x679C;&#x60F3;&#x8C03;&#x7528;&#x65B9;&#x6CD5;&#x67E5;&#x8BE2;&#x65F6;&#xFF0C;&#x53EA;&#x4F20;&#x5165;&#x67E5;&#x8BE2;&#x7684;&#x5173;&#x952E;&#x5B57;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x91C7;&#x7528;&#x4EE5;&#x4E0B;&#x65B9;&#x6CD5; &#xFF1A;
SELECT * FROM user WHERE username LIKE concat(&apos;%&apos;,#{name},&apos;%&apos;);
SELECT * FROM user WHERE username LIKE &quot;%&quot;#{name}&quot;%&quot;&#xFF1B;
</code></pre></li>
</ul>
<p><a href="F:\Typora&#x6570;&#x636E;&#x50A8;&#x5B58;\&#x6570;&#x636E;&#x5E93;\mybatis.assets\image-20200720154032187.png" data-lightbox="f02b778f-3721-4a12-8ecf-cbd9b21ac514" data-title="image-20200720154032187" target="_blank"><img src="F:\Typora&#x6570;&#x636E;&#x50A8;&#x5B58;\&#x6570;&#x636E;&#x5E93;\mybatis.assets\image-20200720154032187.png" alt="image-20200720154032187"></a></p>
<h4 id="parametertype"><a name="parametertype" class="anchor-navigation-ex-anchor" href="#parametertype"><i class="fa fa-link" aria-hidden="true"></i></a>parameterType</h4>
<ul>
<li><p>&#x7B80;&#x5355;&#x5BF9;&#x8C61;</p>
</li>
<li><p>&#x4F20;&#x9012;pojo&#x5BF9;&#x8C61;</p>
<p>&#x9996;&#x5148;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B; OGNL &#x8868;&#x8FBE;&#x5F0F;
&#x5168;&#x79F0; Object Graphic Navigation Language &#xFF0C;&#x5373;&#x5BF9;&#x8C61;&#x56FE;&#x5BFC;&#x822A;&#x8BED;&#x8A00;</p>
<p>&#x5B83;&#x662F;&#x901A;&#x8FC7;&#x5BF9;&#x8C61;&#x7684;&#x53D6;&#x503C;&#x65B9;&#x6CD5;&#x6765;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x3002;&#x5728;&#x5199;&#x6CD5;&#x4E0A;&#x628A;get&#x7ED9;&#x7701;&#x7565;&#x4E86;&#x3002;</p>
</li>
<li><p>&#x4F20;&#x9012;pojo&#x5305;&#x88C5;&#x5BF9;&#x8C61;
&#x5728;&#x5F00;&#x53D1;&#x4E2D;&#x5982;&#x679C;&#x60F3;&#x5B9E;&#x73B0;&#x590D;&#x6742;&#x67E5;&#x8BE2; &#xFF0C;&#x67E5;&#x8BE2;&#x6761;&#x4EF6;&#x4E0D;&#x4EC5;&#x5305;&#x62EC;&#x7528;&#x6237;&#x67E5;&#x8BE2;&#x6761;&#x4EF6;&#xFF0C;&#x8FD8;&#x5305;&#x62EC;&#x5176;&#x5B83;&#x7684;&#x67E5;&#x8BE2;&#x6761;&#x4EF6;&#xFF08;&#x6BD4;&#x5982;&#x5C06;&#x7528;&#x6237;&#x8D2D;&#x4E70;&#x5546;&#x54C1;&#x4FE1;&#x606F;&#x4E5F;&#x4F5C;&#x4E3A;&#x67E5;&#x8BE2;&#x6761;&#x4EF6;&#xFF09;&#xFF0C;&#x8FD9;&#x65F6;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; pojo &#x5305;&#x88C5;&#x5BF9;&#x8C61;&#x4F20;&#x9012;&#x8F93;&#x5165;&#x53C2;&#x6570;&#xFF0C;&#x5373;&#x5C06;&#x591A;&#x4E2A;&#x9700;&#x8981;&#x64CD;&#x4F5C;&#x7684;&#x7C7B;&#x653E;&#x5230;&#x4E00;&#x4E2A;&#x603B;&#x4F53;&#x7C7B;&#x4E2D;</p>
</li>
</ul>
<h4 id="&#x5B9E;&#x4F53;&#x7C7B;&#x5C5E;&#x6027;&#x540D;&#x4E0E;&#x6570;&#x636E;&#x5E93;&#x8868;&#x5217;&#x540D;&#x4E0D;&#x4E00;&#x81F4;"><a name="&#x5B9E;&#x4F53;&#x7C7B;&#x5C5E;&#x6027;&#x540D;&#x4E0E;&#x6570;&#x636E;&#x5E93;&#x8868;&#x5217;&#x540D;&#x4E0D;&#x4E00;&#x81F4;" class="anchor-navigation-ex-anchor" href="#&#x5B9E;&#x4F53;&#x7C7B;&#x5C5E;&#x6027;&#x540D;&#x4E0E;&#x6570;&#x636E;&#x5E93;&#x8868;&#x5217;&#x540D;&#x4E0D;&#x4E00;&#x81F4;"><i class="fa fa-link" aria-hidden="true"></i></a><strong>&#x5B9E;&#x4F53;&#x7C7B;&#x5C5E;&#x6027;&#x540D;&#x4E0E;&#x6570;&#x636E;&#x5E93;&#x8868;&#x5217;&#x540D;&#x4E0D;&#x4E00;&#x81F4;</strong></h4>
<p><strong>&#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5B9E;&#x4F53;&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#x548C;&#x6570;&#x636E;&#x5E93;&#x8868;&#x7684;&#x5217;&#x540D;&#x5E76;&#x4E0D;&#x4E00;&#x81F4;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4F1A;&#x51FA;&#x73B0;&#x67E5;&#x8BE2;&#x7ED3;&#x679C;&#x65E0;&#x6CD5;&#x5C01;&#x88C5;&#x8FDB;&#x5B9E;&#x4F53;&#x7C7B;&#x3002;&#x56E0;&#x4E3A;select&#x7684;&#x8FD4;&#x56DE;&#x7684;&#x6570;&#x636E;&#x662F;&#x4F9D;&#x636E;&#x5217;&#x540D;&#x4E0E;&#x5B9E;&#x4F53;&#x7C7B;&#x5C5E;&#x6027;&#x7684;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#x8FDB;&#x884C;&#x8D4B;&#x503C;&#x7684;&#xFF0C;&#x5931;&#x8D25;&#x4FBF;&#x4E3A;&#x7A7A;&#xFF0C;&#x4FEE;&#x6539;&#x5B9E;&#x4F53;&#x7C7B;&#x8FDB;&#x884C;&#x6F14;&#x793A;</strong></p>
<p><a href="F:\Typora&#x6570;&#x636E;&#x50A8;&#x5B58;\&#x6570;&#x636E;&#x5E93;\mybatis.assets\image-20200720223047768.png" data-lightbox="ab73f303-0b13-48a3-ba59-20be396256a1" data-title="image-20200720223047768" target="_blank"><img src="F:\Typora&#x6570;&#x636E;&#x50A8;&#x5B58;\&#x6570;&#x636E;&#x5E93;\mybatis.assets\image-20200720223047768.png" alt="image-20200720223047768"></a></p>
<ol>
<li><strong>&#x5728; SQL &#x8BED;&#x53E5;&#x4E2D;&#x4E3A;&#x6240;&#x6709;&#x5217;&#x8D77;&#x522B;&#x540D;&#xFF0C;&#x4F7F;&#x522B;&#x540D;&#x4E0E;&#x5B9E;&#x4F53;&#x7C7B;&#x5C5E;&#x6027;&#x540D;&#x4E00;&#x81F4;&#xFF08;&#x6267;&#x884C;&#x6548;&#x7387;&#x76F8;&#x5BF9;&#x9AD8;&#xFF0C;&#x5F00;&#x53D1;&#x6548;&#x7387;&#x4F4E;&#xFF09;</strong></li>
</ol>
<pre class="language-"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>listAllUsers<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.ykf.pojo.User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    SELECT id AS userId, username AS userName, birthday AS userBirthday, sex AS userSex, address AS userAddress FROM user
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre><ol>
<li><strong>&#x4F7F;&#x7528; resultMap &#x5B8C;&#x6210;&#x7ED3;&#x679C;&#x96C6;&#x5230;&#x5B9E;&#x4F53;&#x7C7B;&#x7684;&#x6620;&#x5C04;&#xFF08;&#x6267;&#x884C;&#x6548;&#x7387;&#x76F8;&#x5BF9;&#x4F4E;&#xFF0C;&#x5F00;&#x53D1;&#x6548;&#x7387;&#x9AD8;&#xFF09;</strong></li>
</ol>
<pre class="language-"><code class="lang-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.ykf.mapper.UserMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- &#x914D;&#x7F6E; resultMap &#xFF0C;&#x5B8C;&#x6210;&#x5B9E;&#x4F53;&#x7C7B;&#x4E0E;&#x6570;&#x636E;&#x5E93;&#x8868;&#x7684;&#x6620;&#x5C04; --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userMap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.ykf.pojo.User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userBirthday<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>birthday<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userAddress<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>address<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userSex<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sex<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- &#x914D;&#x7F6E;&#x67E5;&#x8BE2;&#x6240;&#x6709;&#x7528;&#x6237; --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>listAllUsers<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userMap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
       SELECT * FROM user
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h4 id="&#x4F7F;&#x7528;dao&#x5B9E;&#x73B0;&#x7C7B;&#xFF08;&#x5212;&#x91CD;&#x70B9;-&#x5BF9;&#x6BD4;&#x6E90;&#x7801;&#xFF09;"><a name="&#x4F7F;&#x7528;dao&#x5B9E;&#x73B0;&#x7C7B;&#xFF08;&#x5212;&#x91CD;&#x70B9;-&#x5BF9;&#x6BD4;&#x6E90;&#x7801;&#xFF09;" class="anchor-navigation-ex-anchor" href="#&#x4F7F;&#x7528;dao&#x5B9E;&#x73B0;&#x7C7B;&#xFF08;&#x5212;&#x91CD;&#x70B9;-&#x5BF9;&#x6BD4;&#x6E90;&#x7801;&#xFF09;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4F7F;&#x7528;Dao&#x5B9E;&#x73B0;&#x7C7B;&#xFF08;&#x5212;&#x91CD;&#x70B9;-&gt;&#x5BF9;&#x6BD4;&#x6E90;&#x7801;&#xFF09;</h4>
<ul>
<li><strong>&#x82E5;&#x4F7F;&#x7528;sqlsession&#xFF08;defaultSqlSession&#xFF09;&#x7684;selectList&#x7B49;&#x65B9;&#x6CD5;&#xFF0C;&#x5C31;&#x662F;&#x5BF9;&#x4F20;&#x5165;&#x7684;&#x5355;&#x4E2A;&#x65B9;&#x6CD5;&#xFF08;&#x201C;statement&#x201D;&#xFF0C;arg&#xFF09;&#x8FDB;&#x884C;&#x76F8;&#x5E94;executor(CachingExecutor-&gt;SimpleExecutor(extends BaseExecutor))&#x64CD;&#x4F5C;</strong></li>
<li><strong>&#x63A5;&#x7740;&#x8FDB;&#x5165;&#x6267;&#x884C;SQL&#x8BED;&#x53E5;&#x5904;&#x7406;&#xFF08;MyBatis&#x5728;&#x7B2C;&#x4E00;&#x6B21;&#x6267;&#x884C;SQL&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x5728;&#x83B7;&#x53D6;Statement&#x65F6;&#xFF0C;&#x4F1A;&#x53BB;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x5E93;&#x94FE;&#x63A5;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x914D;&#x7F6E;&#x7684;&#x6570;&#x636E;&#x6E90;&#x4E3A;POOLED&#xFF0C;&#x8FD9;&#x91CC;&#x4F1A;&#x4F7F;&#x7528;PooledDataSource&#x6765;&#x83B7;&#x53D6;connection&#xFF09;&#xFF0C;statementHandler&#xFF08;RoutingStatementHandler-&gt;PreparedStatementHandler(extends BaseStatementHandler)&#xFF09;</strong></li>
<li><strong>&#x63A5;&#x7740;&#x5C01;&#x88C5;&#x5904;&#x7406;ResultSetHandler&#xFF08;DefaultResultSetHandler&#xFF09;&#xFF0C;&#x63A5;&#x7740;&#x8C03;&#x7528;excute&#x65B9;&#x6CD5;&#x8FDB;&#x884C;JDBC&#x7684;&#x64CD;&#x4F5C;&#x5E76;&#x8FDB;&#x884C;&#x5C01;&#x88C5;&#xFF0C;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x96C6;&#x3002;</strong></li>
</ul>
<h4 id="&#x4F7F;&#x7528;dao&#x4EE3;&#x7406;&#x7C7B;&#xFF08;&#x5212;&#x91CD;&#x70B9;-&#x5BF9;&#x6BD4;&#x6E90;&#x7801;&#x3001;&#x81EA;&#x5B9A;&#x4E49;mybatis&#xFF09;"><a name="&#x4F7F;&#x7528;dao&#x4EE3;&#x7406;&#x7C7B;&#xFF08;&#x5212;&#x91CD;&#x70B9;-&#x5BF9;&#x6BD4;&#x6E90;&#x7801;&#x3001;&#x81EA;&#x5B9A;&#x4E49;mybatis&#xFF09;" class="anchor-navigation-ex-anchor" href="#&#x4F7F;&#x7528;dao&#x4EE3;&#x7406;&#x7C7B;&#xFF08;&#x5212;&#x91CD;&#x70B9;-&#x5BF9;&#x6BD4;&#x6E90;&#x7801;&#x3001;&#x81EA;&#x5B9A;&#x4E49;mybatis&#xFF09;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4F7F;&#x7528;Dao&#x4EE3;&#x7406;&#x7C7B;&#xFF08;&#x5212;&#x91CD;&#x70B9;-&gt;&#x5BF9;&#x6BD4;&#x6E90;&#x7801;&#x3001;&#x81EA;&#x5B9A;&#x4E49;mybatis&#xFF09;</h4>
<ul>
<li><strong>&#x82E5;&#x662F;&#x7528;getmapper&#x5219;&#x662F;&#x4F1A;&#x5728;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#x8C03;&#x7528;&#x65B9;&#x6CD5;&#x65F6;&#x8C03;&#x7528;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x7684;proxyhadler&#x5BF9;&#x50CF;&#x4E2D;&#x7684;invoke&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x589E;&#x5F3A;&#xFF0C;&#x589E;&#x5F3A;&#x65F6;&#x5BF9;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x8FDB;&#x884C;switch case &#x9009;&#x62E9;&#xFF0C;&#x7EE7;&#x800C;&#x8C03;&#x7528;sqlsession&#x7684;&#x76F8;&#x5E94;CRUD&#x65B9;&#x6CD5;&#xFF08;&#x5373;&#x4E0A;&#x9762;&#x7684;&#x6D41;&#x7A0B;&#xFF09;&#xFF0C;&#x8FD4;&#x56DE;&#x4E86;&#x4E00;&#x4E2A;&#x6574;&#x4E2A;&#x589E;&#x5F3A;&#x7684;&#x4EE3;&#x7406;&#x7C7B;&#x5B9E;&#x4F8B;&#xFF0C;&#x518D;&#x8C03;&#x7528;&#x5B9E;&#x4F8B;&#x65B9;&#x6CD5;&#x65F6;&#x589E;&#x5F3A;&#x8FD4;&#x56DE;&#x589E;&#x5F3A;&#x540E;&#x7684;&#x7ED3;&#x679C;&#x96C6;&#x3002;</strong></li>
</ul>
<h4 id="propeties"><a name="propeties" class="anchor-navigation-ex-anchor" href="#propeties"><i class="fa fa-link" aria-hidden="true"></i></a>propeties</h4>
<ul>
<li><p>&#x5168;&#x5C40;&#x53D8;&#x91CF;</p>
<p>&#x7B2C;&#x4E00;&#x79CD;&#xFF0C;&#x91C7;&#x7528;&#x5168;&#x5C40;&#x7684;&#x5185;&#x90E8;&#x914D;&#x7F6E;&#x3002;&#x91C7;&#x7528;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x7684;&#x8BDD;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x914D;&#x7F6E;&#x591A;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x73AF;&#x5883;&#xFF0C;&#x90A3;&#x4E48;&#x50CF; username&#x3001;password &#x7B49;&#x5C5E;&#x6027;&#x5C31;&#x53EF;&#x4EE5;&#x590D;&#x7528;&#xFF0C;&#x63D0;&#x9AD8;&#x5F00;&#x53D1;&#x6548;&#x7387;&#x3002;</p>
<p>```xml
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</p>
<p>&lt;!DOCTYPE configuration</p>
<pre class="language-"><code>    PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;
    &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;
</code></pre><p><configuration></configuration></p>
<pre class="language-"><code><span class="token comment">&lt;!-- &#x5168;&#x5C40;&#x53D8;&#x91CF; --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>driver<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.mysql.jdbc.Driver<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>url<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc:mysql://localhost:3306/db_mybatis<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123456<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
</code></pre></li>
</ul>
<pre class="language-"><code>  <span class="token comment">&lt;!--&#x914D;&#x7F6E;&#x73AF;&#x5883;--&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environments</span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>development<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>development<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token comment">&lt;!-- &#x914D;&#x7F6E;&#x4E8B;&#x52A1;&#x7C7B;&#x578B; --&gt;</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transactionManager</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>JDBC<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
          <span class="token comment">&lt;!-- &#x914D;&#x7F6E;&#x6570;&#x636E;&#x6E90;&#xFF08;&#x8FDE;&#x63A5;&#x6C60;&#xFF09; --&gt;</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>POOLED<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>driver<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${driver}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>url<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${url}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${username}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${password}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environments</span><span class="token punctuation">&gt;</span></span>

  <span class="token comment">&lt;!-- &#x6307;&#x5B9A;&#x6620;&#x5C04;&#x6587;&#x4EF6; --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UserMapper.xml<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>  &lt;/configuration&gt;</p>
<pre class="language-"><code>


* resource&#xFF1A;

![image-20200720212414351](F:\Typora&#x6570;&#x636E;&#x50A8;&#x5B58;\&#x6570;&#x636E;&#x5E93;\mybatis.assets\image-20200720212414351.png)

* url

![image-20200720212823840](F:\Typora&#x6570;&#x636E;&#x50A8;&#x5B58;\&#x6570;&#x636E;&#x5E93;\mybatis.assets\image-20200720212823840.png)

#### typeAliases &#x6807;&#x7B7E;

&#x4E4B;&#x524D;&#x5728;&#x7F16;&#x5199;&#x6620;&#x5C04;&#x6587;&#x4EF6;&#x7684;&#x65F6;&#x5019;&#xFF0C; resultType &#x8FD9;&#x4E2A;&#x5C5E;&#x6027;&#x53EF;&#x4EE5;&#x5199; int&#x3001;INT &#x7B49;&#xFF0C;&#x5C31;&#x662F;&#x56E0;&#x4E3A; Mybatis &#x7ED9;&#x8FD9;&#x4E9B;&#x7C7B;&#x578B;&#x8D77;&#x4E86;&#x522B;&#x540D;&#x3002;Mybatis &#x5185;&#x7F6E;&#x7684;&#x522B;&#x540D;&#x5982;&#x8868;&#x683C;&#x6240;&#x793A;&#xFF1A;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>F:\Typora&#x6570;&#x636E;&#x50A8;&#x5B58;\&#x6570;&#x636E;&#x5E93;\mybatis.assets\image-20200720223623594.png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>image-20200720223623594<span class="token punctuation">&quot;</span></span>  <span class="token punctuation">/&gt;</span></span>
&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4E5F;&#x60F3;&#x7ED9;&#x67D0;&#x4E2A;&#x5B9E;&#x4F53;&#x7C7B;&#x6307;&#x5B9A;&#x522B;&#x540D;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x91C7;&#x7528; typeAliases &#x6807;&#x7B7E;&#x3002;&#x7528;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A;
</code></pre><configuration>
    <!--配置别名-->
    <typealiases>
        <typealias type="cn.ykf.pojo.User" alias="user">
    </typealias></typealiases>
    <!-- 其他配置省略... -->
</configuration>
```

typeAlias &#x5B50;&#x6807;&#x7B7E;&#x7528;&#x4E8E;&#x914D;&#x7F6E;&#x522B;&#x540D;&#x3002;&#x5176;&#x4E2D; type &#x5C5E;&#x6027;&#x7528;&#x4E8E;&#x6307;&#x5B9A;&#x8981;&#x914D;&#x7F6E;&#x7684;&#x7C7B;&#x7684;&#x5168;&#x9650;&#x5B9A;&#x7C7B;&#x540D;&#xFF08;&#x8BE5;&#x7C7B;&#x53EA;&#x80FD;&#x662F;&#x67D0;&#x4E2A;domain&#x5B9E;&#x4F53;&#x7C7B;&#xFF09;, alias &#x5C5E;&#x6027;&#x6307;&#x5B9A;&#x522B;&#x540D;&#x3002;&#x4E00;&#x65E6;&#x6307;&#x5B9A;&#x4E86;&#x522B;&#x540D;&#xFF0C;&#x90A3;&#x4E48;&#x522B;&#x540D;&#x5C31;&#x4E0D;&#x518D;&#x533A;&#x5206;&#x5927;&#x5C0F;&#x5199;&#x3002;
&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x6B64;&#x65F6;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x6620;&#x5C04;&#x6587;&#x4EF6;&#x4E2D;&#x8FD9;&#x6837;&#x5199; resultType=&quot;user&quot; &#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5199; resultType=&quot;USER&quot;&#x3002;
&#x5F53;&#x6211;&#x4EEC;&#x6709;&#x591A;&#x4E2A;&#x5B9E;&#x4F53;&#x7C7B;&#x9700;&#x8981;&#x8D77;&#x522B;&#x540D;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; package &#x6807;&#x7B7E;&#x3002;


&#x5F53;&#x6211;&#x4EEC;&#x6709;&#x591A;&#x4E2A;&#x5B9E;&#x4F53;&#x7C7B;&#x9700;&#x8981;&#x8D77;&#x522B;&#x540D;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; package &#x6807;&#x7B7E;&#x3002;

```
<typealiases><!--在configuration中使用-->
    <!-- 包下所有实体类起别名 -->
    <package name="cn.ykf.pojo">
</package></typealiases>
```

package &#x6807;&#x7B7E;&#x6307;&#x5B9A;&#x8981;&#x914D;&#x7F6E;&#x522B;&#x540D;&#x7684;&#x5305;&#xFF0C;&#x5F53;&#x6307;&#x5B9A;&#x4E4B;&#x540E;&#xFF0C;&#x8BE5;&#x5305;&#x4E0B;&#x7684;**&#x6240;&#x6709;&#x5B9E;&#x4F53;&#x7C7B;&#x90FD;&#x4F1A;&#x6CE8;&#x518C;&#x522B;&#x540D;**&#xFF0C;&#x5E76;&#x4E14;**&#x7C7B;&#x540D;&#x5C31;&#x662F;&#x522B;&#x540D;**&#xFF0C;&#x4E0D;&#x518D;&#x533A;&#x5206;&#x5927;&#x5C0F;&#x5199;
package &#x6807;&#x7B7E;&#x8FD8;&#x53EF;&#x4EE5;&#x5C06;**&#x67D0;&#x4E2A;&#x5305;&#x5185;&#x7684;&#x6620;&#x5C04;&#x5668;&#x63A5;&#x53E3;&#x5B9E;&#x73B0;&#x5168;&#x90E8;&#x6CE8;&#x518C;&#x4E3A;&#x6620;&#x5C04;&#x5668;**&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;

```
<!-- 指定映射文件 -->
<mappers>
    <package name="cn.ykf.mapper">
</package></mappers>
```

&#x8FD9;&#x6837;&#x914D;&#x7F6E;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x65E0;&#x9700;&#x4E00;&#x4E2A;&#x4E00;&#x4E2A;&#x5730;&#x914D;&#x7F6E; Mapper &#x63A5;&#x53E3;&#x4E86;&#x3002;&#x4E0D;&#x8FC7;&#xFF0C;**&#x8FD9;&#x79CD;&#x914D;&#x7F6E;&#x65B9;&#x5F0F;&#x7684;&#x524D;&#x63D0;&#x662F;&#x6620;&#x5C04;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4F4D;&#x7F6E;&#x5FC5;&#x987B;&#x548C;dao&#x63A5;&#x53E3;&#x7684;&#x5305;&#x7ED3;&#x6784;&#x76F8;&#x540C;**

&gt; * mapper&#x7684;recourse&#x52A0;&#x8F7D;&#xFF0C;&#x626B;&#x63CF;&#x6620;&#x5C04;&#x6587;&#x4EF6;&#x6765;&#x67E5;&#x627E;&#x63A5;&#x53E3;&#x7C7B;&#xFF0C;&#x6620;&#x5C04;&#x6587;&#x4EF6;&#x547D;&#x540D;&#x4E3A;**&#x63A5;&#x53E3;&#x5168;&#x7C7B;&#x540D;**&#xFF08;&#x63A5;&#x53E3;&#x7C7B;&#x540D;&#x53EF;&#x4EE5;&#x548C;&#x6620;&#x5C04;&#x6587;&#x4EF6;&#x540D;&#x4E0D;&#x540C;&#xFF0C;&#x56E0;&#x4E3A;&#x6620;&#x5C04;&#x6587;&#x4EF6;&#x6709;namespace&#xFF09;&#xFF0C;&#x4F46;&#x53EF;&#x4EE5;dao&#x63A5;&#x53E3;&#x548C;mapper&#x6587;&#x4EF6;&#x4E0D;&#x5728;&#x540C;&#x4E00;&#x8DEF;&#x5F84;&#x4E0B;,**mybatis&#x539F;&#x59CB;&#x5F00;&#x53D1;Dao.xml&#x6587;&#x4EF6;&#x4E0E;&#x63A5;&#x53E3;&#x6587;&#x4EF6;&#x4E0D;&#x5728;&#x540C;&#x4E00;&#x8DEF;&#x5F84;&#x4E0B;,&#x4EC5;&#x80FD;&#x7528;resource&#x52A0;&#x8F7D;&#x6620;&#x5C04;&#x6587;&#x4EF6;**
&gt; * mapper&#x7684;class&#x52A0;&#x8F7D;&#xFF0C;&#x4EC5;&#x9002;&#x7528;&#x4E8E;&#x7C7B;&#x8DEF;&#x5F84;&#x4E0B;,**&#x63A5;&#x53E3;&#x6587;&#x4EF6;&#x4E0E;&#x6620;&#x5C04;&#x6587;&#x4EF6;&#x5728;&#x540C;&#x4E00;&#x8DEF;&#x5F84;&#x4E0B;**,&#x4E14;**&#x63A5;&#x53E3;&#x540D;&#x4E0E;&#x6620;&#x5C04;&#x6587;&#x4EF6;&#x540D;&#x76F8;&#x540C;**&#x7684;&#x60C5;&#x51B5;.&#xFF08;&#x626B;&#x63CF;&#x63A5;&#x53E3;&#x7C7B;&#x6765;&#x67E5;&#x627E;&#x6620;&#x5C04;&#x6587;&#x4EF6;&#xFF0C;&#x6CE8;&#x89E3;&#x7684;&#x65F6;&#x5019;&#x7528;&#x7684;&#x591A;&#xFF09;
&gt; * package,&#x9002;&#x7528;&#x4E8E;&#x7C7B;&#x8DEF;&#x5F84;&#x4E0B;,&#x63A5;&#x53E3;&#x6587;&#x4EF6;&#x4E0E;&#x6620;&#x5C04;&#x6587;&#x4EF6;&#x5728;**&#x540C;&#x4E00;&#x8DEF;&#x5F84;**&#x4E0B;,&#x4E14;&#x63A5;&#x53E3;&#x540D;&#x4E0E;&#x6620;&#x5C04;**&#x6587;&#x4EF6;&#x540D;&#x76F8;&#x540C;**&#x7684;&#x60C5;&#x51B5;.(package &#x7684;&#x4F18;&#x52BF;&#x662F;&#x82E5;&#x5728;&#x540C;&#x4E00;&#x8DEF;&#x5F84;&#x4E14;&#x63A5;&#x53E3;&#x540D;&#x4E0E;&#x6620;&#x5C04;**&#x6587;&#x4EF6;&#x540D;&#x76F8;&#x540C;**&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x5B9A;&#x4F4D;&#x5230;&#x5305;&#x540D;&#x5C31;&#x884C;&#xFF0C;&#x4E0D;&#x8981;&#x5B9A;&#x4F4D;&#x5230;&#x6BCF;&#x4E2A;&#x7C7B;&#x540D;)
&gt;
&gt;
&gt; package&#x5B9A;&#x4F4D;&#x65F6;&#xFF0C;&#x82E5;&#x5305;&#x4E0D;&#x540C;&#x4E14;&#x5199;&#x7684;&#x4E3A;xml&#x6240;&#x5728;&#x7684;&#x5305;&#xFF0C;&#x4F1A;&#x62A5;Type interface com.itheima.dao.IUserDao is not known to the MapperRegistry.
&gt;
&gt; &#x82E5;&#x5199;&#x7684;&#x4E3A;&#x63A5;&#x53E3;&#x7684;&#x5305;&#xFF0C;&#x5219;&#x76F4;&#x63A5;&#x627E;&#x4E0D;&#x5230;statement
&gt;

&gt; Mybatis&#x4E2D;&#x63A5;&#x53E3;&#x548C;&#x5BF9;&#x5E94;&#x7684;mapper&#x6587;&#x4EF6;**&#x4E0D;&#x4E00;&#x5B9A;&#x8981;&#x653E;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x5305;&#x4E0B;**&#xFF0C;&#x653E;&#x5728;&#x4E00;&#x8D77;&#x7684;&#x76EE;&#x7684;&#x662F;&#x4E3A;&#x4E86;Mybatis&#x8FDB;&#x884C;&#x81EA;&#x52A8;&#x626B;&#x63CF;&#xFF0C;&#x5E76;&#x4E14;&#x8981;&#x6CE8;&#x610F;&#x6B64;&#x65F6;java&#x63A5;&#x53E3;&#x7C7B;&#x7684;&#x540D;&#x79F0;&#x548C;mapper&#x6587;&#x4EF6;&#x7684;&#x540D;&#x79F0;&#x8981;&#x76F8;&#x540C;&#xFF0C;&#x5426;&#x5219;&#x4F1A;&#x62A5;&#x5F02;&#x5E38;&#xFF0C;&#x7531;&#x4E8E;&#x6B64;&#x65F6;**Mybatis&#x4F1A;&#x81EA;&#x52A8;&#x89E3;&#x6790;&#x5BF9;&#x5E94;&#x7684;&#x63A5;&#x53E3;&#x548C;&#x76F8;&#x5E94;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;**&#xFF08;class&#x548C;package&#xFF09;&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x4E0D;&#x9700;&#x8981;&#x914D;&#x7F6E;mapper&#x6587;&#x4EF6;&#x7684;&#x4F4D;&#x7F6E;&#x4E86;&#x3002;**&#x56E0;&#x4E3A;&#x901A;&#x5E38;&#x7684;xml&#x6587;&#x4EF6;&#x7684;namespace&#x3001;id&#x9700;&#x8981;&#x5230;&#x63A5;&#x53E3;&#x7C7B;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x800C;&#x6B64;&#x65F6;mybatis&#x6700;&#x5148;&#x5F00;&#x59CB;&#x7684;&#x662F; XML&#x7684;&#x89E3;&#x6790;&#xFF0C;&#x82E5;&#x662F;&#x4E0D;&#x540C;&#x5305;&#xFF0C;config.xml&#x8C03;&#x7528;&#x7684;&#x5C06;&#x662F;mappers&#x4E2D;mapper&#x7684;&#x5305;&#xFF08;&#x548C;&#x63A5;&#x53E3;&#x7C7B;&#x4E0D;&#x5728;&#x540C;&#x4E00;&#x7EA7;&#xFF09;&#xFF0C;&#x5C1A;&#x672A;&#x5C06;&#x5176;&#x4ED6;&#x7684;&#x4E3A;&#x7528;&#x5230;&#x7684;&#x63A5;&#x53E3;&#x7C7B;&#x7684;&#x7ED3;&#x6784;&#x4FE1;&#x606F;&#x901A;&#x8FC7;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x52A0;&#x8F7D;&#x5230;JVM&#x7684;&#x65B9;&#x6CD5;&#x533A;&#x4E2D;&#xFF0C;&#x56E0;&#x6B64;&#x4F1A;&#x7F3A;&#x4E4F;&#x76F8;&#x5173;&#x7684;&#x4FE1;&#x606F;&#x7EC4;&#x6210;mappers&#x7684;&#x6210;&#x5458;&#x5BF9;&#x8C61;&#xFF0C;&#x8C03;&#x7528;&#x5931;&#x8D25;&#x5BFC;&#x81F4;&#x62A5;&#x9519;&#x3002;&#x800C;&#x82E5;&#x662F;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x5305;&#xFF0C;&#x7F16;&#x8BD1;&#x6210;.class&#x5230;target&#x5305;&#x4E2D;&#x65F6;&#xFF0C;recourse&#x548C;java&#x5305;&#x4F1A;&#x5408;&#x5E76;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x81EA;&#x52A8;&#x5BFB;&#x627E;&#x540C;&#x4E00;&#x7EA7;&#x4E2D;&#x662F;&#x5426;&#x6709;&#x5BF9;&#x5E94;&#x7684;&#x540C;&#x540D;&#x63A5;&#x53E3;&#x4FE1;&#x606F;&#xFF0C;&#x4FBF;&#x53EF;&#x7701;&#x53BB;&#x914D;&#x7F6E;&#x7684;&#x9EBB;&#x70E6;**&#xFF0C;resouce&#x4E0D;&#x7528;&#x53D7;&#x6B64;&#x62D8;&#x675F;&#x80AF;&#x5B9A;&#x989D;&#x5916;&#x8C03;&#x7528;&#x4E86;&#x522B;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x4F1A;&#x9020;&#x6210;&#x66F4;&#x591A;&#x7684;&#x8D44;&#x6E90;&#x6D6A;&#x8D39;&#xFF0C;&#x4E3A;&#x4E86;&#x7279;&#x6B8A;&#x9700;&#x6C42;&#x8BBE;&#x8BA1;&#x7684;&#x3002;
&gt;
&gt; 1. &#x63A5;&#x53E3;&#x548C;&#x6587;&#x4EF6;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x5305;&#x4E2D;
&gt;    1.1 &#x9ED8;&#x8BA4;maven&#x6784;&#x5EFA;
&gt;    &#x5982;&#x679C;&#x5728;&#x5DE5;&#x7A0B;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;maven&#x6784;&#x5EFA;&#x5DE5;&#x5177;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4F1A;&#x51FA;&#x73B0;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF1A;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x5728;&#x5178;&#x578B;&#x7684;maven&#x5DE5;&#x7A0B;&#x4E2D;&#xFF0C;&#x76EE;&#x5F55;&#x7ED3;&#x6784;&#x6709;&#xFF1A;src/main/java&#x548C;src/main/resources&#xFF0C;&#x524D;&#x8005;&#x662F;&#x7528;&#x6765;&#x5B58;&#x653E;java&#x6E90;&#x4EE3;&#x7801;&#x7684;&#xFF0C;&#x540E;&#x8005;&#x5219;&#x662F;&#x5B58;&#x653E;&#x4E00;&#x4E9B;&#x8D44;&#x6E90;&#x6587;&#x4EF6;&#xFF0C;&#x6BD4;&#x5982;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7B49;&#xFF0C;**&#x5728;&#x9ED8;&#x8BA4;&#x7684;&#x60C5;&#x51B5;&#x4E0B;maven&#x6253;&#x5305;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5BF9;&#x4E8E;src/main/java&#x76EE;&#x5F55;&#x53EA;&#x6253;&#x5305;&#x6E90;&#x4EE3;&#x7801;&#xFF0C;&#x800C;&#x4E0D;&#x4F1A;&#x6253;&#x5305;&#x5176;&#x4ED6;&#x6587;&#x4EF6;&#x3002;&#x6240;&#x4EE5;&#x6B64;&#x65F6;&#x5982;&#x679C;&#x628A;&#x5BF9;&#x5E94;&#x7684;mapper&#x6587;&#x4EF6;&#x653E;&#x5230;src/main/java&#x76EE;&#x5F55;&#x4E0B;&#x65F6;&#xFF0C;&#x4E0D;&#x4F1A;&#x6253;&#x5305;&#x5230;&#x6700;&#x7EC8;&#x7684;jar&#x6587;&#x4EF6;&#x5939;&#x4E2D;&#xFF0C;&#x4E5F;&#x4E0D;&#x4F1A;&#x8F93;&#x51FA;&#x5230;target&#x6587;&#x4EF6;&#x5939;&#x4E2D;&#xFF0C;**&#x7531;&#x4E8E;&#x5728;&#x8FDB;&#x884C;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x7684;&#x65F6;&#x5019;&#x6267;&#x884C;&#x7684;&#x662F;/target&#x76EE;&#x5F55;&#x4E0B;/test-classes&#x4E0B;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x6D4B;&#x8BD5;&#x7684;&#x65F6;&#x5019;&#x4E5F;&#x4E0D;&#x4F1A;&#x6210;&#x529F;&#x3002;
&gt;
&gt;    &#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x5728;maven&#x9ED8;&#x8BA4;&#x73AF;&#x5883;&#x4E0B;&#x6253;&#x5305;&#x65F6;&#xFF0C;Mybatis&#x7684;&#x63A5;&#x53E3;&#x548C;mapper&#x6587;&#x4EF6;&#x5728;&#x540C;&#x4E00;&#x5305;&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5C06;&#x63A5;&#x53E3;&#x6587;&#x4EF6;&#x653E;&#x5728;src/main/java&#x67D0;&#x4E2A;&#x5305;&#x4E2D;&#xFF0C;&#x800C;&#x5728;src/main/resources&#x76EE;&#x5F55;&#x4E2D;&#x5EFA;&#x7ACB;&#x540C;&#x6837;&#x7684;&#x5305;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x79CD;&#x7EA6;&#x5B9A;&#x4F18;&#x4E8E;&#x914D;&#x7F6E;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x8FD9;&#x6837;&#x5728;maven&#x6253;&#x5305;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x4F1A;&#x5C06;src/main/java&#x548C;src/main/resources&#x76F8;&#x540C;&#x5305;&#x4E0B;&#x7684;&#x6587;&#x4EF6;&#x5408;&#x5E76;&#x5230;&#x540C;&#x4E00;&#x5305;&#x4E2D;&#x3002;
&gt;
&gt;    &#x5728;&#x9ED8;&#x8BA4;maven&#x6253;&#x5305;&#x7684;&#x73AF;&#x5883;&#x4E0B;&#xFF0C;&#x4E0D;&#x8981;&#x5C06;&#x63A5;&#x53E3;&#x6587;&#x4EF6;&#x548C;mapper&#x6587;&#x4EF6;&#x5168;&#x90E8;&#x653E;&#x5230;src/main/java&#xFF0C;&#x8FD9;&#x6837;&#x4E5F;&#x4E0D;&#x4F1A;&#x628A;mapper&#x6587;&#x4EF6;&#x6253;&#x5305;&#x8FDB;&#x53BB;
&gt;
&gt; &#x7B80;&#x8981;&#x7684;&#x8FC7;&#x7A0B;&#x5982;&#x4E0B;&#xFF08;&#x4E0E;&#x5982;&#x4E0B;&#x7684;&#x4F8B;&#x5B50;&#x65E0;&#x5173;&#xFF09;&#xFF1A;
&gt;
&gt; ```
&gt; src/main/java
&gt;     edu.zju.mapper
&gt;        UserMapper.java
&gt; src/main/resources
&gt;     config.xml
&gt;     edu.zju.mapper
&gt;         UserMapper.xml
&gt; ```
&gt;
&gt; &#x5982;&#x4E0A;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x5728;maven&#x6253;&#x5305;&#x4E4B;&#x540E;&#x7684;&#x76EE;&#x5F55;&#x5982;&#x4E0B;&#xFF1A;
&gt;
&gt; ```
&gt; -src/main/java
&gt;     -config.xml
&gt;     -edu.zju.mapper
&gt;         -UserMapper.java
&gt;         -UserMapper.xml
&gt; ```
&gt;
&gt; 2.1 &#x66F4;&#x6539;maven&#x6784;&#x5EFA;&#x914D;&#x7F6E;
&gt;
&gt; &#x5982;&#x679C;&#x4E0D;&#x60F3;&#x5C06;&#x63A5;&#x53E3;&#x548C;mapper&#x6587;&#x4EF6;&#x5206;&#x522B;&#x653E;&#x5230;`src/main/java`&#x548C;`src/main/resources`&#x4E2D;&#xFF0C;&#x800C;&#x662F;&#x5168;&#x90E8;&#x653E;&#x5230;`src/main/java`&#xFF0C;&#x90A3;&#x4E48;&#x5728;&#x6784;&#x5EFA;&#x7684;&#x65F6;&#x5019;&#x9700;&#x8981;&#x6307;&#x5B9A;maven&#x6253;&#x5305;&#x9700;&#x8981;&#x5305;&#x62EC;xml&#x6587;&#x4EF6;&#xFF0C;&#x5177;&#x4F53;&#x914D;&#x7F6E;&#x5982;&#x4E0B;&#xFF1A;
&gt;
&gt; ```
&gt; <build>
&gt;     <resources>
&gt;         <resource>
&gt;             <directory>src/main/java</directory>
&gt;             <includes>
&gt;                 <include>**/*.xml</include>
&gt;             </includes>
&gt;             <filtering>false</filtering>
&gt;         </resource>
&gt;     </resources>
&gt; </build>
&gt; ```
&gt;
&gt; 

#### &#x52A8;&#x6001;SQL

###### if

```
<!-- 根据查询条件进行复合查询 -->
<select id="listUsersByCondition" parametertype="cn.ykf.pojo.User" resulttype="cn.ykf.pojo.User">
    SELECT * FROM user WHERE 1 = 1
    
        AND username LIKE CONCAT(&apos;%&apos;,#{username},&apos;%&apos;)
    
    
        AND sex = #{sex}
    
    
        AND address = #{address}
    
    
        AND birthday = #{birthday}
    
</select>
&#x8FD9;&#x91CC;&#x52A0;&#x4E0A; WHERE 1 =1 &#x662F;&#x9632;&#x6B62;&#x6240;&#x6709;&#x6761;&#x4EF6;&#x90FD;&#x4E3A;&#x7A7A;&#x65F6;&#x62FC;&#x63A5; SQL &#x8BED;&#x53E5;&#x51FA;&#x9519;&#x3002;&#x56E0;&#x4E3A;&#x4E0D;&#x52A0;&#x4E0A; 1 = 1 &#x8FD9;&#x4E2A;&#x6052;&#x7B49;&#x6761;&#x4EF6;&#x7684;&#x8BDD;&#xFF0C;&#x5982;&#x679C;&#x540E;&#x9762;&#x67E5;&#x8BE2;&#x6761;&#x4EF6;&#x90FD;&#x6CA1;&#x62FC;&#x63A5;&#x6210;&#x529F;&#xFF0C;&#x90A3;&#x4E48; SQL &#x8BED;&#x53E5;&#x6700;&#x540E;&#x4F1A;&#x5E26;&#x6709;&#x4E00;&#x4E2A; WHERE &#x5173;&#x952E;&#x5B57;&#x800C;&#x6CA1;&#x6709;&#x6761;&#x4EF6;&#xFF0C;&#x4E0D;&#x7B26;&#x5408; SQL &#x8BED;&#x6CD5;&#x3002;
<if></if> &#x6807;&#x7B7E;&#x4E2D; test &#x5C5E;&#x6027;&#x662F;&#x5FC5;&#x987B;&#x7684;&#xFF0C;&#x8868;&#x793A;&#x5224;&#x65AD;&#x7684;&#x6761;&#x4EF6;&#x3002;&#x5176;&#x4E2D;&#x6709;&#x51E0;&#x70B9;&#x9700;&#x8981;&#x6CE8;&#x610F;&#xFF1A;
&#x5982;&#x679C; test &#x6709;&#x591A;&#x4E2A;&#x6761;&#x4EF6;&#xFF0C;&#x90A3;&#x4E48;&#x5FC5;&#x987B;&#x4F7F;&#x7528; and &#x8FDB;&#x884C;&#x8FDE;&#x63A5;&#xFF0C;&#x800C;&#x4E0D;&#x80FD;&#x4F7F;&#x7528; Java &#x4E2D;&#x7684; &amp;&amp; &#x8FD0;&#x7B97;&#x7B26;,mybatis&#x81EA;&#x5DF1;&#x8BBE;&#x7ACB;&#x7684;&#xFF0C;&#x9700;&#x8981;&#x7B26;&#x5408;&#x4ED6;&#x7684;XML&#x89E3;&#x6790;&#x89C4;&#x5219;&#x3002;
test &#x4E2D;&#x7684;&#x53C2;&#x6570;&#x540D;&#x79F0;&#x5FC5;&#x987B;&#x4E0E;&#x5B9E;&#x4F53;&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#x4FDD;&#x6301;&#x4E00;&#x81F4;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x548C; #{&#x53C2;&#x6570;&#x7B26;&#x53F7;} &#x4FDD;&#x6301;&#x4E00;&#x81F4;&#x3002;
&#x5982;&#x679C;&#x5224;&#x65AD;&#x6761;&#x4EF6;&#x4E3A;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x90A3;&#x4E48;&#x9664;&#x4E86;&#x5224;&#x65AD;&#x662F;&#x5426;&#x4E3A; null &#x5916;&#xFF0C;&#x6700;&#x597D;&#x4E5F;&#x5224;&#x65AD;&#x4E00;&#x4E0B;&#x662F;&#x5426;&#x4E3A;&#x7A7A;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&apos;&apos; &#xFF0C;&#x9632;&#x6B62; SQL&#x8BED;&#x53E5;&#x5C06;&#x5176;&#x4F5C;&#x4E3A;&#x6761;&#x4EF6;&#x67E5;&#x8BE2;&#x3002;
```



###### where

```
<select id="listUsersByCondition" parametertype="cn.ykf.pojo.User" resulttype="cn.ykf.pojo.User">
    SELECT * FROM user
    
        
            AND username LIKE CONCAT(&apos;%&apos;,#{username},&apos;%&apos;)
        
        
            AND sex = #{sex}
        
        
            AND address = #{address}
        
        
            AND birthday = #{birthday}
        
    
</select>
&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#xFF0C;&#x76F8;&#x6BD4;&#x4E4B;&#x524D;&#x7684; SQL &#x8BED;&#x53E5;&#xFF0C;&#x6211;&#x4EEC;&#x5C11;&#x5199;&#x4E86; WHERE 1 = 1&#xFF0C;&#x800C;&#x662F;&#x4F7F;&#x7528; <where></where> &#x6807;&#x7B7E;&#x6765;&#x4EE3;&#x66FF;&#x5B83;&#x3002;
<where></where> &#x6807;&#x7B7E;&#x53EA;&#x4F1A;&#x5728;&#x81F3;&#x5C11;&#x6709;&#x4E00;&#x4E2A;&#x5B50;&#x5143;&#x7D20;&#x7684;&#x6761;&#x4EF6;&#x8FD4;&#x56DE; SQL &#x5B50;&#x53E5;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x624D;&#x53BB;&#x63D2;&#x5165; WHERE &#x5B50;&#x53E5;&#x3002;&#x800C;&#x4E14;&#xFF0C;&#x82E5;&#x8BED;&#x53E5;&#x7684;&#x5F00;&#x5934;&#x4E3A; AND &#x6216; OR&#xFF0C;<where></where> &#x6807;&#x7B7E;&#x4E5F;&#x4F1A;&#x5C06;&#x5B83;&#x4EEC;&#x53BB;&#x9664;&#x3002;
&#x7B80;&#x5355;&#x6765;&#x8BF4;&#xFF0C;&#x5C31;&#x662F;&#x8BE5;&#x6807;&#x7B7E;&#x53EF;&#x4EE5;&#x52A8;&#x6001;&#x6DFB;&#x52A0; WHERE &#x5173;&#x952E;&#x5B57;&#xFF0C;&#x5E76;&#x4E14;&#x5254;&#x9664;&#x6389; SQL &#x8BED;&#x53E5;&#x4E2D;&#x591A;&#x4F59;&#x7684; AND &#x6216;&#x8005; OR&#x3002;
```

###### foreach

&#x5047;&#x5982;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x6709;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x9700;&#x6C42;&#xFF0C;&#x5C31;&#x662F;&#x6839;&#x636E;&#x4E00;&#x4E2A; id &#x96C6;&#x5408;&#xFF0C;&#x6765;&#x67E5;&#x8BE2;&#x51FA; id &#x5728;&#x8BE5;&#x96C6;&#x5408;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x7528;&#x6237;&#xFF0C;&#x90A3;&#x4E48;&#x53C8;&#x8BE5;&#x600E;&#x4E48;&#x5B9E;&#x73B0;&#x5462;&#xFF1F;
&#x5982;&#x679C;&#x4F7F;&#x7528;&#x666E;&#x901A; SQL &#x8BED;&#x53E5;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E48;&#x67E5;&#x8BE2;&#x8BED;&#x53E5;&#x5E94;&#x8BE5;&#x8FD9;&#x6837;&#x5199;&#xFF1A;SELECT * FROM user WHERE id IN(41,42,43);
&#x56E0;&#x6B64;&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x4F7F;&#x7528;&#x52A8;&#x6001; SQL &#x6765;&#x5B8C;&#x6210;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5C31;&#x5E94;&#x8BE5;&#x8003;&#x8651;&#x5982;&#x4F55;&#x62FC;&#x63A5;&#x4E0A; id IN(41,42,43) &#x8FD9;&#x4E00;&#x4E32;&#x5185;&#x5BB9;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x7684; <foreach></foreach> &#x6807;&#x7B7E;&#x5C31;&#x51FA;&#x573A;&#x4E86;&#x3002;

**foreach&#x5143;&#x7D20;&#x7684;&#x5C5E;&#x6027;&#x4E3B;&#x8981;&#x6709; item&#xFF0C;index&#xFF0C;collection&#xFF0C;open&#xFF0C;separator&#xFF0C;close&#x3002;**

```
item&#x8868;&#x793A;&#x96C6;&#x5408;&#x4E2D;&#x6BCF;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x8FED;&#x4EE3;&#x65F6;&#x7684;&#x522B;&#x540D;&#xFF0C;
index&#x6307; &#x5B9A;&#x4E00;&#x4E2A;&#x540D;&#x5B57;&#xFF0C;&#x7528;&#x4E8E;&#x8868;&#x793A;&#x5728;&#x8FED;&#x4EE3;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x6BCF;&#x6B21;&#x8FED;&#x4EE3;&#x5230;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;
open&#x8868;&#x793A;&#x8BE5;&#x8BED;&#x53E5;&#x4EE5;&#x4EC0;&#x4E48;&#x5F00;&#x59CB;&#xFF0C;
separator&#x8868;&#x793A;&#x5728;&#x6BCF;&#x6B21;&#x8FDB;&#x884C;&#x8FED;&#x4EE3;&#x4E4B;&#x95F4;&#x4EE5;&#x4EC0;&#x4E48;&#x7B26;&#x53F7;&#x4F5C;&#x4E3A;&#x5206;&#x9694; &#x7B26;&#xFF0C;
close&#x8868;&#x793A;&#x4EE5;&#x4EC0;&#x4E48;&#x7ED3;&#x675F;&#x3002;12345
```

&#x5728;&#x4F7F;&#x7528;foreach&#x7684;&#x65F6;&#x5019;&#x6700;&#x5173;&#x952E;&#x7684;&#x4E5F;&#x662F;&#x6700;&#x5BB9;&#x6613;&#x51FA;&#x9519;&#x7684;&#x5C31;&#x662F;collection&#x5C5E;&#x6027;&#xFF0C;&#x8BE5;&#x5C5E;&#x6027;&#x662F;&#x5FC5;&#x987B;&#x6307;&#x5B9A;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x5728;&#x4E0D;&#x540C;&#x60C5;&#x51B5; &#x4E0B;&#xFF0C;&#x8BE5;&#x5C5E;&#x6027;&#x7684;&#x503C;&#x662F;&#x4E0D;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x4E3B;&#x8981;&#x6709;&#x4E00;&#x4E0B;3&#x79CD;&#x60C5;&#x51B5;&#xFF1A;

```
1. &#x5982;&#x679C;&#x4F20;&#x5165;&#x7684;&#x7684;&#x662F;&#x4E00;&#x4E2A;&#x666E;&#x901A;&#x5BF9;&#x8C61;&#xFF08;&#x6CA1;&#x6709;&#x7279;&#x6B8A;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF09;&#xFF0C;&#x800C;&#x8BE5;&#x7C7B;&#x4E2D;&#x6709;list&#x7B49;collection&#x5C5E;&#x6027;&#x7684;&#xFF0C;&#x9700;&#x8981;&#x7528;&#x5230;&#x8BE5;&#x5C5E;&#x6027;&#x5E76;&#x9700;&#x8981;foreach&#xFF0C;collection&#x5219;&#x4E3A;&#x5176;&#x4E2D;&#x5C5E;&#x6027;&#x7684;&#x503C;&#xFF0C;&#x5373;&#x7528;&#x7684;&#x4E3A;&#x5305;&#x88C5;&#x7C7B;Vo&#x65F6;&#x3002;
2. &#x5982;&#x679C;&#x4F20;&#x5165;&#x7684;&#x662F;&#x5355;&#x53C2;&#x6570;&#x4E14;&#x53C2;&#x6570;&#x7C7B;&#x578B;&#x662F;&#x4E00;&#x4E2A;List&#x7684;&#x65F6;&#x5019;&#xFF0C;collection&#x5C5E;&#x6027;&#x503C;&#x4E3A;list
3. &#x5982;&#x679C;&#x4F20;&#x5165;&#x7684;&#x662F;&#x5355;&#x53C2;&#x6570;&#x4E14;&#x53C2;&#x6570;&#x7C7B;&#x578B;&#x662F;&#x4E00;&#x4E2A;array&#x6570;&#x7EC4;&#x7684;&#x65F6;&#x5019;&#xFF0C;collection&#x7684;&#x5C5E;&#x6027;&#x503C;&#x4E3A;array
4. &#x5982;&#x679C;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;&#x662F;&#x591A;&#x4E2A;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x9700;&#x8981;&#x628A;&#x5B83;&#x4EEC;&#x5C01;&#x88C5;&#x6210;&#x4E00;&#x4E2A;Map&#x4E86;&#xFF0C;collection&#x7684;&#x5C5E;&#x6027;&#x503C;&#x4E3A;map&#x7684;key&#x5C5E;&#x6027;
```

```
<!-- 根据id集合查询用户 -->
<select id="listUsersByIds" parametertype="cn.ykf.pojo.QueryVo" resulttype="cn.ykf.pojo.User">
    SELECT * FROM user
    
        
            
                #{id}
            
        
    
</select>
<foreach></foreach> &#x6807;&#x7B7E;&#x7528;&#x4E8E;&#x904D;&#x5386;&#x96C6;&#x5408;&#xFF0C;&#x6BCF;&#x4E2A;&#x5C5E;&#x6027;&#x7684;&#x4F5C;&#x7528;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;
collection &#xFF1A; &#x4EE3;&#x8868;&#x8981;&#x904D;&#x5386;&#x7684;&#x96C6;&#x5408;&#x6216;&#x6570;&#x7EC4;&#xFF0C;&#x8FD9;&#x4E2A;&#x5C5E;&#x6027;&#x662F;&#x5FC5;&#x987B;&#x7684;&#x3002;&#x5982;&#x679C;&#x662F;&#x904D;&#x5386;&#x6570;&#x7EC4;&#xFF0C;&#x90A3;&#x4E48;&#x8BE5;&#x503C;&#x53EA;&#x80FD;&#x4E3A; array
open &#xFF1A; &#x4EE3;&#x8868;&#x8BED;&#x53E5;&#x7684;&#x5F00;&#x59CB;&#x90E8;&#x4EFD;&#x3002;
close &#xFF1A; &#x4EE3;&#x8868;&#x8BED;&#x53E5;&#x7684;&#x7ED3;&#x675F;&#x90E8;&#x4EFD;&#x3002;
item &#xFF1A; &#x4EE3;&#x8868;&#x904D;&#x5386;&#x96C6;&#x5408;&#x65F6;&#x7684;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x4E00;&#x4E2A;&#x4E34;&#x65F6;&#x53D8;&#x91CF;&#x3002;
separator &#xFF1A; &#x4EE3;&#x8868;&#x62FC;&#x63A5;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#x4E4B;&#x95F4;&#x7684;&#x5206;&#x9694;&#x7B26;&#x3002;
&#x4F60;&#x53EF;&#x4EE5;&#x5C06;&#x4EFB;&#x4F55;&#x53EF;&#x8FED;&#x4EE3;&#x5BF9;&#x8C61;&#xFF08;&#x5982; List&#x3001;Set &#x7B49;&#xFF09;&#x3001;Map &#x5BF9;&#x8C61;&#x6216;&#x8005;&#x6570;&#x7EC4;&#x5BF9;&#x8C61;&#x4F20;&#x9012;&#x7ED9; foreach &#x4F5C;&#x4E3A;&#x96C6;&#x5408;&#x53C2;&#x6570;&#x3002;&#x5F53;&#x4F7F;&#x7528;&#x53EF;&#x8FED;&#x4EE3;&#x5BF9;&#x8C61;&#x6216;&#x8005;&#x6570;&#x7EC4;&#x65F6;&#xFF0C;index &#x662F;&#x5F53;&#x524D;&#x8FED;&#x4EE3;&#x7684;&#x6B21;&#x6570;&#xFF0C;item &#x7684;&#x503C;&#x662F;&#x672C;&#x6B21;&#x8FED;&#x4EE3;&#x83B7;&#x53D6;&#x7684;&#x5143;&#x7D20;&#x3002;&#x5F53;&#x4F7F;&#x7528; Map &#x5BF9;&#x8C61;&#xFF08;&#x6216;&#x8005; Map.Entry &#x5BF9;&#x8C61;&#x7684;&#x96C6;&#x5408;&#xFF09;&#x65F6;&#xFF0C;index &#x662F;&#x952E;&#xFF0C;item &#x662F;&#x503C;&#x3002;
&#x6CE8;&#x610F;&#xFF0C;SQL &#x8BED;&#x53E5;&#x4E2D;&#x7684;&#x53C2;&#x6570;&#x7B26;&#x53F7; #{id} &#x5E94;&#x8BE5;&#x4E0E; item=&quot;id&quot; &#x4FDD;&#x6301;&#x4E00;&#x81F4;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;item &#x5C5E;&#x6027;&#x5982;&#x679C;&#x628A;&#x4E34;&#x65F6;&#x53D8;&#x91CF;&#x58F0;&#x660E;&#x4E3A; uid &#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E48;&#x4F7F;&#x7528;&#x65F6;&#x5C31;&#x5FC5;&#x987B;&#x5199;&#x6210; #{uid}&#x3002;
```

###### &#x5B9A;&#x4E49; SQL &#x7247;&#x6BB5;

- **&#x5728;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x6BCF;&#x6761; SQL &#x4E2D;&#x90FD;&#x7528;&#x5230;&#x4E86; `SELECT \* FROM user` &#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x628A;&#x8BE5;&#x8BED;&#x53E5;&#x5B9A;&#x4E49;&#x4E3A; SQL &#x7247;&#x6BB5;&#xFF0C;&#x4EE5;&#x4F9B;&#x590D;&#x7528;&#xFF0C;&#x51CF;&#x5C11;&#x5DE5;&#x4F5C;&#x91CF;&#x3002;**
- **&#x9996;&#x5148;&#x5728;&#x6620;&#x5C04;&#x6587;&#x4EF6;&#x4E2D;&#x5B9A;&#x4E49;&#x4EE3;&#x7801;&#x7247;&#x6BB5;**

```
<!-- 定义代码片段 -->
<sql id="defaultSql">
    SELECT * FROM user
</sql>

```
&#x63A5;&#x7740;&#x5C31;&#x53EF;&#x4EE5;&#x5728;&#x9700;&#x8981;&#x7684;&#x5730;&#x65B9;&#x5F15;&#x7528;&#x8BE5;&#x7247;&#x6BB5;&#x4E86;
```
<!-- 根据id集合查询用户 -->
<select id="listUsersByIds" parametertype="cn.ykf.pojo.QueryVo" resultmap="userMap">
    <!-- 引用代码片段 -->
    
    
        
            
                #{id}
            
        
    
</select>
```



## &#x8FDE;&#x63A5;&#x6C60;

&#x6211;&#x4EEC;&#x5728;&#x914D;&#x7F6E;&#x6570;&#x636E;&#x6E90;&#x7684;&#x65F6;&#x5019;&#x4E00;&#x822C;&#x90FD;==&#x5DF2;&#x7ECF;&#x914D;&#x7F6E;&#x597D;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x6C60;&#x7684;&#x53C2;&#x6570;==&#xFF0C;&#x7136;&#x540E;&#x6570;&#x636E;&#x6E90;&#x4F1A;&#x81EA;&#x52A8;&#x5E2E;&#x6211;&#x4EEC;&#x7EF4;&#x62A4;&#x8FD9;&#x4E9B;&#x3002;&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x5BF9;&#x5F00;&#x53D1;&#x8005;&#x800C;&#x8A00;&#x662F;&#x900F;&#x660E;&#x7684;&#x3002;

&#x5728; Mybatis &#x4E2D;&#xFF0C;&#x6570;&#x636E;&#x6E90; dataSource &#x5171;&#x6709;&#x4E09;&#x7C7B;&#xFF0C;&#x5206;&#x522B;&#x662F;&#xFF1A;
UNPOOLED &#xFF1A; &#x4E0D;&#x4F7F;&#x7528;&#x8FDE;&#x63A5;&#x6C60;&#x7684;&#x6570;&#x636E;&#x6E90;&#x3002;&#x91C7;&#x7528;&#x4F20;&#x7EDF;&#x7684; javax.sql.DataSource &#x89C4;&#x8303;&#x4E2D;&#x7684;&#x8FDE;&#x63A5;&#x6C60;&#xFF0C;Mybatis &#x4E2D;&#x6709;&#x9488;&#x5BF9;&#x89C4;&#x8303;&#x7684;&#x5B9E;&#x73B0;
POOLED &#xFF1A; &#x4F7F;&#x7528;&#x8FDE;&#x63A5;&#x6C60;&#x7684;&#x6570;&#x636E;&#x6E90;&#x3002;&#x91C7;&#x7528;&#x6C60;&#x7684;&#x601D;&#x60F3;
JNDI &#xFF1A; &#x4F7F;&#x7528; JNDI &#x5B9E;&#x73B0;&#x7684;&#x6570;&#x636E;&#x6E90;&#xFF0C;&#x91C7;&#x7528;&#x670D;&#x52A1;&#x5668;&#x63D0;&#x4F9B;&#x7684; JNDI &#x6280;&#x672F;&#x5B9E;&#x73B0;&#xFF0C;&#x6765;&#x83B7;&#x53D6; DataSource &#x5BF9;&#x8C61;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x670D;&#x52A1;&#x5668;&#x6240;&#x80FD;&#x62FF;&#x5230;&#x7684; DataSource &#x662F;&#x4E0D;&#x4E00;&#x6837;&#x7684;&#x3002;&#xFF08;&#x5982;&#x679C;&#x4E0D;&#x662F;web&#x6216;&#x8005;maven&#x7684;war&#x5DE5;&#x7A0B;&#xFF0C;&#x662F;&#x4E0D;&#x80FD;&#x4F7F;&#x7528;&#x7684;&#xFF0C;tomcat-dbcp&#x8FDE;&#x63A5;&#x6C60;&#xFF1A;**&#x56E0;&#x4E3A;&#x9700;&#x8981;&#x76F8;&#x5E94;&#x7684;&#x4EE3;&#x7801;&#x9700;&#x8981;&#x5728;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x624D;&#x80FD;&#x542F;&#x52A8;&#xFF0C;&#x8FDE;&#x63A5;&#x6C60;&#x8FDE;&#x63A5;&#x7684;&#x6570;&#x636E;&#x6E90;&#x662F;&#x90E8;&#x7F72;&#x5728;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x7684;&#xFF0C;&#x5982;tomcat&#x4F60;&#x53EF;&#x4EE5;&#x5728;servlet&#x6216;&#x8005;jsp&#xFF08;&#x6700;&#x7EC8;&#x8FD8;&#x662F;&#x4F1A;&#x8F6C;&#x6362;&#x6210;servlet&#xFF09;&#x4E0A;&#x8FDB;&#x884C;sqlsession&#x7684;&#x521B;&#x5EFA;&#x624D;&#x80FD;&#x5728;jndi&#x4E0A;getConnection&#x5230;&#x76F8;&#x5E94;&#x7684;connection&#xFF0C;&#x901A;&#x8FC7;&#x6D4F;&#x89C8;&#x5668;&#x6216;&#x5BA2;&#x6237;&#x7AEF;&#x5BF9;&#x670D;&#x52A1;&#x5668;&#x7684;&#x8BBF;&#x95EE;&#x8C03;&#x7528;&#x4E86;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x90E8;&#x7F72;&#x7684;&#x6709;&#x76F8;&#x5E94;&#x9700;&#x8981;&#x8FDE;&#x63A5;&#x6570;&#x636E;&#x5E93;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x624D;&#x80FD;&#x8C03;&#x7528;&#x670D;&#x52A1;&#x5668;&#x8FDE;&#x63A5;&#x7684;&#x6570;&#x636E;&#x5E93;&#x6E90;**&#xFF09;

&gt; &#x8FDE;&#x63A5;&#x6C60;&#x548C;&#x7EBF;&#x7A0B;&#x6C60;&#xFF1A;
&gt;
&gt; &#x8FDE;&#x63A5;&#x6C60;&#xFF1A;&#xFF08;&#x964D;&#x4F4E;&#x7269;&#x7406;&#x8FDE;&#x63A5;&#x635F;&#x8017;&#xFF09;
&gt; 1&#x3001;&#x8FDE;&#x63A5;&#x6C60;&#x662F;&#x9762;&#x5411;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x7684;
&gt; 2&#x3001;&#x8FDE;&#x63A5;&#x6C60;&#x662F;&#x4E3A;&#x4E86;&#x4F18;&#x5316;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x8D44;&#x6E90;
&gt; 3&#x3001;&#x8FDE;&#x63A5;&#x6C60;&#x6709;&#x70B9;&#x7C7B;&#x4F3C;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x505A;&#x4F18;&#x5316;
&gt;
&gt; &#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x662F;&#x4E00;&#x9879;&#x6709;&#x9650;&#x7684;&#x6602;&#x8D35;&#x8D44;&#x6E90;&#xFF0C;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x5BF9;&#x8C61;&#x5747;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;&#x7269;&#x7406;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#xFF0C;&#x6BCF;&#x6B21;&#x64CD;&#x4F5C;&#x90FD;&#x6253;&#x5F00;&#x4E00;&#x4E2A;&#x7269;&#x7406;&#x8FDE;&#x63A5;&#xFF0C;&#x4F7F;&#x7528;&#x5B8C;&#x90FD;&#x5173;&#x95ED;&#x8FDE;&#x63A5;&#xFF0C;&#x8FD9;&#x6837;&#x9020;&#x6210;&#x7CFB;&#x7EDF;&#x7684;&#x6027;&#x80FD;&#x4F4E;&#x4E0B;&#x3002; &#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x6C60;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x662F;&#x5728;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x542F;&#x52A8;&#x65F6;&#x5EFA;&#x7ACB;&#x8DB3;&#x591F;&#x7684;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#xFF0C;&#x5E76;&#x5C06;&#x8FD9;&#x4E9B;&#x8FDE;&#x63A5;&#x7EC4;&#x6210;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x6C60;&#xFF0C;&#x7531;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x52A8;&#x6001;&#x5730;&#x5BF9;&#x6C60;&#x4E2D;&#x7684;&#x8FDE;&#x63A5;&#x8FDB;&#x884C;&#x7533;&#x8BF7;&#x3001;&#x4F7F;&#x7528;&#x548C;&#x91CA;&#x653E;&#x3002;**&#x5BF9;&#x4E8E;&#x591A;&#x4E8E;&#x8FDE;&#x63A5;&#x6C60;&#x4E2D;&#x8FDE;&#x63A5;&#x6570;&#x7684;&#x5E76;&#x53D1;&#x8BF7;&#x6C42;&#xFF0C;&#x5E94;&#x8BE5;&#x5728;&#x8BF7;&#x6C42;&#x961F;&#x5217;&#x4E2D;&#x6392;&#x961F;&#x7B49;&#x5F85;&#x3002;&#x5E76;&#x4E14;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x6C60;&#x4E2D;&#x8FDE;&#x63A5;&#x7684;&#x4F7F;&#x7528;&#x7387;&#xFF0C;&#x52A8;&#x6001;&#x589E;&#x52A0;&#x6216;&#x51CF;&#x5C11;&#x6C60;&#x4E2D;&#x7684;&#x8FDE;&#x63A5;&#x6570;**&#x3002; 
&gt;
&gt; &#x7EBF;&#x7A0B;&#x6C60;&#xFF1A;&#xFF08;&#x964D;&#x4F4E;&#x7EBF;&#x7A0B;&#x521B;&#x5EFA;&#x9500;&#x6BC1;&#x635F;&#x8017;&#xFF09;
&gt; 1.&#x3001;&#x7EBF;&#x7A0B;&#x6C60;&#x662F;&#x9762;&#x5411;&#x540E;&#x53F0;&#x7A0B;&#x5E8F;&#x7684;
&gt; 2&#x3001;&#x7EBF;&#x7A0B;&#x6C60;&#x662F;&#x662F;&#x4E3A;&#x4E86;&#x63D0;&#x9AD8;&#x5185;&#x5B58;&#x548C;CPU&#x6548;&#x7387;
&gt; 3&#x3001;&#x7EBF;&#x7A0B;&#x6C60;&#x6709;&#x70B9;&#x7C7B;&#x4F3C;&#x4E8E;&#x5728;&#x670D;&#x52A1;&#x7AEF;&#x505A;&#x4F18;&#x5316;
&gt;
&gt; &#x7EBF;&#x7A0B;&#x6C60;&#x662F;&#x4E00;&#x6B21;&#x6027;&#x521B;&#x5EFA;&#x4E00;&#x5B9A;&#x6570;&#x91CF;&#x7684;&#x7EBF;&#x7A0B;&#xFF08;&#x5E94;&#x8BE5;&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#x521D;&#x59CB;&#x7EBF;&#x7A0B;&#x6570;&#x91CF;&#x7684;&#xFF09;&#xFF0C;&#x5F53;&#x7528;&#x8BF7;&#x6C42;&#x8FC7;&#x6765;&#x4E0D;&#x7528;&#x53BB;&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x5DF2;&#x521B;&#x5EFA;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x4F7F;&#x7528;&#x540E;&#x53C8;&#x653E;&#x56DE;&#x5230;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x3002;
&gt; &#x907F;&#x514D;&#x4E86;&#x9891;&#x7E41;&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#xFF0C;&#x53CA;&#x9500;&#x6BC1;&#x7EBF;&#x7A0B;&#x7684;&#x7CFB;&#x7EDF;&#x5F00;&#x9500;&#xFF0C;&#x63D0;&#x9AD8;&#x662F;&#x5185;&#x5B58;&#x548C;CPU&#x6548;&#x7387;&#x3002;
&gt;
&gt; &#x76F8;&#x540C;&#x70B9;&#xFF1A;
&gt; &#x90FD;&#x662F;&#x4E8B;&#x5148;&#x51C6;&#x5907;&#x597D;&#x8D44;&#x6E90;&#xFF0C;&#x907F;&#x514D;&#x9891;&#x7E41;&#x521B;&#x5EFA;&#x548C;&#x9500;&#x6BC1;&#x7684;&#x4EE3;&#x4EF7;&#x3002;
&gt;
&gt; &#x6269;&#x5C55;&#xFF1A;
&gt; &#x5BF9;&#x8C61;&#x6C60;&#xFF1A;
&gt; &#x5BF9;&#x8C61;&#x6C60;&#x6280;&#x672F;&#x57FA;&#x672C;&#x539F;&#x7406;&#x7684;&#x6838;&#x5FC3;&#x6709;&#x4E24;&#x70B9;&#xFF1A;&#x7F13;&#x5B58;&#x548C;&#x5171;&#x4EAB;&#xFF0C;&#x5373;&#x5BF9;&#x4E8E;&#x90A3;&#x4E9B;&#x88AB;&#x9891;&#x7E41;&#x4F7F;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x5728;&#x4F7F;&#x7528;&#x5B8C;&#x540E;&#xFF0C;&#x4E0D;&#x7ACB;&#x5373;&#x5C06;&#x5B83;&#x4EEC;&#x91CA;&#x653E;&#xFF0C;&#x800C;&#x662F;&#x5C06;&#x5B83;&#x4EEC;&#x7F13;&#x5B58;&#x8D77;&#x6765;&#xFF0C;&#x4EE5;&#x4F9B;&#x540E;&#x7EED;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x91CD;&#x590D;&#x4F7F;&#x7528;&#xFF0C;&#x4ECE;&#x800C;&#x51CF;&#x5C11;&#x521B;&#x5EFA;&#x5BF9;&#x8C61;&#x548C;&#x91CA;&#x653E;&#x5BF9;&#x8C61;&#x7684;&#x6B21;&#x6570;&#xFF0C;&#x8FDB;&#x800C;&#x6539;&#x5584;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x6027;&#x80FD;&#x3002;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;&#x7531;&#x4E8E;&#x5BF9;&#x8C61;&#x6C60;&#x6280;&#x672F;&#x5C06;&#x5BF9;&#x8C61;&#x9650;&#x5236;&#x5728;&#x4E00;&#x5B9A;&#x7684;&#x6570;&#x91CF;&#xFF0C;&#x4E5F;&#x6709;&#x6548;&#x5730;&#x51CF;&#x5C11;&#x4E86;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5185;&#x5B58;&#x4E0A;&#x7684;&#x5F00;&#x9500;&#x3002;
&gt;
&gt; &#x5BF9;&#x4E8E;&#x4E24;&#x8005;&#x662F;&#x5426;&#x6709;&#x8054;&#x7CFB;&#xFF1A;
&gt;
&gt; 1. &#x9996;&#x5148;&#xFF0C;&#x6BCF;&#x4E2A;&#x8FDE;&#x63A5;&#x8981;&#x542F;&#x52A8;&#xFF0C;&#x90FD;&#x9700;&#x8981;&#x4F9D;&#x8D56;&#x4E8E;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x7684;&#x8C03;&#x7528;&#xFF0C;&#x5426;&#x5219;&#xFF0C;&#x5373;&#x4F7F;&#x8FDE;&#x63A5;&#x5728;&#x8FDE;&#x63A5;&#x6C60;&#x91CC;&#xFF0C;&#x6CA1;&#x6709;&#x65AD;&#x5F00;&#x8FDE;&#x63A5;&#xFF0C;&#x4E5F;&#x65E0;&#x6CD5;&#x505A;&#x51FA;&#x884C;&#x4E3A;
&gt; 2. &#x5F53;&#x7EBF;&#x7A0B;&#x4F7F;&#x7528;&#x5B8C;&#x65F6;&#xFF0C;&#x4F1A;&#x5C06;&#x8FDE;&#x63A5;&#x4E0E;&#x7EBF;&#x7A0B;&#x89E3;&#x7ED1;&#x4EA4;&#x8FD8;&#x4E8E;&#x8FDE;&#x63A5;&#x6C60;
&gt; 3. &#x4E00;&#x822C;&#x4F1A;&#x662F;&#x591A;&#x4E2A;&#x8FDE;&#x63A5;&#x5E76;&#x53D1;&#x6267;&#x884C;&#xFF0C;&#x5373;&#x9700;&#x8981;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#xFF0C;&#x56E0;&#x6B64;&#x524D;&#x9762;&#x4E5F;&#x6709;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x7BA1;&#x7406;
&gt; 4. &#x6BCF;&#x4E2A;&#x8FDE;&#x63A5;&#x90FD;&#x662F;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x7684;&#xFF0C;&#x7528;synchronized&#x9501;&#x4F4F;
&gt;
&gt; ```
&gt; while(conn == null) {
&gt;     synchronized(this.state) {
&gt;         PoolState var10000;
&gt;         if (!this.state.idleConnections.isEmpty()) {
&gt;             conn = (PooledConnection)this.state.idleConnections.remove(0);
&gt;             if (log.isDebugEnabled()) {
&gt;                 log.debug(&quot;Checked out connection &quot; + conn.getRealHashCode() + &quot; from pool.&quot;);
&gt;             }
&gt;         } else if (this.state.activeConnections.size() &lt; this.poolMaximumActiveConnections) {
&gt;             conn = new PooledConnection(this.dataSource.getConnection(), this);
&gt;             if (log.isDebugEnabled()) {
&gt;                 log.debug(&quot;Created connection &quot; + conn.getRealHashCode() + &quot;.&quot;);
&gt;             }
&gt;         } else {
&gt;             PooledConnection oldestActiveConnection = (PooledConnection)this.state.activeConnections.get(0);
&gt;             long longestCheckoutTime = oldestActiveConnection.getCheckoutTime();
&gt;             if (longestCheckoutTime &gt; (long)this.poolMaximumCheckoutTime) {
&gt;                 ++this.state.claimedOverdueConnectionCount;
&gt;                 var10000 = this.state;
&gt;                 var10000.accumulatedCheckoutTimeOfOverdueConnections += longestCheckoutTime;
&gt;                 var10000 = this.state;
&gt;                 var10000.accumulatedCheckoutTime += longestCheckoutTime;
&gt;                 this.state.activeConnections.remove(oldestActiveConnection);
&gt;                 if (!oldestActiveConnection.getRealConnection().getAutoCommit()) {
&gt;                     try {
&gt;                         oldestActiveConnection.getRealConnection().rollback();
&gt;                     } catch (SQLException var16) {
&gt;                         log.debug(&quot;Bad connection. Could not roll back&quot;);
&gt;                     }
&gt;                 }
&gt; 
&gt;                 conn = new PooledConnection(oldestActiveConnection.getRealConnection(), this);
&gt;                 conn.setCreatedTimestamp(oldestActiveConnection.getCreatedTimestamp());
&gt;                 conn.setLastUsedTimestamp(oldestActiveConnection.getLastUsedTimestamp());
&gt;                 oldestActiveConnection.invalidate();
&gt;                 if (log.isDebugEnabled()) {
&gt;                     log.debug(&quot;Claimed overdue connection &quot; + conn.getRealHashCode() + &quot;.&quot;);
&gt;                 }
&gt;             } else {
&gt;                 try {
&gt;                     if (!countedWait) {
&gt;                         ++this.state.hadToWaitCount;
&gt;                         countedWait = true;
&gt;                     }
&gt; 
&gt;                     if (log.isDebugEnabled()) {
&gt;                         log.debug(&quot;Waiting as long as &quot; + this.poolTimeToWait + &quot; milliseconds for connection.&quot;);
&gt;                     }
&gt; 
&gt;                     long wt = System.currentTimeMillis();
&gt;                     this.state.wait((long)this.poolTimeToWait);
&gt;                     var10000 = this.state;
&gt;                     var10000.accumulatedWaitTime += System.currentTimeMillis() - wt;
&gt;                 } catch (InterruptedException var17) {
&gt;                     break;
&gt;                 }
&gt;             }
&gt;         }
&gt; ```

- **&#x5982;&#x679C;&#x60F3;&#x8981;&#x4FEE;&#x6539; Mybatis &#x4F7F;&#x7528;&#x7684;&#x6570;&#x636E;&#x6E90;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x53EF;&#x4EE5;&#x5728; Mybatis &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x4FEE;&#x6539;&#xFF1A;**&#xFF08;&#x8FD9;&#x91CC; `type` &#x5C5E;&#x6027;&#x7684;&#x53D6;&#x503C;&#x5C31;&#x662F;&#x4E3A;`POOLED&#x3001;UNPOOLED&#x3001;JNDI` &#x3002;&#xFF09;

```
<!-- 配置数据源（连接池） -->
<datasource type="POOLED">
    <property name="driver" value="${jdbc.driver}">
    <property name="url" value="${jdbc.url}">
    <property name="username" value="${jdbc.username}">
    <property name="password" value="${jdbc.password}">
</property></property></property></property></datasource>

```

**&#x67E5;&#x770B; `POOLED` &#x7684;&#x5B9E;&#x73B0; `PooledDataSource` &#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x83B7;&#x53D6;&#x8FDE;&#x63A5;&#x65F6;&#x91C7;&#x7528;&#x4E86;&#x6C60;&#x7684;&#x601D;&#x60F3;&#xFF0C;&#x5927;&#x6982;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#x56FE;&#xFF08;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x4ECB;&#x7ECD;&#xFF0C;&#x4E0D;&#x5168;&#x9762;&#xFF09;**

```java
protected DataSource createDataSource() throws SQLException {
    if (this.closed) {
        throw new SQLException(&quot;Data source is closed&quot;);
    } else if (this.dataSource != null) {
        return this.dataSource;
    } else {
        synchronized(this) {// &#x7EBF;&#x7A0B;&#x5B89;&#x5168;
            if (this.dataSource != null) {
                return this.dataSource;
            } else {
                this.jmxRegister();
                ConnectionFactory driverConnectionFactory = this.createConnectionFactory();// &#x7EBF;&#x521B;&#x5EFA;&#x6570;&#x636E;&#x5E93;&#x7684;&#x8FDE;&#x63A5;&#x5DE5;&#x5382;
                boolean success = false;

                PoolableConnectionFactory poolableConnectionFactory;
                try {
                    poolableConnectionFactory = this.createPoolableConnectionFactory(driverConnectionFactory);
                    poolableConnectionFactory.setPoolStatements(this.poolPreparedStatements);
                    poolableConnectionFactory.setMaxOpenPreparedStatements(this.maxOpenPreparedStatements);
                    success = true;
                } catch (SQLException var21) {
                    throw var21;
                } catch (RuntimeException var22) {
                    throw var22;
                } catch (Exception var23) {
                    throw new SQLException(&quot;Error creating connection factory&quot;, var23);
                }

                if (success) {
                    this.createConnectionPool(poolableConnectionFactory);// &#x771F;&#x6B63;&#x7684;&#x521B;&#x5EFA;&#x8FDE;&#x63A5;&#x6C60;&#x7684;&#x90E8;&#x5206;
                }

                success = false;

                DataSource newDataSource;
                try {
                    newDataSource = this.createDataSourceInstance();// &#x518D;&#x521B;&#x5EFA;&#x6570;&#x636E;&#x6E90;
                    newDataSource.setLogWriter(this.logWriter);
                    success = true;
                } catch (SQLException var18) {
                    throw var18;
                } catch (RuntimeException var19) {
                    throw var19;
                } catch (Exception var20) {
                    throw new SQLException(&quot;Error creating datasource&quot;, var20);
                } finally {
                    if (!success) {
                        this.closeConnectionPool();// &#x521B;&#x5EFA;&#x5931;&#x8D25;&#xFF0C;&#x56DE;&#x6EDA;
                    }
                }

                try {
                    for(int i = 0; i &lt; this.initialSize; ++i) {
                        this.connectionPool.addObject();// &#x6839;&#x636E;&#x914D;&#x7F6E;&#xFF0C;&#x521D;&#x59CB;&#x5316;&#x4E00;&#x5B9A;&#x6570;&#x91CF;&#x7684;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;
                    }
                } catch (Exception var25) {
                    this.closeConnectionPool();
                    throw new SQLException(&quot;Error preloading the connection pool&quot;, var25);
                }

                this.startPoolMaintenance();
                this.dataSource = newDataSource;
                return this.dataSource;
            }
        }
    }
}
```
**&#x67E5;&#x770B; `UNPOOLED` &#x7684;&#x5B9E;&#x73B0; `UnpooledDataSource` &#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x6BCF;&#x6B21;&#x83B7;&#x53D6;&#x8FDE;&#x63A5;&#x65F6;&#x90FD;&#x4F1A;&#x6CE8;&#x518C;&#x9A71;&#x52A8;&#x5E76;&#x521B;&#x5EFA;&#x65B0;&#x8FDE;&#x63A5;&#xFF0C;&#x5927;&#x6982;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#x56FE;&#xFF08;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x4ECB;&#x7ECD;&#xFF0C;&#x4E0D;&#x5168;&#x9762;&#xFF09;**

![UnpooledDataSource](https://img-blog.csdnimg.cn/202002031056597.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ExMDkyODgyNTgw,size_16,color_FFFFFF,t_70#pic_center)

## sqlsession&#x548C;connection

* &#x4E00;&#x4E2A;sqlsession&#x4E00;&#x822C;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;connection&#xFF0C;&#x5E76;&#x4E14;mybatis&#x9ED8;&#x8BA4;&#x6BCF;&#x6B21;&#x83B7;&#x53D6;session&#x90FD;&#x4F1A;&#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#xFF0C;&#x4E14;&#x4E0D;&#x81EA;&#x52A8;&#x63D0;&#x4EA4;&#x4E8B;&#x52A1;&#x3002;&#x5982;&#x679C;&#x66F4;&#x65B0;&#x64CD;&#x4F5C;&#x5B8C;&#x6210;&#x540E;&#x4E0D;&#x624B;&#x52A8;commit&#xFF0C;&#x5219;&#x5728;&#x8FDE;&#x63A5;&#x65AD;&#x5F00;&#x65F6;&#x4F1A;&#x5C06;&#x66F4;&#x65B0;&#x64CD;&#x4F5C;&#x56DE;&#x6EDA;&#xFF0C;&#x4E00;&#x4E2A;sqlSession(&#x4E00;&#x4E2A;transaction)&#x4E2D;&#x53EF;&#x4EE5;&#x591A;&#x6B21;commit&#xFF0C;commit&#x540E;cache&#x548C;statement&#x5237;&#x65B0;&#xFF08;&#x4E00;&#x822C;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#xFF08;transaction&#xFF09;&#x53EA;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;sqlseesion&#xFF0C;&#x4E5F;&#x5373;&#x4E00;&#x4E2A;connection&#xFF0C;&#x5206;&#x5E03;&#x5F0F;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x53EF;&#x4EE5;&#x5BF9;&#x5E94;&#x591A;&#x4E2A;connection&#xFF09;&#xFF0C;&#x53EA;&#x6709;close&#x540E;&#x540C;&#x65F6;&#x5173;&#x95ED;sqlsession&#x548C;transaction&#xFF08;transaction&#x53EF;&#x4EE5;&#x7531;factory&#x5173;&#x95ED;&#xFF09;&#x5E76;&#x8FD4;&#x56DE;connection&#x3002;mybatis&#x7684;transaction&#x57FA;&#x672C;&#x6CA1;&#x6DFB;&#x52A0;&#x4EC0;&#x4E48;&#x529F;&#x80FD;&#xFF0C;&#x5927;&#x90E8;&#x5206;&#x4EC5;&#x72B6;&#x6001;&#x5224;&#x65AD;&#x540E;&#x4EA4;&#x7531;connection&#xFF08;&#x518D;&#x7531;jdbc&#xFF09;&#x6267;&#x884C;&#x3002;&#x53EF;&#x80FD;&#x662F;&#x4E3A;&#x4E86;&#x7ED9;spring&#x7B49;&#x6846;&#x67B6;&#x5BB9;&#x6613;&#x7EC4;&#x8F6C;&#x81EA;&#x5DF1;&#x7684;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x673A;&#x5236;&#x3002;
* mybatis&#x4E00;&#x822C;&#x7531;&#x4E00;&#x4E2A;sqlsession&#x7ECF;&#x8FC7;getmapper&#x5B8C;&#x6210;&#x5BF9;dao&#x7684;&#x591A;&#x6B21;&#x8C03;&#x7528;&#xFF0C;&#x4E4B;&#x540E;&#x518D;commit&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x4E00;&#x7EA7;&#x7F13;&#x5B58;&#x80FD;&#x8FD0;&#x884C;&#x7684;&#x539F;&#x56E0;

#### sqlsession&#x4E0E;transaction

**&#xFF08;&#x7B2C;&#x4E00;&#x4E2A;JdbcTransactionFactory&#x3001;&#x7B2C;&#x4E8C;&#x4E2A;defaultsqlsessonfactory&#xFF09;&#xFF1A;**

&#x7528;transactionFactory&#x521B;&#x5EFA;&#x76F8;&#x5E94;&#x7684;transaction&#xFF0C;&#x7528;&#x521B;&#x5EFA;&#x51FA;&#x7684;tx&#x6765;&#x521B;&#x5EFA;executor&#xFF0C;&#x518D;&#x7528;executor&#x548C;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#x6765;&#x521B;&#x5EFA;defaulSqlsession

```

public class JdbcTransactionFactory implements TransactionFactory {
    public JdbcTransactionFactory() {
    }

    public void setProperties(Properties props) {
    }

    public Transaction newTransaction(Connection conn) {
        return new JdbcTransaction(conn);
    }

    public Transaction newTransaction(DataSource ds, TransactionIsolationLevel level, boolean autoCommit) {
        return new JdbcTransaction(ds, level, autoCommit);
    }
}

```

```
public class DefaultSqlSessionFactory implements SqlSessionFactory {

public SqlSession openSession(ExecutorType execType, Connection connection) {
    return this.openSessionFromConnection(execType, connection);
}
 private SqlSession openSessionFromConnection(ExecutorType execType, Connection connection) {//&#x5206;&#x4E3A;&#x4E24;&#x79CD;&#x521B;&#x5EFA;&#xFF08;dataSource&#x3001;fromConnection&#xFF09;&#xFF0C;&#x4E0E;Spring&#x6574;&#x5408;&#x65F6;transactionFactory&#x7684;&#x5B9E;&#x4F8B;&#x662F;SpringtransactionFactory
        DefaultSqlSession var8;
        try {
            boolean autoCommit;
            try {
                autoCommit = connection.getAutoCommit();
            } catch (SQLException var13) {
                autoCommit = true;
            }

            Environment environment = this.configuration.getEnvironment();
            TransactionFactory transactionFactory = this.getTransactionFactoryFromEnvironment(environment);
            Transaction tx = transactionFactory.newTransaction(connection);
            Executor executor = this.configuration.newExecutor(tx, execType);
            var8 = new DefaultSqlSession(this.configuration, executor, autoCommit);
        } catch (Exception var14) {
            throw ExceptionFactory.wrapException(&quot;Error opening session.  Cause: &quot; + var14, var14);
        } finally {
            ErrorContext.instance().reset();
        }

        return var8;
    }
 private SqlSession openSessionFromConnection(ExecutorType execType, Connection connection) {
        DefaultSqlSession var8;
        try {
            boolean autoCommit;
            try {
                autoCommit = connection.getAutoCommit();
            } catch (SQLException var13) {
                autoCommit = true;
            }

            Environment environment = this.configuration.getEnvironment();
            TransactionFactory transactionFactory = this.getTransactionFactoryFromEnvironment(environment);
            Transaction tx = transactionFactory.newTransaction(connection);
            Executor executor = this.configuration.newExecutor(tx, execType);
            var8 = new DefaultSqlSession(this.configuration, executor, autoCommit);
        } catch (Exception var14) {
            throw ExceptionFactory.wrapException(&quot;Error opening session.  Cause: &quot; + var14, var14);
        } finally {
            ErrorContext.instance().reset();
        }

        return var8;
    }

```

#### sqlsession&#x5BF9;executor&#x7684;&#x8C03;&#x7528;

**&#xFF08;defaultSqlsession&#xFF09;**

  ```
 public class DefaultSqlSession implements SqlSession {

 public <e> List<e> selectList(String statement, Object parameter, RowBounds rowBounds) {
      List var5;
      try {
          MappedStatement ms = this.configuration.getMappedStatement(statement);
          var5 = this.executor.query(ms, this.wrapCollection(parameter), rowBounds, Executor.NO_RESULT_HANDLER);
      } catch (Exception var9) {
          throw ExceptionFactory.wrapException(&quot;Error querying database.  Cause: &quot; + var9, var9);
      } finally {
          ErrorContext.instance().reset();
      }

      return var5;
  }
  public int update(String statement, Object parameter) {
          int var4;
          try {
              this.dirty = true;
              MappedStatement ms = this.configuration.getMappedStatement(statement);
              var4 = this.executor.update(ms, this.wrapCollection(parameter));
          } catch (Exception var8) {
              throw ExceptionFactory.wrapException(&quot;Error updating database.  Cause: &quot; + var8, var8);
          } finally {
              ErrorContext.instance().reset();
          }

          return var4;
      }
   public void commit(boolean force) {
          try {
              this.executor.commit(this.isCommitOrRollbackRequired(force));
              this.dirty = false;
          } catch (Exception var6) {
              throw ExceptionFactory.wrapException(&quot;Error committing transaction.  Cause: &quot; + var6, var6);
          } finally {
              ErrorContext.instance().reset();
          }

      }

       public void rollback(boolean force) {
          try {
              this.executor.rollback(this.isCommitOrRollbackRequired(force));
              this.dirty = false;
          } catch (Exception var6) {
              throw ExceptionFactory.wrapException(&quot;Error rolling back transaction.  Cause: &quot; + var6, var6);
          } finally {
              ErrorContext.instance().reset();
          }

      }
  ```

* sqlsession&#x65E0;&#x8BBA;&#x6267;&#x884C;sql&#x8BED;&#x53E5;&#x8FD8;&#x662F;&#x5BF9;&#x4E8B;&#x7269;&#x7684;&#x7BA1;&#x7406;&#xFF0C;&#x90FD;&#x4F1A;&#x8F6C;&#x7531;executor&#x6267;&#x884C;

#### executor&#x5BF9;sql&#x7684;&#x6267;&#x884C;

* &#xFF08;simpleExecutor  extends baseExecutor&#xFF09;  sqlsession-&gt;executor-&gt;connection
* &#x7531;configuration&#x4EE5;&#x53CA;&#x53C2;&#x6570;&#x751F;&#x6210;&#x8BED;&#x53E5;&#x5904;&#x7406;&#x5BF9;&#x8C61;  handler&#xFF0C;&#x518D;&#x8C03;&#x7528;preaparement&#x65B9;&#x6CD5;&#x5BF9;handler&#x8FDB;&#x884C;connection&#x7684;&#x83B7;&#x53D6;&#x4E0E;&#x8FDE;&#x63A5;&#xFF08;&#x5F53;&#x7136;&#x4E5F;&#x901A;&#x8FC7;&#x4E86;transaction&#xFF0C;&#x7528;&#x7684;&#x662F;&#x7236;&#x7C7B;baseEexcutor&#x7684;&#x65B9;&#x6CD5;&#xFF09;
* &#x4E4B;&#x540E;&#x5C06;&#x64CD;&#x4F5C;&#x90FD;&#x4EA4;&#x7ED9;&#x4E86;handler&#xFF0C;&#x7ECF;&#x8FC7;&#x5B9E;&#x73B0;&#x4E86;statementhandler&#x63A5;&#x53E3;&#x7684;RoutingStatementHandler-&gt;PreparedStatementHandler(extends BaseStatementHandler)&#x4E4B;&#x540E;&#x7684;preparedstatement&#x7B49;statement&#x540E;&#xFF0C;&#x4FBF;&#x662F;jdbc&#x7684;excute&#x64CD;&#x4F5C;&#x4E0E;result&#x7684;&#x5C01;&#x88C5;
* &#x4E00;&#x7EA7;&#x7F13;&#x5B58;&#x7684;&#x53D1;&#x751F;&#x4E5F;&#x5728;&#x5904;&#x7406;&#x540E;&#x53D1;&#x751F;

```
public class SimpleExecutor extends BaseExecutor {
    public SimpleExecutor(Configuration configuration, Transaction transaction) {
        super(configuration, transaction);
    }

    public int doUpdate(MappedStatement ms, Object parameter) throws SQLException {
        Statement stmt = null;

        int var6;
        try {
            Configuration configuration = ms.getConfiguration();
            StatementHandler handler = configuration.newStatementHandler(this, ms, parameter, RowBounds.DEFAULT, (ResultHandler)null, (BoundSql)null);
            stmt = this.prepareStatement(handler, ms.getStatementLog());
            var6 = handler.update(stmt);
        } finally {
            this.closeStatement(stmt);
        }

        return var6;
    }

    public <e> List<e> doQuery(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, BoundSql boundSql) throws SQLException {
        Statement stmt = null;

        List var9;
        try {
            Configuration configuration = ms.getConfiguration();
            StatementHandler handler = configuration.newStatementHandler(this.wrapper, ms, parameter, rowBounds, resultHandler, boundSql);
            stmt = this.prepareStatement(handler, ms.getStatementLog());
            var9 = handler.query(stmt, resultHandler);
        } finally {
            this.closeStatement(stmt);
        }

        return var9;
    }

     private Statement prepareStatement(StatementHandler handler, Log statementLog) throws SQLException {
        Connection connection = this.getConnection(statementLog);
        Statement stmt = handler.prepare(connection, this.transaction.getTimeout());
        handler.parameterize(stmt);
        return stmt;
    }
```

```
public abstract class BaseExecutor implements Executor {

protected Connection getConnection(Log statementLog) throws SQLException {
    Connection connection = this.transaction.getConnection();
    return statementLog.isDebugEnabled() ? ConnectionLogger.newInstance(connection, statementLog, this.queryStack) : connection;
}
}
```

#### executor&#x5BF9;&#x4E8B;&#x52A1;&#x7684;&#x5904;&#x7406;

* &#x7531;simpleExecutor&#x5BF9;&#x8C61;&#x5904;&#x7406;&#xFF0C;&#x4F46;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x90FD;&#x7EE7;&#x627F;&#x81EA;baseExecutor
* sqlsession(&#x5E26;&#x7740;&#x5728;sqlsessionfactory&#x521B;&#x5EFA;&#x7684;transaction)-&gt;executor(transaction)-&gt;transaction.commit/close&#xB7;&#xB7;&#xB7;&#xB7;&#xB7;
* executor &#x5C06;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x4EA4;&#x7ED9;&#x4E86; transaction&#xFF0C;commit/rollback&#x7B49;&#x5BF9;cache&#x548C;statement&#x7684;&#x6E05;&#x7A7A;&#xFF08;clearLocalCache&#xFF0C;flushStatements&#xFF09;&#x4E5F;&#x5728;&#x8FD9;&#x91CC;&#x5F00;&#x59CB;&#x8FDB;&#x884C;&#x3002;
* **&#x5728;sqlsession&#x7684;close&#x524D;&#xFF0C;&#x5BF9;sql&#x8BED;&#x53E5;&#x7684;&#x6267;&#x884C;&#x90FD;&#x4F1A;&#x7528;getConnection&#x521B;&#x5EFA;&#x7684;&#x8FDE;&#x63A5;&#x8FDB;&#x884C;sql&#x8BED;&#x53E5;&#x7684;&#x6267;&#x884C;&#xFF0C;commit&#x4E5F;&#x5E76;&#x4E0D;&#x4F1A;&#x8BF4;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#xFF08;transaction&#xFF09;&#xFF0C;&#x800C;&#x662F;&#x6E05;&#x7A7A;cache&#x548C;statement&#x5E76;&#x63D0;&#x4EA4;jdbc&#x6267;&#x884C;&#x540E;&#x7684;&#x7ED3;&#x679C;&#x5230;mysql&#x3002;&#x6B64;&#x65F6;&#x4ECD;&#x53EF;&#x4EE5;&#x7528;commit&#x540E;&#x7684;sqlsession&#x548C;transaction&#x8FDB;&#x884C;getMapper&#x4EE3;&#x7406;&#x5E76;&#x8C03;&#x7528;&#x63A5;&#x53E3;&#x65B9;&#x6CD5;&#xFF0C;&#x53EA;&#x6709;close&#x540E;&#x4E24;&#x8005;&#x624D;&#x4F1A;&#x6D88;&#x5931;**

```
public class SimpleExecutor extends BaseExecutor {

public Transaction getTransaction() {
    if (this.closed) {
        throw new ExecutorException(&quot;Executor was closed.&quot;);
    } else {
        return this.transaction;
    }
}

public void close(boolean forceRollback) {
    try {
        try {
            this.rollback(forceRollback);
        } finally {
            if (this.transaction != null) {
                this.transaction.close();
            }

        }
    } catch (SQLException var11) {
        log.warn(&quot;Unexpected exception on closing transaction.  Cause: &quot; + var11);
    } finally {
        this.transaction = null;
        this.deferredLoads = null;
        this.localCache = null;
        this.localOutputParameterCache = null;
        this.closed = true;
    }

}
public void commit(boolean required) throws SQLException {
        if (this.closed) {
            throw new ExecutorException(&quot;Cannot commit, transaction is already closed&quot;);
        } else {
            this.clearLocalCache();
            this.flushStatements();
            if (required) {
                this.transaction.commit();
            }

        }
    }
 public void rollback(boolean required) throws SQLException {
        if (!this.closed) {
            try {
                this.clearLocalCache();
                this.flushStatements(true);
            } finally {
                if (required) {
                    this.transaction.rollback();
                }

            }
        }

    }

public void clearLocalCache() {
        if (!this.closed) {
            this.localCache.clear();
            this.localOutputParameterCache.clear();
        }

    }
```

#### transaction&#x5230;connection

* JdbcTransaction
* &#x7531;transaction&#x5BF9;&#x4E0E;connection &#x7684;commit/colse&#x8FDB;&#x884C;&#x7BA1;&#x7406;&#x3002;

```java
public class JdbcTransaction implements Transaction {


public JdbcTransaction(Connection connection) {
    this.connection = connection;
}

public Connection getConnection() throws SQLException {
    if (this.connection == null) {
        this.openConnection();
    }

    return this.connection;
}

public void commit() throws SQLException {
    if (this.connection != null &amp;&amp; !this.connection.getAutoCommit()) {
        if (log.isDebugEnabled()) {
            log.debug(&quot;Committing JDBC Connection [&quot; + this.connection + &quot;]&quot;);
        }

        this.connection.commit();
    }

}

public void rollback() throws SQLException {
    if (this.connection != null &amp;&amp; !this.connection.getAutoCommit()) {
        if (log.isDebugEnabled()) {
            log.debug(&quot;Rolling back JDBC Connection [&quot; + this.connection + &quot;]&quot;);
        }

        this.connection.rollback();
    }

}

public void close() throws SQLException {
    if (this.connection != null) {
        this.resetAutoCommit();
        if (log.isDebugEnabled()) {
            log.debug(&quot;Closing JDBC Connection [&quot; + this.connection + &quot;]&quot;);
        }

        this.connection.close();
    }

}
}
```

#### connection

* connectionImp&#x7C7B;
* &#x4ECE;&#x8FD9;&#x5F00;&#x59CB;&#x4FBF;&#x662F;com.mysql.jdbc&#x5305;&#x7684;&#x4E1C;&#x897F;&#x4E86;&#xFF0C;&#x5C31;&#x662F;&#x4E0E;&#x6570;&#x636E;&#x5E93;&#x76F4;&#x63A5;&#x8FDB;&#x884C;&#x4EA4;&#x63A5;&#x7684;&#x90E8;&#x5206;&#x4E86;

```java
public class ConnectionImpl extends ConnectionPropertiesImpl implements Connection {

public void commit() throws SQLException {
    synchronized(this.getMutex()) {
        this.checkClosed();

        try {
            if (this.connectionLifecycleInterceptors != null) {
                IterateBlock iter = new IterateBlock(this.connectionLifecycleInterceptors.iterator()) {
                    void forEach(Object each) throws SQLException {
                        if (!((ConnectionLifecycleInterceptor)each).commit()) {
                            this.stopIterating = true;
                        }

                    }
                };
                iter.doForAll();
                if (!iter.fullIteration()) {
                    return;
                }
            }

            if (this.autoCommit &amp;&amp; !this.getRelaxAutoCommit()) {
                throw SQLError.createSQLException(&quot;Can&apos;t call commit when autocommit=true&quot;);
            }

            if (this.transactionsSupported) {
                if (this.getUseLocalSessionState() &amp;&amp; this.versionMeetsMinimum(5, 0, 0) &amp;&amp; !this.io.inTransactionOnServer()) {
                    return;
                }

                this.execSQL((StatementImpl)null, &quot;commit&quot;, -1, (Buffer)null, 1003, 1007, false, this.database, (Field[])null, false);
            }
        } catch (SQLException var8) {
            if (&quot;08S01&quot;.equals(var8.getSQLState())) {
                throw SQLError.createSQLException(&quot;Communications link failure during commit(). Transaction resolution unknown.&quot;, &quot;08007&quot;);
            }

            throw var8;
        } finally {
            this.needsPing = this.getReconnectAtTxEnd();
        }

    }
}
}
```








![&#x5728;&#x8FD9;&#x91CC;&#x63D2;&#x5165;&#x56FE;&#x7247;&#x63CF;&#x8FF0;](https://img-blog.csdnimg.cn/20200621235803927.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjQ5MDM4Mw==,size_16,color_FFFFFF,t_70)

## &#x591A;&#x8868;&#x67E5;&#x8BE2;

1. &#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x63A5;&#x6536;&#x591A;&#x8868;&#x6D88;&#x606F;&#x7684;&#x5B9E;&#x4F53;&#x7C7B;

2. &#x4E00;&#x5BF9;&#x4E00;&#xFF1A;&#x5EFA;&#x7ACB;&#x4E24;&#x8005;&#x7684;&#x8868;&#xFF0C;&#x5728;**&#x4E00;**&#x4E2D;&#x7684;&#x5B9E;&#x4F53;&#x7C7B;&#x6DFB;&#x52A0;**&#x4E00;**&#x7684;&#x7C7B;&#x4E3A;&#x6210;&#x5458;&#x53D8;&#x91CF;&#xFF0C;&#x4F7F;&#x7528;resultmap&#x6620;&#x5C04;&#x3002;

   &#x4E00;&#x5BF9;&#x591A;&#xFF1A; &#x5EFA;&#x7ACB;&#x4E24;&#x8005;&#x7684;&#x8868;&#xFF0C;&#x5B9E;&#x4F53;&#x7C7B;&#x4E0A;&#x8F6C;&#x6362;&#x6210;&#x76F8;&#x5E94;&#x7684;&#x4E00;&#x5BF9;&#x591A;&#x7684;&#x5173;&#x7CFB;&#xFF0C;&#x5728;**&#x4E00;**&#x4E2D;&#x7684;&#x5B9E;&#x4F53;&#x7C7B;&#x6DFB;&#x52A0;**&#x591A;**&#x7684;&#x7C7B;&#x4E3A;&#x6210;&#x5458;&#x53D8;&#x91CF;&#xFF0C;&#x4F7F;&#x7528;resultmap&#x6620;&#x5C04;&#x3002;

   &#x591A;&#x5BF9;&#x591A;&#xFF1A; &#x5EFA;&#x7ACB;&#x4E24;&#x8005;&#x7684;&#x8868;&#x5E76;&#x5EFA;&#x7ACB;&#x4E2D;&#x95F4;&#x8868;&#xFF0C;&#x5B9E;&#x4F53;&#x7C7B;(&#x4E0E;&#x4E00;&#x5BF9;&#x591A;&#x4E00;&#x81F4;)&#x8F6C;&#x6362;&#x6210;&#x76F8;&#x5E94;&#x7684;&#x4E00;&#x5BF9;&#x591A;&#x7684;&#x5173;&#x7CFB;&#xFF0C;&#x5728;**&#x4E00;**&#x4E2D;&#x7684;&#x5B9E;&#x4F53;&#x7C7B;&#x6DFB;&#x52A0;**&#x591A;**&#x7684;&#x7C7B;&#x4E3A;&#x6210;&#x5458;&#x53D8;&#x91CF;&#xFF0C;&#x4F7F;&#x7528;resultmap&#x6620;&#x5C04;(&#x4E0E;&#x4E00;&#x5BF9;&#x591A;&#x4E00;&#x81F4;)&#xFF0C;&#x4E2D;&#x95F4;&#x8868;&#x88AB;sql&#x8BED;&#x53E5;&#x4E2D;&#x7528;&#x6765;&#x4E0E;&#x5176;&#x4ED6;sql&#x5173;&#x952E;&#x5B57;&#x548C;&#x51FD;&#x6570;&#x8FDB;&#x884C;&#x8868;&#x7684;&#x62FC;&#x63A5;



###### &#x4E00;&#x5BF9;&#x4E00;

**&#x9996;&#x5148;&#x7F16;&#x5199; SQL &#x8BED;&#x53E5;&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x8981;&#x8FBE;&#x5230;&#x4E0A;&#x8FF0;&#x6548;&#x679C;&#xFF0C;&#x90A3;&#x4E48; SQL &#x8BED;&#x53E5;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x5199;&#xFF1A;**

```
SELECT U.*, a.id AS aid, a.uid, a.money from account a, user u WHERE a.uid = u.id;
```

- **&#x4E3A;&#x4E86;&#x53EF;&#x4EE5;&#x63A5;&#x6536;&#x8FD9;&#x6761;&#x8BED;&#x53E5;&#x7684;&#x67E5;&#x8BE2;&#x7ED3;&#x679C;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x5BF9;&#x8D26;&#x6237;&#x5B9E;&#x4F53;&#x7C7B; `Account` &#x8FDB;&#x884C;&#x4FEE;&#x6539;&#xFF0C;&#x4E3A;&#x5176;&#x589E;&#x52A0;&#x6210;&#x5458;&#x53D8;&#x91CF; `User` &#x6765;&#x63A5;&#x6536;&#x67E5;&#x8BE2;&#x51FA;&#x7684;&#x7528;&#x6237;&#x4FE1;&#x606F;&#xFF08;&#x4ECE;&#x8868;&#x5B9E;&#x4F53;&#x5E94;&#x8BE5;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x4E3B;&#x8868;&#x5B9E;&#x4F53;&#x7684;&#x5BF9;&#x8C61;&#x5F15;&#x7528;&#xFF09;&#xFF1A;**

```
public class Account implements Serializable {
    // &#x5176;&#x4ED6;&#x6210;&#x5458;&#x4E0D;&#x5C55;&#x793A;...

    /**
     * &#x8D26;&#x6237;&#x5BF9;&#x5E94;&#x7684;&#x7528;&#x6237;&#x4FE1;&#x606F;,&#x4ECE;&#x8868;&#x5B9E;&#x4F53;&#x5E94;&#x8BE5;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x4E3B;&#x8868;&#x5B9E;&#x4F53;&#x7684;&#x5BF9;&#x8C61;&#x5F15;&#x7528;
     */
    private User user;

    public User getUser() {
        return user;
    }

    public void setUser(User user) {
        this.user = user;
    }

    // &#x5176;&#x4ED6;setter()/getter()&#x4E0D;&#x5C55;&#x793A;...

    @Override
    public String toString() {
        return &quot;Account{&quot; +
                &quot;id=&quot; + id +
                &quot;, uid=&quot; + uid +
                &quot;, money=&quot; + money +
                &quot;, user=&quot; + user +
                &apos;}&apos;;
    }
```
* &#x56E0;&#x4E3A;&#x6B64;&#x65F6;&#x8D26;&#x6237;&#x5B9E;&#x4F53;&#x7C7B; Account &#x5DF2;&#x7ECF;&#x53D1;&#x751F;&#x4E86;&#x53D8;&#x5316;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x5728;&#x6620;&#x5C04;&#x6587;&#x4EF6;&#x5B9A;&#x4E49;&#x7528;&#x4E8E;&#x5C01;&#x88C5;&#x5E26;&#x6709; User &#x4FE1;&#x606F;&#x7684; Account &#x7684;&#x6620;&#x5C04;&#x96C6;&#x5408;resultMap

```xml
<!--?xml version="1.0" encoding="UTF-8" ?-->

<mapper namespace="cn.ykf.mapper.AccountMapper">
    <!-- 定义可以封装带有User的Account的 resultMap -->
    <resultmap id="AccountWithUserMap" type="cn.ykf.pojo.Account">
        <id property="id" column="aid">
        <result property="uid" column="uid">
        <result property="money" column="money">
        <!-- 关联 User 对象 -->
        <association property="user" javatype="cn.ykf.pojo.User">
            <id property="id" column="id">
            <result property="username" column="username">
            <result property="sex" column="sex">
            <result property="birthday" column="birthday">
            <result property="address" column="address">
        </result></result></result></result></id></association>
    </result></result></id></resultmap>
    <!-- 配置查询所有账户，带有用户信息 -->
    <select id="listAllAccounts" resultmap="AccountWithUserMap">
        SELECT U.*, a.id AS aid, a.uid, a.money from account a, user u WHERE a.uid = u.id
    </select>
</mapper>
<association></association> &#x7528;&#x4E8E;&#x4E00;&#x5BF9;&#x4E00;&#x6620;&#x5C04;&#xFF0C;&#x5176;&#x4E2D;&#x7684; property &#x5C5E;&#x6027;&#x8868;&#x793A;&#x8981;&#x5173;&#x8054;&#x7684;&#x5C5E;&#x6027;&#xFF0C;javaType &#x8868;&#x793A;&#x5F85;&#x5173;&#x8054;&#x7684;&#x5B9E;&#x4F53;&#x7C7B;&#x7684;&#x5168;&#x9650;&#x5B9A;&#x7C7B;&#x540D;&#x3002;
&#x6CE8;&#x610F;&#xFF0C;&#x56E0;&#x4E3A; SQL &#x8BED;&#x53E5;&#x4E2D;&#x4E3A; account &#x8868;&#x7684; id &#x5B57;&#x6BB5;&#x8D77;&#x4E86;&#x522B;&#x540D; aid &#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x5B9A;&#x4E49; resultMap &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8BB0;&#x5F97;&#x4E3B;&#x5B57;&#x6BB5;&#x5199; column=&quot;aid&quot;&#xFF0C;&#x800C;&#x4E0D;&#x662F; column=&quot;id&quot;&#x3002;
```

###### &#x4E00;&#x5BF9;&#x591A;

- **&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x91C7;&#x7528;&#x5916;&#x8FDE;&#x63A5;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x4F7F;&#x5F97;&#x6CA1;&#x6709;&#x8D26;&#x6237;&#x7684;&#x7528;&#x6237;&#x4E5F;&#x53EF;&#x4EE5;&#x67E5;&#x8BE2;&#x51FA;&#x6765;&#xFF1A;**

```
SELECT u.*, a.id AS aid, a.uid, a.money FROM user u LEFT OUTER JOIN account a ON u.id = a.uid;
```

- **&#x4E3A;&#x4E86;&#x53EF;&#x4EE5;&#x63A5;&#x6536;&#x8FD9;&#x6761;&#x8BED;&#x53E5;&#x7684;&#x67E5;&#x8BE2;&#x7ED3;&#x679C;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x5BF9;&#x7528;&#x6237;&#x5B9E;&#x4F53;&#x7C7B; `User` &#x8FDB;&#x884C;&#x4FEE;&#x6539;&#xFF0C;&#x4E3A;&#x5176;&#x589E;&#x52A0;&#x6210;&#x5458;&#x53D8;&#x91CF; `accounts` &#x6765;&#x63A5;&#x6536;&#x67E5;&#x8BE2;&#x51FA;&#x7684;&#x8D26;&#x6237;&#x4FE1;&#x606F;&#xFF08;&#x4E3B;&#x8868;&#x5B9E;&#x4F53;&#x5E94;&#x8BE5;&#x5305;&#x542B;&#x4ECE;&#x8868;&#x5B9E;&#x4F53;&#x7684;&#x96C6;&#x5408;&#x5F15;&#x7528;&#xFF09;&#xFF1A;**

```java
public class User implements Serializable {
    // &#x5176;&#x4ED6;&#x6210;&#x5458;&#x7701;&#x7565;&#x4E0D;&#x5C55;&#x793A;...

    /**
     * &#x4E00;&#x5BF9;&#x591A;&#x5173;&#x7CFB;&#x6620;&#x5C04;&#xFF1A;&#x4E3B;&#x8868;&#x5B9E;&#x4F53;&#x5E94;&#x8BE5;&#x5305;&#x542B;&#x4ECE;&#x8868;&#x5B9E;&#x4F53;&#x7684;&#x96C6;&#x5408;&#x5F15;&#x7528;
     */
    private List<account> accounts;

    public List<account> getAccounts() {
        return accounts;
    }

    public void setAccounts(List<account> accounts) {
        this.accounts = accounts;
    }

    // &#x5176;&#x4ED6;setter()/getter()&#x7701;&#x7565;&#x4E0D;&#x5C55;&#x793A;...

    @Override
    public String toString() {
        return &quot;User{&quot; +
                &quot;id=&quot; + id +
                &quot;, username=&apos;&quot; + username + &apos;\&apos;&apos; +
                &quot;, birthday=&quot; + birthday +
                &quot;, sex=&apos;&quot; + sex + &apos;\&apos;&apos; +
                &quot;, address=&apos;&quot; + address + &apos;\&apos;&apos; +
                &quot;, accounts=&quot; + accounts +
                &apos;}&apos;;
    }
```

- **&#x4FEE;&#x6539;&#x6620;&#x5C04;&#x6587;&#x4EF6;**

```
<mapper namespace="cn.ykf.mapper.UserMapper">
    <!-- 配置 resultMap ，完成实体类与数据库表的映射 -->
    <resultmap id="UserWithAccountsMap" type="cn.ykf.pojo.User">
        <id property="id" column="id">
        <result property="username" column="username">
        <result property="sex" column="sex">
        <result property="birthday" column="birthday">
        <result property="address" column="address">
        <!-- 配置user对象中accounts集合的映射 -->
        <collection property="accounts" oftype="cn.ykf.pojo.Account">
            <id property="id" column="aid">
            <result property="uid" column="uid">
            <result property="money" column="money">
        </result></result></id></collection>
    </result></result></result></result></id></resultmap>
    <!-- 配置查询所有用户，并且带有账户信息 -->
    <select id="listAllUsers" resultmap="UserWithAccountsMap">
        SELECT u.*, a.id AS aid, a.uid, a.money FROM user u LEFT OUTER JOIN account a ON u.id = a.uid;
    </select>
</mapper>
<collection></collection> &#x7528;&#x4E8E;&#x4E00;&#x5BF9;&#x591A;&#x6620;&#x5C04;&#xFF0C;&#x5176;&#x4E2D;&#x7684; property &#x5C5E;&#x6027;&#x8868;&#x793A;&#x8981;&#x5173;&#x8054;&#x7684;&#x96C6;&#x5408;&#xFF0C;ofType &#x8868;&#x793A;&#x96C6;&#x5408;&#x4E2D;&#x7684;&#x5B9E;&#x4F53;&#x7C7B;&#x7684;&#x5168;&#x9650;&#x5B9A;&#x7C7B;&#x540D;&#x3002;

```

###### &#x591A;&#x5BF9;&#x591A;

- **&#x4FEE;&#x6539;&#x7528;&#x6237;&#x5B9E;&#x4F53;&#x7C7B; `User` &#xFF0C;&#x5E76;&#x6DFB;&#x52A0;&#x89D2;&#x8272;&#x5B9E;&#x4F53;&#x7C7B; `Role`&#xFF0C;&#x4E3A;&#x4E86;&#x80FD;&#x4F53;&#x73B0;&#x51FA;&#x591A;&#x5BF9;&#x591A;&#x7684;&#x5173;&#x7CFB;&#xFF0C;&#x4E24;&#x4E2A;&#x5B9E;&#x4F53;&#x7C7B;&#x90FD;&#x5FC5;&#x987B;&#x5305;&#x542B;&#x5BF9;&#x65B9;&#x7684;&#x4E00;&#x4E2A;&#x96C6;&#x5408;&#x5F15;&#x7528;&#xFF08;&#x591A;&#x5BF9;&#x591A;&#x5173;&#x7CFB;&#x5176;&#x5B9E;&#x6211;&#x4EEC;&#x770B;&#x6210;&#x662F;&#x53CC;&#x5411;&#x7684;&#x4E00;&#x5BF9;&#x591A;&#x5173;&#x7CFB;&#xFF09;**

```java
public class User implements Serializable {
    /**
     * &#x591A;&#x5BF9;&#x591A;&#x5173;&#x7CFB;&#x6620;&#x5C04;&#xFF1A;&#x5305;&#x542B;&#x5BF9;&#x65B9;&#x7684;&#x96C6;&#x5408;&#x5F15;&#x7528;
     */
    private List<role> roles;

    public List<role> getRoles() {
        return roles;
    }

    public void setRoles(List<role> roles) {
        this.roles = roles;
    }

    @Override
    public String toString() {
        return &quot;User{&quot; +
                &quot;id=&quot; + id +
                &quot;, username=&apos;&quot; + username + &apos;\&apos;&apos; +
                &quot;, birthday=&quot; + birthday +
                &quot;, sex=&apos;&quot; + sex + &apos;\&apos;&apos; +
                &quot;, address=&apos;&quot; + address + &apos;\&apos;&apos; +
                &quot;, accounts=&quot; + accounts +
                &quot;, roles=&quot; + roles +
                &apos;}&apos;;
       }
```

```
public class Role implements Serializable {
    private Integer roleId;
    private String roleName;
    private String roleDesc;
    /**
     * &#x591A;&#x5BF9;&#x591A;&#x5173;&#x7CFB;&#x6620;&#x5C04;&#xFF1A;&#x6301;&#x6709;&#x5BF9;&#x65B9;&#x96C6;&#x5408;&#x5F15;&#x7528;
     */
    private List<user> users;

    public List<user> getUsers() {
        return users;
    }

    public void setUsers(List<user> users) {
        this.users = users;
    }

    public Integer getRoleId() {
        return roleId;
    }

    public void setRoleId(Integer roleId) {
        this.roleId = roleId;
    }

    public String getRoleName() {
        return roleName;
    }

    public void setRoleName(String roleName) {
        this.roleName = roleName;
    }

    public String getRoleDesc() {
        return roleDesc;
    }

    public void setRoleDesc(String roleDesc) {
        this.roleDesc = roleDesc;
    }

    @Override
    public String toString() {
        return &quot;Role{&quot; +
                &quot;roleId=&quot; + roleId +
                &quot;, roleName=&apos;&quot; + roleName + &apos;\&apos;&apos; +
                &quot;, roleDesc=&apos;&quot; + roleDesc + &apos;\&apos;&apos; +
                &quot;, users=&quot; + users +
                &apos;}&apos;;
    }
}
```

- **&#x4E3A;&#x4E86;&#x786E;&#x4FDD;&#x6240;&#x6709;&#x7528;&#x6237;&#xFF08;&#x65E0;&#x8BBA;&#x662F;&#x5426;&#x5177;&#x6709;&#x89D2;&#x8272;&#xFF09;&#x90FD;&#x53EF;&#x4EE5;&#x88AB;&#x67E5;&#x8BE2;&#x51FA;&#x6765;&#xFF0C;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;&#x5DE6;&#x8FDE;&#x63A5;**

```SELECT u.*, r.id as rid, r.role_name, r.role_desc FROM user u
SELECT u.*, r.id as rid, r.role_name, r.role_desc FROM user u
    LEFT OUTER JOIN user_role ur ON u.id = ur.uid
    LEFT OUTER JOIN role r ON ur.rid = r.id;

```

- **&#x5F00;&#x59CB;&#x7F16;&#x5199;&#x63A5;&#x53E3;&#x5C42;&#x548C;&#x6620;&#x5C04;&#x6587;&#x4EF6;**

```
/**
 * &#x67E5;&#x8BE2;&#x6240;&#x6709;&#x7528;&#x6237;&#x4FE1;&#x606F;&#xFF0C;&#x5305;&#x542B;&#x7528;&#x6237;&#x6240;&#x62E5;&#x6709;&#x7684;&#x89D2;&#x8272;&#x4FE1;&#x606F;
 * @return
 */
List<user> listUsersWithRoles();
```

```
<mapper namespace="cn.ykf.mapper.UserMapper">
    <resultmap id="UserWithRolesMap" type="cn.ykf.pojo.User">
        <id property="id" column="id">
        <result property="username" column="username">
        <result property="sex" column="sex">
        <result property="birthday" column="birthday">
        <result property="address" column="address">
        <!-- 配置user对象中roles集合的映射 -->
        <collection property="roles" oftype="cn.ykf.pojo.Role">
            <id property="roleId" column="rid">
            <result property="roleName" column="role_name">
            <result property="roleDesc" column="role_desc">
        </result></result></id></collection>
    </result></result></result></result></id></resultmap>
    <!-- 查询所有用户，并且带有角色信息 -->
    <select id="listUsersWithRoles" resultmap="UserWithRolesMap">
        SELECT u.*, r.id as rid, r.role_name, r.role_desc FROM user u
            LEFT OUTER JOIN user_role ur ON u.id = ur.uid
            LEFT OUTER JOIN role r ON ur.rid = r.id
    </select>
</mapper>
```

## &#x52A0;&#x8F7D;

###  &#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x548C;&#x7ACB;&#x5373;&#x52A0;&#x8F7D;

&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x9488;&#x5BF9;&#x7EA7;&#x8054;&#x4F7F;&#x7528;&#x7684;&#xFF0C;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x7684;&#x76EE;&#x7684;&#x662F;&#x51CF;&#x5C11;&#x5185;&#x5B58;&#x7684;&#x6D6A;&#x8D39;&#x548C;&#x51CF;&#x8F7B;&#x7CFB;&#x7EDF;&#x8D1F;&#x62C5;&#x3002;



**&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x9700;&#x8981;&#x7684;&#x914D;&#x7F6E;&#xFF1A;**

| &#x8BBE;&#x7F6E;&#x53C2;&#x6570;               | &#x63CF;&#x8FF0;                                                         | &#x6709;&#x6548;&#x503C;                 | &#x9ED8;&#x8BA4;&#x503C;                         |
| ---------------------- | ------------------------------------------------------------ | ---------------------- | ------------------------------ |
| lazyLoadingEnabled     | &#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x7684;&#x5168;&#x5C40;&#x5F00;&#x5173;&#x3002;&#x5F53;&#x5F00;&#x542F;&#x65F6;&#xFF0C;&#x6240;&#x6709;&#x5173;&#x8054;&#x5BF9;&#x8C61;&#x90FD;&#x4F1A;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x3002; &#x7279;&#x5B9A;&#x5173;&#x8054;&#x5173;&#x7CFB;&#x4E2D;&#x53EF;&#x901A;&#x8FC7;&#x8BBE;&#x7F6E;fetchType&#x5C5E;&#x6027;&#x6765;&#x8986;&#x76D6;&#x8BE5;&#x9879;&#x7684;&#x5F00;&#x5173;&#x72B6;&#x6001;&#x3002; | true&#x3001;false            | false                          |
| aggressiveLazyLoading  | &#x5F53;&#x5F00;&#x542F;&#x65F6;&#xFF0C;&#x4EFB;&#x4F55;&#x65B9;&#x6CD5;&#x7684;&#x8C03;&#x7528;&#x90FD;&#x4F1A;&#x52A0;&#x8F7D;&#x8BE5;&#x5BF9;&#x8C61;&#x7684;&#x6240;&#x6709;&#x5C5E;&#x6027;&#x3002;&#x5426;&#x5219;&#xFF0C;&#x6BCF;&#x4E2A;&#x5C5E;&#x6027;&#x4F1A;&#x6309;&#x9700;&#x52A0;&#x8F7D;&#xFF08;&#x53C2;&#x8003;lazyLoadTriggerMethods). | true&#x3001;false            | false (true in &#x2264;3.4.1)         |
| lazyLoadTriggerMethods | &#x6307;&#x5B9A;&#x54EA;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x65B9;&#x6CD5;&#x89E6;&#x53D1;&#x4E00;&#x6B21;&#x5168;&#x90E8;&#x5C5E;&#x6027;&#x52A0;&#x8F7D;&#x3002;                     | &#x7528;&#x9017;&#x53F7;&#x5206;&#x9694;&#x7684;&#x65B9;&#x6CD5;&#x5217;&#x8868;&#x3002; | equals,clone,hashCode,toString |

```xml
<configuration>
    <settings>
        <!-- 开启延迟加载 -->
        <setting name="lazyLoadingEnabled" value="true">
        <setting name="aggressiveLazyLoading" value="false">
        <setting name="lazyLoadTriggerMethods" value="equals,clone,hashCode,toString">
      </setting></setting></setting></settings>
</configuration>

<pre class="language-"><code>
**&#x5F00;&#x542F;&#x61D2;&#x52A0;&#x8F7D;&#x4E00;&#x5B9A;&#x8981;&#x4E24;&#x4E2A;&#x5C5E;&#x6027;&#x90FD;&#x914D;&#x7F6E;&#x5417;&#xFF1F;**
&#x4E0D;&#x662F;&#x7684;&#xFF0C;&#x771F;&#x6B63;&#x5F00;&#x542F;&#x61D2;&#x52A0;&#x8F7D;&#x6807;&#x7B7E;&#x7684;&#x53EA;&#x662F;lazyLoadingEnabled&#xFF1A;true&#x8868;&#x793A;&#x5F00;&#x542F;&#xFF0C;false&#x8868;&#x793A;&#x5173;&#x95ED;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;false&#x3002;
**&#x5982;&#x679C;&#x6211;&#x4E0D;&#x60F3;&#x5C06;&#x5168;&#x90E8;&#x7684;&#x7EA7;&#x8054;&#x90FD;&#x8BBE;&#x8BA1;&#x61D2;&#x52A0;&#x8F7D;&#x600E;&#x4E48;&#x529E;&#xFF1F;**
association&#x548C;collection&#x6709;&#x4E2A;fetchType&#x5C5E;&#x6027;&#x53EF;&#x4EE5;&#x8986;&#x76D6;&#x5168;&#x5C40;&#x7684;&#x61D2;&#x52A0;&#x8F7D;&#x72B6;&#x6001;&#xFF1A;eager&#x8868;&#x793A;&#x8FD9;&#x4E2A;&#x7EA7;&#x8054;&#x4E0D;&#x4F7F;&#x7528;&#x61D2;&#x52A0;&#x8F7D;&#x8981;&#x7ACB;&#x5373;&#x52A0;&#x8F7D;&#xFF0C;lazy&#x8868;&#x793A;&#x4F7F;&#x7528;&#x61D2;&#x52A0;&#x8F7D;&#x3002;

**&#x65E2;&#x7136;fetchType&#x53EF;&#x4EE5;&#x63A7;&#x5236;&#x61D2;&#x52A0;&#x8F7D;&#x90A3;&#x4E48;&#x6211;&#x4EC5;&#x4EC5;&#x914D;&#x7F6E;fetchType&#x4E0D;&#x914D;&#x7F6E;&#x5168;&#x5C40;&#x7684;&#x53EF;&#x4EE5;&#x5417;&#xFF1F;**
&#x53EF;&#x4EE5;&#x7684;&#x3002;
**aggressiveLazyLoading&#x662F;&#x505A;&#x4EC0;&#x4E48;&#x4E48;&#x7684;&#xFF1F;**
&#x5B83;&#x662F;&#x63A7;&#x5236;&#x5177;&#x6709;&#x61D2;&#x52A0;&#x8F7D;&#x7279;&#x6027;&#x7684;&#x5BF9;&#x8C61;&#x7684;&#x5C5E;&#x6027;&#x7684;&#x52A0;&#x8F7D;&#x60C5;&#x51B5;&#x7684;&#x3002;(&#x61D2;&#x52A0;&#x8F7D;&#x5BF9;&#x8C61;&#x5728;&#x88AB;&#x8C03;&#x7528;&#x65B9;&#x6CD5;&#x6216;&#x5C5E;&#x6027;&#x65F6;&#xFF0C;)
true&#x8868;&#x793A;&#x5982;&#x679C;&#x5BF9;&#x5177;&#x6709;&#x61D2;&#x52A0;&#x8F7D;&#x7279;&#x6027;&#x7684;&#x5BF9;&#x8C61;&#x7684;&#x4EFB;&#x610F;&#x8C03;&#x7528;&#x4F1A;&#x5BFC;&#x81F4;&#x8FD9;&#x4E2A;**&#x5BF9;&#x8C61;&#x7684;&#x5B8C;&#x6574;&#x52A0;&#x8F7D;**&#xFF0C;false&#x8868;&#x793A;&#x6BCF;&#x79CD;&#x5C5E;&#x6027;&#x6309;&#x7167;&#x9700;&#x8981;&#x52A0;&#x8F7D;&#x3002;

**&#x5982;&#x679C;&#x6211;&#x4EC5;&#x4EC5;&#x4F7F;&#x7528;aggressiveLazyLoading&#x4E0D;&#x4F7F;&#x7528;lazyLoadingEnabled&#x8FD8;&#x6709;&#x80FD;&#x6309;&#x9700;&#x52A0;&#x8F7D;&#x5417;&#xFF1F;&#x5373;&#x8C03;&#x7528;getName&#x4E0D;&#x6267;&#x884C;role&#x7684;sql&#x8BED;&#x53E5;&#xFF0C;&#x5C31;&#x50CF;&#x7B2C;&#x4E00;&#x79CD;&#x60C5;&#x51B5;&#x90A3;&#x6837;**
&#x5982;&#x679C;&#x4E0D;&#x5F00;&#x542F;&#x61D2;&#x52A0;&#x8F7D;&#xFF0C;&#x5728;&#x6267;&#x884C;user&#x7684;sql&#x8BED;&#x53E5;&#x65F6;&#x4E5F;&#x5C06;&#x6267;&#x884C;role&#x7684;sql&#x8BED;&#x53E5;&#x3002;&#x56E0;&#x6B64;&#x4E0D;&#x80FD;&#x5B9E;&#x73B0;&#x9700;&#x6C42;&#x3002;

```xml
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.apache.ibatis.submitted.lazy_properties.Mapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.apache.ibatis.submitted.lazy_properties.User<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- &#x7ED3;&#x679C;&#x5BF9;&#x8C61; --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.apache.ibatis.submitted.lazy_properties.User<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userWithLazyProperties<span class="token punctuation">&quot;</span></span> <span class="token attr-name">extends</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- &#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x5BF9;&#x8C61;lazy1 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>lazy1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">select</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getLazy1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">fetchType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>lazy<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!-- &#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x5BF9;&#x8C61;lazy2 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>lazy2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">select</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getLazy2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">fetchType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>lazy<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!-- &#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x96C6;&#x5408;lazy3 --&gt;</span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>lazy3<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">select</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getLazy3<span class="token punctuation">&quot;</span></span> <span class="token attr-name">fetchType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>lazy<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- &#x6267;&#x884C;&#x7684;&#x67E5;&#x8BE2; --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getUser<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userWithLazyProperties<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    select * from users where id = #{id}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre><blockquote>
<ol>
<li>&#x8C03;&#x7528;getUser&#x67E5;&#x8BE2;&#x6570;&#x636E;&#xFF0C;&#x4ECE;&#x67E5;&#x8BE2;&#x7ED3;&#x679C;&#x96C6;&#x89E3;&#x6790;&#x6570;&#x636E;&#x5230;User&#x5BF9;&#x8C61;&#xFF0C;&#x5F53;&#x6570;&#x636E;&#x89E3;&#x6790;&#x5230;lazy1&#xFF0C;lazy2&#xFF0C;lazy3&#x5224;&#x65AD;&#x9700;&#x8981;&#x6267;&#x884C;&#x5173;&#x8054;&#x67E5;&#x8BE2;</li>
<li>lazyLoadingEnabled=true&#xFF0C;&#x5C06;&#x521B;&#x5EFA;lazy1&#xFF0C;lazy2&#xFF0C;lazy3&#x5BF9;&#x5E94;&#x7684;Proxy&#x5EF6;&#x8FDF;&#x6267;&#x884C;&#x5BF9;&#x8C61;lazyLoader&#xFF0C;&#x5E76;&#x4FDD;&#x5B58;</li>
<li>&#x5F53;&#x903B;&#x8F91;&#x89E6;&#x53D1;lazyLoadTriggerMethods &#x5BF9;&#x5E94;&#x7684;&#x65B9;&#x6CD5;&#xFF08;equals,clone,hashCode,toString&#xFF09;&#x5219;&#x6267;&#x884C;&#x5168;&#x90E8;&#x5C5E;&#x6027;&#x52A0;&#x8F7D;</li>
<li>&#x5982;&#x679C;aggressiveLazyLoading=true&#xFF0C;&#x53EA;&#x8981;&#x89E6;&#x53D1;&#x5230;&#x5BF9;&#x8C61;&#x4EFB;&#x4F55;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5C31;&#x4F1A;&#x7ACB;&#x5373;&#x52A0;&#x8F7D;&#x6240;&#x6709;&#x5C5E;&#x6027;&#x7684;&#x52A0;&#x8F7D;</li>
</ol>
</blockquote>
<h3 id="&#x5B9E;&#x73B0;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x4E00;&#x5BF9;&#x4E00;&#x3001;&#x4E00;&#x5BF9;&#x591A;"><a name="&#x5B9E;&#x73B0;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x4E00;&#x5BF9;&#x4E00;&#x3001;&#x4E00;&#x5BF9;&#x591A;" class="anchor-navigation-ex-anchor" href="#&#x5B9E;&#x73B0;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x4E00;&#x5BF9;&#x4E00;&#x3001;&#x4E00;&#x5BF9;&#x591A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5B9E;&#x73B0;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;(&#x4E00;&#x5BF9;&#x4E00;&#x3001;&#x4E00;&#x5BF9;&#x591A;)</h3>
<ul>
<li>&#x5B9E;&#x73B0;&#x4EE5;&#x4E0B;&#x9700;&#x6C42;&#xFF1A;<ul>
<li>&#x5F53;&#x67E5;&#x8BE2;&#x8D26;&#x6237;&#x4FE1;&#x606F;&#x65F6;&#x4F7F;&#x7528;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x7528;&#x6237;&#x4FE1;&#x606F;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E48;&#x53EA;&#x67E5;&#x8BE2;&#x8D26;&#x6237;&#x4FE1;&#x606F;&#xFF1B;&#x53EA;&#x6709;&#x5F53;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x7528;&#x6237;&#x4FE1;&#x606F;&#x65F6;&#xFF0C;&#x624D;&#x53BB;&#x5173;&#x8054;&#x67E5;&#x8BE2;</li>
</ul>
</li>
<li>dao&#xFF1A;</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>doamin<span class="token punctuation">.</span></span><span class="token class-name">Account</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>doamin<span class="token punctuation">.</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IAccountDao</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Account</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Account</span><span class="token punctuation">&gt;</span></span> selectUserById <span class="token punctuation">(</span><span class="token class-name">Integer</span> uid<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>doamin<span class="token punctuation">.</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">sun<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>cs<span class="token punctuation">.</span></span>US_ASCII<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>jws<span class="token punctuation">.</span>soap<span class="token punctuation">.</span></span><span class="token class-name">SOAPBinding</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IUserDao</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">User</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token punctuation">}</span>
</code></pre>
<ul>
<li><p>domain:</p>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>doamin</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>jws<span class="token punctuation">.</span>soap<span class="token punctuation">.</span></span><span class="token class-name">SOAPBinding</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Account</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> uid<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Double</span> money<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">User</span> user<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> user<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>user <span class="token operator">=</span> user<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setId</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getUid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> uid<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUid</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> uid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>uid <span class="token operator">=</span> uid<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Double</span> <span class="token function">getMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> money<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMoney</span><span class="token punctuation">(</span><span class="token class-name">Double</span> money<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>money <span class="token operator">=</span> money<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Account{&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;id=&quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span>
                <span class="token string">&quot;, uid=&quot;</span> <span class="token operator">+</span> uid <span class="token operator">+</span>
                <span class="token string">&quot;, money=&quot;</span> <span class="token operator">+</span> money <span class="token operator">+</span>
                <span class="token string">&apos;}&apos;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>doamin</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> address<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> sex<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> birthday<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Account</span><span class="token punctuation">&gt;</span></span>  accounts<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Account</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAccounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> accounts<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAccounts</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Account</span><span class="token punctuation">&gt;</span></span> accounts<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>accounts <span class="token operator">=</span> accounts<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> username<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> address<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> sex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Date</span> <span class="token function">getBirthday</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> birthday<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setId</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>username <span class="token operator">=</span> username<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token class-name">String</span> address<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>address <span class="token operator">=</span> address<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSex</span><span class="token punctuation">(</span><span class="token class-name">String</span> sex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sex <span class="token operator">=</span> sex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBirthday</span><span class="token punctuation">(</span><span class="token class-name">Date</span> birthday<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>birthday <span class="token operator">=</span> birthday<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;User{&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;id=&quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span>
                <span class="token string">&quot;, username=&apos;&quot;</span> <span class="token operator">+</span> username <span class="token operator">+</span> <span class="token string">&apos;\&apos;&apos;</span> <span class="token operator">+</span>
                <span class="token string">&quot;, address=&apos;&quot;</span> <span class="token operator">+</span> address <span class="token operator">+</span> <span class="token string">&apos;\&apos;&apos;</span> <span class="token operator">+</span>
                <span class="token string">&quot;, sex=&apos;&quot;</span> <span class="token operator">+</span> sex <span class="token operator">+</span> <span class="token string">&apos;\&apos;&apos;</span> <span class="token operator">+</span>
                <span class="token string">&quot;, birthday=&quot;</span> <span class="token operator">+</span> birthday <span class="token operator">+</span>
                <span class="token string">&apos;}&apos;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</li>
<li><p>&#x914D;&#x7F6E;xml&#xFF1A;</p>
<p>IAccountDao.xml&#xFF1A;</p>
<pre class="language-"><code class="lang-xml"><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span>
        <span class="token name">PUBLIC</span> <span class="token string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
        <span class="token string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.itheima.dao.IAccountDao<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- &#x5B9A;&#x4E49;&#x53EF;&#x4EE5;&#x5C01;&#x88C5;&#x5E26;&#x6709;User&#x7684;Account&#x7684; resultMap --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>AccountWithUserMap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Account<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>aid<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>uid<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>uid<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>money<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>money<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!-- &#x5173;&#x8054; User &#x5BF9;&#x8C61; --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>User<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>uid<span class="token punctuation">&quot;</span></span> <span class="token attr-name">select</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.itheima.dao.IUserDao.findById<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>association</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- &#x914D;&#x7F6E;&#x67E5;&#x8BE2;&#x6240;&#x6709;&#x8D26;&#x6237;&#xFF0C;&#x5E26;&#x6709;&#x7528;&#x6237;&#x4FE1;&#x606F; --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>findAll<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>AccountWithUserMap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        SELECT * from account;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>selectUserById<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>int<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.itheima.doamin.Account<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        SELECT * from account where uid =  #{uid};
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>IAccountDao.xml&#xFF1A;</p>
</li>
</ul>
<pre class="language-"><code class="lang-xml"><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span>
        <span class="token name">PUBLIC</span> <span class="token string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
        <span class="token string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.itheima.dao.IUserDao<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userAccountMap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>address<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>address<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sex<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>birthday<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>birthday<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>accounts<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Account<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">select</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.itheima.dao.IAccountDao.selectUserById<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>  <span class="token comment">&lt;!--JavaType&#x548C;ofType&#x90FD;&#x662F;&#x7528;&#x6765;&#x6307;&#x5B9A;&#x5BF9;&#x8C61;&#x7C7B;&#x578B;&#x7684;&#xFF0C;&#x4F46;&#x662F;JavaType&#x662F;&#x7528;&#x6765;&#x6307;&#x5B9A;pojo&#x4E2D;&#x5C5E;&#x6027;&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x800C;ofType&#x6307;&#x5B9A;&#x7684;&#x662F;&#x6620;&#x5C04;&#x5230;list&#x96C6;&#x5408;&#x5C5E;&#x6027;&#x4E2D;pojo&#x7684;&#x7C7B;&#x578B;&#x3002;--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>findAll<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userAccountMap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        SELECT  * from user;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>findById<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>int<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        select * from user where  id = #{id}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>



<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>test:</p>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">IAccountDao</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">IUserDao</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>doamin<span class="token punctuation">.</span></span><span class="token class-name">Account</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>doamin<span class="token punctuation">.</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Resources</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSession</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">After</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Before</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>


<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountTest</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">InputStream</span> in<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">SqlSession</span> sqlSession<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">IAccountDao</span> accountDao<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Before</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">throws</span>  <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        in <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">&quot;SqlMapConfig.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SqlSessionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sqlSession <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        accountDao <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">IAccountDao</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@After</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        sqlSession<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFindAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Account</span><span class="token punctuation">&gt;</span></span> accounts <span class="token operator">=</span> accountDao<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        for(Account account:accounts){</span>
<span class="token comment">//</span>
<span class="token comment">//            System.out.println(account);</span>
<span class="token comment">//            System.out.println(account.getUser());</span>
<span class="token comment">//        }</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">IAccountDao</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">IUserDao</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>doamin<span class="token punctuation">.</span></span><span class="token class-name">Account</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>doamin<span class="token punctuation">.</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Resources</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSession</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">After</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Before</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">InputStream</span> in<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">SqlSession</span> sqlSession<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">IUserDao</span> userDao<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Before</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">throws</span>  <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        in <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">&quot;SqlMapConfig.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SqlSessionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sqlSession <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userDao <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">IUserDao</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@After</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        sqlSession<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFindAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userDao<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token operator">:</span>users<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getAccounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<h3 id="&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x539F;&#x7406;"><a name="&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x539F;&#x7406;" class="anchor-navigation-ex-anchor" href="#&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x539F;&#x7406;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x539F;&#x7406;</h3>
<p>Mybatis &#x4EC5;&#x652F;&#x6301; association &#x5173;&#x8054;&#x5BF9;&#x8C61;&#x548C; collection &#x5173;&#x8054;&#x96C6;&#x5408;&#x5BF9;&#x8C61;&#x7684;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#xFF0C;association &#x6307;&#x7684;&#x5C31;&#x662F;&#x4E00;&#x5BF9;&#x4E00;&#xFF0C;collection &#x6307;&#x7684;&#x5C31;&#x662F;&#x4E00;&#x5BF9;&#x591A;&#x67E5;&#x8BE2;&#x3002;&#x5728; Mybatis&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#x662F;&#x5426;&#x542F;&#x7528;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D; lazyLoadingEnabled=true|false&#x3002;&#x5B83;&#x7684;&#x539F;&#x7406;&#x662F;&#xFF0C;&#x4F7F;&#x7528; CGLIB &#x521B;&#x5EFA;&#x76EE;&#x6807;&#x5BF9;&#x8C61;&#x7684;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#xFF0C;&#x5F53;&#x8C03;&#x7528;&#x76EE;&#x6807;&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x8FDB;&#x5165;&#x62E6;&#x622A;&#x5668;&#x65B9;&#x6CD5;&#xFF0C;&#x6BD4;&#x5982;&#x8C03;&#x7528; a.getB().getName()&#xFF0C;&#x62E6;&#x622A;&#x5668; invoke()&#x65B9;&#x6CD5;&#x53D1;&#x73B0; a.getB()&#x662F;null &#x503C;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4F1A;&#x5355;&#x72EC;&#x53D1;&#x9001;&#x4E8B;&#x5148;&#x4FDD;&#x5B58;&#x597D;&#x7684;&#x67E5;&#x8BE2;&#x5173;&#x8054; B &#x5BF9;&#x8C61;&#x7684; sql&#xFF0C;&#x628A; B &#x67E5;&#x8BE2;&#x4E0A;&#x6765;&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x7528; a.setB(b)&#xFF0C;&#x4E8E;&#x662F; a &#x7684;&#x5BF9;&#x8C61; b &#x5C5E;&#x6027;&#x5C31;&#x6709;&#x503C;&#x4E86;&#xFF0C;&#x63A5;&#x7740;&#x5B8C;&#x6210; a.getB().getName()&#x65B9;&#x6CD5;&#x7684;&#x8C03;&#x7528;&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x7684;&#x57FA;&#x672C;&#x539F;&#x7406;&#x3002;&#x5F53;&#x7136;&#x4E86;&#xFF0C;&#x4E0D;&#x5149;&#x662F; Mybatis&#xFF0C;&#x51E0;&#x4E4E;&#x6240;&#x6709;&#x7684;&#x5305;&#x62EC; Hibernate&#xFF0C;&#x652F;&#x6301;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x7684;&#x539F;&#x7406;&#x90FD;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;</p>
<p><a href="F:\Typora&#x6570;&#x636E;&#x50A8;&#x5B58;\&#x6570;&#x636E;&#x5E93;\mybatis.assets\image-20201116085012615.png" data-lightbox="2b1f115f-ee9d-4456-91b2-7bf9bcb8c7e8" data-title="image-20201116085012615" target="_blank"><img src="F:\Typora&#x6570;&#x636E;&#x50A8;&#x5B58;\&#x6570;&#x636E;&#x5E93;\mybatis.assets\image-20201116085012615.png" alt="image-20201116085012615"></a></p>
<h3 id="&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x6E90;&#x7801;&#x89E3;&#x6790;"><a name="&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x6E90;&#x7801;&#x89E3;&#x6790;" class="anchor-navigation-ex-anchor" href="#&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x6E90;&#x7801;&#x89E3;&#x6790;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x6E90;&#x7801;&#x89E3;&#x6790;</h3>
<h4 id="setting-&#x914D;&#x7F6E;&#x52A0;&#x8F7D;&#xFF1A;"><a name="setting-&#x914D;&#x7F6E;&#x52A0;&#x8F7D;&#xFF1A;" class="anchor-navigation-ex-anchor" href="#setting-&#x914D;&#x7F6E;&#x52A0;&#x8F7D;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>Setting &#x914D;&#x7F6E;&#x52A0;&#x8F7D;&#xFF1A;</h4>
<pre class="language-"><code class="lang-Java">public class Configuration {
   /** aggressiveLazyLoading&#xFF1A;
   * &#x5F53;&#x5F00;&#x542F;&#x65F6;&#xFF0C;&#x4EFB;&#x4F55;&#x65B9;&#x6CD5;&#x7684;&#x8C03;&#x7528;&#x90FD;&#x4F1A;&#x52A0;&#x8F7D;&#x8BE5;&#x5BF9;&#x8C61;&#x7684;&#x6240;&#x6709;&#x5C5E;&#x6027;&#x3002;&#x5426;&#x5219;&#xFF0C;&#x6BCF;&#x4E2A;&#x5C5E;&#x6027;&#x4F1A;&#x6309;&#x9700;&#x52A0;&#x8F7D;&#xFF08;&#x53C2;&#x8003;lazyLoadTriggerMethods).
   * &#x9ED8;&#x8BA4;&#x4E3A;true
   * */
  protected boolean aggressiveLazyLoading;
  /**
   * &#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x89E6;&#x53D1;&#x65B9;&#x6CD5;
   */
  protected Set<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>String</span><span class="token punctuation">&gt;</span></span> lazyLoadTriggerMethods = new HashSet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>String</span><span class="token punctuation">&gt;</span></span>(Arrays.asList(new String[] { &quot;equals&quot;, &quot;clone&quot;, &quot;hashCode&quot;, &quot;toString&quot; }));
  /** &#x662F;&#x5426;&#x5F00;&#x542F;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D; */
  protected boolean lazyLoadingEnabled = false;

  /**
   * &#x9ED8;&#x8BA4;&#x4F7F;&#x7528;Javassist&#x4EE3;&#x7406;&#x5DE5;&#x5382;
   * @param proxyFactory
   */
  public void setProxyFactory(ProxyFactory proxyFactory) {
    if (proxyFactory == null) {
      proxyFactory = new JavassistProxyFactory();
    }
    this.proxyFactory = proxyFactory;
  }

  //&#x7701;&#x7565;...
}
</code></pre>
<h4 id="&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#x521B;&#x5EFA;"><a name="&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#x521B;&#x5EFA;" class="anchor-navigation-ex-anchor" href="#&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#x521B;&#x5EFA;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#x521B;&#x5EFA;</h4>
<p>DefaultResultSetHandler</p>
<pre class="language-"><code class="lang-Java">//#mark &#x521B;&#x5EFA;&#x7ED3;&#x679C;&#x5BF9;&#x8C61;
  private Object createResultObject(ResultSetWrapper rsw, ResultMap resultMap, ResultLoaderMap lazyLoader, String columnPrefix) throws SQLException {
    this.useConstructorMappings = false; // reset previous mapping result
    final List&lt;Class<span class="token prolog">&lt;?&gt;&gt; constructorArgTypes = new ArrayList&lt;Class&lt;?&gt;</span>&gt;();
    final List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Object</span><span class="token punctuation">&gt;</span></span> constructorArgs = new ArrayList<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Object</span><span class="token punctuation">&gt;</span></span>();
    //#mark &#x521B;&#x5EFA;&#x8FD4;&#x56DE;&#x7684;&#x7ED3;&#x679C;&#x6620;&#x5C04;&#x7684;&#x771F;&#x5B9E;&#x5BF9;&#x8C61;
    Object resultObject = createResultObject(rsw, resultMap, constructorArgTypes, constructorArgs, columnPrefix);
    if (resultObject != null &amp;&amp; !hasTypeHandlerForResultObject(rsw, resultMap.getType())) {
      final List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ResultMapping</span><span class="token punctuation">&gt;</span></span> propertyMappings = resultMap.getPropertyResultMappings();
      for (ResultMapping propertyMapping : propertyMappings) {
        // issue gcode #109 &amp;&amp; issue #149 &#x5224;&#x65AD;&#x5C5E;&#x6027;&#x6709;&#x6CA1;&#x914D;&#x7F6E;&#x5D4C;&#x5957;&#x67E5;&#x8BE2;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x5C31;&#x521B;&#x5EFA;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;
        if (propertyMapping.getNestedQueryId() != null &amp;&amp; propertyMapping.isLazy()) {
          //#mark &#x521B;&#x5EFA;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;
          resultObject = configuration.getProxyFactory().createProxy(resultObject, lazyLoader, configuration, objectFactory, constructorArgTypes, constructorArgs);
          break;
        }
      }
    }
    this.useConstructorMappings = resultObject != null &amp;&amp; !constructorArgTypes.isEmpty(); // set current mapping result
    return resultObject;
  }
</code></pre>
<h4 id="&#x4EE3;&#x7406;&#x529F;&#x80FD;&#x5B9E;&#x73B0;"><a name="&#x4EE3;&#x7406;&#x529F;&#x80FD;&#x5B9E;&#x73B0;" class="anchor-navigation-ex-anchor" href="#&#x4EE3;&#x7406;&#x529F;&#x80FD;&#x5B9E;&#x73B0;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4EE3;&#x7406;&#x529F;&#x80FD;&#x5B9E;&#x73B0;</h4>
<blockquote>
<p>&#x7531;&#x4E8E;Javasisst&#x548C;Cglib&#x7684;&#x4EE3;&#x7406;&#x5B9E;&#x73B0;&#x57FA;&#x672C;&#x76F8;&#x540C;&#xFF0C;&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x4ECB;&#x7ECD;Javasisst</p>
</blockquote>
<p>ProxyFactory&#x63A5;&#x53E3;&#x5B9A;&#x4E49;</p>
<pre class="language-"><code class="lang-Java">public interface ProxyFactory {

  void setProperties(Properties properties);

  /**
   * &#x521B;&#x5EFA;&#x4EE3;&#x7406;
   * @param target &#x76EE;&#x6807;&#x7ED3;&#x679C;&#x5BF9;&#x8C61;
   * @param lazyLoader &#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x5BF9;&#x8C61;
   * @param configuration &#x914D;&#x7F6E;
   * @param objectFactory &#x5BF9;&#x8C61;&#x5DE5;&#x5382;
   * @param constructorArgTypes &#x6784;&#x9020;&#x53C2;&#x6570;&#x7C7B;&#x578B;
   * @param constructorArgs &#x6784;&#x9020;&#x53C2;&#x6570;&#x503C;
   * @return
   */
  Object createProxy(Object target, ResultLoaderMap lazyLoader, Configuration configuration, ObjectFactory objectFactory, List&lt;Class<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>?</span><span class="token punctuation">&gt;</span></span>&gt; constructorArgTypes, List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Object</span><span class="token punctuation">&gt;</span></span> constructorArgs);
}
</code></pre>
<p>JavasisstProxyFactory&#x5B9E;&#x73B0;</p>
<pre class="language-"><code class="lang-Java">public class JavassistProxyFactory implements org.apache.ibatis.executor.loader.ProxyFactory {


    /**
   * &#x63A5;&#x53E3;&#x5B9E;&#x73B0;
   * @param target &#x76EE;&#x6807;&#x7ED3;&#x679C;&#x5BF9;&#x8C61;
   * @param lazyLoader &#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x5BF9;&#x8C61;
   * @param configuration &#x914D;&#x7F6E;
   * @param objectFactory &#x5BF9;&#x8C61;&#x5DE5;&#x5382;
   * @param constructorArgTypes &#x6784;&#x9020;&#x53C2;&#x6570;&#x7C7B;&#x578B;
   * @param constructorArgs &#x6784;&#x9020;&#x53C2;&#x6570;&#x503C;
   * @return
   */
  @Override
  public Object createProxy(Object target, ResultLoaderMap lazyLoader, Configuration configuration, ObjectFactory objectFactory, List&lt;Class<span class="token prolog">&lt;?&gt;&gt; constructorArgTypes, List&lt;Object&gt; constructorArgs) {
    return EnhancedResultObjectProxyImpl.createProxy(target, lazyLoader, configuration, objectFactory, constructorArgTypes, constructorArgs);
  }

    //&#x7701;&#x7565;...

  /**
   * &#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#x5B9E;&#x73B0;&#xFF0C;&#x6838;&#x5FC3;&#x903B;&#x8F91;&#x6267;&#x884C;
   */
  private static class EnhancedResultObjectProxyImpl implements MethodHandler {

    /**
   * &#x521B;&#x5EFA;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;
   * @param type
   * @param callback
   * @param constructorArgTypes
   * @param constructorArgs
   * @return
   */
  static Object crateProxy(Class&lt;?&gt;</span> type, MethodHandler callback, List&lt;Class<span class="token prolog">&lt;?&gt;&gt; constructorArgTypes, List&lt;Object&gt; constructorArgs) {

    ProxyFactory enhancer = new ProxyFactory();
    enhancer.setSuperclass(type);

    try {
      //&#x901A;&#x8FC7;&#x83B7;&#x53D6;&#x5BF9;&#x8C61;&#x65B9;&#x6CD5;&#xFF0C;&#x5224;&#x65AD;&#x662F;&#x5426;&#x5B58;&#x5728;&#x8BE5;&#x65B9;&#x6CD5;
      type.getDeclaredMethod(WRITE_REPLACE_METHOD);
      // ObjectOutputStream will call writeReplace of objects returned by writeReplace
      if (log.isDebugEnabled()) {
        log.debug(WRITE_REPLACE_METHOD + &quot; method was found on bean &quot; + type + &quot;, make sure it returns this&quot;);
      }
    } catch (NoSuchMethodException e) {
      //&#x6CA1;&#x627E;&#x5230;&#x8BE5;&#x65B9;&#x6CD5;&#xFF0C;&#x5B9E;&#x73B0;&#x63A5;&#x53E3;
      enhancer.setInterfaces(new Class[]{WriteReplaceInterface.class});
    } catch (SecurityException e) {
      // nothing to do here
    }

    Object enhanced;
    Class&lt;?&gt;</span>[] typesArray = constructorArgTypes.toArray(new Class[constructorArgTypes.size()]);
    Object[] valuesArray = constructorArgs.toArray(new Object[constructorArgs.size()]);
    try {
      //&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;
      enhanced = enhancer.create(typesArray, valuesArray);
    } catch (Exception e) {
      throw new ExecutorException(&quot;Error creating lazy proxy.  Cause: &quot; + e, e);
    }
    //&#x8BBE;&#x7F6E;&#x4EE3;&#x7406;&#x6267;&#x884C;&#x5668;
    ((Proxy) enhanced).setHandler(callback);
    return enhanced;
  }


     /**
     * &#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#x6267;&#x884C;
     * @param enhanced &#x539F;&#x5BF9;&#x8C61;
     * @param method &#x539F;&#x5BF9;&#x8C61;&#x65B9;&#x6CD5;
     * @param methodProxy &#x4EE3;&#x7406;&#x65B9;&#x6CD5;
     * @param args &#x65B9;&#x6CD5;&#x53C2;&#x6570;
     * @return
     * @throws Throwable
     */
    @Override
    public Object invoke(Object enhanced, Method method, Method methodProxy, Object[] args) throws Throwable {
      final String methodName = method.getName();
      try {
        synchronized (lazyLoader) {
          if (WRITE_REPLACE_METHOD.equals(methodName)) { 
            //&#x5FFD;&#x7565;&#x6682;&#x672A;&#x627E;&#x5230;&#x5177;&#x4F53;&#x4F5C;&#x7528;
            Object original;
            if (constructorArgTypes.isEmpty()) {
              original = objectFactory.create(type);
            } else {
              original = objectFactory.create(type, constructorArgTypes, constructorArgs);
            }
            PropertyCopier.copyBeanProperties(type, enhanced, original);
            if (lazyLoader.size() &gt; 0) {
              return new JavassistSerialStateHolder(original, lazyLoader.getProperties(), objectFactory, constructorArgTypes, constructorArgs);
            } else {
              return original;
            }
          } else {
              //&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x6570;&#x91CF;&#x5927;&#x4E8E;0
            if (lazyLoader.size() &gt; 0 &amp;&amp; !FINALIZE_METHOD.equals(methodName)) {
                //aggressive &#x4E00;&#x6B21;&#x52A0;&#x8F7D;&#x6027;&#x6240;&#x6709;&#x9700;&#x8981;&#x8981;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x5C5E;&#x6027;&#x6216;&#x8005;&#x5305;&#x542B;&#x89E6;&#x53D1;&#x5EF6;&#x8FDF;&#x5BF9;&#x8C61;&#x5168;&#x90E8;&#x52A0;&#x8F7D;&#x65B9;&#x6CD5;
              if (aggressive || lazyLoadTriggerMethods.contains(methodName)) {
                log.debug(&quot;==&gt; laze lod trigger method:&quot; + methodName + &quot;,proxy method:&quot; + methodProxy.getName() + &quot; class:&quot; + enhanced.getClass());
                //&#x4E00;&#x6B21;&#x5168;&#x90E8;&#x52A0;&#x8F7D;
                lazyLoader.loadAll();
              } else if (PropertyNamer.isSetter(methodName)) {
                //&#x5224;&#x65AD;&#x662F;&#x5426;&#x4E3A;set&#x65B9;&#x6CD5;&#xFF0C;set&#x65B9;&#x6CD5;&#x4E0D;&#x9700;&#x8981;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;
                final String property = PropertyNamer.methodToProperty(methodName);
                lazyLoader.remove(property);
              } else if (PropertyNamer.isGetter(methodName)) {
                final String property = PropertyNamer.methodToProperty(methodName);
                if (lazyLoader.hasLoader(property)) {
                  //&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x5355;&#x4E2A;&#x5C5E;&#x6027;
                  lazyLoader.load(property);
                  log.debug(&quot;load one :&quot; + methodName);
                }
              }
            }
          }
        }
        return methodProxy.invoke(enhanced, args);
      } catch (Throwable t) {
        throw ExceptionUtil.unwrapThrowable(t);
      }
    }
  }
</code></pre>
<h2 id="&#x7F13;&#x5B58;"><a name="&#x7F13;&#x5B58;" class="anchor-navigation-ex-anchor" href="#&#x7F13;&#x5B58;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7F13;&#x5B58;</h2>
<ul>
<li>&#x4EC0;&#x4E48;&#x662F;&#x7F13;&#x5B58;&#xFF1F;
&#x7F13;&#x5B58;&#x5C31;&#x662F;&#x5B58;&#x5728;&#x4E8E;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x4E34;&#x65F6;&#x6570;&#x636E;&#x3002;</li>
<li>&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x4F7F;&#x7528;&#x7F13;&#x5B58;&#xFF1F;
&#x4E3A;&#x4E86;&#x51CF;&#x5C11;&#x548C;&#x6570;&#x636E;&#x5E93;&#x4EA4;&#x4E92;&#x7684;&#x6B21;&#x6570;&#xFF0C;&#x63D0;&#x9AD8;&#x6267;&#x884C;&#x6548;&#x7387;&#x3002;</li>
<li>&#x9002;&#x7528;&#x4E8E;&#x7F13;&#x5B58;&#x7684;&#x6570;&#x636E;
&#x7ECF;&#x5E38;&#x67E5;&#x8BE2;&#x5E76;&#x4E14;&#x4E0D;&#x7ECF;&#x5E38;&#x6539;&#x53D8;&#x7684;&#x6570;&#x636E;&#x3002;
&#x6570;&#x636E;&#x7684;&#x6B63;&#x786E;&#x4E0E;&#x5426;&#x5BF9;&#x6700;&#x7EC8;&#x7ED3;&#x679C;&#x5F71;&#x54CD;&#x4E0D;&#x5927;&#x7684;&#x3002;</li>
<li>&#x4E0D;&#x9002;&#x7528;&#x4E8E;&#x7F13;&#x5B58;&#x7684;&#x6570;&#x636E;
&#x7ECF;&#x5E38;&#x6539;&#x53D8;&#x7684;&#x6570;&#x636E;&#x3002;
&#x6570;&#x636E;&#x7684;&#x6B63;&#x786E;&#x4E0E;&#x5426;&#x5BF9;&#x6700;&#x7EC8;&#x7ED3;&#x679C;&#x5F71;&#x54CD;&#x5F88;&#x5927;&#x7684;&#x3002;&#x4F8B;&#x5982;&#xFF1A;&#x5546;&#x54C1;&#x7684;&#x5E93;&#x5B58;&#x3001;&#x94F6;&#x884C;&#x7684;&#x6C47;&#x7387;&#x3001;&#x80A1;&#x5E02;&#x7684;&#x724C;&#x4EF7;&#x7B49;&#x3002;</li>
</ul>
<h4 id="&#x4E00;&#x7EA7;&#x7F13;&#x5B58;"><a name="&#x4E00;&#x7EA7;&#x7F13;&#x5B58;" class="anchor-navigation-ex-anchor" href="#&#x4E00;&#x7EA7;&#x7F13;&#x5B58;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4E00;&#x7EA7;&#x7F13;&#x5B58;</h4>
<p>&#x4E00;&#x7EA7;&#x7F13;&#x5B58;&#x662F; <strong>SqlSession</strong> &#x7EA7;&#x522B;&#x7684;&#x7F13;&#x5B58;&#xFF0C;&#x53EA;&#x8981; SqlSession &#x6CA1;&#x6709; <strong>flush</strong> &#x6216; <strong>close</strong>&#xFF0C;&#x5B83;&#x5C31;&#x4F1A;&#x5B58;&#x5728;&#x3002;&#x5F53;&#x8C03;&#x7528; SqlSession &#x7684;<strong>&#x4FEE;&#x6539;&#x3001;&#x6DFB;&#x52A0;&#x3001;&#x5220;&#x9664;&#x3001;commit()&#x3001;close()&#x3001;clearCache()</strong> &#x7B49;&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x5C31;&#x4F1A;&#x6E05;&#x7A7A;&#x4E00;&#x7EA7;&#x7F13;&#x5B58;&#x3002;</p>
<p>&#x4E00;&#x7EA7;&#x7F13;&#x5B58;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;</p>
<p><a href="https://img-blog.csdnimg.cn/20200206103422757.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ExMDkyODgyNTgw,size_16,color_FFFFFF,t_70#pic_center" data-lightbox="b5082582-f945-4092-af30-6befc8f8857b" data-title="&#x4E00;&#x7EA7;&#x7F13;&#x5B58;&#x5206;&#x6790;" target="_blank"><img src="https://img-blog.csdnimg.cn/20200206103422757.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ExMDkyODgyNTgw,size_16,color_FFFFFF,t_70#pic_center" alt="&#x4E00;&#x7EA7;&#x7F13;&#x5B58;&#x5206;&#x6790;"></a></p>
<ul>
<li>&#x7B2C;&#x4E00;&#x6B21;&#x53D1;&#x8D77;&#x67E5;&#x8BE2;&#x7528;&#x6237; id &#x4E3A; 1 &#x7684;&#x7528;&#x6237;&#x4FE1;&#x606F;&#xFF0C;Mybatis &#x4F1A;&#x5148;&#x53BB;&#x627E;&#x7F13;&#x5B58;&#x4E2D;&#x662F;&#x5426;&#x6709; id &#x4E3A; 1 &#x7684;&#x7528;&#x6237;&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#xFF0C;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x67E5;&#x8BE2;&#x7528;&#x6237;&#x4FE1;&#x606F;&#x3002;
&#x5F97;&#x5230;&#x7528;&#x6237;&#x4FE1;&#x606F;&#xFF0C;&#x5C06;&#x7528;&#x6237;&#x4FE1;&#x606F;&#x5B58;&#x50A8;&#x5230;&#x4E00;&#x7EA7;&#x7F13;&#x5B58;&#x4E2D;&#x3002;</li>
<li>&#x5982;&#x679C; sqlSession &#x53BB;&#x6267;&#x884C; commit &#x64CD;&#x4F5C;&#xFF08;&#x6267;&#x884C;&#x63D2;&#x5165;&#x3001;&#x66F4;&#x65B0;&#x3001;&#x5220;&#x9664;&#xFF09;&#xFF0C;&#x90A3;&#x4E48; Mybatis &#x5C31;&#x4F1A;&#x6E05;&#x7A7A; SqlSession &#x4E2D;&#x7684;&#x4E00;&#x7EA7;&#x7F13;&#x5B58;&#xFF0C;&#x8FD9;&#x6837;&#x505A;&#x7684;&#x76EE;&#x7684;&#x4E3A;&#x4E86;&#x8BA9;&#x7F13;&#x5B58;&#x4E2D;&#x5B58;&#x50A8;&#x7684;&#x662F;&#x6700;&#x65B0;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x907F;&#x514D;&#x810F;&#x8BFB;&#x3002;</li>
<li>&#x7B2C;&#x4E8C;&#x6B21;&#x53D1;&#x8D77;&#x67E5;&#x8BE2;&#x7528;&#x6237; id &#x4E3A; 1 &#x7684;&#x7528;&#x6237;&#x4FE1;&#x606F;&#xFF0C;&#x5148;&#x53BB;&#x627E;&#x7F13;&#x5B58;&#x4E2D;&#x662F;&#x5426;&#x6709; id &#x4E3A; 1 &#x7684;&#x7528;&#x6237;&#x4FE1;&#x606F;&#xFF0C;&#x7F13;&#x5B58;&#x4E2D;&#x6709;&#xFF0C;&#x76F4;&#x63A5;&#x4ECE;&#x7F13;&#x5B58;&#x4E2D;&#x83B7;&#x53D6;&#x7528;&#x6237;&#x4FE1;&#x606F;&#x3002;</li>
</ul>
<blockquote>
<p>Mybatis &#x9ED8;&#x8BA4;&#x5C31;&#x662F;&#x4F7F;&#x7528;&#x4E00;&#x6B21;&#x7F13;&#x5B58;&#x7684;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x914D;&#x7F6E;&#x3002;
<strong>&#x4E00;&#x7EA7;&#x7F13;&#x5B58;&#x4E2D;&#x5B58;&#x653E;&#x7684;&#x662F;&#x5BF9;&#x8C61;&#x3002;</strong>&#xFF08;&#x4E00;&#x7EA7;&#x7F13;&#x5B58;&#x5176;&#x5B9E;&#x5C31;&#x662F; Map &#x7ED3;&#x6784;&#xFF0C;&#x76F4;&#x63A5;&#x5B58;&#x653E;&#x5BF9;&#x8C61;&#xFF09; </p>
<p>mybatis&#x4E00;&#x7EA7;&#x7F13;&#x5B58;&#xFF0C;&#x7F13;&#x5B58;&#x5728;SqlSession&#x4E2D;&#x3002;</p>
<p>&#x4E00;&#x7EA7;&#x7F13;&#x5B58;&#x662F;&#x9ED8;&#x8BA4;&#x7684;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x914D;&#x7F6E;&#xFF0C;localCache&#x4E2D;&#x6CA1;&#x6709;&#x7F13;&#x5B58;&#x65F6;&#xFF0C;&#x624D;&#x53BB;&#x6267;&#x884C;queryFromDatabase&#x65B9;&#x6CD5;&#xFF0C;&#x53BB;&#x67E5;&#x8BE2;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x5E76;&#x5C06;&#x7ED3;&#x679C;&#x7F13;&#x5B58;&#x5230;localCache&#x4E2D;&#x3002;</p>
<p>MyBatis&#x7684;&#x4E00;&#x7EA7;&#x7F13;&#x5B58;&#x6700;&#x5927;&#x8303;&#x56F4;&#x662F;SqlSession&#x5185;&#x90E8;&#xFF0C;&#x6709;&#x591A;&#x4E2A;SqlSession&#x6216;&#x8005;&#x5206;&#x5E03;&#x5F0F;&#x7684;&#x73AF;&#x5883;&#x4E0B;&#xFF0C;&#x6570;&#x636E;&#x5E93;&#x5199;&#x64CD;&#x4F5C;&#x4F1A;&#x5F15;&#x8D77;&#x810F;&#x6570;&#x636E;&#xFF0C;&#x5EFA;&#x8BAE;&#x8BBE;&#x5B9A;&#x7F13;&#x5B58;&#x7EA7;&#x522B;&#x4E3A;Statement</p>
</blockquote>
<h6 id="&#x6E90;&#x7801;"><a name="&#x6E90;&#x7801;" class="anchor-navigation-ex-anchor" href="#&#x6E90;&#x7801;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6E90;&#x7801;</h6>
<pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">BaseExecutor</span> <span class="token keyword">implements</span> <span class="token class-name">Executor</span> <span class="token punctuation">{</span>

<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">MappedStatement</span> ms<span class="token punctuation">,</span> <span class="token class-name">Object</span> parameter<span class="token punctuation">,</span> <span class="token class-name">RowBounds</span> rowBounds<span class="token punctuation">,</span> <span class="token class-name">ResultHandler</span> resultHandler<span class="token punctuation">,</span> <span class="token class-name">CacheKey</span> key<span class="token punctuation">,</span> <span class="token class-name">BoundSql</span> boundSql<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
    <span class="token class-name">ErrorContext</span><span class="token punctuation">.</span><span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">resource</span><span class="token punctuation">(</span>ms<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">activity</span><span class="token punctuation">(</span><span class="token string">&quot;executing a query&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span>ms<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>closed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ExecutorException</span><span class="token punctuation">(</span><span class="token string">&quot;Executor was closed.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>queryStack <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> ms<span class="token punctuation">.</span><span class="token function">isFlushCacheRequired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clearLocalCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">List</span> list<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span>queryStack<span class="token punctuation">;</span>

            <span class="token comment">//&#x5728;&#x7F13;&#x5B58;&#x4E2D;&#x67E5;&#x627E;&#x662F;&#x5426;&#x6709;</span>
            list <span class="token operator">=</span> resultHandler <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>localCache<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>list <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleLocallyCachedOutputParameters</span><span class="token punctuation">(</span>ms<span class="token punctuation">,</span> key<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> boundSql<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                list <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">queryFromDatabase</span><span class="token punctuation">(</span>ms<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> rowBounds<span class="token punctuation">,</span> resultHandler<span class="token punctuation">,</span> key<span class="token punctuation">,</span> boundSql<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token operator">--</span><span class="token keyword">this</span><span class="token punctuation">.</span>queryStack<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>queryStack <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Iterator</span> var8 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>deferredLoads<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">while</span><span class="token punctuation">(</span>var8<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">BaseExecutor<span class="token punctuation">.</span>DeferredLoad</span> deferredLoad <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">BaseExecutor<span class="token punctuation">.</span>DeferredLoad</span><span class="token punctuation">)</span>var8<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                deferredLoad<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span>deferredLoads<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>configuration<span class="token punctuation">.</span><span class="token function">getLocalCacheScope</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">LocalCacheScope</span><span class="token punctuation">.</span>STATEMENT<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clearLocalCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> list<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;"><a name="&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;" class="anchor-navigation-ex-anchor" href="#&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;</h4>
<ul>
<li>&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#x662F; <strong>Mapper</strong> &#x6620;&#x5C04;&#x7EA7;&#x522B;&#x7684;&#x7F13;&#x5B58;&#xFF0C;&#x591A;&#x4E2A; SqlSession &#x53BB;&#x64CD;&#x4F5C;&#x540C;&#x4E00;&#x4E2A; Mapper &#x6620;&#x5C04;&#x7684; SQL &#x8BED;&#x53E5;&#xFF0C;&#x591A;&#x4E2A;SqlSession &#x53EF;&#x4EE5;&#x5171;&#x7528;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#xFF0C;<strong>&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#x662F;&#x8DE8; SqlSession &#x7684;</strong>&#x3002;</li>
</ul>
<p>&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;</p>
<p><a href="https://img-blog.csdnimg.cn/20200206103408586.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ExMDkyODgyNTgw,size_16,color_FFFFFF,t_70#pic_center" data-lightbox="dce0fe71-a7d3-4400-b710-4ec41339c3c1" data-title="img" target="_blank"><img src="https://img-blog.csdnimg.cn/20200206103408586.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ExMDkyODgyNTgw,size_16,color_FFFFFF,t_70#pic_center" alt="img"></a></p>
<p><a href="https://img2018.cnblogs.com/blog/1383365/201906/1383365-20190628180149776-546074458.png" data-lightbox="e637c59a-77ef-43ec-a091-90156278af5d" data-title="img" target="_blank"><img src="https://img2018.cnblogs.com/blog/1383365/201906/1383365-20190628180149776-546074458.png" alt="img"></a></p>
<ul>
<li>&#x5F53; sqlSession1 &#x53BB;&#x67E5;&#x8BE2;&#x7528;&#x6237;&#x4FE1;&#x606F;&#x7684;&#x65F6;&#x5019;&#xFF0C;Mybatis &#x4F1A;&#x5C06;&#x67E5;&#x8BE2;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x5230;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#x4E2D;&#x3002;</li>
<li>&#x5982;&#x679C; sqlSession3 &#x53BB;&#x6267;&#x884C;&#x76F8;&#x540C; Mapper &#x6620;&#x5C04;&#x4E0B;&#x7684; SQL &#x8BED;&#x53E5;&#xFF0C;&#x5E76;&#x4E14;&#x6267;&#x884C; commit &#x63D0;&#x4EA4;&#xFF0C;&#x90A3;&#x4E48; Mybatis &#x5C06;&#x4F1A;&#x6E05;&#x7A7A;&#x8BE5; Mapper &#x6620;&#x5C04;&#x4E0B;&#x7684;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#x533A;&#x57DF;&#x7684;&#x6570;&#x636E;&#x3002;</li>
<li>sqlSession2 &#x53BB;&#x67E5;&#x8BE2;&#x4E0E; sqlSession1 &#x76F8;&#x540C;&#x7684;&#x7528;&#x6237;&#x4FE1;&#x606F;&#xFF0C;Mybatis &#x9996;&#x5148;&#x4F1A;&#x53BB;&#x7F13;&#x5B58;&#x4E2D;&#x627E;&#x662F;&#x5426;&#x5B58;&#x5728;&#x6570;&#x636E;&#xFF0C;&#x5982;&#x679C;&#x5B58;&#x5728;&#x76F4;&#x63A5;&#x4ECE;&#x7F13;&#x5B58;&#x4E2D;&#x53D6;&#x51FA;&#x6570;&#x636E;&#x3002;</li>
<li>&#x5982;&#x679C;&#x60F3;&#x4F7F;&#x7528; Mybatis &#x7684;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#xFF0C;&#x90A3;&#x4E48;&#x5E94;&#x8BE5;&#x505A;&#x4EE5;&#x4E0B;&#x914D;&#x7F6E;<ul>
<li>&#x9996;&#x5148;&#x5728; Mybatis &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x6DFB;&#x52A0;&#x914D;&#x7F6E; <strong>&#xFF08;&#x8FD9;&#x4E00;&#x6B65;&#x5176;&#x5B9E;&#x53EF;&#x4EE5;&#x5FFD;&#x7565;&#xFF0C;&#x56E0;&#x4E3A;&#x9ED8;&#x8BA4;&#x503C;&#x4E3A; true&#xFF09;</strong></li>
</ul>
</li>
</ul>
<pre class="language-"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- &#x5F00;&#x542F;&#x7F13;&#x5B58; --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cacheEnabled<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">&gt;</span></span>
</code></pre><ul>
<li>&#x63A5;&#x7740;&#x5728;&#x6620;&#x5C04;&#x6587;&#x4EF6;&#x4E2D;&#x914D;&#x7F6E;</li>
</ul>
<pre class="language-"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.ykf.mapper.UserMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- &#x4F7F;&#x7528;&#x7F13;&#x5B58; --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre><ul>
<li>&#x6700;&#x540E;&#x5728;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#x7684;&#x64CD;&#x4F5C;&#x4E0A;&#x914D;&#x7F6E; <strong>&#xFF08;&#x9488;&#x5BF9;&#x6BCF;&#x6B21;&#x67E5;&#x8BE2;&#x90FD;&#x9700;&#x8981;&#x6700;&#x65B0;&#x6570;&#x636E;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x8981;&#x8BBE;&#x7F6E;&#x6210; <code>useCache=&quot;false&quot;</code>&#xFF0C;&#x7981;&#x7528;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#xFF09;</strong></li>
</ul>
<p>```<select id="listAllUsers" resultmap="UserWithAccountsMap" usecache="true"></select></p>
<p><select id="listAllUsers" resultmap="UserWithAccountsMap" usecache="true">
    SELECT * FROM user
</select></p>
<pre class="language-"><code>
&gt; - &#x5F53;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6240;&#x7F13;&#x5B58;&#x7684;&#x7C7B;&#x4E00;&#x5B9A;&#x8981;**&#x5B9E;&#x73B0; `java.io.Serializable` &#x63A5;&#x53E3;**&#xFF0C;&#x8FD9;&#x6837;&#x624D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5E8F;&#x5217;&#x5316;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x4FDD;&#x5B58;&#x5BF9;&#x8C61;&#x3002;
&gt; - &#x7531;&#x4E8E;&#x662F;&#x5E8F;&#x5217;&#x5316;&#x4FDD;&#x5B58;&#x5BF9;&#x8C61;&#xFF0C;&#x6240;&#x4EE5;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#x4E2D;&#x5B58;&#x653E;&#x7684;&#x662F;&#x6570;&#x636E;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x6574;&#x4E2A;&#x5BF9;&#x8C61;&#x3002;

###### &#x6E90;&#x7801;

* &#x9996;&#x5148;&#xFF0C;excutor&#x662F;&#x5728;sqlsessionfactory&#x521B;&#x5EFA;sqlsession&#x65F6;&#x521B;&#x5EFA;&#x7684;&#xFF0C;&#x7528;&#x4EE5;&#x4F5C;&#x4E3A;sqlsession&#x7684;&#x53C2;&#x6570;&#x4F20;&#x5165;

```java
public class DefaultSqlSessionFactory implements SqlSessionFactory {

private SqlSession openSessionFromDataSource(ExecutorType execType, TransactionIsolationLevel level, boolean autoCommit) {
    Transaction tx = null;

    DefaultSqlSession var8;
    try {
        Environment environment = this.configuration.getEnvironment();
        TransactionFactory transactionFactory = this.getTransactionFactoryFromEnvironment(environment);
        tx = transactionFactory.newTransaction(environment.getDataSource(), level, autoCommit);
        Executor executor = this.configuration.newExecutor(tx, execType);
        var8 = new DefaultSqlSession(this.configuration, executor, autoCommit);
    } catch (Exception var12) {
        this.closeTransaction(tx);
        throw ExceptionFactory.wrapException(&quot;Error opening session.  Cause: &quot; + var12, var12);
    } finally {
        ErrorContext.instance().reset();
    }

    return var8;
}
</code></pre><ul>
<li>&#x63A5;&#x7740;&#x770B;&#x4E0B;excutor&#x6709;&#x4EC0;&#x4E48;&#x7C7B;&#x578B;</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Configuration</span> <span class="token punctuation">{</span>
 <span class="token keyword">public</span> <span class="token class-name">Executor</span> <span class="token function">newExecutor</span><span class="token punctuation">(</span><span class="token class-name">Transaction</span> transaction<span class="token punctuation">,</span> <span class="token class-name">ExecutorType</span> executorType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        executorType <span class="token operator">=</span> executorType <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>defaultExecutorType <span class="token operator">:</span> executorType<span class="token punctuation">;</span>
        executorType <span class="token operator">=</span> executorType <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token class-name">ExecutorType</span><span class="token punctuation">.</span>SIMPLE <span class="token operator">:</span> executorType<span class="token punctuation">;</span>
        <span class="token class-name">Object</span> executor<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ExecutorType</span><span class="token punctuation">.</span>BATCH <span class="token operator">==</span> executorType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            executor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BatchExecutor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> transaction<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ExecutorType</span><span class="token punctuation">.</span>REUSE <span class="token operator">==</span> executorType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            executor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReuseExecutor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> transaction<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            executor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleExecutor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> transaction<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cacheEnabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            executor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CachingExecutor</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Executor</span><span class="token punctuation">)</span>executor<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//&#x88C5;&#x9970;&#x524D;&#x9762;&#x7684;&#x4E09;&#x4E2A;executor</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Executor</span> executor <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Executor</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>interceptorChain<span class="token punctuation">.</span><span class="token function">pluginAll</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> executor<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x5982;&#x679C;&#x5F00;&#x542F;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#xFF0C;cachingExecutor&#x4F1A;&#x88AB;&#x4F5C;&#x4E3A;&#x88C5;&#x9970;&#x7C7B;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x8BF4;&#x662F;&#x88C5;&#x9970;&#x7C7B;&#x5462;</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CachingExecutor</span> <span class="token keyword">implements</span> <span class="token class-name">Executor</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Executor</span> delegate<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">TransactionalCacheManager</span> tcm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransactionalCacheManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">CachingExecutor</span><span class="token punctuation">(</span><span class="token class-name">Executor</span> delegate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>delegate <span class="token operator">=</span> delegate<span class="token punctuation">;</span>
        delegate<span class="token punctuation">.</span><span class="token function">setExecutorWrapper</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Transaction</span> <span class="token function">getTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>delegate<span class="token punctuation">.</span><span class="token function">getTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> forceRollback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>forceRollback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>tcm<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>tcm<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>delegate<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>forceRollback<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isClosed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>delegate<span class="token punctuation">.</span><span class="token function">isClosed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">MappedStatement</span> ms<span class="token punctuation">,</span> <span class="token class-name">Object</span> parameterObject<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">flushCacheIfRequired</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//&#x5237;&#x65B0;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>delegate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>ms<span class="token punctuation">,</span> parameterObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">MappedStatement</span> ms<span class="token punctuation">,</span> <span class="token class-name">Object</span> parameterObject<span class="token punctuation">,</span> <span class="token class-name">RowBounds</span> rowBounds<span class="token punctuation">,</span> <span class="token class-name">ResultHandler</span> resultHandler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token class-name">BoundSql</span> boundSql <span class="token operator">=</span> ms<span class="token punctuation">.</span><span class="token function">getBoundSql</span><span class="token punctuation">(</span>parameterObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CacheKey</span> key <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createCacheKey</span><span class="token punctuation">(</span>ms<span class="token punctuation">,</span> parameterObject<span class="token punctuation">,</span> rowBounds<span class="token punctuation">,</span> boundSql<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>ms<span class="token punctuation">,</span> parameterObject<span class="token punctuation">,</span> rowBounds<span class="token punctuation">,</span> resultHandler<span class="token punctuation">,</span> key<span class="token punctuation">,</span> boundSql<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">MappedStatement</span> ms<span class="token punctuation">,</span> <span class="token class-name">Object</span> parameterObject<span class="token punctuation">,</span> <span class="token class-name">RowBounds</span> rowBounds<span class="token punctuation">,</span> <span class="token class-name">ResultHandler</span> resultHandler<span class="token punctuation">,</span> <span class="token class-name">CacheKey</span> key<span class="token punctuation">,</span> <span class="token class-name">BoundSql</span> boundSql<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Cache</span> cache <span class="token operator">=</span> ms<span class="token punctuation">.</span><span class="token function">getCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cache <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">flushCacheIfRequired</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>ms<span class="token punctuation">.</span><span class="token function">isUseCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> resultHandler <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ensureNoOutParams</span><span class="token punctuation">(</span>ms<span class="token punctuation">,</span> parameterObject<span class="token punctuation">,</span> boundSql<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>tcm<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span>cache<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#x4E2D;&#x5B58;&#x5728;&#x5219;&#x5728;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#x4E2D;&#x8BFB;&#x53D6;
                <span class="token keyword">if</span> <span class="token punctuation">(</span>list <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//&#x82E5;&#x662F;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#x6CA1;&#x6709;&#xFF0C;&#x5219;&#x5230;&#x4E00;&#x7EA7;&#x7F13;&#x5B58;&#x4E2D;&#x67E5;&#x8BE2;</span>
                    list <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>delegate<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>ms<span class="token punctuation">,</span> parameterObject<span class="token punctuation">,</span> rowBounds<span class="token punctuation">,</span> resultHandler<span class="token punctuation">,</span> key<span class="token punctuation">,</span> boundSql<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>tcm<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span>cache<span class="token punctuation">,</span> key<span class="token punctuation">,</span> list<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//&#x4FDD;&#x5B58;&#x5230;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#x4E2D;</span>
                <span class="token punctuation">}</span>

                <span class="token keyword">return</span> list<span class="token punctuation">;</span><span class="token comment">//&#x8FD4;&#x56DE;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>delegate<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>ms<span class="token punctuation">,</span> parameterObject<span class="token punctuation">,</span> rowBounds<span class="token punctuation">,</span> resultHandler<span class="token punctuation">,</span> key<span class="token punctuation">,</span> boundSql<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BatchResult</span><span class="token punctuation">&gt;</span></span> <span class="token function">flushStatements</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>delegate<span class="token punctuation">.</span><span class="token function">flushStatements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">commit</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> required<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>delegate<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span>required<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>tcm<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">rollback</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> required<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>delegate<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span>required<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>required<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>tcm<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<ul>
<li><p>&#x53EF;&#x4EE5;&#x4ECE;commit&#x7B49;&#x4E8B;&#x52A1;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x6765;&#x662F;&#x7531;&#x4F20;&#x5165;&#x7684;excutor&#xFF08;delegate&#xFF09;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x4E0E;TransactionalCacheManager tcm&#x8F85;&#x52A9;&#x5B8C;&#x6210;&#x529F;&#x80FD;&#xFF0C;&#x53EA;&#x6709;query&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x4E86;&#x529F;&#x80FD;&#xFF0C;&#x5373;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#xFF0C;&#x4ECE;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x4ED6;&#x662F;&#x5148;&#x8BFB;&#x53D6;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#x6709;&#x65E0;&#x5185;&#x5BB9;&#xFF0C;&#x6CA1;&#x6709;&#x518D;&#x5230;&#x4E00;&#x7EA7;&#x7F13;&#x5B58;&#x4E2D;&#x67E5;&#x770B;&#xFF0C;&#x6CA1;&#x6709;&#x518D;&#x53BB;&#x6570;&#x636E;&#x5E93;&#x67E5;&#x8BE2;&#xFF0C;&#x518D;&#x4FDD;&#x5B58;&#x5230;&#x4E00;&#x7EA7;&#x7F13;&#x5B58;&#xFF08;&#x82E5;commit&#x6216;&#xFF09;&#xFF0C;&#x6700;&#x540E;&#x8FD4;&#x8FD8;&#x7ED9;&#x7528;&#x6237;&#x3002;</p>
</li>
<li><p>&#x56E0;&#x4E3A;&#x4E00;&#x4E2A;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#x5BF9;&#x5E94;&#x591A;&#x4E2A;&#x4E00;&#x7EA7;&#x7F13;&#x5B58;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;sqlsession&#x9700;&#x8981;&#x5237;&#x65B0;&#x5BFC;&#x81F4;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#x5237;&#x65B0;&#x65F6;&#xFF0C;&#x5176;&#x4ED6;sqlsession&#x7684;&#x4E0E;&#x8BE5;sqlsession&#x65E0;&#x5173;&#x8054;&#x7684;&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x5728;&#x4E00;&#x7EA7;&#x7F13;&#x5B58;&#x4E2D;&#x83B7;&#x53D6;&#x5C31;&#x884C;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x662F;&#x76F8;&#x5173;&#x8054;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x6B64;&#x65F6;&#x53C8;&#x7528;&#x5176;&#x4ED6;&#x7684;sqlsession&#x6765;&#x67E5;&#x627E;&#xFF0C;&#x5176;&#x4ED6;sqlsession&#x7684;&#x4E00;&#x7EA7;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x662F;&#x5426;&#x5B58;&#x5728;&#x8FC7;&#x671F;&#x73B0;&#x8C61;&#x3002;&#xFF08;&#x4E0D;&#x540C;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF1F;&#xFF09;<strong>&#x8FD9;&#x5C31;&#x6D89;&#x53CA;&#x5230;&#x4E00;&#x7EA7;&#x7F13;&#x5B58;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x63D0;&#x4EA4;&#x6570;&#x636E;&#x5230;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#x4E2D;&#x7684;&#x95EE;&#x9898;&#x4E86;</strong>&#xFF1A;</p>
<p><strong>&#x53EA;&#x6709;&#x4F1A;&#x8BDD;&#x5173;&#x95ED;&#x6216;&#x63D0;&#x4EA4;&#x540E;&#xFF0C;&#x4E00;&#x7EA7;&#x7F13;&#x5B58;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x624D;&#x4F1A;&#x8F6C;&#x79FB;&#x5230;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#x4E2D;,&#x5E76;&#x4E14;&#x53EA;&#x6709;&#x662F;&#x540C;&#x4E00;&#x4E2A;namespace&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x5230;&#x6570;&#x636E;&#xFF1B;&#x56E0;&#x4E3A;mybatis&#x7684;&#x7F13;&#x5B58;&#x4F1A;&#x88AB;&#x4E00;&#x4E2A;transactioncache&#x7C7B;&#x5305;&#x88C5;&#x4F4F;&#xFF0C;&#x6240;&#x6709;&#x7684;cache.putObject&#x5168;&#x90E8;&#x90FD;&#x4F1A;&#x88AB;&#x6682;&#x65F6;&#x5B58;&#x5230;&#x4E00;&#x4E2A;map&#x91CC;&#xFF0C;&#x7B49;&#x4F1A;&#x8BDD;commit/close&#x4EE5;&#x540E;&#xFF0C;&#x8FD9;&#x4E2A;map&#x91CC;&#x7684;&#x7F13;&#x5B58;&#x5BF9;&#x8C61;&#x624D;&#x4F1A;&#x88AB;&#x771F;&#x6B63;&#x7684;cache&#x7C7B;&#x6267;&#x884C;putObject&#x64CD;&#x4F5C;&#x3002;&#x8FD9;&#x4E48;&#x8BBE;&#x8BA1;&#x7684;&#x539F;&#x56E0;&#x662F;&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x4E8B;&#x52A1;&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#x4E2D;&#x51FA;&#x5F02;&#x5E38;&#x5BFC;&#x81F4;&#x56DE;&#x6EDA;&#xFF0C;&#x5982;&#x679C;get&#x5230;object&#x540E;&#x76F4;&#x63A5;put&#x8FDB;&#x7F13;&#x5B58;&#xFF0C;&#x4E07;&#x4E00;&#x53D1;&#x751F;&#x56DE;&#x6EDA;&#xFF0C;&#x5C31;&#x5F88;&#x5BB9;&#x6613;&#x5BFC;&#x81F4;mybatis&#x7F13;&#x5B58;&#x88AB;&#x810F;&#x8BFB;</strong></p>
<ul>
<li>&#x8FD9;&#x5C31;&#x4FDD;&#x8BC1;&#x4E86;select&#x5C31;&#x4E0D;&#x4F1A;&#x5230;&#x8FBE;&#x540C;&#x7684;&#x5176;&#x4ED6;&#x7684;sqlsession&#x7684;cache&#x4E2D;&#x4E86;&#xFF0C;&#x82E5;&#x662F;update&#x6210;&#x529F;&#xFF0C;&#x5219;commit&#x6210;&#x529F;&#xFF0C;&#x6570;&#x636E;&#x4E0A;&#x4F20;&#x5230;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#x4E2D;&#xFF0C;&#x5BF9;&#x8BE5;sqlsession&#x7684;&#x6570;&#x636E;&#x8BBF;&#x95EE;&#x4F1A;&#x76F4;&#x63A5;&#x5728;&#x4E8C;&#x7EA7;&#x5185;&#x5B58;&#x8BFB;&#x53D6;&#xFF0C;&#x82E5;&#x662F;&#x5931;&#x8D25;&#xFF0C;&#x5219;&#x4E0D;&#x4F1A;commit&#xFF0C;&#x5219;&#x4E0D;&#x4F1A;&#x4E0A;&#x4F20;&#x5230;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#x4E2D;&#xFF0C;&#x6570;&#x636E;&#x56E0;&#x4E3A;&#x5931;&#x8D25;&#x4ECD;&#x5E94;&#x662F;&#x539F;&#x6765;&#x7684;&#x6570;&#x636E;&#x624D;&#x662F;&#x5BF9;&#x7684;&#xFF0C;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x6CA1;&#x6709;&#x6536;&#x5230;commit&#x6216;close&#x540E;&#x4F20;&#x6765;&#x7684;&#x6570;&#x636E;&#x800C;&#x4E0D;&#x53D8;&#xFF0C;&#x7EE7;&#x7EED;&#x7B49;&#x5F85;&#x76F8;&#x5E94;&#x7684;sqlsession &#x8FDB;&#x884C;commit/close</li>
</ul>
</li>
<li><p>UserMapper&#x6709;&#x4E00;&#x4E2A;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#x533A;&#x57DF;&#xFF08;&#x6309;namespace&#x5206;&#xFF0C;&#x5982;&#x679C;namespace&#x76F8;&#x540C;&#x5219;&#x4F7F;&#x7528;&#x540C;&#x4E00;&#x4E2A;&#x76F8;&#x540C;&#x7684;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#x533A;&#xFF09;&#xFF0C;&#x5176;&#x5B83;mapper&#x4E5F;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#x533A;&#x57DF;&#xFF08;&#x6309;namespace&#x5206;&#xFF09;</p>
</li>
<li><p>&#x6BCF;&#x4E00;&#x4E2A;namespace&#x7684;mapper&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x4E8C;&#x7F13;&#x5B58;&#x533A;&#x57DF;&#xFF0C;&#x4E24;&#x4E2A;mapper&#x7684;namespace&#x5982;&#x679C;&#x76F8;&#x540C;&#xFF0C;&#x8FD9;&#x4E24;&#x4E2A;mapper&#x6267;&#x884C;sql&#x67E5;&#x8BE2;&#x5230;&#x6570;&#x636E;&#x5C06;&#x5B58;&#x5728;&#x76F8;&#x540C;&#x7684;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#x533A;&#x57DF;&#x4E2D;&#x3002;</p>
</li>
<li><p>mybatis&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#x7684;&#x5C40;&#x9650;&#x6027;&#xFF1A;</p>
<blockquote>
<p>&#x7EC6;&#x7C92;&#x5EA6;&#x7F13;&#x5B58;&#x5C31;&#x662F;&#xFF0C;&#x9488;&#x5BF9;&#x67D0;&#x4E2A;&#x5546;&#x54C1;&#xFF0C;&#x5982;&#x679C;&#x8981;&#x4FEE;&#x6539;&#x5176;&#x4FE1;&#x606F;&#xFF0C;&#x53EA;&#x4FEE;&#x6539;&#x8BE5;&#x5546;&#x54C1;&#x7684;&#x7F13;&#x5B58;&#x6570;&#x636E;&#xFF0C;&#x7F13;&#x5B58;&#x533A;&#x7684;&#x5176;&#x4ED6;&#x6570;&#x636E;&#x4E0D;&#x52A8;&#xFF08;&#x4E0D;&#x4F1A;&#x56E0;&#x4E3A;&#x67D0;&#x4E2A;&#x5546;&#x54C1;&#x4FE1;&#x606F;&#x7684;&#x4FEE;&#x6539;&#x5C31;&#x76F4;&#x63A5;&#x6E05;&#x7A7A;&#x6574;&#x4E2A;&#x7F13;&#x5B58;&#x533A;&#xFF09;</p>
</blockquote>
<p>mybatis&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#x5BF9;&#x7EC6;&#x7C92;&#x5EA6;&#x7EA7;&#x522B;&#x7684;&#x7F13;&#x5B58;&#x5B9E;&#x73B0;&#x4E0D;&#x597D;&#xFF0C;&#x6BD4;&#x5982;&#x5982;&#x4E0B;&#x9700;&#x6C42;&#xFF1A;
&#x5BF9;&#x5546;&#x54C1;&#x4FE1;&#x606F;&#x8FDB;&#x884C;&#x7F13;&#x5B58;&#xFF0C; &#x7531;&#x4E8E;&#x5546;&#x54C1;&#x4FE1;&#x606F;&#x67E5;&#x8BE2;&#x8BBF;&#x95EE;&#x91CF;&#x5927;&#xFF0C;&#x4F46;&#x662F;&#x8981;&#x6C42;&#x7528;&#x6237;&#x6BCF;&#x6B21;&#x90FD;&#x80FD;&#x67E5;&#x8BE2;&#x5230;&#x6700;&#x65B0;&#x7684;&#x5546;&#x54C1;&#x4FE1;&#x606F;&#xFF0C;&#x6B64;&#x65F6;&#x5982;&#x679C;&#x4F7F;&#x7528;mybatis&#x7684;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#xFF0C;&#x5C31;&#x65E0;&#x6CD5;&#x5B9E;&#x73B0;&#x5F53;&#x4E00;&#x4E2A;&#x5546;&#x54C1;&#x4FE1;&#x606F;&#x53D8;&#x5316;&#x65F6;&#xFF0C;&#x53EA;&#x5237;&#x65B0;&#x8BE5;&#x5546;&#x54C1;&#x7684;&#x7F13;&#x5B58;&#x4FE1;&#x606F;&#xFF0C;&#x800C;&#x4E0D;&#x5237;&#x65B0;&#x5176;&#x5B83;&#x5546;&#x54C1;&#x7684;&#x4FE1;&#x606F;&#x3002;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;mybatis&#x7684;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#x533A;&#x57DF;&#x4EE5;mapper&#x4E3A;&#x5355;&#x4F4D;&#x8FDB;&#x884C;&#x5212;&#x5206;&#xFF0C;&#x5F53;&#x4E00;&#x4E2A;&#x5546;&#x54C1;&#x4FE1;&#x606F;&#x53D8;&#x5316;&#x65F6;&#xFF08;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;mapper&#x7684;&#x4EFB;&#x610F;&#x4E00;&#x4E2A;sqlSession&#x6267;&#x884C;commt&#x64CD;&#x4F5C;&#xFF09;&#xFF0C;&#x4F1A;&#x5C06;&#x6240;&#x6709;&#x5546;&#x54C1;&#x4FE1;&#x606F;&#x7684;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x5168;&#x90E8;&#x6E05;&#x7A7A;&#x3002;&#x89E3;&#x51B3;&#x6B64;&#x95EE;&#x9898;&#xFF0C;&#x9700;&#x8981;&#x5728;&#x4E1A;&#x52A1;&#x5C42;&#x6839;&#x636E;&#x9700;&#x6C42;&#x5BF9;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x9488;&#x5BF9;&#x6027;&#x7684;&#x7F13;&#x5B58;&#xFF08;&#x4E09;&#x7EA7;&#x7F13;&#x5B58;&#xFF09;&#x3002;</p>
</li>
</ul>
<h2 id="&#x6CE8;&#x89E3;&#x5F00;&#x53D1;"><a name="&#x6CE8;&#x89E3;&#x5F00;&#x53D1;" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x89E3;&#x5F00;&#x53D1;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x89E3;&#x5F00;&#x53D1;</h2>
<p>Mybatis &#x4E2D;&#x7684;&#x6CE8;&#x89E3;&#x5F00;&#x53D1;
&#x5728; Mybatis &#x7684;&#x6CE8;&#x89E3;&#x5F00;&#x53D1;&#x4E2D;&#xFF0C;&#x5E38;&#x7528;&#x7684;&#x6CE8;&#x89E3;&#x5982;&#x4E0B;&#x8868;&#x6240;&#x793A;&#xFF1A;
&#x6CE8;&#x89E3;    &#x4F5C;&#x7528;
@Intsert    &#x5B9E;&#x73B0;&#x65B0;&#x589E;
@Update    &#x5B9E;&#x73B0;&#x66F4;&#x65B0;
@Delete    &#x5B9E;&#x73B0;&#x5220;&#x9664;
@Select    &#x5B9E;&#x73B0;&#x67E5;&#x8BE2;
@Results    &#x5B9E;&#x73B0;&#x7ED3;&#x679C;&#x96C6;&#x5C01;&#x88C5;
@ResultMap    &#x5B9E;&#x73B0;&#x5F15;&#x7528; @Results &#x5B9A;&#x4E49;&#x7684;&#x5C01;&#x88C5;
@One    &#x5B9E;&#x73B0;&#x4E00;&#x5BF9;&#x4E00;&#x7ED3;&#x679C;&#x96C6;&#x5C01;&#x88C5;
@Many    &#x5B9E;&#x73B0;&#x4E00;&#x5BF9;&#x591A;&#x7ED3;&#x679C;&#x96C6;&#x5C01;&#x88C5;
@SelectProvider    &#x5B9E;&#x73B0;&#x52A8;&#x6001; SQL &#x6620;&#x5C04;</p>
<h3 id="mybatis-&#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x5B9E;&#x73B0;&#x5355;&#x8868;-curd"><a name="mybatis-&#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x5B9E;&#x73B0;&#x5355;&#x8868;-curd" class="anchor-navigation-ex-anchor" href="#mybatis-&#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x5B9E;&#x73B0;&#x5355;&#x8868;-curd"><i class="fa fa-link" aria-hidden="true"></i></a>Mybatis &#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x5B9E;&#x73B0;&#x5355;&#x8868; CURD</h3>
<ul>
<li>&#x7528;&#x6237;&#x5B9E;&#x4F53;&#x7C7B;&#x63A5;&#x53E3;&#x5C42; <code>UserMapper</code> &#x4EE3;&#x7801;&#x5982;&#x4E0B;</li>
</ul>
<pre class="language-"><code>public interface UserMapper {
    /**
     * &#x67E5;&#x8BE2;&#x6240;&#x6709;&#x7528;&#x6237;
     *
     * @return
     */
    @Select(&quot;SELECT * FROM user&quot;)
    List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>User</span><span class="token punctuation">&gt;</span></span> listAllUsers();

    /**
     * &#x6DFB;&#x52A0;&#x7528;&#x6237;
     *
     * @param user
     * @return &#x6210;&#x529F;&#x8FD4;&#x56DE;1&#xFF0C;&#x5931;&#x8D25;&#x8FD4;&#x56DE;0
     */
    @Insert(&quot;INSERT INTO user(username,birthday,sex,address) VALUES(#{username},#{birthday},#{sex},#{address})&quot;)
    @SelectKey(keyProperty = &quot;id&quot;, keyColumn = &quot;id&quot;, statement = &quot;SELECT LAST_INSERT_ID()&quot;, resultType = Integer.class, before = false)
    int saveUser(User user);

    /**
     * &#x6839;&#x636E;id&#x5220;&#x9664;&#x7528;&#x6237;
     *
     * @param userId
     * @return &#x6210;&#x529F;&#x8FD4;&#x56DE;1&#xFF0C;&#x5931;&#x8D25;&#x8FD4;&#x56DE;0
     */
    @Delete(&quot;DELETE FROM user WHERE id = #{id}&quot;)
    int removeUserById(Integer userId);

    /**
     * &#x4FEE;&#x6539;&#x7528;&#x6237;
     *
     * @param user
     * @return &#x6210;&#x529F;&#x8FD4;&#x56DE;1&#xFF0C;&#x5931;&#x8D25;&#x8FD4;&#x56DE;0
     */
    @Update(&quot;UPDATE user SET username = #{username}, birthday = #{birthday}, sex = #{sex}, address = #{address} WHERE id = #{id}&quot;)
    int updateUser(User user);

    /**
     * &#x6839;&#x636E;id&#x67E5;&#x8BE2;&#x5355;&#x4E2A;&#x7528;&#x6237;
     *
     * @param userId
     * @return
     */
    @Select(&quot;SELECT * FROM user WHERE id = #{id}&quot;)
    User getUserById(Integer userId);

    /**
     * &#x6839;&#x636E;&#x59D3;&#x540D;&#x6A21;&#x7CCA;&#x67E5;&#x8BE2;&#x591A;&#x4E2A;&#x7528;&#x6237;
     *
     * @param username
     * @return
     */
    @Select(&quot;SELECT * FROM user WHERE username LIKE CONCAT(&apos;%&apos;,#{username},&apos;%&apos;)&quot;)
    List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>User</span><span class="token punctuation">&gt;</span></span> listUsersByName(String username);

    /**
     * &#x67E5;&#x8BE2;&#x7528;&#x6237;&#x603B;&#x6570;
     *
     * @return
     */
    @Select(&quot;SELECT COUNT(id) FROM user&quot;)
    int countUser();
}
</code></pre><ul>
<li>&#x6CE8;&#x610F;&#xFF0C;&#x5982;&#x679C;&#x6B64;&#x65F6;<strong>&#x5B9E;&#x4F53;&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#x4E0E;&#x6570;&#x636E;&#x5E93;&#x8868;&#x5217;&#x540D;&#x4E0D;&#x4E00;&#x81F4;</strong>&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;<code>@Results&#x3001;@Result&#x3001;@ResultMap</code> &#x7B49;&#x6CE8;&#x89E3;&#xFF0C;&#x5982;&#x4E0B;</li>
</ul>
<pre class="language-"><code>public interface UserMapper {
    /**
     * &#x67E5;&#x8BE2;&#x6240;&#x6709;&#x7528;&#x6237;
     *
     * @return
     */
    @Select(&quot;SELECT * FROM user&quot;)
    @Results(id = &quot;UserMap&quot;,value = {
            @Result(id = true,property = &quot;userId&quot;,column = &quot;id&quot;),
            @Result(property = &quot;userName&quot;,column = &quot;username&quot;),
            @Result(property = &quot;userBirthday&quot;,column = &quot;birthday&quot;),
            @Result(property = &quot;userSex&quot;,column = &quot;sex&quot;),
            @Result(property = &quot;userAddress&quot;,column = &quot;address&quot;),
    })
    List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>User</span><span class="token punctuation">&gt;</span></span> listAllUsers();

    /**
     * &#x6DFB;&#x52A0;&#x7528;&#x6237;
     *
     * @param user
     * @return &#x6210;&#x529F;&#x8FD4;&#x56DE;1&#xFF0C;&#x5931;&#x8D25;&#x8FD4;&#x56DE;0
     */
    @Insert(&quot;INSERT INTO user(username,birthday,sex,address) VALUES(#{username},#{birthday},#{sex},#{address})&quot;)
    @ResultMap(&quot;UserMap&quot;)
    int saveUser(User user);
</code></pre><blockquote>
<p>@Results &#x6CE8;&#x89E3;&#x7528;&#x4E8E;&#x5B9A;&#x4E49;&#x6620;&#x5C04;&#x7ED3;&#x679C;&#x96C6;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x6807;&#x7B7E; <resultmap></resultmap>&#x3002;
&#x5176;&#x4E2D;&#xFF0C;id &#x5C5E;&#x6027;&#x4E3A;&#x552F;&#x4E00;&#x6807;&#x8BC6;&#x3002;
value &#x5C5E;&#x6027;&#x7528;&#x4E8E;&#x63A5;&#x6536; @Result[] &#x6CE8;&#x89E3;&#x7C7B;&#x578B;&#x7684;&#x6570;&#x7EC4;&#x3002;
@Result &#x6CE8;&#x89E3;&#x7528;&#x4E8E;&#x5B9A;&#x4E49;&#x6620;&#x5C04;&#x5173;&#x7CFB;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x6807;&#x7B7E; <id> &#x548C; <result>
&#x5176;&#x4E2D;&#xFF0C;id &#x5C5E;&#x6027;&#x6307;&#x5B9A;&#x4E3B;&#x952E;&#x3002;
property &#x5C5E;&#x6027;&#x6307;&#x5B9A;&#x5B9E;&#x4F53;&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#x540D;&#xFF0C;column &#x5C5E;&#x6027;&#x6307;&#x5B9A;&#x6570;&#x636E;&#x5E93;&#x8868;&#x4E2D;&#x5BF9;&#x5E94;&#x7684;&#x5217;&#x3002;
@ResultMap &#x6CE8;&#x89E3;&#x7528;&#x4E8E;&#x5F15;&#x7528; @Results &#x5B9A;&#x4E49;&#x7684;&#x6620;&#x5C04;&#x7ED3;&#x679C;&#x96C6;&#xFF0C;&#x907F;&#x514D;&#x4E86;&#x91CD;&#x590D;&#x5B9A;&#x4E49;&#x6620;&#x5C04;&#x7ED3;&#x679C;&#x96C6;&#x3002;</result></id></p>
</blockquote>
<h3 id="mybatis-&#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x5B9E;&#x73B0;&#x591A;&#x5BF9;&#x4E00;&#xFF08;&#x4E00;&#x5BF9;&#x4E00;&#xFF09;"><a name="mybatis-&#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x5B9E;&#x73B0;&#x591A;&#x5BF9;&#x4E00;&#xFF08;&#x4E00;&#x5BF9;&#x4E00;&#xFF09;" class="anchor-navigation-ex-anchor" href="#mybatis-&#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x5B9E;&#x73B0;&#x591A;&#x5BF9;&#x4E00;&#xFF08;&#x4E00;&#x5BF9;&#x4E00;&#xFF09;"><i class="fa fa-link" aria-hidden="true"></i></a>Mybatis &#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x5B9E;&#x73B0;&#x591A;&#x5BF9;&#x4E00;&#xFF08;&#x4E00;&#x5BF9;&#x4E00;&#xFF09;</h3>
<p>&#x8FD8;&#x662F;&#x4EE5;&#x4E0A;&#x4E00;&#x7BC7;&#x7B14;&#x8BB0;&#x7684;&#x7528;&#x6237;&#x548C;&#x8D26;&#x6237;&#x4E3A;&#x4F8B;&#x5B50;&#x3002;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x6709;&#x591A;&#x4E2A;&#x8D26;&#x6237;&#xFF0C;&#x800C;&#x4E00;&#x4E2A;&#x8D26;&#x6237;&#x53EA;&#x80FD;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x3002;
&#x5728; Mybatis &#x4E2D;&#xFF0C;&#x591A;&#x5BF9;&#x4E00;&#x662F;&#x4F5C;&#x4E3A;&#x4E00;&#x5BF9;&#x4E00;&#x6765;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x7684;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x867D;&#x7136;&#x591A;&#x4E2A;&#x8D26;&#x6237;&#x53EF;&#x4EE5;&#x5C5E;&#x4E8E;&#x540C;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#xFF08;&#x591A;&#x5BF9;&#x4E00;&#xFF09;&#xFF0C;&#x4F46;&#x662F;&#x5728;&#x5B9E;&#x4F53;&#x7C7B;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x662F;&#x5728;&#x8D26;&#x6237;&#x7C7B;&#x4E2D;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x7C7B;&#x7684;&#x5BF9;&#x8C61;&#x5F15;&#x7528;&#xFF0C;&#x4EE5;&#x6B64;&#x6765;&#x8868;&#x660E;&#x6240;&#x5C5E;&#x7528;&#x6237;&#x3002;(&#x6B64;&#x65F6;&#x5C31;&#x76F8;&#x5F53;&#x4E8E;&#x4E00;&#x5BF9;&#x4E00;)
&#x8D26;&#x6237;&#x5B9E;&#x4F53;&#x7C7B;&#x548C;&#x7528;&#x6237;&#x5B9E;&#x4F53;&#x7C7B;&#x89C1;&#x4E0A;&#x7BC7;&#x7B14;&#x8BB0;&#xFF0C;&#x63A5;&#x53E3;&#x5C42;&#x4EE3;&#x7801;&#x5982;&#x4E0B;</p>
<pre class="language-"><code>public interface AccountMapper {
    /**
     * &#x67E5;&#x8BE2;&#x6240;&#x6709;&#x8D26;&#x6237;&#xFF0C;&#x5E76;&#x67E5;&#x8BE2;&#x6240;&#x5C5E;&#x7528;&#x6237;&#xFF0C;&#x91C7;&#x7528;&#x7ACB;&#x5373;&#x52A0;&#x8F7D;
     *
     * @return
     */
    @Select(&quot;SELECT * FROM account&quot;)
    @Results(id = &quot;AccountMap&quot;, value = {
            @Result(id = true, property = &quot;id&quot;, column = &quot;id&quot;),
            @Result(property = &quot;uid&quot;, column = &quot;uid&quot;),
            @Result(property = &quot;user&quot;, column = &quot;uid&quot;,
                    one = @One(select = &quot;cn.ykf.mapper.UserMapper.getUserById&quot;, fetchType = FetchType.EAGER))
    })
    List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Account</span><span class="token punctuation">&gt;</span></span> listAllAccounts();
}
</code></pre><pre class="language-"><code>public interface UserMapper {
    /**
     * &#x6839;&#x636E;id&#x67E5;&#x8BE2;&#x5355;&#x4E2A;&#x7528;&#x6237;
     *
     * @param userId
     * @return
     */
    @Select(&quot;SELECT * FROM user WHERE id = #{id}&quot;)
    User getUserById(Integer userId);
}
@One &#x6CE8;&#x89E3;&#x76F8;&#x5F53;&#x4E8E;&#x6807;&#x7B7E; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>association</span><span class="token punctuation">&gt;</span></span>&#xFF0C;&#x662F;&#x591A;&#x8868;&#x67E5;&#x8BE2;&#x7684;&#x5173;&#x952E;&#xFF0C;&#x5728;&#x6CE8;&#x89E3;&#x4E2D;&#x7528;&#x6765;&#x6307;&#x5B9A;&#x5B50;&#x67E5;&#x8BE2;&#x8FD4;&#x56DE;&#x5355;&#x4E00;&#x5BF9;&#x8C61;&#x3002;
&#x5176;&#x4E2D;&#xFF0C;select &#x5C5E;&#x6027;&#x6307;&#x5B9A;&#x7528;&#x4E8E;&#x67E5;&#x8BE2;&#x7684;&#x63A5;&#x53E3;&#x65B9;&#x6CD5;&#xFF0C;fetchType &#x5C5E;&#x6027;&#x7528;&#x4E8E;&#x6307;&#x5B9A;&#x7ACB;&#x5373;&#x52A0;&#x8F7D;&#x6216;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#xFF0C;&#x5206;&#x522B;&#x5BF9;&#x5E94; FetchType.EAGER &#x548C; FetchType.LAZY
&#x5728;&#x5305;&#x542B; @one &#x6CE8;&#x89E3;&#x7684; @Result &#x4E2D;&#xFF0C;column &#x5C5E;&#x6027;&#x7528;&#x4E8E;&#x6307;&#x5B9A;&#x5C06;&#x8981;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x8FDB;&#x884C;&#x67E5;&#x8BE2;&#x7684;&#x6570;&#x636E;&#x5E93;&#x8868;&#x5217;&#x3002;
</code></pre><h3 id="mybatis-&#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x5B9E;&#x73B0;&#x4E00;&#x5BF9;&#x591A;"><a name="mybatis-&#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x5B9E;&#x73B0;&#x4E00;&#x5BF9;&#x591A;" class="anchor-navigation-ex-anchor" href="#mybatis-&#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x5B9E;&#x73B0;&#x4E00;&#x5BF9;&#x591A;"><i class="fa fa-link" aria-hidden="true"></i></a>Mybatis &#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x5B9E;&#x73B0;&#x4E00;&#x5BF9;&#x591A;</h3>
<ul>
<li>&#x4E3A;&#x7528;&#x6237;&#x5B9E;&#x4F53;&#x7C7B;&#x6DFB;&#x52A0;&#x5305;&#x542B;&#x8D26;&#x6237;&#x5B9E;&#x4F53;&#x7C7B;&#x7684;&#x96C6;&#x5408;&#x5F15;&#x7528;&#xFF0C;&#x5177;&#x4F53;&#x4EE3;&#x7801;&#x89C1;&#x4E0A;&#x7BC7;&#x7B14;&#x8BB0;&#x3002;&#x63A5;&#x53E3;&#x5C42;&#x4EE3;&#x7801;&#x5982;&#x4E0B;</li>
</ul>
<pre class="language-"><code>public interface UserMapper {
    /**
     * &#x67E5;&#x8BE2;&#x6240;&#x6709;&#x7528;&#x6237;&#xFF0C;&#x5E76;&#x4E14;&#x67E5;&#x8BE2;&#x62E5;&#x6709;&#x8D26;&#x6237;&#xFF0C;&#x91C7;&#x7528;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;
     *
     * @return
     */
    @Select(&quot;SELECT * FROM user&quot;)
    @Results(id = &quot;UserMap&quot;, value = {
            @Result(id = true, property = &quot;userId&quot;, column = &quot;id&quot;),
            @Result(property = &quot;userName&quot;, column = &quot;username&quot;),
            @Result(property = &quot;userBirthday&quot;, column = &quot;birthday&quot;),
            @Result(property = &quot;userSex&quot;, column = &quot;sex&quot;),
            @Result(property = &quot;userAddress&quot;, column = &quot;address&quot;),
            @Result(property = &quot;accounts&quot;, column = &quot;id&quot;,
                    many = @Many(select = &quot;cn.ykf.mapper.AccountMapper.getAccountByUid&quot;, fetchType = FetchType.LAZY))
    })
    List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>User</span><span class="token punctuation">&gt;</span></span> listAllUsers();
</code></pre><pre class="language-"><code>public interface AccountMapper {
    /**
     * &#x6839;&#x636E;&#x7528;&#x6237;id&#x67E5;&#x8BE2;&#x8D26;&#x6237;&#x5217;&#x8868;
     *
     * @param uid
     * @return
     */
    @Select(&quot;SELECT * FROM account WHERE uid = #{uid}&quot;)
    List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Account</span><span class="token punctuation">&gt;</span></span> listAccountsByUid(Integer uid);
}
@Many &#x6CE8;&#x89E3;&#x76F8;&#x5F53;&#x4E8E;&#x6807;&#x7B7E; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">&gt;</span></span>&#xFF0C;&#x662F;&#x591A;&#x8868;&#x67E5;&#x8BE2;&#x7684;&#x5173;&#x952E;&#xFF0C;&#x5728;&#x6CE8;&#x89E3;&#x4E2D;&#x7528;&#x6765;&#x6307;&#x5B9A;&#x5B50;&#x67E5;&#x8BE2;&#x8FD4;&#x56DE;&#x5BF9;&#x8C61;&#x96C6;&#x5408;&#x3002;
&#x5176;&#x4E2D;&#xFF0C;select &#x5C5E;&#x6027;&#x6307;&#x5B9A;&#x7528;&#x4E8E;&#x67E5;&#x8BE2;&#x7684;&#x63A5;&#x53E3;&#x65B9;&#x6CD5;&#xFF0C;fetchType &#x5C5E;&#x6027;&#x7528;&#x4E8E;&#x6307;&#x5B9A;&#x7ACB;&#x5373;&#x52A0;&#x8F7D;&#x6216;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#xFF0C;&#x5206;&#x522B;&#x5BF9;&#x5E94; FetchType.EAGER &#x548C; FetchType.LAZY
&#x5728;&#x5305;&#x542B; @Many &#x6CE8;&#x89E3;&#x7684; @Result &#x4E2D;&#xFF0C;column &#x5C5E;&#x6027;&#x7528;&#x4E8E;&#x6307;&#x5B9A;&#x5C06;&#x8981;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x8FDB;&#x884C;&#x67E5;&#x8BE2;&#x7684;&#x6570;&#x636E;&#x5E93;&#x8868;&#x5217;&#x3002;
</code></pre><h3 id="mybatis-&#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x5B9E;&#x73B0;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;"><a name="mybatis-&#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x5B9E;&#x73B0;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;" class="anchor-navigation-ex-anchor" href="#mybatis-&#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x5B9E;&#x73B0;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;"><i class="fa fa-link" aria-hidden="true"></i></a>Mybatis &#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x5B9E;&#x73B0;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;</h3>
<ul>
<li>&#x5982;&#x679C;&#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x65F6;&#x60F3;&#x5F00;&#x542F;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#xFF0C;&#x90A3;&#x4E48;&#x9996;&#x5148;&#x5E94;&#x8BE5;&#x5728; Mybatis &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x5F00;&#x542F;&#x5168;&#x5C40;&#x914D;&#x7F6E;</li>
</ul>
<pre class="language-"><code> Mybatis &#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x5B9E;&#x73B0;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;
&#x5982;&#x679C;&#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x65F6;&#x60F3;&#x5F00;&#x542F;&#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#xFF0C;&#x90A3;&#x4E48;&#x9996;&#x5148;&#x5E94;&#x8BE5;&#x5728; Mybatis &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x5F00;&#x542F;&#x5168;&#x5C40;&#x914D;&#x7F6E;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- &#x5F00;&#x542F;&#x7F13;&#x5B58; --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cacheEnabled<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">&gt;</span></span>
</code></pre><pre class="language-"><code>@CacheNamespace(blocking = true)
public interface UserMapper {
    // .....
}
</code></pre><h2 id="mybatis&#x5206;&#x9875;&#x529F;&#x80FD;"><a name="mybatis&#x5206;&#x9875;&#x529F;&#x80FD;" class="anchor-navigation-ex-anchor" href="#mybatis&#x5206;&#x9875;&#x529F;&#x80FD;"><i class="fa fa-link" aria-hidden="true"></i></a>Mybatis&#x5206;&#x9875;&#x529F;&#x80FD;</h2>
<p><a href="https://blog.csdn.net/chenbaige/article/details/70846902" target="_blank">https://blog.csdn.net/chenbaige/article/details/70846902</a></p>
<p><strong>&#x4E00;.&#x501F;&#x52A9;&#x6570;&#x7EC4;&#x8FDB;&#x884C;&#x5206;&#x9875;&#xFF08;Service&#x5C42;&#x7684;&#x6846;&#x67B6;&#x5B9E;&#x73B0;&#xFF09;</strong></p>
<p>&#x539F;&#x7406;&#xFF1A;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x5E93;&#x67E5;&#x8BE2;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x83B7;&#x53D6;&#x5230;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x6240;&#x6709;&#x6EE1;&#x8DB3;&#x6761;&#x4EF6;&#x7684;&#x8BB0;&#x5F55;&#xFF0C;&#x4FDD;&#x5B58;&#x5728;&#x5E94;&#x7528;&#x7684;&#x4E34;&#x65F6;&#x6570;&#x7EC4;&#x4E2D;&#xFF0C;&#x518D;&#x901A;&#x8FC7;List&#x7684;subList&#x65B9;&#x6CD5;&#xFF0C;&#x83B7;&#x53D6;&#x5230;&#x6EE1;&#x8DB3;&#x6761;&#x4EF6;&#x7684;&#x6240;&#x6709;&#x8BB0;&#x5F55;&#x3002;</p>
<p>&#x7F3A;&#x70B9;&#xFF1A;&#x6570;&#x636E;&#x5E93;&#x67E5;&#x8BE2;&#x5E76;&#x8FD4;&#x56DE;&#x6240;&#x6709;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x800C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7684;&#x53EA;&#x662F;&#x6781;&#x5C11;&#x6570;&#x7B26;&#x5408;&#x8981;&#x6C42;&#x7684;&#x6570;&#x636E;&#x3002;&#x5F53;&#x6570;&#x636E;&#x91CF;&#x5C11;&#x65F6;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x63A5;&#x53D7;&#x3002;&#x5F53;&#x6570;&#x636E;&#x5E93;&#x6570;&#x636E;&#x91CF;&#x8FC7;&#x5927;&#x65F6;&#xFF0C;&#x6BCF;&#x6B21;&#x67E5;&#x8BE2;&#x5BF9;&#x6570;&#x636E;&#x5E93;&#x548C;&#x7A0B;&#x5E8F;&#x7684;&#x6027;&#x80FD;&#x90FD;&#x4F1A;&#x4EA7;&#x751F;&#x6781;&#x5927;&#x7684;&#x5F71;&#x54CD;&#x3002;</p>
<p><strong>&#x4E8C;.&#x501F;&#x52A9;Sql&#x8BED;&#x53E5;&#x8FDB;&#x884C;&#x5206;&#x9875;(Dao&#x5C42;&#x7684;sql limit&#x5B9E;&#x73B0;)</strong></p>
<p>&#x5B9E;&#x73B0;&#xFF1A;&#x901A;&#x8FC7;sql&#x8BED;&#x53E5;&#x5B9E;&#x73B0;&#x5206;&#x9875;&#x4E5F;&#x662F;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x7684;&#xFF0C;&#x53EA;&#x662F;&#x9700;&#x8981;&#x6539;&#x53D8;&#x6211;&#x4EEC;&#x67E5;&#x8BE2;&#x7684;&#x8BED;&#x53E5;&#x5C31;&#x80FD;&#x5B9E;&#x73B0;&#x4E86;&#xFF0C;&#x5373;&#x5728;sql&#x8BED;&#x53E5;&#x540E;&#x9762;&#x6DFB;&#x52A0;limit&#x5206;&#x9875;&#x8BED;&#x53E5;&#x3002;</p>
<p>&#x5728;xxxMapper.xml&#x6587;&#x4EF6;&#x4E2D;&#x7F16;&#x5199;sql&#x8BED;&#x53E5;&#x901A;&#x8FC7;limit&#x5173;&#x952E;&#x5B57;&#x8FDB;&#x884C;&#x5206;&#x9875;&#xFF1A;</p>
<pre class="language-"><code class="lang-xml"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>queryStudentsBySql<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>map<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>studentmapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        select * from student limit #{currIndex} , #{pageSize}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p><strong>&#x4E09;.&#x62E6;&#x622A;&#x5668;&#x5206;&#x9875;(PageHelper&#x539F;&#x7406;&#x4E5F;&#x662F;&#x5982;&#x6B64;&#xFF0C;&#x5176;&#x4E2D;startPage&#x53EA;&#x662F;&#x501F;&#x52A9;localThread&#x5148;&#x4FDD;&#x5B58;&#x5206;&#x9875;Page&#x4FE1;&#x606F;&#xFF0C;&#x5E76;&#x5728;Intercept&#x65B9;&#x6CD5;&#x4E2D;&#x8F85;&#x4EE5;dialect&#x5BF9;&#x8C61;&#x8FDB;&#x884C;&#x68C0;&#x6D4B;&#x4E0E;&#x6267;&#x884C;&#x76F8;&#x5173;&#x64CD;&#x4F5C;&#xFF0C;sqlsession&#x4E0B;&#x62E6;&#x622A;&#x5668;&#x7684;limit&#x5B9E;&#x73B0;)</strong></p>
<p>PageHelepr&#x7684;Intecepter&#x5728;dao&#x5C42;&#x4E0B;&#x9762;&#x7684;sqlsession.selectlist&#x4E0B;&#x9762;&#x5BF9;statemnehandler&#x7B49;&#x62E6;&#x622A;&#x5BF9;&#x8C61;&#x8FDB;&#x884C;&#x62E6;&#x622A;&#x751F;&#x6210;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x8BF4;&#x662F;&#x5BF9;dao&#x5C42;&#xFF08;sql&#x8BED;&#x53E5;execute&#x524D;&#xFF09;&#x7684;&#x62E6;&#x622A;&#x589E;&#x5F3A;</p>
<p>&#x81EA;&#x5B9A;&#x4E49;&#x62E6;&#x622A;&#x5668;&#x5B9E;&#x73B0;&#x4E86;&#x62E6;&#x622A;&#x6240;&#x6709;StatementHandler&#x7684;prepare&#x65B9;&#x6CD5;&#x5904;&#x7406;&#x7684;xml&#x4E2D;id&#x4EE5;ByPage&#x7ED3;&#x5C3E;&#x7684;&#x8BED;&#x53E5;&#xFF0C;&#x5E76;&#x4E14;&#x5229;&#x7528;&#x83B7;&#x53D6;&#x5230;&#x7684;&#x5206;&#x9875;&#x76F8;&#x5173;&#x53C2;&#x6570;&#x7EDF;&#x4E00;&#x5728;sql&#x8BED;&#x53E5;&#x540E;&#x9762;&#x52A0;&#x4E0A;limit&#x5206;&#x9875;&#x7684;&#x76F8;&#x5173;&#x8BED;&#x53E5;</p>
<blockquote>
<p>&#x5982;&#x4F55;&#x4F7F;&#x7528;Interceptor&#x5462;&#xFF1F;</p>
<p>&#x5B9E;&#x4F8B;&#x5316;&#x540E;&#x7684;Interceptor&#x4F1A;&#x5728;ApplicationContext&#x521D;&#x59CB;&#x5316;&#x65F6;&#x8BFB;&#x53D6;&#x5B9E;&#x73B0;&#x4E86;Inteceptor&#x63A5;&#x53E3;&#x7684;&#x5B9E;&#x4F8B;&#x6309;&#x5B9E;&#x4F8B;&#x987A;&#x5E8F;&#x81EA;&#x52A8;&#x6DFB;&#x52A0;&#x5230;&#x8D23;&#x4EFB;&#x94FE;&#x4E2D;</p>
<p>Interceptor&#x4F1A;&#x5728;&#x4F55;&#x65F6;&#x8D77;&#x4F5C;&#x7528;&#xFF1F;</p>
<p>&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5148;&#x901A;&#x8FC7;@Interceptor&#x5224;&#x65AD;&#x6211;&#x4EEC;&#x7684;Interceptor&#x662F;&#x5BF9;&#x4E8E;&#x5728;sql&#x7684;Executor&#x3001;StatementHandler&#x3001;ParameterHandler&#x3001;ResultSetHandler&#x56DB;&#x4E2A;&#x5904;&#x7406;&#x9636;&#x6BB5;&#x4E2D;&#x8FDB;&#x884C;&#x62E6;&#x622A;&#x7684;&#x4E0E;&#x62E6;&#x622A;&#x4E86;&#x56DB;&#x4E2A;&#x7C7B;&#x4E2D;&#x7684;&#x4EC0;&#x4E48;&#x65B9;&#x6CD5;&#xFF0C;&#x4EE5;&#x4FBF;&#x66F4;&#x597D;&#x7684;&#x7406;&#x89E3;Interceptor&#x5728;&#x54EA;&#x4E00;&#x6B65;&#x5C06;Page&#x4FE1;&#x606F;&#x5F80;&#x4E0B;&#x4F20;&#x9012;&#x3002;&#xFF08;&#x56E0;&#x4E3A;&#x5728;&#x521B;&#x5EFA;sqlSession &#x7684;&#x65F6;&#x5019;&#x5C31;&#x4F1A;&#x540C;&#x6B65;&#x521B;&#x5EFA;Executor&#xFF0C;&#x5E76;&#x5728;query&#x6267;&#x884C;sql&#x8BED;&#x53E5;&#x65F6;&#xFF0C;&#x65B0;&#x5EFA;statementHandler&#x5E76;&#x540C;&#x65F6;&#x521B;&#x5EFA;ParameterHandle&#x548C;ResultSetHandler&#xFF0C;&#x6240;&#x4EE5;Interceptor&#x53EF;&#x4EE5;&#x968F;&#x5FC3;&#x5728;&#x54EA;&#x4E2A;&#x9636;&#x6BB5;&#x8FDB;&#x884C;&#x62E6;&#x622A;&#x5E76;&#x987A;&#x5E8F;&#x5904;&#x7406;&#xFF0C;&#x4E5F;&#x56E0;&#x6B64;&#x662F;&#x5206;&#x9875;&#x63D2;&#x4EF6;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#xFF09;</p>
<p><a href="https://www.cnblogs.com/tanghaorong/p/14094521.html" target="_blank">https://www.cnblogs.com/tanghaorong/p/14094521.html</a></p>
<p>&#x5206;&#x9875;&#x9700;&#x8981;&#x5728;Dao&#x5C42;&#x8FDB;&#x884C;&#x54EA;&#x4E9B;&#x6807;&#x8BB0;&#x4F7F;&#x5F97;Inteceptor&#x80FD;&#x5224;&#x65AD;&#x54EA;&#x4E9B;&#x65B9;&#x6CD5;&#x9700;&#x8981;&#x5206;&#x9875;&#x5462;&#xFF1F;</p>
<p>&#x4E0D;&#x540C;&#x7684;Interceptor&#x6709;&#x4E0D;&#x540C;&#x7684;&#x62E6;&#x622A;&#x903B;&#x8F91;&#xFF0C;&#x4F1A;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x903B;&#x8F91;&#x5224;&#x65AD;&#x52A8;&#x6001;&#x589E;&#x5F3A;DAO&#x5C42;&#xFF0C;</p>
<p>&#x5728;&#x62E6;&#x622A;&#x5230;&#x6807;&#x8BB0;&#x7684;&#x62E6;&#x622A;&#x7C7B;&#x7684;&#x62E6;&#x622A;&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x5728;intercept&#x65B9;&#x6CD5;&#x4E2D;&#x5BF9;Dao&#x65B9;&#x6CD5;&#x5C01;&#x88C5;&#x6210;&#x7684;statement&#x8FDB;&#x884C;&#x76F8;&#x5E94;&#x6761;&#x4EF6;&#x7684;&#x5224;&#x65AD;</p>
<p>&#x5982;PageHelper&#x4F1A;&#x5728;&#x6267;&#x884C;Dao&#x5C42;&#x65F6;&#x5224;&#x65AD;ThreadLocal&#x4E0A;&#x7684;&#x67E5;&#x770B;&#x6709;&#x6CA1;&#x6709;Page &#x7684;&#x5C5E;&#x6027;&#x5B58;&#x50A8;&#xFF0C;&#x4E2D;&#x95F4;&#x4F1A;&#x8FDB;&#x884C;&#x5224;&#x65AD;&#x8BE5;sql &#x7684;&#x7C7B;&#x578B;&#x662F;&#x67E5;&#x8BE2;&#xFF0C;&#x8FD8;&#x662F;&#x4FEE;&#x6539;&#x64CD;&#x4F5C;&#x3002;&#x82E5;&#x662F;&#x67E5;&#x8BE2;&#x6709;&#x5219;&#x52A8;&#x6001;&#x589E;&#x5F3A;&#xFF0C;&#x5206;&#x9875;&#x5904;&#x7406;</p>
<p>PaginationInterceptor&#x5219;&#x4F1A;&#x5224;&#x65AD;Dao&#x5C42;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x4E2D;&#x6709;&#x6CA1;&#x6709;&#x5B9E;&#x73B0;IPage&#x63A5;&#x53E3;&#x7684;&#x5982;Page&#x7C7B;&#xFF0C;&#x4E5F;&#x4F1A;&#x5224;&#x65AD;&#x662F;&#x5426;&#x4E3A;&#x67E5;&#x8BE2;&#x64CD;&#x4F5C;&#xFF0C;&#x82E5;&#x662F;&#x4E14;&#x6709;&#x5219;&#x8BFB;&#x53D6;Page&#x7C7B;&#x4E2D;&#x5B58;&#x50A8;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x52A8;&#x6001;&#x589E;&#x5F3A;&#xFF0C;&#x8FDB;&#x884C;&#x5206;&#x9875;&#x5904;&#x7406;&#x3002;</p>
</blockquote>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cbg<span class="token punctuation">.</span>interceptor</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>executor<span class="token punctuation">.</span></span><span class="token class-name">Executor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>executor<span class="token punctuation">.</span>parameter<span class="token punctuation">.</span></span><span class="token class-name">ParameterHandler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>executor<span class="token punctuation">.</span>resultset<span class="token punctuation">.</span></span><span class="token class-name">ResultSetHandler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>executor<span class="token punctuation">.</span>statement<span class="token punctuation">.</span></span><span class="token class-name">StatementHandler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>mapping<span class="token punctuation">.</span></span><span class="token class-name">MappedStatement</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>plugin<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>reflection<span class="token punctuation">.</span></span><span class="token class-name">MetaObject</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>reflection<span class="token punctuation">.</span></span><span class="token class-name">SystemMetaObject</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">Connection</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Created by chenboge on 2017/5/7.
 * &lt;p&gt;
 * Email:baigegechen@gmail.com
 * &lt;p&gt;
 * description:
 */</span>

<span class="token comment">/**
 * @Intercepts &#x8BF4;&#x660E;&#x662F;&#x4E00;&#x4E2A;&#x62E6;&#x622A;&#x5668;
 * @Signature &#x62E6;&#x622A;&#x5668;&#x7684;&#x7B7E;&#x540D;
 * type &#x62E6;&#x622A;&#x7684;&#x7C7B;&#x578B; &#x56DB;&#x5927;&#x5BF9;&#x8C61;&#x4E4B;&#x4E00;( Executor,ResultSetHandler,ParameterHandler,StatementHandler)
 * method &#x62E6;&#x622A;&#x7684;&#x65B9;&#x6CD5;
 * args &#x53C2;&#x6570;
 */</span>
<span class="token annotation punctuation">@Intercepts</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token annotation punctuation">@Signature</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">StatementHandler</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">&quot;prepare&quot;</span><span class="token punctuation">,</span> args <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">Connection</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyPageInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">Interceptor</span> <span class="token punctuation">{</span>

<span class="token comment">//&#x6BCF;&#x9875;&#x663E;&#x793A;&#x7684;&#x6761;&#x76EE;&#x6570;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> pageSize<span class="token punctuation">;</span>
<span class="token comment">//&#x5F53;&#x524D;&#x73B0;&#x5B9E;&#x7684;&#x9875;&#x6570;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> currPage<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> dbType<span class="token punctuation">;</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">Invocation</span> invocation<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token comment">//&#x83B7;&#x53D6;StatementHandler&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;RoutingStatementHandler</span>
        <span class="token class-name">StatementHandler</span> statementHandler <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">StatementHandler</span><span class="token punctuation">)</span> invocation<span class="token punctuation">.</span><span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//&#x83B7;&#x53D6;statementHandler&#x5305;&#x88C5;&#x7C7B;</span>
        <span class="token class-name">MetaObject</span> <span class="token class-name">MetaObjectHandler</span> <span class="token operator">=</span> <span class="token class-name">SystemMetaObject</span><span class="token punctuation">.</span><span class="token function">forObject</span><span class="token punctuation">(</span>statementHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//&#x5206;&#x79BB;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#x94FE;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token class-name">MetaObjectHandler</span><span class="token punctuation">.</span><span class="token function">hasGetter</span><span class="token punctuation">(</span><span class="token string">&quot;h&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token class-name">MetaObjectHandler</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">&quot;h&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">MetaObjectHandler</span> <span class="token operator">=</span> <span class="token class-name">SystemMetaObject</span><span class="token punctuation">.</span><span class="token function">forObject</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token class-name">MetaObjectHandler</span><span class="token punctuation">.</span><span class="token function">hasGetter</span><span class="token punctuation">(</span><span class="token string">&quot;target&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token class-name">MetaObjectHandler</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">&quot;target&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">MetaObjectHandler</span> <span class="token operator">=</span> <span class="token class-name">SystemMetaObject</span><span class="token punctuation">.</span><span class="token function">forObject</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//&#x83B7;&#x53D6;&#x8FDE;&#x63A5;&#x5BF9;&#x8C61;</span>
        <span class="token comment">//Connection connection = (Connection) invocation.getArgs()[0];</span>


        <span class="token comment">//object.getValue(&quot;delegate&quot;);  &#x83B7;&#x53D6;StatementHandler&#x7684;&#x5B9E;&#x73B0;&#x7C7B;</span>

        <span class="token comment">//&#x83B7;&#x53D6;&#x67E5;&#x8BE2;&#x63A5;&#x53E3;&#x6620;&#x5C04;&#x7684;&#x76F8;&#x5173;&#x4FE1;&#x606F;</span>
        <span class="token class-name">MappedStatement</span> mappedStatement <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">MappedStatement</span><span class="token punctuation">)</span> <span class="token class-name">MetaObjectHandler</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">&quot;delegate.mappedStatement&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> mapId <span class="token operator">=</span> mappedStatement<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//statementHandler.getBoundSql().getParameterObject();</span>

        <span class="token comment">//&#x62E6;&#x622A;&#x4EE5;.ByPage&#x7ED3;&#x5C3E;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x5206;&#x9875;&#x529F;&#x80FD;&#x7684;&#x7EDF;&#x4E00;&#x5B9E;&#x73B0;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mapId<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">&quot;.+ByPage$&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//&#x83B7;&#x53D6;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x5E93;&#x64CD;&#x4F5C;&#x65F6;&#x7BA1;&#x7406;&#x53C2;&#x6570;&#x7684;handler</span>
            <span class="token class-name">ParameterHandler</span> parameterHandler <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ParameterHandler</span><span class="token punctuation">)</span> <span class="token class-name">MetaObjectHandler</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">&quot;delegate.parameterHandler&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//&#x83B7;&#x53D6;&#x8BF7;&#x6C42;&#x65F6;&#x7684;&#x53C2;&#x6570;</span>
            <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> paraObject <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> parameterHandler<span class="token punctuation">.</span><span class="token function">getParameterObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//&#x4E5F;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x83B7;&#x53D6;</span>
            <span class="token comment">//paraObject = (Map&lt;String, Object&gt;) statementHandler.getBoundSql().getParameterObject();</span>

            <span class="token comment">//&#x53C2;&#x6570;&#x540D;&#x79F0;&#x548C;&#x5728;service&#x4E2D;&#x8BBE;&#x7F6E;&#x5230;map&#x4E2D;&#x7684;&#x540D;&#x79F0;&#x4E00;&#x81F4;</span>
            currPage <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> paraObject<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;currPage&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            pageSize <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> paraObject<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;pageSize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token class-name">MetaObjectHandler</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">&quot;delegate.boundSql.sql&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;statementHandler&#x76F4;&#x63A5;&#x83B7;&#x53D6;</span>
            <span class="token comment">//sql = statementHandler.getBoundSql().getSql();</span>

            <span class="token comment">//&#x6784;&#x5EFA;&#x5206;&#x9875;&#x529F;&#x80FD;&#x7684;sql&#x8BED;&#x53E5;</span>
            <span class="token class-name">String</span> limitSql<span class="token punctuation">;</span>
            sql <span class="token operator">=</span> sql<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            limitSql <span class="token operator">=</span> sql <span class="token operator">+</span> <span class="token string">&quot; limit &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>currPage <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> pageSize <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> pageSize<span class="token punctuation">;</span>

            <span class="token comment">//&#x5C06;&#x6784;&#x5EFA;&#x5B8C;&#x6210;&#x7684;&#x5206;&#x9875;sql&#x8BED;&#x53E5;&#x8D4B;&#x503C;&#x4E2A;&#x4F53;&apos;delegate.boundSql.sql&apos;&#xFF0C;&#x5077;&#x5929;&#x6362;&#x65E5;</span>
            <span class="token class-name">MetaObjectHandler</span><span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">&quot;delegate.boundSql.sql&quot;</span><span class="token punctuation">,</span> limitSql<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token comment">//&#x8C03;&#x7528;&#x539F;&#x5BF9;&#x8C61;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x8FDB;&#x5165;&#x8D23;&#x4EFB;&#x94FE;&#x7684;&#x4E0B;&#x4E00;&#x7EA7;</span>
        <span class="token keyword">return</span> invocation<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">//&#x83B7;&#x53D6;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">plugin</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//&#x751F;&#x6210;object&#x5BF9;&#x8C61;&#x7684;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;</span>
        <span class="token keyword">return</span> <span class="token class-name">Plugin</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//&#x8BBE;&#x7F6E;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#x7684;&#x53C2;&#x6570;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setProperties</span><span class="token punctuation">(</span><span class="token class-name">Properties</span> properties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//&#x5982;&#x679C;&#x9879;&#x76EE;&#x4E2D;&#x5206;&#x9875;&#x7684;pageSize&#x662F;&#x7EDF;&#x4E00;&#x7684;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;&#x8FD9;&#x91CC;&#x7EDF;&#x4E00;&#x914D;&#x7F6E;&#x548C;&#x83B7;&#x53D6;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x4E0D;&#x7528;&#x6BCF;&#x6B21;&#x8BF7;&#x6C42;&#x90FD;&#x4F20;&#x9012;pageSize&#x53C2;&#x6570;&#x4E86;&#x3002;&#x53C2;&#x6570;&#x662F;&#x5728;&#x914D;&#x7F6E;&#x62E6;&#x622A;&#x5668;&#x65F6;&#x914D;&#x7F6E;&#x7684;&#x3002;</span>
        <span class="token class-name">String</span> limit1 <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;limit&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pageSize <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>limit1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dbType <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;dbType&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;mysql&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x7F16;&#x5199;&#x597D;&#x62E6;&#x622A;&#x5668;&#x540E;&#xFF0C;&#x9700;&#x8981;&#x6CE8;&#x518C;&#x5230;&#x9879;&#x76EE;&#x4E2D;&#xFF0C;&#x624D;&#x80FD;&#x53D1;&#x6325;&#x5B83;&#x7684;&#x4F5C;&#x7528;&#x3002;&#x5728;mybatis&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x6DFB;&#x52A0;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#xFF1A;</p>
<pre class="language-"><code class="lang-xml">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span> <span class="token attr-name">interceptor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.cbg.interceptor.MyPageInterceptor<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>limit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dbType<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mysql<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>&#x82E5;&#x662F;&#x81EA;&#x5B9A;&#x4E49;&#x7684;interceptor&#xFF0C;&#x5219;&#x9700;&#x8981;&#x7528;setProperties&#x65B9;&#x6CD5;&#x5904;&#x7406;&#x6211;&#x4EEC;property&#x6807;&#x7B7E;&#x7684;&#x53C2;&#x6570;&#xFF0C;PageHelper&#x7B49;&#x5DF2;&#x7ECF;&#x8BBE;&#x7F6E;&#x597D;&#x76F8;&#x5E94;&#x7684;properties&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x5728;property&#x4E2D;&#x5199;&#x5165;&#x76F8;&#x5E94;&#x7684;name&#x548C;value&#x5373;&#x53EF;</p>
<pre class="language-"><code class="lang-java"> <span class="token comment">//&#x8BFB;&#x53D6;&#x914D;&#x7F6E;&#x7684;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#x7684;&#x53C2;&#x6570;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setProperties</span><span class="token punctuation">(</span><span class="token class-name">Properties</span> properties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> limit1 <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;limit&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pageSize <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>limit1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dbType <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;dbType&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;mysql&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
<p><strong>&#x56DB;.RowBounds&#x5B9E;&#x73B0;&#x5206;&#x9875;&#xFF08;sqlsession&#x7684;selectList&#x65B9;&#x6CD5;&#x91CD;&#x8F7D;&#x540E;&#x5728;&#x6846;&#x67B6;&#x4E2D;&#x5206;&#x9875;&#xFF0C;sqlsession&#x7684;&#x6846;&#x67B6;&#x5B9E;&#x73B0;&#xFF09;</strong></p>
<p>&#x539F;&#x7406;&#xFF1A;&#x901A;&#x8FC7;RowBounds&#x5B9E;&#x73B0;&#x5206;&#x9875;&#x548C;&#x901A;&#x8FC7;&#x6570;&#x7EC4;&#x65B9;&#x5F0F;&#x5206;&#x9875;&#x539F;&#x7406;&#x5DEE;&#x4E0D;&#x591A;&#xFF0C;&#x90FD;&#x662F;&#x4E00;&#x6B21;&#x83B7;&#x53D6;&#x6240;&#x6709;&#x7B26;&#x5408;&#x6761;&#x4EF6;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x5BF9;&#x5927;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x5B9E;&#x73B0;&#x5206;&#x9875;&#x6548;&#x679C;&#x3002;&#x53EA;&#x662F;&#x6570;&#x7EC4;&#x5206;&#x9875;&#x9700;&#x8981;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x53BB;&#x5B9E;&#x73B0;&#x5206;&#x9875;&#x903B;&#x8F91;&#xFF0C;&#x8FD9;&#x91CC;&#x66F4;&#x52A0;&#x7B80;&#x5316;&#x800C;&#x5DF2;&#x3002;</p>
<p>&#x5B58;&#x5728;&#x95EE;&#x9898;&#xFF1A;&#x4E00;&#x6B21;&#x6027;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x83B7;&#x53D6;&#x7684;&#x6570;&#x636E;&#x53EF;&#x80FD;&#x4F1A;&#x5F88;&#x591A;&#xFF0C;&#x5BF9;&#x5185;&#x5B58;&#x7684;&#x6D88;&#x8017;&#x5F88;&#x5927;&#xFF0C;&#x53EF;&#x80FD;&#x5BFC;&#x5E08;&#x6027;&#x80FD;&#x53D8;&#x5DEE;&#xFF0C;&#x751A;&#x81F3;&#x5F15;&#x53D1;&#x5185;&#x5B58;&#x6EA2;&#x51FA;&#x3002;</p>
<p>&#x5B9E;&#x73B0;&#xFF1A;&#x5728;Dao&#x5C42;&#x4E2D;&#x9700;&#x8981;&#x5206;&#x9875;&#x7684;&#x65B9;&#x6CD5;&#x7684;SelectList&#x65B9;&#x6CD5;&#x4F9D;&#x636E;Page&#x7B49;Service&#x5C42;&#x4F20;&#x9012;&#x7684;&#x5B9E;&#x53C2;&#xFF0C;&#x8F6C;&#x6362;&#x6210;RowBounds&#x5BF9;&#x8C61;&#x6216;&#x8005;DAO&#x63A5;&#x53E3;&#x5199;&#x6210;List<xxx> xxx(RowBounds page)&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;mybatis&#x4E5F;&#x4F1A;&#x5B8C;&#x6210;&#x5206;&#x9875;&#x67E5;&#x8BE2;&#x3002;(&#x4F46;&#x662F;Dao&#x63A5;&#x53E3;&#x7684;&#x5F62;&#x53C2;&#x4E3A;Page&#x7B49;&#x81EA;&#x5B9A;&#x4E49;&#x7C7B;&#x578B;&#xFF0C;&#x5374;&#x6CA1;&#x6709;&#x5B9E;&#x73B0;&#x5C06;Page&#x8F6C;&#x6362;&#x6210;RowBounds&#x4EA4;&#x7ED9;selectList&#x65B9;&#x6CD5;&#xFF0C;&#x5219;&#x4E0D;&#x4F1A;&#x5B9E;&#x73B0;&#x5206;&#x9875;&#x529F;&#x80FD;)</xxx></p>
<h2 id="spring&#x4E0E;mybatis-&#x4E8B;&#x52A1;&#x7BA1;&#x7406;"><a name="spring&#x4E0E;mybatis-&#x4E8B;&#x52A1;&#x7BA1;&#x7406;" class="anchor-navigation-ex-anchor" href="#spring&#x4E0E;mybatis-&#x4E8B;&#x52A1;&#x7BA1;&#x7406;"><i class="fa fa-link" aria-hidden="true"></i></a>spring&#x4E0E;MyBatis &#x4E8B;&#x52A1;&#x7BA1;&#x7406;</h2>
<p><a href="https://coderbee.net/index.php/framework/20191025/2002" target="_blank">https://coderbee.net/index.php/framework/20191025/2002</a></p>
<h4 id="1-&#x8FD0;&#x884C;&#x73AF;&#x5883;-enviroment"><a name="1-&#x8FD0;&#x884C;&#x73AF;&#x5883;-enviroment" class="anchor-navigation-ex-anchor" href="#1-&#x8FD0;&#x884C;&#x73AF;&#x5883;-enviroment"><i class="fa fa-link" aria-hidden="true"></i></a>1. &#x8FD0;&#x884C;&#x73AF;&#x5883; Enviroment</h4>
<p> &#x5F53; MyBatis &#x4E0E;&#x4E0D;&#x540C;&#x7684;&#x5E94;&#x7528;&#x7ED3;&#x5408;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x4E0D;&#x540C;&#x7684;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x673A;&#x5236;&#x3002;&#x4E0E; Spring &#x7ED3;&#x5408;&#x65F6;&#xFF0C;&#x7531; Spring &#x6765;&#x7BA1;&#x7406;&#x4E8B;&#x52A1;&#xFF1B;&#x5355;&#x72EC;&#x4F7F;&#x7528;&#x65F6;&#x9700;&#x8981;&#x81EA;&#x884C;&#x7BA1;&#x7406;&#x4E8B;&#x52A1;&#xFF0C;&#x5728;&#x5BB9;&#x5668;&#x91CC;&#x8FD0;&#x884C;&#x65F6;&#x53EF;&#x80FD;&#x7531;&#x5BB9;&#x5668;&#x8FDB;&#x884C;&#x7BA1;&#x7406;&#x3002;</p>
<p>MyBatis &#x7528; Enviroment &#x6765;&#x8868;&#x793A;&#x8FD0;&#x884C;&#x73AF;&#x5883;&#xFF0C;&#x5176;&#x5C01;&#x88C5;&#x4E86;&#x4E09;&#x4E2A;&#x5C5E;&#x6027;&#xFF1A;</p>
<pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Configuration</span> <span class="token punctuation">{</span>
    <span class="token comment">// &#x4E00;&#x4E2A; MyBatis &#x7684;&#x914D;&#x7F6E;&#x53EA;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;&#x73AF;&#x5883;</span>
    <span class="token keyword">protected</span> <span class="token class-name">Environment</span> environment<span class="token punctuation">;</span>
    <span class="token comment">// &#x5176;&#x4ED6;&#x5C5E;&#x6027; .....</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Environment</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">TransactionFactory</span> transactionFactory<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="2-&#x4E8B;&#x52A1;&#x62BD;&#x8C61;"><a name="2-&#x4E8B;&#x52A1;&#x62BD;&#x8C61;" class="anchor-navigation-ex-anchor" href="#2-&#x4E8B;&#x52A1;&#x62BD;&#x8C61;"><i class="fa fa-link" aria-hidden="true"></i></a>2. &#x4E8B;&#x52A1;&#x62BD;&#x8C61;</h4>
<p>MyBatis &#x628A;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x62BD;&#x8C61;&#x51FA; <code>Transaction</code> &#x63A5;&#x53E3;&#xFF0C;&#x7531; <code>TransactionFactory</code> &#x63A5;&#x53E3;&#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#x8D1F;&#x8D23;&#x521B;&#x5EFA;&#x3002;</p>
<pre class="language-"><code>public interface Transaction {
    Connection getConnection() throws SQLException;
    void commit() throws SQLException;
    void rollback() throws SQLException;
    void close() throws SQLException;
    Integer getTimeout() throws SQLException;
}

public interface TransactionFactory {
    void setProperties(Properties props);
    Transaction newTransaction(Connection conn);
    Transaction newTransaction(DataSource dataSource, TransactionIsolationLevel level, boolean autoCommit);
}
</code></pre><p>Executor &#x7684;&#x5B9E;&#x73B0;&#x6301;&#x6709;&#x4E00;&#x4E2A; SqlSession &#x5B9E;&#x73B0;&#xFF0C;&#x4E8B;&#x52A1;&#x63A7;&#x5236;&#x662F;&#x59D4;&#x6258;&#x7ED9; SqlSession &#x7684;&#x65B9;&#x6CD5;&#x6765;&#x5B9E;&#x73B0;&#x7684;&#x3002;</p>
<pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">BaseExecutor</span> <span class="token keyword">implements</span> <span class="token class-name">Executor</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token class-name">Transaction</span> transaction<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">commit</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> required<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>closed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ExecutorException</span><span class="token punctuation">(</span><span class="token string">&quot;Cannot commit, transaction is already closed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">clearLocalCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">flushStatements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>required<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            transaction<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">rollback</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> required<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>closed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token function">clearLocalCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">flushStatements</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>required<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    transaction<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// &#x7701;&#x7565;&#x5176;&#x4ED6;&#x65B9;&#x6CD5;&#x3001;&#x5C5E;&#x6027;</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="3-&#x4E0E;-spring-&#x96C6;&#x6210;&#x7684;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;"><a name="3-&#x4E0E;-spring-&#x96C6;&#x6210;&#x7684;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;" class="anchor-navigation-ex-anchor" href="#3-&#x4E0E;-spring-&#x96C6;&#x6210;&#x7684;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;"><i class="fa fa-link" aria-hidden="true"></i></a>3. &#x4E0E; Spring &#x96C6;&#x6210;&#x7684;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;</h4>
<h5 id="31-&#x914D;&#x7F6E;-transactionfactory"><a name="31-&#x914D;&#x7F6E;-transactionfactory" class="anchor-navigation-ex-anchor" href="#31-&#x914D;&#x7F6E;-transactionfactory"><i class="fa fa-link" aria-hidden="true"></i></a>3.1 &#x914D;&#x7F6E; TransactionFactory</h5>
<p>&#x4E0E; Spring &#x96C6;&#x6210;&#x65F6;&#xFF0C;&#x901A;&#x8FC7; SqlSessionFactoryBean &#x6765;&#x521D;&#x59CB;&#x5316; MyBatis &#x3002;</p>
<pre class="language-"><code class="lang-java"><span class="token keyword">protected</span> <span class="token class-name">SqlSessionFactory</span> <span class="token function">buildSqlSessionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Configuration</span> configuration<span class="token punctuation">;</span>

    <span class="token class-name">XMLConfigBuilder</span> xmlConfigBuilder <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>configuration <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        configuration <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>configuration<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>configuration<span class="token punctuation">.</span><span class="token function">getVariables</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            configuration<span class="token punctuation">.</span><span class="token function">setVariables</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>configurationProperties<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>configurationProperties <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            configuration<span class="token punctuation">.</span><span class="token function">getVariables</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>configurationProperties<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>configLocation <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        xmlConfigBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLConfigBuilder</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>configLocation<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>configurationProperties<span class="token punctuation">)</span><span class="token punctuation">;</span>
        configuration <span class="token operator">=</span> xmlConfigBuilder<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        configuration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        configuration<span class="token punctuation">.</span><span class="token function">setVariables</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>configurationProperties<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>objectFactory <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        configuration<span class="token punctuation">.</span><span class="token function">setObjectFactory</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>objectFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>objectWrapperFactory <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        configuration<span class="token punctuation">.</span><span class="token function">setObjectWrapperFactory</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>objectWrapperFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vfs <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        configuration<span class="token punctuation">.</span><span class="token function">setVfsImpl</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vfs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasLength</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>typeAliasesPackage<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> typeAliasPackageArray <span class="token operator">=</span> <span class="token function">tokenizeToStringArray</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>typeAliasesPackage<span class="token punctuation">,</span>
        <span class="token class-name">ConfigurableApplicationContext</span><span class="token punctuation">.</span>CONFIG_LOCATION_DELIMITERS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> packageToScan <span class="token operator">:</span> typeAliasPackageArray<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            configuration<span class="token punctuation">.</span><span class="token function">getTypeAliasRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">registerAliases</span><span class="token punctuation">(</span>packageToScan<span class="token punctuation">,</span>
            typeAliasesSuperType <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token operator">:</span> typeAliasesSuperType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>typeAliases<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> typeAlias <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>typeAliases<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            configuration<span class="token punctuation">.</span><span class="token function">getTypeAliasRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">registerAlias</span><span class="token punctuation">(</span>typeAlias<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>plugins<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Interceptor</span> plugin <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>plugins<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            configuration<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span>plugin<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasLength</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>typeHandlersPackage<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> typeHandlersPackageArray <span class="token operator">=</span> <span class="token function">tokenizeToStringArray</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>typeHandlersPackage<span class="token punctuation">,</span>
        <span class="token class-name">ConfigurableApplicationContext</span><span class="token punctuation">.</span>CONFIG_LOCATION_DELIMITERS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> packageToScan <span class="token operator">:</span> typeHandlersPackageArray<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            configuration<span class="token punctuation">.</span><span class="token function">getTypeHandlerRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>packageToScan<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>typeHandlers<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">TypeHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> typeHandler <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>typeHandlers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            configuration<span class="token punctuation">.</span><span class="token function">getTypeHandlerRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>typeHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>databaseIdProvider <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//fix #64 set databaseId before parse mapper xmls</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            configuration<span class="token punctuation">.</span><span class="token function">setDatabaseId</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>databaseIdProvider<span class="token punctuation">.</span><span class="token function">getDatabaseId</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NestedIOException</span><span class="token punctuation">(</span><span class="token string">&quot;Failed getting a databaseId&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cache <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        configuration<span class="token punctuation">.</span><span class="token function">addCache</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>xmlConfigBuilder <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            xmlConfigBuilder<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NestedIOException</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to parse config resource: &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>configLocation<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token class-name">ErrorContext</span><span class="token punctuation">.</span><span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// &#x521B;&#x5EFA; SpringManagedTransactionFactory</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>transactionFactory <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>transactionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpringManagedTransactionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// &#x5C01;&#x88C5;&#x6210; Environment</span>
    configuration<span class="token punctuation">.</span><span class="token function">setEnvironment</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Environment</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>environment<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>transactionFactory<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mapperLocations<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Resource</span> mapperLocation <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mapperLocations<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mapperLocation <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">XMLMapperBuilder</span> xmlMapperBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLMapperBuilder</span><span class="token punctuation">(</span>mapperLocation<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                configuration<span class="token punctuation">,</span> mapperLocation<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> configuration<span class="token punctuation">.</span><span class="token function">getSqlFragments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                xmlMapperBuilder<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NestedIOException</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to parse mapping resource: &apos;&quot;</span> <span class="token operator">+</span> mapperLocation <span class="token operator">+</span> <span class="token string">&quot;&apos;&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                <span class="token class-name">ErrorContext</span><span class="token punctuation">.</span><span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sqlSessionFactoryBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>configuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SqlSessionFactoryBuilder</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">SqlSessionFactory</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DefaultSqlSessionFactory</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x91CD;&#x70B9;&#x662F;&#x5728;&#x6784;&#x5EFA; MyBatis Configuration &#x5BF9;&#x8C61;&#x65F6;&#xFF0C;&#x628A; transactionFactory &#x914D;&#x7F6E;&#x6210; SpringManagedTransactionFactory&#xFF0C;&#x518D;&#x5C01;&#x88C5;&#x6210; Environment &#x5BF9;&#x8C61;&#x3002;</p>
<h5 id="32-&#x8FD0;&#x884C;&#x65F6;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;"><a name="32-&#x8FD0;&#x884C;&#x65F6;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;" class="anchor-navigation-ex-anchor" href="#32-&#x8FD0;&#x884C;&#x65F6;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;"><i class="fa fa-link" aria-hidden="true"></i></a>3.2 &#x8FD0;&#x884C;&#x65F6;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;</h5>
<p>Mapper &#x7684;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#x6301;&#x6709;&#x7684;&#x662F; <code>SqlSessionTemplate</code>&#xFF0C;&#x5176;&#x5B9E;&#x73B0;&#x4E86; <code>SqlSession</code> &#x63A5;&#x53E3;&#x3002;</p>
<p><code>SqlSessionTemplate</code> &#x7684;&#x65B9;&#x6CD5;&#x5E76;&#x4E0D;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x5177;&#x4F53;&#x7684; <code>SqlSession</code> &#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x800C;&#x662F;&#x59D4;&#x6258;&#x7ED9;&#x4E00;&#x4E2A;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#xFF0C;&#x901A;&#x8FC7;&#x4EE3;&#x7406; <code>SqlSessionInterceptor</code> &#x5BF9;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x8FDB;&#x884C;&#x62E6;&#x622A;&#x3002;</p>
<p><code>SqlSessionInterceptor</code> &#x8D1F;&#x8D23;&#x83B7;&#x53D6;&#x771F;&#x5B9E;&#x7684;&#x4E0E;&#x6570;&#x636E;&#x5E93;&#x5173;&#x8054;&#x7684; <code>SqlSession</code> &#x5B9E;&#x73B0;&#xFF0C;&#x5E76;&#x5728;&#x65B9;&#x6CD5;&#x6267;&#x884C;&#x5B8C;&#x540E;&#x51B3;&#x5B9A;&#x63D0;&#x4EA4;&#x6216;&#x56DE;&#x6EDA;&#x4E8B;&#x52A1;&#x3001;&#x5173;&#x95ED;&#x4F1A;&#x8BDD;&#x3002;</p>
<pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SqlSessionTemplate</span> <span class="token keyword">implements</span> <span class="token class-name">SqlSession</span><span class="token punctuation">,</span> <span class="token class-name">DisposableBean</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">SqlSessionFactory</span> sqlSessionFactory<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ExecutorType</span> executorType<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">SqlSession</span> sqlSessionProxy<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">PersistenceExceptionTranslator</span> exceptionTranslator<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">SqlSessionTemplate</span><span class="token punctuation">(</span><span class="token class-name">SqlSessionFactory</span> sqlSessionFactory<span class="token punctuation">,</span> <span class="token class-name">ExecutorType</span> executorType<span class="token punctuation">,</span>
        <span class="token class-name">PersistenceExceptionTranslator</span> exceptionTranslator<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token function">notNull</span><span class="token punctuation">(</span>sqlSessionFactory<span class="token punctuation">,</span> <span class="token string">&quot;Property &apos;sqlSessionFactory&apos; is required&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">notNull</span><span class="token punctuation">(</span>executorType<span class="token punctuation">,</span> <span class="token string">&quot;Property &apos;executorType&apos; is required&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>sqlSessionFactory <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>executorType <span class="token operator">=</span> executorType<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>exceptionTranslator <span class="token operator">=</span> exceptionTranslator<span class="token punctuation">;</span>

        <span class="token comment">// &#x56E0;&#x4E3A; SqlSession &#x63A5;&#x53E3;&#x58F0;&#x660E;&#x7684;&#x65B9;&#x6CD5;&#x4E5F;&#x4E0D;&#x5C11;&#xFF0C;</span>
        <span class="token comment">// &#x5728;&#x6BCF;&#x4E2A;&#x65B9;&#x6CD5;&#x91CC;&#x6DFB;&#x52A0;&#x4E8B;&#x52A1;&#x76F8;&#x5173;&#x7684;&#x62E6;&#x622A;&#x6BD4;&#x8F83;&#x9EBB;&#x70E6;&#xFF0C;</span>
        <span class="token comment">// &#x4E0D;&#x5982;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5185;&#x90E8;&#x7684;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#x8FDB;&#x884C;&#x7EDF;&#x4E00;&#x5904;&#x7406;&#x3002;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sqlSessionProxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SqlSession</span><span class="token punctuation">)</span> <span class="token function">newProxyInstance</span><span class="token punctuation">(</span>
            <span class="token class-name">SqlSessionFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token class-name">SqlSession</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">SqlSessionInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">String</span> statement<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// &#x5728;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#x4E0A;&#x6267;&#x884C;&#x65B9;&#x6CD5;&#x8C03;&#x7528;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sqlSessionProxy<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>statement<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// &#x5BF9;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x8FDB;&#x884C;&#x62E6;&#x622A;&#xFF0C;&#x52A0;&#x5165;&#x4E8B;&#x52A1;&#x63A7;&#x5236;&#x903B;&#x8F91;</span>
    <span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">SqlSessionInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
            <span class="token comment">// &#x83B7;&#x53D6;&#x4E0E;&#x6570;&#x636E;&#x5E93;&#x5173;&#x8054;&#x7684;&#x4F1A;&#x8BDD;</span>
            <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> <span class="token class-name">SqlSessionUtils</span><span class="token punctuation">.</span><span class="token function">getSqlSession</span><span class="token punctuation">(</span>
                <span class="token class-name">SqlSessionTemplate</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>sqlSessionFactory<span class="token punctuation">,</span>
                <span class="token class-name">SqlSessionTemplate</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>executorType<span class="token punctuation">,</span>
                <span class="token class-name">SqlSessionTemplate</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>exceptionTranslator<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// &#x6267;&#x884C; SQL &#x64CD;&#x4F5C;</span>
                <span class="token class-name">Object</span> result <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>sqlSession<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">SqlSessionUtils</span><span class="token punctuation">.</span><span class="token function">isSqlSessionTransactional</span><span class="token punctuation">(</span>sqlSession<span class="token punctuation">,</span> <span class="token class-name">SqlSessionTemplate</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>sqlSessionFactory<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// &#x5982;&#x679C; sqlSession &#x4E0D;&#x662F; Spring &#x7BA1;&#x7406;&#x7684;&#xFF0C;&#x5219;&#x8981;&#x81EA;&#x884C;&#x63D0;&#x4EA4;&#x4E8B;&#x52A1;</span>
                    sqlSession<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> result<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Throwable</span> unwrapped <span class="token operator">=</span> <span class="token function">unwrapThrowable</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">SqlSessionTemplate</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>exceptionTranslator <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> unwrapped <span class="token keyword">instanceof</span> <span class="token class-name">PersistenceException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                    <span class="token class-name">SqlSessionUtils</span><span class="token punctuation">.</span><span class="token function">closeSqlSession</span><span class="token punctuation">(</span>sqlSession<span class="token punctuation">,</span> <span class="token class-name">SqlSessionTemplate</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>sqlSessionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    sqlSession <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    <span class="token class-name">Throwable</span> translated <span class="token operator">=</span> <span class="token class-name">SqlSessionTemplate</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>exceptionTranslator<span class="token punctuation">.</span><span class="token function">translateExceptionIfPossible</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">PersistenceException</span><span class="token punctuation">)</span> unwrapped<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>translated <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        unwrapped <span class="token operator">=</span> translated<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">throw</span> unwrapped<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>sqlSession <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">SqlSessionUtils</span><span class="token punctuation">.</span><span class="token function">closeSqlSession</span><span class="token punctuation">(</span>sqlSession<span class="token punctuation">,</span> <span class="token class-name">SqlSessionTemplate</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>sqlSessionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><code>SqlSessionUtils</code> &#x5C01;&#x88C5;&#x4E86;&#x5BF9; Spring &#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x673A;&#x5236;&#x7684;&#x8BBF;&#x95EE;&#x3002;</p>
<pre class="language-"><code class="lang-java"><span class="token comment">// SqlSessionUtils</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">SqlSession</span> <span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token class-name">SqlSessionFactory</span> sessionFactory<span class="token punctuation">,</span> <span class="token class-name">ExecutorType</span> executorType<span class="token punctuation">,</span> <span class="token class-name">PersistenceExceptionTranslator</span> exceptionTranslator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// &#x4ECE; Spring &#x7684;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x673A;&#x5236;&#x90A3;&#x91CC;&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x4E8B;&#x52A1;&#x5173;&#x8054;&#x7684;&#x4F1A;&#x8BDD;</span>
    <span class="token class-name">SqlSessionHolder</span> holder <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SqlSessionHolder</span><span class="token punctuation">)</span> <span class="token class-name">TransactionSynchronizationManager</span><span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span>sessionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">SqlSession</span> session <span class="token operator">=</span> <span class="token function">sessionHolder</span><span class="token punctuation">(</span>executorType<span class="token punctuation">,</span> holder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>session <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// &#x5DF2;&#x7ECF;&#x6709;&#x4E00;&#x4E2A;&#x4F1A;&#x8BDD;&#x5219;&#x590D;&#x7528;</span>
        <span class="token keyword">return</span> session<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// &#x521B;&#x5EFA;&#x65B0;&#x7684; &#x4F1A;&#x8BDD;</span>
    session <span class="token operator">=</span> sessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span>executorType<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// &#x6CE8;&#x518C;&#x5230; Spring &#x7684;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x673A;&#x5236;&#x91CC;</span>
    <span class="token function">registerSessionHolder</span><span class="token punctuation">(</span>sessionFactory<span class="token punctuation">,</span> executorType<span class="token punctuation">,</span> exceptionTranslator<span class="token punctuation">,</span> session<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> session<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">registerSessionHolder</span><span class="token punctuation">(</span><span class="token class-name">SqlSessionFactory</span> sessionFactory<span class="token punctuation">,</span> <span class="token class-name">ExecutorType</span> executorType<span class="token punctuation">,</span>
        <span class="token class-name">PersistenceExceptionTranslator</span> exceptionTranslator<span class="token punctuation">,</span> <span class="token class-name">SqlSession</span> session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">SqlSessionHolder</span> holder<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">TransactionSynchronizationManager</span><span class="token punctuation">.</span><span class="token function">isSynchronizationActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Environment</span> environment <span class="token operator">=</span> sessionFactory<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>environment<span class="token punctuation">.</span><span class="token function">getTransactionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">SpringManagedTransactionFactory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            holder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionHolder</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> executorType<span class="token punctuation">,</span> exceptionTranslator<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">TransactionSynchronizationManager</span><span class="token punctuation">.</span><span class="token function">bindResource</span><span class="token punctuation">(</span>sessionFactory<span class="token punctuation">,</span> holder<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// &#x91CD;&#x70B9;&#xFF1A;&#x6CE8;&#x518C;&#x4F1A;&#x8BDD;&#x7BA1;&#x7406;&#x7684;&#x56DE;&#x8C03;&#x94A9;&#x5B50;&#xFF0C;&#x771F;&#x6B63;&#x7684;&#x5173;&#x95ED;&#x52A8;&#x4F5C;&#x662F;&#x5728;&#x56DE;&#x8C03;&#x91CC;&#x5B8C;&#x6210;&#x7684;&#x3002;</span>
            <span class="token class-name">TransactionSynchronizationManager</span><span class="token punctuation">.</span><span class="token function">registerSynchronization</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SqlSessionSynchronization</span><span class="token punctuation">(</span>holder<span class="token punctuation">,</span> sessionFactory<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span><span class="token function">setSynchronizedWithTransaction</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// &#x7EF4;&#x62A4;&#x4F1A;&#x8BDD;&#x7684;&#x5F15;&#x7528;&#x8BA1;&#x6570;</span>
            holder<span class="token punctuation">.</span><span class="token function">requested</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">TransactionSynchronizationManager</span><span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span>environment<span class="token punctuation">.</span><span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TransientDataAccessResourceException</span><span class="token punctuation">(</span>
                    <span class="token string">&quot;SqlSessionFactory must be using a SpringManagedTransactionFactory in order to use Spring transaction synchronization&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">closeSqlSession</span><span class="token punctuation">(</span><span class="token class-name">SqlSession</span> session<span class="token punctuation">,</span> <span class="token class-name">SqlSessionFactory</span> sessionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// &#x4ECE;&#x7EBF;&#x7A0B;&#x672C;&#x5730;&#x53D8;&#x91CF;&#x91CC;&#x83B7;&#x53D6; Spring &#x7BA1;&#x7406;&#x7684;&#x4F1A;&#x8BDD;</span>
    <span class="token class-name">SqlSessionHolder</span> holder <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SqlSessionHolder</span><span class="token punctuation">)</span> <span class="token class-name">TransactionSynchronizationManager</span><span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span>sessionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>holder <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>holder<span class="token punctuation">.</span><span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> session<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Spring &#x7BA1;&#x7406;&#x7684;&#x4E0D;&#x76F4;&#x63A5;&#x5173;&#x95ED;&#xFF0C;&#x7531;&#x56DE;&#x8C03;&#x94A9;&#x5B50;&#x6765;&#x5173;&#x95ED;</span>
        holder<span class="token punctuation">.</span><span class="token function">released</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// &#x975E; Spring &#x7BA1;&#x7406;&#x7684;&#x76F4;&#x63A5;&#x5173;&#x95ED;</span>
        session<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><code>SqlSessionSynchronization</code> &#x662F; <code>SqlSessionUtils</code> &#x7684;&#x5185;&#x90E8;&#x79C1;&#x6709;&#x7C7B;&#xFF0C;&#x7528;&#x4E8E;&#x4F5C;&#x4E3A;&#x56DE;&#x8C03;&#x94A9;&#x5B50;&#x4E0E; Spring &#x7684;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x673A;&#x5236;&#x534F;&#x8C03;&#x5DE5;&#x4F5C;&#xFF0C;<code>TransactionSynchronizationManager</code> &#x5728;&#x9002;&#x5F53;&#x7684;&#x65F6;&#x5019;&#x56DE;&#x8C03;&#x5176;&#x65B9;&#x6CD5;&#x3002;</p>
<pre class="language-"><code class="lang-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">SqlSessionSynchronization</span> <span class="token keyword">extends</span> <span class="token class-name">TransactionSynchronizationAdapter</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">SqlSessionHolder</span> holder<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">SqlSessionFactory</span> sessionFactory<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> holderActive <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">SqlSessionSynchronization</span><span class="token punctuation">(</span><span class="token class-name">SqlSessionHolder</span> holder<span class="token punctuation">,</span> <span class="token class-name">SqlSessionFactory</span> sessionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>holder <span class="token operator">=</span> holder<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sessionFactory <span class="token operator">=</span> sessionFactory<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">DataSourceUtils</span><span class="token punctuation">.</span>CONNECTION_SYNCHRONIZATION_ORDER <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">suspend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>holderActive<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">TransactionSynchronizationManager</span><span class="token punctuation">.</span><span class="token function">unbindResource</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sessionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>holderActive<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">TransactionSynchronizationManager</span><span class="token punctuation">.</span><span class="token function">bindResource</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sessionFactory<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>holder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">beforeCommit</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> readOnly<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">TransactionSynchronizationManager</span><span class="token punctuation">.</span><span class="token function">isActualTransactionActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>holder<span class="token punctuation">.</span><span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">PersistenceException</span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>holder<span class="token punctuation">.</span><span class="token function">getPersistenceExceptionTranslator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">DataAccessException</span> translated <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>holder
                        <span class="token punctuation">.</span><span class="token function">getPersistenceExceptionTranslator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">translateExceptionIfPossible</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>translated <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">throw</span> translated<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">throw</span> p<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">beforeCompletion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>holder<span class="token punctuation">.</span><span class="token function">isOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">TransactionSynchronizationManager</span><span class="token punctuation">.</span><span class="token function">unbindResource</span><span class="token punctuation">(</span>sessionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>holderActive <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

            <span class="token comment">// &#x771F;&#x6B63;&#x5173;&#x95ED;&#x6570;&#x636E;&#x5E93;&#x4F1A;&#x8BDD;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>holder<span class="token punctuation">.</span><span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterCompletion</span><span class="token punctuation">(</span><span class="token keyword">int</span> status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>holderActive<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">TransactionSynchronizationManager</span><span class="token punctuation">.</span><span class="token function">unbindResourceIfPossible</span><span class="token punctuation">(</span>sessionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>holderActive <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

            <span class="token comment">// &#x771F;&#x6B63;&#x5173;&#x95ED;&#x6570;&#x636E;&#x5E93;&#x4F1A;&#x8BDD;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>holder<span class="token punctuation">.</span><span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>holder<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h5 id="33-&#x521B;&#x5EFA;&#x65B0;&#x4F1A;&#x8BDD;"><a name="33-&#x521B;&#x5EFA;&#x65B0;&#x4F1A;&#x8BDD;" class="anchor-navigation-ex-anchor" href="#33-&#x521B;&#x5EFA;&#x65B0;&#x4F1A;&#x8BDD;"><i class="fa fa-link" aria-hidden="true"></i></a>3.3 &#x521B;&#x5EFA;&#x65B0;&#x4F1A;&#x8BDD;</h5>
<pre class="language-"><code class="lang-java"><span class="token comment">// DefaultSqlSessionFactory</span>
<span class="token keyword">private</span> <span class="token class-name">SqlSession</span> <span class="token function">openSessionFromDataSource</span><span class="token punctuation">(</span><span class="token class-name">ExecutorType</span> execType<span class="token punctuation">,</span> <span class="token class-name">TransactionIsolationLevel</span> level<span class="token punctuation">,</span> <span class="token keyword">boolean</span> autoCommit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Transaction</span> tx <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">Environment</span> environment <span class="token operator">=</span> configuration<span class="token punctuation">.</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// &#x83B7;&#x53D6;&#x4E8B;&#x52A1;&#x5DE5;&#x5382;&#x5B9E;&#x73B0;</span>
        <span class="token keyword">final</span> <span class="token class-name">TransactionFactory</span> transactionFactory <span class="token operator">=</span> <span class="token function">getTransactionFactoryFromEnvironment</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>

        tx <span class="token operator">=</span> transactionFactory<span class="token punctuation">.</span><span class="token function">newTransaction</span><span class="token punctuation">(</span>environment<span class="token punctuation">.</span><span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> level<span class="token punctuation">,</span> autoCommit<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">final</span> <span class="token class-name">Executor</span> executor <span class="token operator">=</span> configuration<span class="token punctuation">.</span><span class="token function">newExecutor</span><span class="token punctuation">(</span>tx<span class="token punctuation">,</span> execType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DefaultSqlSession</span><span class="token punctuation">(</span>configuration<span class="token punctuation">,</span> executor<span class="token punctuation">,</span> autoCommit<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">closeTransaction</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// may have fetched a connection so lets call close()</span>
        <span class="token keyword">throw</span> <span class="token class-name">ExceptionFactory</span><span class="token punctuation">.</span><span class="token function">wrapException</span><span class="token punctuation">(</span><span class="token string">&quot;Error opening session.  Cause: &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token class-name">ErrorContext</span><span class="token punctuation">.</span><span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token class-name">TransactionFactory</span> <span class="token function">getTransactionFactoryFromEnvironment</span><span class="token punctuation">(</span><span class="token class-name">Environment</span> environment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>environment <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> environment<span class="token punctuation">.</span><span class="token function">getTransactionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ManagedTransactionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> environment<span class="token punctuation">.</span><span class="token function">getTransactionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="4-&#x5C0F;&#x7ED3;"><a name="4-&#x5C0F;&#x7ED3;" class="anchor-navigation-ex-anchor" href="#4-&#x5C0F;&#x7ED3;"><i class="fa fa-link" aria-hidden="true"></i></a>4. &#x5C0F;&#x7ED3;</h4>
<ol>
<li>MyBatis &#x7684;&#x6838;&#x5FC3;&#x7EC4;&#x4EF6; Executor &#x901A;&#x8FC7; Transaction &#x63A5;&#x53E3;&#x6765;&#x8FDB;&#x884C;&#x4E8B;&#x52A1;&#x63A7;&#x5236;&#x3002;</li>
<li>&#x4E0E; Spring &#x96C6;&#x6210;&#x65F6;&#xFF0C;&#x521D;&#x59CB;&#x5316; Configuration &#x65F6;&#x4F1A;&#x628A; transactionFactory &#x8BBE;&#x7F6E;&#x4E3A; SpringManagedTransactionFactory &#x7684;&#x5B9E;&#x4F8B;&#x3002;</li>
<li>&#x6BCF;&#x4E2A; Mapper &#x4EE3;&#x7406;&#x91CC;&#x6CE8;&#x5165;&#x7684; SqlSession &#x662F; SqlSessionTemplate &#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x5176;&#x5B9E;&#x73B0;&#x4E86; SqlSession &#x63A5;&#x53E3;&#xFF1B;</li>
<li>SqlSessionTemplate &#x628A;&#x5BF9; SqlSession &#x63A5;&#x53E3;&#x91CC;&#x58F0;&#x660E;&#x7684;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x59D4;&#x6258;&#x7ED9;&#x5185;&#x90E8;&#x7684;&#x4E00;&#x4E2A;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#xFF0C;&#x8BE5;&#x4EE3;&#x7406;&#x7684;&#x65B9;&#x6CD5;&#x5904;&#x7406;&#x5668;&#x4E3A;&#x5185;&#x90E8;&#x7C7B; SqlSessionInterceptor &#x3002;</li>
<li>SqlSessionInterceptor &#x63A5;&#x6536;&#x5230;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x65F6;&#xFF0C;&#x901A;&#x8FC7; SqlSessionUtil &#x8BBF;&#x95EE; Spring &#x7684;&#x4E8B;&#x52A1;&#x8BBE;&#x65BD;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x4E0E; Spring &#x5F53;&#x524D;&#x4E8B;&#x52A1;&#x5173;&#x8054;&#x7684; SqlSession &#x5219;&#x590D;&#x7528;&#xFF1B;&#x6CA1;&#x6709;&#x5219;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x3002;</li>
<li>SqlSessionInterceptor &#x6839;&#x636E; Spring &#x5F53;&#x524D;&#x4E8B;&#x52A1;&#x7684;&#x72B6;&#x6001;&#x6765;&#x51B3;&#x5B9A;&#x662F;&#x5426;&#x63D0;&#x4EA4;&#x6216;&#x56DE;&#x6EDA;&#x4E8B;&#x52A1;&#x3002;&#x4F1A;&#x8BDD;&#x7684;&#x771F;&#x6B63;&#x5173;&#x95ED;&#x662F;&#x901A;&#x8FC7;&#x6CE8;&#x518C;&#x5728; TransactionSynchronizationManager &#x4E0A;&#x7684;&#x56DE;&#x8C03;&#x94A9;&#x5B50;&#x5B9E;&#x73B0;&#x7684;&#x3002;</li>
</ol>
<p><a href="https://coderbee.net/wp-content/uploads/2019/10/mybatis-mapper-call.png" data-lightbox="57758560-c806-43f8-bab5-3ba052ed84c0" data-title="img" target="_blank"><img src="https://coderbee.net/wp-content/uploads/2019/10/mybatis-mapper-call.png" alt="img"></a></p>
<p>&#x5982;&#x4E0A;&#x56FE;&#xFF1A;</p>
<ol>
<li>&#x6B65;&#x9AA4; 1 &#x662F; Spring AOP &#x6DFB;&#x52A0;&#x7684;&#x5207;&#x9762;&#x7684;&#x6267;&#x884C;&#xFF0C;&#x4E8B;&#x52A1;&#x662F;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x5207;&#x9762;&#x3002;</li>
<li>&#x6B65;&#x9AA4; 2 &#x662F; Spring &#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x673A;&#x5236;&#x7684;&#x90E8;&#x5206;&#x3002;</li>
<li>&#x6B65;&#x9AA4; 3 &#x662F;&#x4E1A;&#x52A1;&#x4EE3;&#x7801;&#xFF0C;&#x8C03;&#x7528; Mapper &#x4EE3;&#x7406;&#x4E0A;&#x7684;&#x65B9;&#x6CD5;&#x3002;</li>
<li>&#x6B65;&#x9AA4; 4 &#x662F;&#x4EE3;&#x7406;&#x4E0A;&#x7684;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x88AB; MapperProxy.invoke &#x62E6;&#x622A;&#x3002;</li>
<li>&#x6B65;&#x9AA4; 5&#x3001;6 &#x662F;&#x56E0;&#x4E3A; MapperProxy &#x6301;&#x6709;&#x7684; sqlSession &#x662F; SqlSessionTemplate&#xFF0C;&#x8C03;&#x7528;&#x5230; template &#x4E0A;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x53C8;&#x88AB;&#x8F6C;&#x53D1;&#x7ED9;&#x5185;&#x90E8;&#x7C7B; SqlSessionInterceptor &#xFF0C;&#x8BE5;&#x7C7B;&#x83B7;&#x5F97; Spring &#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x6301;&#x6709;&#x7684;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#xFF0C;&#x7528;&#x4EE5;&#x521B;&#x5EFA; Executor h&#x548C; DefaultSqlSession&#x3002;</li>
<li>&#x6B65;&#x9AA4; 7 &#x7528; DefaultSqlSession &#x53D1;&#x8D77;&#x6570;&#x636E;&#x5E93;&#x8C03;&#x7528;&#x3002;</li>
</ol>
<h2 id="spring-&#x4E0E;-mybatis"><a name="spring-&#x4E0E;-mybatis" class="anchor-navigation-ex-anchor" href="#spring-&#x4E0E;-mybatis"><i class="fa fa-link" aria-hidden="true"></i></a>Spring &#x4E0E; MyBatis</h2>
<h4 id="&#x7B80;&#x8981;&#x6982;&#x8FF0;"><a name="&#x7B80;&#x8981;&#x6982;&#x8FF0;" class="anchor-navigation-ex-anchor" href="#&#x7B80;&#x8981;&#x6982;&#x8FF0;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7B80;&#x8981;&#x6982;&#x8FF0;</h4>
<ul>
<li>&#x5728;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x5BF9;service&#x5C42;&#x7684;AOP&#x5B9E;&#x73B0;&#xFF0C;&#x4F7F;&#x5F97;SpringMVC&#x7B49;servlet&#x8C03;&#x7528;&#x5BB9;&#x5668;&#x4E2D;&#x7684;Service&#x5BF9;&#x8C61;&#x65F6;&#xFF0C;&#x4F1A;&#x7528;TransactionInterceptor&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x52A8;&#x6001;&#x5904;&#x7406;&#xFF0C;&#x4E3A;&#x5176;&#x8C03;&#x7528;DataSourceTransactionManager&#x4E3A;&#x5176;&#x521B;&#x5EFA;transaction&#x5E76;&#x5C06;connection&#x7ED1;&#x5B9A;&#x5230;ThreadLocal&#xFF08;&#x5173;&#x952E;&#x5B57;&#x4E3A;datasource&#xFF0C;&#x4E4B;&#x540E;&#x7528;&#x5230;&#x8BE5;datasource&#x7684;&#x5C31;&#x7528;&#x8BE5;connectionholder&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x5224;&#x65AD;&#x662F;&#x5426;&#x5B58;&#x5728;&#x4E8B;&#x52A1;Spring&#x7684;&#x4E8B;&#x52A1;&#x63A7;&#x5236;&#xFF09;&#x4E2D;</li>
<li><strong>&#xFF08;service&#x5BF9;&#x8C61;&#x4E00;&#x7ECF;&#x4ECE;&#x5BB9;&#x5668;&#x4E2D;&#x83B7;&#x53D6;&#x5C31;&#x6267;&#x884C;&#xFF0C;&#x4F7F;&#x5F97;commit&#x7B49;&#x4EA4;&#x6613;transaction&#x7BA1;&#x7406;&#xFF0C;sqlsession&#x4FDD;&#x5B58;&#x5728;&#x7EBF;&#x7A0B;&#x4E2D;&#xFF0C;&#x53EF;&#x91CD;&#x590D;&#x4F7F;&#x7528;&#xFF0C;&#x5426;&#x5219;sqlsession&#x662F;&#x7531;&#x6BCF;&#x4E2A;&#x5355;&#x72EC;&#x7684;MapperFactoryBean&#x8C03;&#x7528;&#x7684;&#xFF0C;&#x6BCF;&#x4E2A;&#x6267;&#x884C;&#x5B8C;&#x4FBF;&#x63D0;&#x4EA4;&#xFF0C;&#x518D;&#x6B21;&#x8C03;&#x7528;&#x4F1A;&#x83B7;&#x53D6;&#x4E0D;&#x540C;&#x7684;connection&#xFF0C;&#x4E00;&#x7EA7;&#x7F13;&#x5B58;&#x5931;&#x6548;&#xFF1B;&#x5C31;&#x7B97;&#x4F60;&#x4E0D;&#x81EA;&#x52A8;&#x63D0;&#x4EA4;&#xFF08;&#x6CA1;&#x5F00;&#x542F;&#x4E8B;&#x52A1;&#x4E00;&#x822C;&#x662F;&#x81EA;&#x52A8;commit&#xFF09;&#xFF0C;&#x4E0D;&#x5F00;&#x542F;&#x4E8B;&#x52A1;&#x4E5F;&#x4E0D;&#x80FD;&#x4FDD;&#x8BC1;&#x540C;&#x4E00;&#x4E2A;sqlsession&#x8C03;&#x7528;&#x7684;&#x662F;&#x540C;&#x4E00;&#x4E2A;connection&#xFF0C;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x66F4;&#x5927;&#x7684;&#x95EE;&#x9898;&#x5982;&#x810F;&#x8BFB;&#x7B49;&#xFF0C;&#x82E5;&#x662F;&#x7ED1;&#x5B9A;&#x540C;&#x4E00;&#x4E2A;&#x5219;&#x53C8;&#x662F;&#x4E8B;&#x52A1;&#x7684;&#x539F;&#x7406;&#x4E86;&#xFF09;</strong></li>
<li>&#x5BF9;service&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x8C03;&#x7528;&#x65F6;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x8C03;&#x7528;&#x5230;dao&#x5C42;&#x7684;&#x65B9;&#x6CD5;&#x4E0E;mysql&#x8FDB;&#x884C;&#x4EA4;&#x4E92;&#xFF0C;&#x800C;dao&#x5C42;&#x7684;&#x7ECF;&#x8FC7;MapperScannerConfigurer&#x7684;&#x81EA;&#x52A8;&#x626B;&#x63CF;&#x4EE5;&#x53CA;&#x5C06;&#x65B9;&#x6CD5;&#x5C01;&#x88C5;&#x6210;&#x5404;&#x4E2A;MapperFactoryBean</li>
<li>MapperFactoryBean&#x521B;&#x5EFA;&#x65F6;&#x82E5;&#x6CA1;&#x6709;&#x6307;&#x5B9A;&#x7279;&#x5B9A;&#x7684;&#x6CE8;&#x5165;&#x5BF9;&#x8C61;&#xFF0C;&#x5728;&#x521D;&#x59CB;&#x5316;&#x65F6;Spring&#x4F1A;&#x81EA;&#x52A8;&#x6CE8;&#x5165;&#x76F8;&#x5E94;&#x7684;sqlsessionTemplate&#x7B49;sqlsession&#x5BF9;&#x8C61;&#xFF08;&#x5B9E;&#x73B0;&#x4E86;sqlsession&#x63A5;&#x53E3;&#xFF0C;&#x4F46;&#x90FD;&#x4E0D;&#x662F;&#x5B9E;&#x9645;&#x8D1F;&#x8D23;sql&#x8BED;&#x53E5;&#x6267;&#x884C;&#x7684;&#xFF09;</li>
<li>&#x82E5;&#x662F;&#x5B9E;&#x73B0;&#x4E86;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#xFF0C;&#x5219;&#x4F1A;&#x5728;TransactionSynchronizationManager&#x5BFB;&#x627E;&#x771F;&#x6B63;&#x6267;&#x884C;sql&#x8BED;&#x53E5;&#x7684;&#x4E14;&#x5728;&#x540C;&#x4E00;&#x4E8B;&#x52A1;&#x4E2D;&#x7684;DefaultSqlsession&#x8FD9;&#x7C7B;sqlsession&#x771F;&#x6B63;&#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#xFF0C;&#x901A;&#x8FC7;SpringManageTransaction&#x8C03;&#x7528;datasourceUtils&#xFF0C;&#x4ECE;TransactionSynchronizationManager&#x83B7;&#x53D6;&#x552F;&#x4E00;&#x7684;connection&#x53BB;&#x6267;&#x884C;&#x76F8;&#x5E94;&#x7684;sql&#x8BED;&#x53E5;&#x3002;</li>
<li>&#x82E5;&#x662F;&#x58F0;&#x660E;&#x5F0F;&#x4E8B;&#x52A1;&#xFF0C;&#x5219;&#x5728;service&#x65B9;&#x6CD5;&#x6267;&#x884C;&#x5B8C;&#x540E;&#x81EA;&#x52A8;commit&#xFF1B;&#x82E5;&#x7F16;&#x7A0B;&#x5F0F;&#x5219;&#x4ECE;status&#x83B7;&#x53D6;transaction&#x8FDB;&#x884C;commit</li>
</ul>
<pre class="language-"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.itcast<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>//&#x626B;&#x63CF;&#x7684;&#x5305;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>exclude-filter</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>annotation<span class="token punctuation">&quot;</span></span> <span class="token attr-name">expression</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.stereotype.Controller<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">context:</span>component-scan</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comboPooledDataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.mchange.v2.c3p0.ComboPooledDataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>//&#x6570;&#x636E;&#x6E90;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>driverClass<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.mysql.jdbc.Driver<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbcUrl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc:mysql://localhost:3306/ssm<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123456<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

//&#x521B;&#x5EFA;&#x7279;&#x5B9A;&#x7684;SqlSessionFactory
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sqlSessionFactory<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.mybatis.spring.SqlSessionFactoryBean<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comboPooledDataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

// &#x67E5; &#x627E; &#x7C7B; &#x8DEF; &#x5F84; &#x4E0B; &#x7684; &#x6620; &#x5C04; &#x5668; &#x5E76;&#x81EA; &#x52A8; &#x5C06; &#x5B83; &#x4EEC; &#x521B; &#x5EFA; &#x6210; MapperFactoryBean
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mapperScannerConfigurer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.mybatis.spring.mapper.MapperScannerConfigurer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>basePackage<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.itcast.dao<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

//&#x4E8B;&#x52A1;&#x7BA1;&#x7406;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSourceTransactionManager<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.jdbc.datasource.DataSourceTransactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comboPooledDataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>advice</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>txAdvice<span class="token punctuation">&quot;</span></span> <span class="token attr-name">transaction-manager</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSourceTransactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>attributes</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>find*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">read-only</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">isolation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DEFAULT<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>attributes</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>advice</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>advisor</span> <span class="token attr-name">advice-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>txAdvice<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pointcut</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>execution(* cn.itcast.service.impl.*ServiceImpl.*(..))<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>
</code></pre><hr>
<h4 id="mapperscannerconfigurer&#x4E0E;mapperfactorybean"><a name="mapperscannerconfigurer&#x4E0E;mapperfactorybean" class="anchor-navigation-ex-anchor" href="#mapperscannerconfigurer&#x4E0E;mapperfactorybean"><i class="fa fa-link" aria-hidden="true"></i></a>MapperScannerConfigurer&#x4E0E;MapperFactoryBean</h4>
<ul>
<li>MapperScannerConfigurer&#x67E5; &#x627E; &#x7C7B; &#x8DEF; &#x5F84; &#x4E0B; &#x7684; &#x6620; &#x5C04; &#x5668; &#x5E76;&#x81EA; &#x52A8; &#x5C06; &#x5B83; &#x4EEC; &#x521B; &#x5EFA; &#x6210; MapperFactoryBean</li>
</ul>
<blockquote>
<p>basePackage &#x5C5E;&#x6027;&#x662F;&#x8BA9;&#x4F60;&#x4E3A;&#x6620;&#x5C04;&#x5668;&#x63A5;&#x53E3;&#x6587;&#x4EF6;&#x8BBE;&#x7F6E;&#x57FA;&#x672C;&#x7684;&#x5305;&#x8DEF;&#x5F84;&#x3002; &#x4F60;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5206;&#x53F7;&#x6216;&#x9017;&#x53F7; &#x4F5C;&#x4E3A;&#x5206;&#x9694;&#x7B26;&#x8BBE;&#x7F6E;&#x591A;&#x4E8E;&#x4E00;&#x4E2A;&#x7684;&#x5305;&#x8DEF;&#x5F84;&#x3002;&#x6BCF;&#x4E2A;&#x6620;&#x5C04;&#x5668;&#x5C06;&#x4F1A;&#x5728;&#x6307;&#x5B9A;&#x7684;&#x5305;&#x8DEF;&#x5F84;&#x4E2D;&#x9012;&#x5F52;&#x5730;&#x88AB;&#x641C;&#x7D22;&#x5230;&#x3002;</p>
<p>&#x5982;&#x679C;&#x4E0D;&#x662F;&#x6709;&#x7279;&#x6B8A;&#x9700;&#x6C42;&#xFF0C;&#x4E0D;&#x9700;&#x8981; &#x53BB; &#x6307; &#x5B9A; SqlSessionFactory &#x6216; SqlSessionTemplate , &#x56E0; &#x4E3A; MapperScannerConfigurer &#x5C06;&#x4F1A;&#x521B;&#x5EFA; MapperFactoryBean,&#x4E4B;&#x540E;&#x81EA;&#x52A8;&#x88C5;&#x914D;&#x3002;&#x4F46;&#x662F;,&#x5982;&#x679C;&#x4F60;&#x4F7F; &#x7528;&#x4E86;&#x4E00;&#x4E2A; &#x4EE5;&#x4E0A;&#x7684; DataSource ,&#x90A3; &#x4E48;&#x81EA;&#x52A8; &#x88C5;&#x914D;&#x53EF; &#x80FD;&#x4F1A;&#x5931;&#x6548; &#x3002;&#x8FD9;&#x79CD; &#x60C5;&#x51B5;&#x4E0B; ,&#x4F60;&#x53EF; &#x4EE5;&#x4F7F;&#x7528; <strong>sqlSessionFactoryBeanName &#x6216; sqlSessionTemplateBeanName</strong> &#x5C5E;&#x6027;&#x6765;&#x8BBE;&#x7F6E;&#x6B63;&#x786E;&#x7684; bean &#x540D; &#x79F0;&#x6765;&#x4F7F;&#x7528;&#x3002;</p>
<pre class="language-"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sqlSessionFactoryBeanName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sqlSessionFactory<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></blockquote>
<pre class="language-"><code>public class MapperScannerConfigurer implements BeanDefinitionRegistryPostProcessor, InitializingBean, ApplicationContextAware, BeanNameAware {

    //&#x63A5;&#x53E3;&#x5305;

    private String basePackage;
    private boolean addToConfig = true;
    private SqlSessionFactory sqlSessionFactory;
    private SqlSessionTemplate sqlSessionTemplate;
    private String sqlSessionFactoryBeanName;
    private String sqlSessionTemplateBeanName;
    private Class<span class="token prolog">&lt;? extends Annotation&gt; annotationClass;
    private Class&lt;?&gt;</span> markerInterface;
    private ApplicationContext applicationContext;
    private String beanName;
    private boolean processPropertyPlaceHolders;
    private BeanNameGenerator nameGenerator;
     &#xB7;&#xB7;&#xB7;
     get/set&#x65B9;&#x6CD5;&#x7528;&#x4EE5;&#x6CE8;&#x5165;
     &#xB7;&#xB7;&#xB7;
}
private void processPropertyPlaceHolders() {
        Map<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>String,</span> <span class="token attr-name">PropertyResourceConfigurer</span><span class="token punctuation">&gt;</span></span> prcs = this.applicationContext.getBeansOfType(PropertyResourceConfigurer.class);
        if (!prcs.isEmpty() &amp;&amp; this.applicationContext instanceof GenericApplicationContext) {
            BeanDefinition mapperScannerBean = ((GenericApplicationContext)this.applicationContext).getBeanFactory().getBeanDefinition(this.beanName);
            DefaultListableBeanFactory factory = new DefaultListableBeanFactory();
            factory.registerBeanDefinition(this.beanName, mapperScannerBean);
            Iterator var4 = prcs.values().iterator();

            while(var4.hasNext()) {
                PropertyResourceConfigurer prc = (PropertyResourceConfigurer)var4.next();
                prc.postProcessBeanFactory(factory);
            }

            PropertyValues values = mapperScannerBean.getPropertyValues();
            this.basePackage = this.updatePropertyValue(&quot;basePackage&quot;, values);
            this.sqlSessionFactoryBeanName = this.updatePropertyValue(&quot;sqlSessionFactoryBeanName&quot;, values);
            this.sqlSessionTemplateBeanName = this.updatePropertyValue(&quot;sqlSessionTemplateBeanName&quot;, values);
        }

    }
</code></pre><ul>
<li>MapperFactoryBean</li>
</ul>
<blockquote>
<p>&#x6570;&#x636E;&#x6620;&#x5C04;&#x5668;&#x63A5;&#x53E3;&#x53EF;&#x4EE5;&#x6309;&#x7167;&#x5982;&#x4E0B;&#x505A;&#x6CD5;&#x52A0;&#x5165;&#x5230; Spring &#x4E2D;:</p>
<pre class="language-"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userMapper<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.mybatis.spring.mapper.MapperFactoryBean<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mapperInterface<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.mybatis.spring.sample.mapper.UserMapper<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sqlSessionFactory<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sqlSessionFactory<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>MapperFactoryBean &#x521B;&#x5EFA;&#x7684;&#x4EE3;&#x7406;&#x7C7B;&#x5B9E;&#x73B0;&#x4E86; UserMapper &#x63A5;&#x53E3;,&#x5E76;&#x4E14;&#x6CE8;&#x5165;&#x5230;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x3002; &#x56E0;&#x4E3A;&#x4EE3;&#x7406;&#x521B;&#x5EFA;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x73AF;&#x5883;&#x4E2D; ,&#x90A3;&#x4E48;&#x6307;&#x5B9A;&#x7684;&#x6620;&#x5C04;&#x5668;&#x5FC5;&#x987B;&#x662F;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;,&#x800C; &#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x5177;&#x4F53;&#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#x3002;</p>
<p>&#x5982;&#x679C; UserMapper &#x6709;&#x4E00;&#x4E2A;&#x5BF9;&#x5E94;&#x7684; MyBatis &#x7684; XML &#x6620;&#x5C04;&#x5668;&#x6587;&#x4EF6;, &#x5982;&#x679C; XML &#x6587;&#x4EF6;&#x5728;&#x7C7B;&#x8DEF;&#x5F84;&#x7684; &#x4F4D;&#x7F6E;&#x548C;&#x6620;&#x5C04;&#x5668;&#x7C7B;&#x76F8;&#x540C;&#x65F6;, &#x5B83;&#x4F1A;&#x88AB; MapperFactoryBean &#x81EA;&#x52A8;&#x89E3;&#x6790;&#x3002; &#x6CA1;&#x6709;&#x5FC5;&#x8981;&#x5728; MyBatis &#x914D;&#x7F6E;&#x6587; &#x4EF6; &#x4E2D; &#x53BB; &#x6307; &#x5B9A; &#x6620; &#x5C04; &#x5668; , &#x9664; &#x975E; &#x6620; &#x5C04; &#x5668; &#x7684; XML &#x6587; &#x4EF6; &#x5728; &#x4E0D; &#x540C; &#x7684; &#x7C7B; &#x8DEF; &#x5F84; &#x4E0B; &#x3002;</p>
<p>&#x5F53; MapperFactoryBean &#x9700;&#x8981; SqlSessionFactory &#x6216; SqlSessionTemplate &#x65F6;&#x3002; &#x8FD9;&#x4E9B;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5404;&#x81EA;&#x7684; SqlSessionFactory &#x6216; SqlSessionTemplate &#x5C5E;&#x6027;&#x6765;&#x8BBE;&#x7F6E;, &#x6216;&#x8005;&#x53EF;&#x4EE5;&#x7531; Spring &#x6765;&#x81EA;&#x52A8;&#x88C5;&#x914D;&#x3002;&#x5982;&#x679C;&#x4E24;&#x4E2A;&#x5C5E;&#x6027;&#x90FD;&#x8BBE;&#x7F6E;&#x4E86;,&#x90A3;&#x4E48; SqlSessionFactory &#x5C31;&#x4F1A;&#x88AB;&#x5FFD;&#x7565;,&#x56E0;&#x4E3A; SqlSessionTemplate &#x662F;&#x9700;&#x8981;&#x6709;&#x4E00;&#x4E2A; session &#x5DE5;&#x5382;&#x7684;&#x8BBE;&#x7F6E;; &#x90A3;&#x4E2A;&#x5DE5;&#x5382;&#x4F1A;&#x7531; MapperFactoryBean. &#x6765;&#x4F7F;&#x7528;&#x3002;</p>
</blockquote>
<ul>
<li><p>&#x7531;&#x4E8E;&#x4F7F;&#x7528;spring&#x7BA1;&#x7406;bean&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;bean&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x9996;&#x5148;&#x53BB;&#x5BB9;&#x5668;&#x4E2D;&#x627E;&#xFF0C;&#x7B2C;&#x4E00;&#x6B21;&#x9700;&#x8981;&#x8C03;&#x7528;MapperFactoryBean&#x7684;getObject&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x4E00;&#x4E2A;bean&#xFF0C;&#x5E76;&#x4FDD;&#x5B58;&#x5230;&#x5BB9;&#x5668;&#x4E2D;&#x3002;&#xFF08;&#x8FD9;&#x91CC;&#x751F;&#x6210;&#x7684;&#x5BF9;&#x8C61;&#x6700;&#x7EC8;&#x4E5F;&#x662F;&#x7528;sqlssion&#x7684;getMapper&#x751F;&#x6210;&#x7684;&#xFF0C;&#x4E0E;mybatis&#x4E00;&#x81F4;&#xFF09;</p>
<p>MapperFactoryBean&#x7684;getObject&#x65B9;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A;</p>
</li>
</ul>
<blockquote>
<pre class="language-"><code>public class MapperFactoryBean<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span> extends SqlSessionDaoSupport implements FactoryBean<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span> {
public T getObject() throws Exception {
    return this.getSqlSession().getMapper(this.mapperInterface);
}
}
</code></pre></blockquote>
<ul>
<li>&#x53C8;&#x5230;SqlSessionDaoSupport&#x4E2D;&#x53BB;&#x83B7;&#x53D6;</li>
</ul>
<blockquote>
<pre class="language-"><code>public abstract class SqlSessionDaoSupport extends DaoSupport {
    private SqlSession sqlSession;
    private boolean externalSqlSession;

public SqlSession getSqlSession() {
    return this.sqlSession;
}

// &#x5728;MapperScannerConfigurer&#x81EA;&#x52A8;&#x626B;&#x63CF;&#x751F;&#x6210;/&#x81EA;&#x5DF1;&#x521B;&#x5EFA;MapperFactoryBean&#x65F6;&#xFF0C;&#x7531;&#x4F20;&#x5165;&#x7684;&#x5DE5;&#x5382;&#x7C7B;&#x578B;/Spring&#x81EA;&#x52A8;&#x914D;&#x7F6E;&#x7684;&#x5DE5;&#x5382;&#x7C7B;&#x578B;
&#x65F6;&#xFF0C;&#x5C31;&#x521B;&#x5EFA;&#x4E86;SqlSessionTemplate&#xFF08;&#x5B9E;&#x73B0;&#x4E86;sqlsession&#x63A5;&#x53E3;&#xFF09;&#xFF0C;&#x56E0;&#x6B64;&#x8C03;&#x7528;&#x65B9;&#x6CD5;&#x65F6;&#x4F1A;&#x901A;&#x8FC7;SqlSessionTemplate&#x7684;proxysqlsession&#xFF08;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x751F;&#x6210;&#x7684;&#x4EE3;&#x7406;&#x7C7B;&#xFF09;&#x53BB;TransactionSynchronizationManager&#x5BFB;&#x627E;&#x771F;&#x6B63;&#x7684;sqlsession&#x6216;&#x521B;&#x5EFA;

 public void setSqlSessionFactory(SqlSessionFactory sqlSessionFactory) {
        if (!this.externalSqlSession) {
            this.sqlSession = new SqlSessionTemplate(sqlSessionFactory);
        }

    }
}

//spring&#x6574;&#x5408;mybatis&#x540E;&#xFF0C;&#x975E;&#x4E8B;&#x52A1;&#x73AF;&#x5883;&#x4E0B;&#xFF0C;&#x6BCF;&#x4E2A;&#x6267;&#x884C;&#x5B8C;&#x4FBF;&#x63D0;&#x4EA4;&#xFF0C;&#x6BCF;&#x6B21;&#x64CD;&#x4F5C;&#x6570;&#x636E;&#x5E93;&#x90FD;&#x4F7F;&#x7528;&#x65B0;&#x7684;sqlSession&#x5BF9;&#x8C61;&#xFF0C;&#x83B7;&#x53D6;&#x4E0D;&#x540C;&#x7684;connection&#x3002;&#x56E0;&#x6B64;mybatis&#x7684;&#x4E00;&#x7EA7;&#x7F13;&#x5B58;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#xFF0C;&#x82E5;&#x6709;&#x5219;&#x53D6;TransactionSynchronizationManager&#x4E2D;&#x7684;sqlsession&#x5219;&#x4E00;&#x7EA7;&#x7F13;&#x5B58;&#x751F;&#x6548;&#xFF08;&#x4E00;&#x7EA7;&#x7F13;&#x5B58;&#x9488;&#x5BF9;&#x540C;&#x4E00;&#x4E2A;sqlsession&#x6709;&#x6548;&#xFF09;
</code></pre></blockquote>
<hr>
<h4 id="transactiondefinition&#x4E0E;transactionattributes"><a name="transactiondefinition&#x4E0E;transactionattributes" class="anchor-navigation-ex-anchor" href="#transactiondefinition&#x4E0E;transactionattributes"><i class="fa fa-link" aria-hidden="true"></i></a>TransactionDefinition&#x4E0E;TransactionAttributes</h4>
<ul>
<li><p><strong>&#x83B7;&#x53D6;&#x4E8B;&#x52A1;&#x5C5E;&#x6027;&#x5BF9;&#x8C61;(TransactionAttributes&#x82E5;&#x65E0;&#x8BBE;&#x7F6E;attributes&#x5219;&#x9ED8;&#x8BA4;&#x4E3A;DefaultTransactionDefinition)&#xFF0C;&#x653E;&#x7F6E;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;transactionManager&#x8C03;&#x7528;getTransaction&#x65F6;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x4F20;&#x5165;</strong></p>
<p>&#x4E8B;&#x52A1;&#x5C5E;&#x6027;&#x5BF9;&#x8C61;&#x6301;&#x6709;&#x4E8B;&#x52A1;&#x7684;&#x76F8;&#x5173;&#x914D;&#x7F6E;&#xFF0C;&#x6BD4;&#x5982;&#x4E8B;&#x52A1;&#x7684;&#x9694;&#x79BB;&#x7EA7;&#x522B;&#xFF0C;&#x4F20;&#x64AD;&#x884C;&#x4E3A;&#xFF0C;&#x662F;&#x5426;&#x53EA;&#x8BFB;&#x7B49;&#x3002;&#x6211;&#x4EEC;&#x5F00;&#x542F;spring&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x65F6;&#xFF0C;&#x901A;&#x5E38;&#x90FD;&#x4F1A;&#x5728;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x91CC;&#x52A0;&#x5165;&#x8FD9;&#x6837;&#x4E00;&#x6BB5;&#x914D;&#x7F6E;&#x3002;</p>
<pre class="language-"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>advice</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>txAdvice<span class="token punctuation">&quot;</span></span> <span class="token attr-name">transaction-manager</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>attributes</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>get*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">read-only</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>*<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>attributes</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>advice</span><span class="token punctuation">&gt;</span></span>
</code></pre><blockquote>
<ul>
<li><p>TransactionDefinition&#x4E3B;&#x8981;&#x5B9A;&#x4E49;&#x4E86;&#x6709;&#x54EA;&#x4E9B;&#x4E8B;&#x52A1;&#x5C5E;&#x6027;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#xFF1A;</p>
<ul>
<li><p>&#x4E8B;&#x52A1;&#x7684;&#x9694;&#x79BB;&#x7EA7;&#x522B;&#xFF08;Isolation&#xFF09;</p>
</li>
<li><p>&#x4E8B;&#x52A1;&#x7684;&#x4F20;&#x64AD;&#x884C;&#x4E3A;&#xFF08;Propagation Behavior&#xFF09;</p>
<blockquote>
<p> &#x9ED8;&#x8BA4;&#x4E3A;PROPAGATION_REQUIRED ,&#x82E5;&#x5B58;&#x5728;&#x4E8B;&#x52A1;&#x5219;&#x52A0;&#x5165;&#x5F53;&#x524D;&#x4E8B;&#x52A1;&#xFF0C;&#x82E5;&#x6CA1;&#x6709;&#x5219;&#x81EA;&#x5DF1;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x3002;</p>
<p> Propagation Behavior&#x6CE8;&#x610F;PROPAGATION_REQUIRES_NEW&#x548C;PROPAGATION_NESTED&#x7684;&#x533A;&#x522B;&#xFF0C;&#x524D;&#x8005;&#x5C06;&#x5F53;&#x524D;&#x4E8B;&#x52A1;&#x6302;&#x8D77;&#xFF0C;&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x4E8B;&#x52A1;&#x6267;&#x884C;&#xFF1B;&#x540E;&#x8005;&#xFF0C;&#x5219;&#x662F;&#x5728;&#x5F53;&#x524D;&#x4E8B;&#x52A1;&#x79CD;&#x7684;&#x4E00;&#x4E2A;&#x5D4C;&#x5957;&#x4E8B;&#x52A1;&#x4E2D;&#x6267;&#x884C;</p>
</blockquote>
</li>
<li><p>&#x4E8B;&#x52A1;&#x7684;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#xFF08;Timeout&#xFF09;</p>
</li>
<li><p>&#x662F;&#x5426;&#x4E3A;&#x53EA;&#x8BFB;&#x4E8B;&#x52A1;(ReadOnly)</p>
</li>
<li><p>SQL&#x6807;&#x51C6;&#x5B9A;&#x4E49;&#x4E86;4&#x7C7B;&#x9694;&#x79BB;&#x7EA7;&#x522B;&#xFF0C;&#x5305;&#x62EC;&#x4E86;&#x4E00;&#x4E9B;&#x5177;&#x4F53;&#x89C4;&#x5219;&#xFF0C;&#x7528;&#x6765;&#x9650;&#x5B9A;&#x4E8B;&#x52A1;&#x5185;&#x5916;&#x7684;&#x54EA;&#x4E9B;&#x6539;&#x53D8;&#x662F;&#x53EF;&#x89C1;&#x7684;&#xFF0C;&#x54EA;&#x4E9B;&#x662F;&#x4E0D;&#x53EF;&#x89C1;&#x7684;&#x3002;&#x4F4E;&#x7EA7;&#x522B;&#x7684;&#x9694;&#x79BB;&#x7EA7;&#x4E00;&#x822C;&#x652F;&#x6301;&#x66F4;&#x9AD8;&#x7684;&#x5E76;&#x53D1;&#x5904;&#x7406;&#xFF0C;&#x5E76;&#x62E5;&#x6709;&#x66F4;&#x4F4E;&#x7684;&#x7CFB;&#x7EDF;&#x5F00;&#x9500;&#x3002;</p>
</li>
<li><p>ISOLATION_DEFAULT &#x6570;&#x636E;&#x5E93;&#x7684;&#x9ED8;&#x8BA4;&#x7EA7;&#x522B;&#xFF1A;mysql&#x4E3A;<strong>Repeatable Read&#xFF08;&#x53EF;&#x91CD;&#x8BFB;&#xFF09;</strong>&#xFF0C;&#x5176;&#x4ED6;&#x7684;&#x4E00;&#x822C;&#x4E3A;<strong>Read Committed&#xFF08;&#x8BFB;&#x53D6;&#x63D0;&#x4EA4;&#x5185;&#x5BB9;&#xFF09;</strong></p>
</li>
</ul>
</li>
</ul>
<ul>
<li><strong>Read Uncommitted&#xFF08;&#x8BFB;&#x53D6;&#x672A;&#x63D0;&#x4EA4;&#x5185;&#x5BB9;&#xFF09;</strong> ISOLATION_READ_UNCOMITTED</li>
</ul>
<pre class="language-"><code>&#x5728;&#x8BE5;&#x9694;&#x79BB;&#x7EA7;&#x522B;&#xFF0C;&#x6240;&#x6709;&#x4E8B;&#x52A1;&#x90FD;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5176;&#x4ED6;&#x672A;&#x63D0;&#x4EA4;&#x4E8B;&#x52A1;&#x7684;&#x6267;&#x884C;&#x7ED3;&#x679C;&#x3002;&#x672C;&#x9694;&#x79BB;&#x7EA7;&#x522B;&#x5F88;&#x5C11;&#x7528;&#x4E8E;&#x5B9E;&#x9645;&#x5E94;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x7684;&#x6027;&#x80FD;&#x4E5F;&#x4E0D;&#x6BD4;&#x5176;&#x4ED6;&#x7EA7;&#x522B;&#x597D;&#x591A;&#x5C11;&#x3002;**&#x8BFB;&#x53D6;&#x672A;&#x63D0;&#x4EA4;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4E5F;&#x88AB;&#x79F0;&#x4E4B;&#x4E3A;&#x810F;&#x8BFB;&#xFF08;Dirty Read&#xFF09;&#x3002;**
</code></pre><ul>
<li><strong>Read Committed&#xFF08;&#x8BFB;&#x53D6;&#x63D0;&#x4EA4;&#x5185;&#x5BB9;&#xFF09;</strong>ISOLATION_READ_COMITTED</li>
</ul>
<p>  &#x200B;        &#x8FD9;&#x662F;&#x5927;&#x591A;&#x6570;&#x6570;&#x636E;&#x5E93;&#x7CFB;&#x7EDF;&#x7684;&#x9ED8;&#x8BA4;&#x9694;&#x79BB;&#x7EA7;&#x522B;&#xFF08;&#x4F46;&#x4E0D;&#x662F;MySQL&#x9ED8;&#x8BA4;&#x7684;&#xFF09;&#x3002;&#x5B83;&#x6EE1;&#x8DB3;&#x4E86;&#x9694;&#x79BB;&#x7684;&#x7B80;&#x5355;&#x5B9A;&#x4E49;&#xFF1A;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x53EA;&#x80FD;&#x770B;&#x89C1;&#x5DF2;&#x7ECF;&#x63D0;&#x4EA4;&#x4E8B;&#x52A1;&#x6240;&#x505A;&#x7684;&#x6539;&#x53D8;&#x3002;&#x8FD9;&#x79CD;&#x9694;&#x79BB;&#x7EA7;&#x522B; &#x4E5F;&#x652F;&#x6301;&#x6240;&#x8C13;&#x7684;<strong>&#x4E0D;&#x53EF;&#x91CD;&#x590D;&#x8BFB;&#xFF08;Nonrepeatable Read&#xFF09;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x5728;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x4E2D;&#x591A;&#x6B21;&#x8BFB;&#x53D6;&#x4E00;&#x6761;&#x6570;&#x636E;&#xFF0C;&#x800C;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x5219;&#x540C;&#x65F6;&#x66F4;&#x65B0;&#x5566;&#x8FD9;&#x6761;&#x6570;&#x636E;&#xFF0C;&#x9020;&#x6210;&#x7B2C;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x591A;&#x6B21;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x4E0D;&#x4E00;&#x81F4;&#x3002;**</strong></p>
<ul>
<li><strong>Repeatable Read&#xFF08;&#x53EF;&#x91CD;&#x8BFB;&#xFF09;</strong>ISOLATION_REPEATABLE_READ</li>
</ul>
<p>  &#x8FD9;&#x662F;MySQL&#x7684;&#x9ED8;&#x8BA4;&#x4E8B;&#x52A1;&#x9694;&#x79BB;&#x7EA7;&#x522B;&#xFF0C;&#x5B83;&#x786E;&#x4FDD;&#x540C;&#x4E00;&#x4E8B;&#x52A1;&#x7684;&#x591A;&#x4E2A;&#x5B9E;&#x4F8B;&#x5728;&#x5E76;&#x53D1;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x4F1A;&#x770B;&#x5230;&#x540C;&#x6837;&#x7684;&#x6570;&#x636E;&#x884C;&#x3002;&#x4E0D;&#x8FC7;&#x7406;&#x8BBA;&#x4E0A;&#xFF0C;&#x8FD9;&#x4F1A;&#x5BFC;&#x81F4;&#x53E6;&#x4E00;&#x4E2A;&#x68D8;&#x624B;&#x7684;&#x95EE;&#x9898;&#xFF1A;<strong>&#x5E7B;&#x8BFB; &#xFF08;Phantom Read&#xFF09;</strong>&#x3002;&#x7B80;&#x5355;&#x7684;&#x8BF4;&#xFF0C;&#x5E7B;&#x8BFB;&#x6307;&#x7B2C;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x8BFB;&#x53D6;&#x4E00;&#x4E2A;&#x7ED3;&#x679C;&#x96C6;&#x540E;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x4E8B;&#x52A1;&#xFF0C;&#x5BF9;&#x8FD9;&#x4E2A;&#x7ED3;&#x679C;&#x96C6;&#x7ECF;&#x884C;&#x589E;&#x5220;&#x64CD;&#x4F5C;&#xFF08;&#x7B2C;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x6682;&#x65F6;&#x6CA1;&#x7528;&#x5230;&#xFF0C;&#x6CA1;&#x6DFB;&#x52A0;&#x884C;&#x9501;&#xFF09;&#xFF0C;&#x7136;&#x800C;&#x7B2C;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x4E2D;&#x518D;&#x6B21;&#x5BF9;&#x8FD9;&#x4E2A;&#x7ED3;&#x679C;&#x96C6;&#x8FDB;&#x884C;&#x67E5;&#x8BE2;&#x65F6;&#xFF0C;&#x6570;&#x636E;&#x53D1;&#x73B0;&#x4E22;&#x5931;&#x6216;&#x65B0;&#x589E;&#xFF0C;&#x51FA;&#x73B0;&#x4E86;&#x201C;&#x5E7B;&#x5F71;&#x201D;&#x3002;<strong>&#x901A;&#x8FC7;&#x52A0;&#x8868;&#x7EA7;&#x9501;&#x89E3;&#x51B3;&#xFF0C;&#x5982;&#x95F4;&#x9699;&#x9501;</strong>InnoDB&#x548C;Falcon&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x901A;&#x8FC7;&#x591A;&#x7248;&#x672C;&#x5E76;&#x53D1;&#x63A7;&#x5236;&#xFF08;MVCC&#xFF0C;Multiversion Concurrency Control&#xFF09;&#x673A;&#x5236;&#x89E3;&#x51B3;&#x4E86;&#x8BE5;&#x95EE;&#x9898;&#x3002;</p>
<p>  <strong>Serializable&#xFF08;&#x53EF;&#x4E32;&#x884C;&#x5316;&#xFF09;</strong>ISOLATION_SERIALIZABLE</p>
<p>  &#x8FD9;&#x662F;&#x6700;&#x9AD8;&#x7684;&#x9694;&#x79BB;&#x7EA7;&#x522B;&#xFF0C;&#x5B83;&#x901A;&#x8FC7;&#x5F3A;&#x5236;&#x4E8B;&#x52A1;&#x6392;&#x5E8F;&#xFF0C;&#x4F7F;&#x4E4B;&#x4E0D;&#x53EF;&#x80FD;&#x76F8;&#x4E92;&#x51B2;&#x7A81;&#xFF0C;&#x4ECE;&#x800C;&#x89E3;&#x51B3;&#x5E7B;&#x8BFB;&#x95EE;&#x9898;&#x3002;&#x7B80;&#x8A00;&#x4E4B;&#xFF0C;&#x5B83;&#x662F;&#x5728;&#x6BCF;&#x4E2A;&#x8BFB;&#x7684;&#x6570;&#x636E;&#x884C;&#x4E0A;&#x52A0;&#x4E0A;&#x5171;&#x4EAB;&#x9501;&#x3002;&#x5728;&#x8FD9;&#x4E2A;&#x7EA7;&#x522B;&#xFF0C;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x5927;&#x91CF;&#x7684;&#x8D85;&#x65F6;&#x73B0;&#x8C61;&#x548C;&#x9501;&#x7ADE;&#x4E89;&#x3002;</p>
<ul>
<li>TransactionAttribute&#x5728;TransactionDefinition&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x6DFB;&#x52A0;&#x4E86;rollbackon&#x65B9;&#x6CD5;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x58F0;&#x660E;&#x7684;&#x65B9;&#x5F0F;&#x6307;&#x5B9A;&#x4E1A;&#x52A1;&#x65B9;&#x6CD5;&#x5728;&#x629B;&#x51FA;&#x7684;&#x54EA;&#x4E9B;&#x7684;&#x5F02;&#x5E38;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x53EF;&#x4EE5;&#x56DE;&#x6EDA;&#x4E8B;&#x52A1;&#x3002;&#xFF08;&#x8BE5;&#x63A5;&#x53E3;&#x4E3B;&#x8981;&#x9762;&#x5411;&#x4F7F;&#x7528;Spring AOP&#x8FDB;&#x884C;&#x58F0;&#x660E;&#x5F0F;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x7684;&#x573A;&#x5408;&#xFF09;</li>
</ul>
<p><a href="F:\Typora&#x6570;&#x636E;&#x50A8;&#x5B58;\&#x6570;&#x636E;&#x5E93;\mybatis.assets\image-20200728132052202.png" data-lightbox="a2cfc78a-6d0c-4129-872a-228f5890b72f" data-title="image-20200728132052202" target="_blank"><img src="F:\Typora&#x6570;&#x636E;&#x50A8;&#x5B58;\&#x6570;&#x636E;&#x5E93;\mybatis.assets\image-20200728132052202.png" alt="image-20200728132052202"></a></p>
</blockquote>
<hr>
</li>
</ul>
<h4 id="&#x7F16;&#x7A0B;&#x5F0F;&#x7684;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x4E0E;&#x58F0;&#x660E;&#x5F0F;&#x4E8B;&#x52A1;&#x5904;&#x7406;"><a name="&#x7F16;&#x7A0B;&#x5F0F;&#x7684;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x4E0E;&#x58F0;&#x660E;&#x5F0F;&#x4E8B;&#x52A1;&#x5904;&#x7406;" class="anchor-navigation-ex-anchor" href="#&#x7F16;&#x7A0B;&#x5F0F;&#x7684;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x4E0E;&#x58F0;&#x660E;&#x5F0F;&#x4E8B;&#x52A1;&#x5904;&#x7406;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7F16;&#x7A0B;&#x5F0F;&#x7684;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x4E0E;&#x58F0;&#x660E;&#x5F0F;&#x4E8B;&#x52A1;&#x5904;&#x7406;</h4>
<ul>
<li><p>spring&#x63D0;&#x4F9B;<strong>&#x7F16;&#x7A0B;&#x5F0F;&#x7684;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#xFF08;&#x81EA;&#x5DF1;&#x521B;&#x5EFA;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x5668;&#xFF0C;&#x7531;&#x81EA;&#x5DF1;&#x8C03;&#x7528;&#x7BA1;&#x7406;&#x5668;&#x7684;&#x65B9;&#x6CD5;&#x521B;&#x5EFA;&#x4E8B;&#x52A1;&#x6216;&#x5904;&#x7406;&#x4E8B;&#x52A1;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x51CF;&#x5C11;&#x4EE3;&#x7406;&#x7C7B;&#x7684;&#x7F16;&#x5199;&#xFF0C;&#x4F46;&#x662F;&#x8FD8;&#x662F;&#x8981;&#x7F16;&#x5199;&#x5F88;&#x591A;&#x4E8B;&#x52A1;&#x7684;&#x4EE3;&#x7801;&#x5728;&#x4E1A;&#x52A1;&#x4EE3;&#x7801;&#x7684;&#x524D;&#x540E;&#xFF0C;&#x4E0D;&#x662F;&#x5F88;&#x65B9;&#x4FBF;&#x7BA1;&#x7406;&#xFF0C;&#x5BF9;&#x4E8E;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x8FD9;&#x79CD;&#x7279;&#x6027;&#x57FA;&#x672C;&#x4E00;&#x81F4;&#x7684;&#x64CD;&#x4F5C;&#x7528;&#x58F0;&#x660E;&#x53CD;&#x800C;&#x66F4;&#x5229;&#x4E8E;&#x7EF4;&#x62A4;&#xFF09;&#x548C;&#x58F0;&#x660E;&#x5F0F;&#x4E8B;&#x52A1;&#x5904;&#x7406;&#xFF08;&#x58F0;&#x660E;&#x540E;&#x7531;&#x5BB9;&#x5668;&#x521B;&#x5EFA;&#xFF0C;&#x7531;&#x58F0;&#x660E;&#x6765;&#x8C03;&#x7528;&#x76F8;&#x5E94;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x58F0;&#x660E;&#x5F0F;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x7528;AOP&#x907F;&#x514D;&#x4E86;&#x6211;&#x4EEC;&#x4E3A;&#x6BCF;&#x4E00;&#x4E2A;&#x9700;&#x8981;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x7684;&#x7C7B;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x4EE3;&#x7406;&#x7C7B;&#xFF09;&#x3002;</strong></p>
</li>
<li><p>&#x82E5;&#x662F;&#x58F0;&#x660E;&#x5F0F;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x53D1;&#x73B0;&#xFF0C;&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x81EA;&#x5DF1;&#x64CD;&#x4F5C;commit&#x7684;&#x7A7A;&#x95F4;&#xFF0C;&#x4ED6;&#x4F1A;&#x5728;&#x4F60;&#x4E8B;&#x52A1;&#x58F0;&#x660E;&#x7684;&#x65B9;&#x6CD5;&#x7ED3;&#x675F;&#x65F6;&#x5C31;commit&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x628A;&#x5F88;&#x591A;&#x4E1A;&#x52A1;&#x4EE3;&#x7801;&#x653E;&#x5728;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;service&#x65B9;&#x6CD5;&#x4E2D;&#x5B9E;&#x73B0;&#x540C;&#x4E00;&#x4E8B;&#x52A1;&#xFF0C;&#x4F46;&#x82E5;&#x662F;&#x4E0D;&#x60F3;&#x5219;&#x53EF;&#x4EE5;&#x7F16;&#x7801;&#x5F0F;&#x4E8B;&#x52A1;&#x63A7;&#x5236;&#x3002;</p>
<blockquote>
<p>&#x58F0;&#x660E;&#x5F0F;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x4E2D;&#x6211;&#x4EEC;&#x7528;&#x5230;org.springframework.transaction.interceptor.TransactionInterceptor&#x5E2E;&#x6211;&#x4EEC;&#x62E6;&#x622A;&#x4E1A;&#x52A1;&#x65B9;&#x6CD5;&#xFF0C;&#x4F7F;&#x5F97;&#x6211;&#x4EEC;&#x5728;springMVc&#x4E2D;&#x8C03;&#x7528;serviece&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x65F6;&#xFF08;&#x6211;&#x4EEC;&#x4ECE;&#x5BB9;&#x5668;&#x62FF;&#x5230;&#x7684;Service&#x662F;&#x7ECF;&#x8FC7;AOP&#xFF08;&#x4E5F;&#x5C31;&#x662F;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#xFF09;&#x5904;&#x7406;&#x7684;&#x4E86;&#xFF09;&#xFF0C;&#x9700;&#x8981;&#x5148;&#x7ECF;&#x8FC7;&#x5B83;&#x3002;</p>
<p>&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x53BB;&#x653E;&#x7F6E;&#x7528;&#x4E0D;&#x540C;ORM&#x6846;&#x67B6;&#x65F6;&#xFF0C;&#x5728;TransactionInterceptor&#x5E2E;&#x6211;&#x4EEC;&#x62E6;&#x622A;&#x540E;&#xFF0C;&#x5C06;service&#x589E;&#x5F3A;&#x6210;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x7684;&#x6A21;&#x677F;&#xFF0C;&#x52A0;&#x5165;&#x5230;&#x50CF;JdbcTempalte/SqlsessionTemplate&#x8FD9;&#x6837;&#x4E0D;&#x540C;&#x7684;&#x6A21;&#x677F;&#x4E2D;&#xFF0C;&#x4EE5;&#x4FBF;&#x5728;&#x8C03;&#x7528;service&#x7684;&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x81EA;&#x52A8;&#x53BB;&#x8C03;&#x7528;&#x76F8;&#x5E94;&#x7684;&#x6570;&#x636E;&#x5E93;&#x6846;&#x67B6;&#x6267;&#x884C;sql&#x8BED;&#x53E5;&#x65F6;&#x9700;&#x8981;&#x7684;&#x6D41;&#x7A0B;&#xFF0C;&#x5982;SqlsessionTemplate&#xFF08;&#x5B83;&#x7684;&#x539F;&#x7406;&#x8DDF;sqlsession.getMapper&#x76F8;&#x4F3C;&#xFF09;&#x4F1A;&#x81EA;&#x52A8;&#x5BF9;sqlsession&#x8FDB;&#x884C;&#x521B;&#x5EFA;&#xFF0C;&#x518D;&#x8FDB;&#x884C;&#x8BE5;&#x6846;&#x67B6;&#x5BF9;sql&#x8BED;&#x53E5;&#x6267;&#x884C;&#x6D41;&#x7A0B;&#xFF0C;&#x8FD9;&#x4E2A;&#x5BB9;&#x5668;&#x53EF;&#x4EE5;&#x662F;ProxyFactory&#xFF08;ProxyFactoryBean&#xFF09;&#x6216;&#x8005;&#x5176;&#x4ED6;&#x7684;interceptor&#x7684;&#x5B9E;&#x73B0;&#x7C7B;</p>
<p>&#x800C;sqlsessionTemplate&#x6240;&#x9700;&#x8981;&#x7684;springMapConfig&#x5DF2;&#x7ECF;&#x7528;SqlSessionFactoryBean&#x521B;&#x5EFA;&#x7684;SqlSessionFactory&#x4E2D;&#x4E86;&#xFF0C;sqlsessionTemplate&#x4F1A;&#x5C06;SqlSessionFactory&#x6CE8;&#x5165;&#x5176;&#x4E2D;&#xFF0C;&#x4FBF;&#x53EF;&#x4EE5;&#x62E5;&#x6709;&#x9700;&#x8981;&#x7684;Dao&#x5C42;&#x4FE1;&#x606F;&#x548C;&#x9700;&#x8981;&#x7684;sql&#x8BED;&#x53E5;&#x7B49;&#x4E86;</p>
<blockquote>
<p>&#x5728;spring 1.x&#x5230;2.x&#x4E2D;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;4&#x79CD;&#x914D;&#x7F6E;&#x7684;&#x65B9;&#x5F0F;&#x5728;IoC&#x5BB9;&#x5668;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x79CD;&#x6307;&#x5B9A;&#x4E8B;&#x52A1;&#x9700;&#x8981;&#x7684;&#x5143;&#x6570;&#x636E;</p>
<ol>
<li><p>&#x4F7F;&#x7528;ProxyFactory&#xFF08;ProxyFactoryBean&#xFF09;+TransactionIntercepter</p>
<blockquote>
<pre class="language-"><code><span class="token comment">&lt;!-- TransactionInterceptor --&gt;</span>//&#x62E6;&#x622A;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7684;service&#x65B9;&#x6CD5;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transactionInterceptor<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.transaction.interceptor.TransactionInterceptor<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ref</span> <span class="token attr-name">bean</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transactionAttributeSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>
          org.springframework.prospring.ticket.service.PaymentService.transfer=PROPAGATION_REQUIRED,ISOLATION_SERIALIZABLE,timeout_30,-Exception
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- Business Object --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>paymentServiceTarget<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.prospring.ticket.service.PaymentServiceImpl<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>paymentDao<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ref</span> <span class="token attr-name">local</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>paymentDao<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

// &#x5C06;&#x9700;&#x8981;&#x7684;&#x6846;&#x67B6;Template/&#x76F8;&#x5E94;&#x7684;dao&#x5B9E;&#x73B0;&#xFF0C;&#x4E0E;Service&#x5C42;&#x63A5;&#x53E3;&#x4EE5;&#x53CA;transactionInterceptor&#x96C6;&#x6210;&#x4E00;&#x4E2A;Bean&#x65B9;&#x4FBF;Client&#x8C03;&#x7528;

<span class="token comment">&lt;!-- Transactional proxy for the primary business object --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>paymentService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.aop.framework.ProxyFactoryBean<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>target<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ref</span> <span class="token attr-name">local</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>paymentServiceTarget<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>proxyInterfaces<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>org.springframework.prospring.ticket.service.PaymentService
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>interceptorNames<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>transactionInterceptor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></blockquote>
</li>
<li><p>&#x4F7F;&#x7528;&#x201C;&#x4E00;&#x7AD9;&#x5F0F;&#x201D;&#x7684;TransactionProxyFactoryBean</p>
</li>
<li><p>&#x4F7F;&#x7528;BeanNameAutoProxyCreater</p>
</li>
<li><p>&#x4F7F;&#x7528;Spring2.x&#x7684;&#x58F0;&#x660E;&#x4E8B;&#x52A1;&#x914D;&#x7F6E;&#x65B9;&#x5F0F;&#xFF08;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x7684;&#xFF09;</p>
</li>
</ol>
<pre class="language-"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.itcast<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>exclude-filter</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>annotation<span class="token punctuation">&quot;</span></span> <span class="token attr-name">expression</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.stereotype.Controller<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">context:</span>component-scan</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comboPooledDataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.mchange.v2.c3p0.ComboPooledDataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>driverClass<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.mysql.jdbc.Driver<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbcUrl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc:mysql://localhost:3306/ssm<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123456<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sqlSessionFactory<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.mybatis.spring.SqlSessionFactoryBean<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comboPooledDataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mapperScannerConfigurer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.mybatis.spring.mapper.MapperScannerConfigurer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>basePackage<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.itcast.dao<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSourceTransactionManager<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.jdbc.datasource.DataSourceTransactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comboPooledDataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>advice</span><span class="token punctuation">&gt;</span></span>&#x4E13;&#x95E8;&#x4E3A;&#x58F0;&#x660E;&#x4E8B;&#x52A1;Advice&#x800C;&#x8BBE;&#x7F6E;&#x7684;&#x914D;&#x7F6E;&#x5143;&#x7D20;&#xFF0C;&#x5E95;&#x5C42;&#x8FD8;&#x662F;TransactionInterceptor
        &#x82E5;&#x4E0D;&#x6307;&#x5B9A;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>attributes</span><span class="token punctuation">&gt;</span></span>&#xFF0C;&#x5219;&#x91C7;&#x7528;DefaultTransactionDefinition

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>advice</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>txAdvice<span class="token punctuation">&quot;</span></span> <span class="token attr-name">transaction-manager</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSourceTransactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>attributes</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>find*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">read-only</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">isolation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DEFAULT<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>attributes</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>advice</span><span class="token punctuation">&gt;</span></span>


// &#x4F5C;&#x7528;&#x5982;&#x540C;ProxyFactoryBean&#x4E00;&#x76F4;&#xFF0C;&#x4E0D;&#x8FC7;&#x4F7F;&#x7528;&#x4E86;aop&#x5B9E;&#x73B0;&#xFF0C;&#x53EA;&#x9700;&#x6307;&#x5B9A;ServiceTarget&#x7684;class&#xFF0C;&#x4E4B;&#x540E;&#x7684;&#x4FBF;&#x4F9D;&#x9760;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x5B9E;&#x73B0;

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>advisor</span> <span class="token attr-name">advice-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>txAdvice<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pointcut</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>execution(* cn.itcast.service.impl.*ServiceImpl.*(..))<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>

//&#x8FD9;&#x4E2A;&#x5B9E;&#x73B0;&#x4F7F;&#x5F97;&#x6211;&#x4EEC;&#x5728;MVC&#x5C42;&#x8C03;&#x7528;&#x7684;service&#x5BF9;&#x8C61;&#x5DF2;&#x7ECF;&#x662F;&#x7ECF;&#x8FC7;&#x4EE3;&#x7406;&#x5B9E;&#x73B0;&#x4E86;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x7528;&#x5176;&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5E95;&#x5C42;&#x90FD;&#x4F1A;&#x4F9D;&#x636E;&#x6D41;&#x7A0B;&#x81EA;&#x5DF1;&#x5B8C;&#x6210;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x53D1;&#x73B0;&#xFF0C;&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x81EA;&#x5DF1;&#x64CD;&#x4F5C;commit&#x7684;&#x7A7A;&#x95F4;&#xFF0C;&#x4ED6;&#x4F1A;&#x5728;&#x4F60;&#x4E8B;&#x52A1;&#x58F0;&#x660E;&#x7684;&#x65B9;&#x6CD5;&#x7ED3;&#x675F;&#x65F6;&#x5C31;commit&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x628A;&#x5F88;&#x591A;&#x4E1A;&#x52A1;&#x4EE3;&#x7801;&#x653E;&#x5728;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;service&#x65B9;&#x6CD5;&#x4E2D;&#x5B9E;&#x73B0;&#x540C;&#x4E00;&#x4E8B;&#x52A1;&#xFF0C;&#x4F46;&#x82E5;&#x662F;&#x4E0D;&#x60F3;&#x5219;&#x53EF;&#x4EE5;&#x7F16;&#x7801;&#x5F0F;&#x4E8B;&#x52A1;&#x63A7;&#x5236;&#x3002;
</code></pre></blockquote>
</blockquote>
</li>
</ul>
<hr>
<h4 id="spring&#x7684;&#x4E8B;&#x52A1;&#x5904;&#x7406;"><a name="spring&#x7684;&#x4E8B;&#x52A1;&#x5904;&#x7406;" class="anchor-navigation-ex-anchor" href="#spring&#x7684;&#x4E8B;&#x52A1;&#x5904;&#x7406;"><i class="fa fa-link" aria-hidden="true"></i></a>Spring&#x7684;&#x4E8B;&#x52A1;&#x5904;&#x7406;</h4>
<ul>
<li>&#x6211;&#x4EEC;&#x4E00;&#x822C;&#x901A;&#x8FC7;TransactionTemplate&#x6765;&#x5BF9;PlatformTransactionManager&#x7684;&#x4E8B;&#x52A1;&#x8FDB;&#x884C;&#x5C01;&#x88C5;&#xFF0C;&#x4F7F;&#x5F97;&#x51FA;&#x73B0;&#x5F02;&#x5E38;&#x9700;&#x8981;callback&#x65F6;&#xFF0C;&#x5C06;&#x5176;&#x4F9D;&#x636E;callback&#x63A5;&#x53E3;&#x7684;&#x5B9E;&#x73B0;&#x53EF;&#x4EE5;&#x5728;TransactionTemplate&#x7C7B;&#x7684;excute&#x65B9;&#x6CD5;&#x4E2D;&#x4FBF;&#x5904;&#x7406;&#x6210;&#x529F;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EA;&#x9700;&#x8981;<strong>&#x6CE8;&#x610F;call back&#x63A5;&#x53E3;&#x7684;&#x8BBE;&#x8BA1;&#x4E0E;&#x5B9E;&#x73B0;</strong>&#xFF0C;&#x5C31;&#x80FD;&#x5C06;PlatformTransactionManager&#x7684;callback&#x90FD;&#x7531;&#x8BE5;&#x6A21;&#x677F;&#x5B9E;&#x73B0;&#xFF0C;<strong>&#x51CF;&#x5C11;&#x91CD;&#x590D;&#x4EE3;&#x7801;&#x7684;&#x7F16;&#x5199;</strong>&#x3002;&#x5F53;&#x7136;&#x5C0F;&#x578B;&#x6D4B;&#x8BD5;&#x76F4;&#x63A5;&#x7528;&#x4E5F;&#x53EF;&#x4EE5;&#x3002;</li>
</ul>
<ul>
<li><p>Spring&#x7684;&#x4E8B;&#x52A1;&#x5904;&#x7406;&#x4E2D;&#xFF0C;&#x901A;&#x7528;&#x7684;&#x4E8B;&#x52A1;&#x5904;&#x7406;&#x6D41;&#x7A0B;&#x662F;&#x7531;&#x62BD;&#x8C61;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x5668;AbstractPlatformTransactionManager&#x6765;&#x63D0;&#x4F9B;&#x7684;&#xFF0C;&#x800C;&#x5177;&#x4F53;&#x7684;&#x5E95;&#x5C42;&#x4E8B;&#x52A1;&#x5904;&#x7406;&#x5B9E;&#x73B0;&#xFF0C;&#x7531;PlatformTransactionManager&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x7C7B;&#x6765;&#x5B9E;&#x73B0;&#xFF0C;&#x5982; DataSourceTransactionManager &#x3001;JtaTransactionManager&#x548C; HibernateTransactionManager&#x7B49;&#x3002;&#xFF08;<strong>&#x6211;&#x4EEC;&#x901A;&#x5E38;&#x4F7F;&#x7528;&#x7684;&#x662F;DataSourceTransactionManager&#x6765;&#x4E0E;mybatis&#x96C6;&#x6210;</strong>&#xFF09;</p>
</li>
<li><p>spring&#x4E8B;&#x52A1;&#x5904;&#x7406;&#x7684;&#x4E00;&#x4E2A;&#x5173;&#x952E;&#x662F;&#x4FDD;&#x8BC1;&#x5728;&#x6574;&#x4E2A;&#x4E8B;&#x52A1;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x91CC;&#x6240;&#x6709;&#x6267;&#x884C;sql&#x7684;jdbc connection&#x548C;&#x5904;&#x7406;&#x4E8B;&#x52A1;&#x7684;jdbc connection&#x59CB;&#x7EC8;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#xFF08;&#x4E0D;&#x7136;&#x4E8B;&#x52A1;&#x901A;&#x8FC7;&#x4E0D;&#x540C;connection commit&#x7684;&#x65F6;&#x5019;&#x53EF;&#x80FD;&#x4F1A;&#x76F8;&#x4E92;&#x8986;&#x76D6;&#xFF0C;&#x987A;&#x5E8F;&#x4E5F;&#x96BE;&#x4EE5;&#x786E;&#x5B9A;&#xFF09;&#x3002;&#x7136;&#x540E;&#x6267;&#x884C;sql&#x7684;&#x4E1A;&#x52A1;&#x4EE3;&#x7801;&#x4E00;&#x822C;&#x90FD;&#x5206;&#x6563;&#x5728;&#x7A0B;&#x5E8F;&#x7684;&#x4E0D;&#x540C;&#x5730;&#x65B9;&#xFF0C;&#x5982;&#x4F55;&#x8BA9;&#x5B83;&#x4EEC;&#x5171;&#x4EAB;&#x4E00;&#x4E2A;jdbc connection&#x5462;&#xFF1F;</p>
</li>
</ul>
<ul>
<li>&#x8FD9;&#x91CC;spring&#x505A;&#x4E86;&#x4E00;&#x4E2A;&#x524D;&#x63D0;&#x5047;&#x8BBE;&#xFF1A;&#x5373;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x7684;&#x64CD;&#x4F5C;&#x4E00;&#x5B9A;&#x662F;&#x5728;&#x4E00;&#x4E2A;thread&#x4E2D;&#x6267;&#x884C;&#xFF0C;&#x5728;&#x4E8B;&#x52A1;&#x672A;&#x7ED3;&#x675F;&#x524D;&#x8BE5;&#x4E8B;&#x52A1;&#x4E00;&#x76F4;&#x5B58;&#x5728;&#x4E8E;&#x8BE5;thread&#x4E2D;&#xFF0C;&#x4E14;&#x4E00;&#x4E2A;thread&#x4E2D;&#x5982;&#x679C;&#x6709;&#x591A;&#x4E2A;&#x4E8B;&#x52A1;&#x5728;&#x4E0D;&#x540C;&#x7684;jdbc connection&#x7684;&#x8BDD;&#xFF0C;&#x4ED6;&#x4EEC;&#x5FC5;&#x987B;&#x987A;&#x5E8F;&#x6267;&#x884C;&#xFF08;&#x5728;&#x4E0A;&#x4E00;&#x4E2A;&#x7ED3;&#x675F;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF09;&#xFF0C;<strong>&#x4E0D;&#x80FD;&#x540C;&#x65F6;&#x5B58;&#x5728;</strong>&#xFF0C;&#x6B64;&#x65F6;&#x82E5;&#x662F;&#x5C06;connection&#x4E5F;&#x7ED1;&#x5B9A;&#x5230;&#x7EBF;&#x7A0B;&#x4E2D;&#xFF0C;&#x90A3;&#xFF08;&#x8FD9;&#x4E2A;&#x5047;&#x8BBE;&#x5728;&#x7EDD;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#x90FD;&#x662F;&#x6210;&#x7ACB;&#x7684;&#xFF0C;mybatis&#x81EA;&#x8EAB;&#x7684;&#x4E8B;&#x52A1;&#x5904;&#x7406;&#x4E2D;&#xFF0C;sqlsession&#x4E5F;&#x53EF;&#x4EE5;&#x591A;&#x6B21;&#x6267;&#x884C;commit&#xFF0C;connection&#x7684;&#x83B7;&#x53D6;&#x662F;&#x5728;sqlsession&#x6267;&#x884C;sql&#x65F6;&#x8FDB;&#x884C;&#x7684;&#xFF0C;&#x56E0;&#x6B64;sqlsession&#x4E5F;&#x53EF;&#x6709;&#x591A;&#x4E2A;&#x4E0D;&#x540C;jdbc connection&#x751F;&#x6210;&#x7684;&#x4E8B;&#x52A1;&#xFF0C;&#x5FC5;&#x987B;&#x987A;&#x5E8F;&#x6267;&#x884C;&#xFF09;&#x3002;</li>
</ul>
<ul>
<li>&#x57FA;&#x4E8E;&#x8FD9;&#x4E2A;&#x5047;&#x8BBE;&#xFF0C;spring&#x5728;transaction&#x521B;&#x5EFA;&#x65F6;&#xFF0C;&#x4F1A;&#x7528;ThreadLocal&#x628A;&#x521B;&#x5EFA;&#x8FD9;&#x4E2A;&#x4E8B;&#x52A1;&#x7684;jdbc connection&#x7ED1;&#x5B9A;&#x5230;&#x5F53;&#x524D;thread&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x5728;&#x4E8B;&#x52A1;&#x7684;&#x6574;&#x4E2A;&#x751F;&#x547D;&#x5468;&#x671F;&#x4E2D;&#x90FD;&#x4F1A;&#x4ECE;ThreadLocal&#x4E2D;&#x83B7;&#x53D6;&#x540C;&#x4E00;&#x4E2A;jdbc connection&#xFF08;&#x53EA;&#x8981;&#x6CA1;&#x6709;&#x4E3B;&#x52A8;&#x65AD;&#x5F00;connection&#xFF09;&#x3002;</li>
</ul>
<ul>
<li>Spring&#x672C;&#x8EAB;&#x7684;&#x4E8B;&#x52A1;&#x6D41;&#x7A0B;&#xFF08;&#x914D;&#x5408;JdbcTemplate&#xFF09;</li>
</ul>
<p><a href="https://static.oschina.net/uploads/space/2016/1110/143421_Bmpa_1452390.png" data-lightbox="a41e0f58-4a35-4129-ba7b-ceaf4af839af" data-title="143421_Bmpa_1452390.png" target="_blank"><img src="https://static.oschina.net/uploads/space/2016/1110/143421_Bmpa_1452390.png" alt="143421_Bmpa_1452390.png"></a></p>
<ul>
<li><strong>&#x4ECE;&#x4E0A;&#x9762;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;Spring&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x4E00;&#x5171;&#x53EF;&#x5206;&#x4E3A;&#x4E09;&#x4E2A;&#x6B65;&#x9AA4;&#xFF0C;&#x5206;&#x522B;&#x662F;&#x521D;&#x59CB;&#x5316;&#x4E8B;&#x52A1;&#x3001;&#x63D0;&#x4EA4;&#x4E8B;&#x52A1;&#x3001;&#x56DE;&#x6EDA;&#x4E8B;&#x52A1;&#xFF0C;spring&#x4E8B;&#x52A1;&#x5DE5;&#x4F5C;&#x6D41;&#x76F8;&#x5F53;&#x4E8E;&#x4E3A;&#x7528;&#x6237;&#x5C4F;&#x853D;&#x4E86;&#x5177;&#x4F53;orm&#x6846;&#x67B6;&#x7684;&#x5E95;&#x5C42;&#x5904;&#x7406;&#x903B;&#x8F91;&#xFF0C;&#x57FA;&#x4E8E;spring&#x5F00;&#x53D1;&#x7684;&#x7A0B;&#x5E8F;&#xFF0C;&#x5373;&#x4FBF;&#x66F4;&#x6362;&#x4E86;orm&#x6846;&#x67B6;&#x4E5F;&#x662F;&#x8DDF;&#x6362;&#x4E86;&#x8C03;&#x7528;&#x7684;sqlTemplate&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x5668;&#x66F4;&#x6362;&#x6210;&#x9002;&#x5408;&#x4E8E;&#x4ED6;&#x7684;&#x4FBF;&#x53EF;&#xFF0C;&#x57FA;&#x672C;&#x4E0D;&#x7528;&#x6539;&#x53D8;&#x5176;&#x4ED6;&#x7684;&#x5B9E;&#x73B0;&#x3002;&#x8FD9;&#x662F;Spring&#x7684;&#x4F18;&#x70B9;</strong></li>
</ul>
<ul>
<li>Spring&#x63A7;&#x5236;datasourcetransaction &#xFF0C;mybaitis&#x7528;springManagedTransaction&#x5BF9;&#x6570;&#x636E;&#x5E93;&#x8FDB;&#x884C;sql&#x64CD;&#x4F5C;&#xFF0C;&#x4F46;commit&#x7B49;&#x90FD;&#x662F;&#x6700;&#x540E;&#x7531;datasourceTransaction &#x8FDB;&#x884C;.</li>
</ul>
<h6 id="sqlsessionfactorybean"><a name="sqlsessionfactorybean" class="anchor-navigation-ex-anchor" href="#sqlsessionfactorybean"><i class="fa fa-link" aria-hidden="true"></i></a>SqlSessionFactoryBean</h6>
<ul>
<li>&#x518D;&#x770B;&#x8FD9;&#x4E2A;&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x53C2;&#x6570;&#xFF0C;<strong>&#x65E0;&#x8BBA;&#x5982;&#x4F55;&#x6211;&#x4EEC;&#x90FD;&#x9700;&#x8981;SqlSessionFactoryBean&#xFF08;&#x65E0;&#x8BBA;&#x662F;&#x5426;&#x6709;&#x7528;Spring&#x7684;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x90FD;&#x9700;&#x8981;&#xFF09;&#x548C;DataSourceTransactionManager</strong></li>
</ul>
<ul>
<li>&#x7531;SqlSessionFactoryBean&#x521B;&#x5EFA;&#x5DE5;&#x5382;&#xFF0C;&#x6B64;&#x5DE5;&#x5382;&#x5C06;<strong>&#x751F;&#x6210;SpringManagedTransactionFactory</strong>&#xFF08;&#x53EF;&#x80FD;&#x6709;&#x4EBA;&#x4F1A;&#x597D;&#x5947;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x5927;&#x8D39;&#x5468;&#x7AE0;&#x91CD;&#x65B0;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;TransactionFactory&#xFF0C;&#x5230;&#x4E0B;&#x9762;&#x8FDB;&#x5165;sqlsession&#x7684;&#x90E8;&#x5206;&#x5C31;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#x7B54;&#x6848;&#x4E86;&#xFF09;&#xFF0C;&#x518D;&#x5C01;&#x88C5;&#x6210; Environment &#x5BF9;&#x8C61;&#x3002;&#x6700;&#x540E;&#x5C01;&#x88C5;&#x6210;configuration&#x5BF9;&#x8C61;&#x6765;&#x8C03;&#x7528;sqlSessionFactoryBuilder.build(configuration);</li>
</ul>
<blockquote>
<p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F; SqlSessionFactoryBean &#x5B9E;&#x73B0;&#x4E86; Spring &#x7684; FactoryBean &#x63A5;&#x53E3;&#x3002;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x7531; Spring &#x6700;&#x7EC8;&#x521B;&#x5EFA;&#x7684; bean &#x5E76;&#x4E0D;&#x662F; SqlSessionFactoryBean &#x672C;&#x8EAB;&#xFF0C;&#x800C;&#x662F;&#x5DE5;&#x5382;&#x7C7B;&#xFF08;SqlSessionFactoryBean&#xFF09;&#x7684; getObject() &#x65B9;&#x6CD5;&#x7684;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x3002;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;Spring &#x5C06;&#x4F1A;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x4E3A;&#x4F60;&#x521B;&#x5EFA; SqlSessionFactory&#xFF0C;&#x5E76;&#x4F7F;&#x7528; sqlSessionFactory &#x8FD9;&#x4E2A;&#x540D;&#x5B57;&#x5B58;&#x50A8;&#x8D77;&#x6765;&#x3002;&#x56E0;&#x4E3A;&#x662F;spring&#x5BB9;&#x5668;&#x751F;&#x6210;&#x7684;&#xFF0C;&#x6240;&#x4EE5;xml&#x89E3;&#x6790;&#x65F6;&#x5BF9;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#x63A5;&#x53E3;&#x7684;&#x5BF9;&#x8C61;&#x4F1A;&#x81EA;&#x52A8;&#x8C03;&#x7528;getObject() &#x65B9;&#x6CD5;</p>
<p>&#x7B49;&#x6548;&#x7684; Java &#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre class="language-"><code class="lang-java"><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SqlSessionFactory</span> <span class="token function">sqlSessionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">SqlSessionFactoryBean</span> factoryBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  factoryBean<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span><span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> factoryBean<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</blockquote>
<ul>
<li><p>&#x751F;&#x6210;sqlsqlSessionFactory&#xFF0C;&#x7531;XMLConfigBuilder&#x8BFB;&#x53D6;parse&#x6210;&#x4E00;&#x4E2A;sqlsqlSessionFactory&#xFF0C;<strong>&#x4EA4;&#x7531;SqlsessionTemplate&#x4F7F;&#x7528;</strong>&#xFF08;&#x5176;&#x5B9E;&#x73B0;&#x4E86; <code>SqlSession</code> &#x63A5;&#x53E3;&#xFF0C;&#x5E76;&#x4E0D;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x5177;&#x4F53;&#x7684; <code>SqlSession</code> &#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x800C;&#x662F;&#x59D4;&#x6258;&#x7ED9;&#x4E00;&#x4E2A;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#xFF0C;&#x901A;&#x8FC7;&#x4EE3;&#x7406; <code>SqlSessionInterceptor</code> &#x5BF9;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x8FDB;&#x884C;&#x62E6;&#x622A;&#xFF0C;&#x7528;&#x8C03;&#x7528;&#x63A5;&#x53E3;&#x7684;&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x4F1A;&#x53BB;&#x5BFB;&#x627E;&#x662F;&#x5426;&#x6709;&#x4E86;&#x505C;&#x7559;&#x5728;resources&#x4E2D;&#x7684;&#x672A;&#x5173;&#x95ED;&#x7684;sqlsession&#xFF09;</p>
<blockquote>
<p> &#x82E5;&#x662F;&#x7F16;&#x7A0B;&#x5F0F;&#x4E8B;&#x52A1;&#x63A7;&#x5236;&#x7684;&#x8BDD;&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x5148;&#x521B;&#x5EFA;SqlSessionFactoryBean&#x521B;&#x5EFA;sqlsqlSessionFactory&#xFF0C;&#x518D;&#x5C06;&#x5176;&#x6CE8;&#x5165;&#x81EA;&#x5DF1;&#x521B;&#x5EFA;&#x7684;SqlsessionTemplate&#x5BF9;&#x8C61;&#x4E2D;&#xFF0C;&#x518D;&#x5229;&#x7528;SqlsessionTemplate&#x8FDB;&#x884C;&#x589E;&#x5220;&#x67E5;&#x6539;</p>
</blockquote>
<pre class="language-"><code>public class SqlSessionFactoryBean implements FactoryBean<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SqlSessionFactory</span><span class="token punctuation">&gt;</span></span>, InitializingBean, ApplicationListener<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ApplicationEvent</span><span class="token punctuation">&gt;</span></span> {

protected SqlSessionFactory buildSqlSessionFactory() throws IOException {
    XMLConfigBuilder xmlConfigBuilder = null;
    Configuration configuration;
    &#xB7;&#xB7;&#xB7;
    &#x5404;&#x79CD;configuration&#x7684;&#x53C2;&#x6570;&#x5224;&#x65AD;
    &#xB7;&#xB7;&#xB7;&#xB7;
     //&#x751F;&#x6210;SpringManagedTransactionFactory
    if (this.transactionFactory == null) {
        this.transactionFactory = new SpringManagedTransactionFactory();

    }

    //&#x5C01;&#x88C5;&#x6210; Environment &#x5BF9;&#x8C61;
    //&#x5C01;&#x88C5;&#x6210;configuration&#x5BF9;&#x8C61;
    configuration.setEnvironment(new Environment(this.environment, this.transactionFactory, this.dataSource));
    &#xB7;&#xB7;&#xB7;
    &#x53C2;&#x6570;&#x68C0;&#x67E5;
    &#xB7;&#xB7;&#xB7;

    //&#x8C03;&#x7528;sqlSessionFactoryBuilder.build(configuration);&#x751F;&#x6210;sqlsqlSessionFactory&#xFF0C;
    return this.sqlSessionFactoryBuilder.build(configuration);
}
}
</code></pre></li>
</ul>
<h6 id="datasourcetransactionmanager"><a name="datasourcetransactionmanager" class="anchor-navigation-ex-anchor" href="#datasourcetransactionmanager"><i class="fa fa-link" aria-hidden="true"></i></a>DataSourceTransactionManager</h6>
<ul>
<li>&#x82E5;&#x8981;&#x4F7F;&#x7528;spring&#x7684;&#x4E8B;&#x52A1;&#xFF0C;&#x4F7F;&#x7528;sqlsessionTemplate&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x5206;&#x6790;DataSourceTransactionManager&#x6574;&#x4E2A;&#x6D41;&#x7A0B;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E00;&#x6B65;&#x4E00;&#x6B65;&#x6765;&#xFF0C;&#x4ECE;&#x6700;&#x9876;&#x5C42;&#x5F00;&#x59CB;</li>
</ul>
<ul>
<li>Spring&#x7684;PlatformTransactionManager&#x662F;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x7684;&#x9876;&#x5C42;&#x63A5;&#x53E3;&#xFF0C;&#x5176;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x4E09;&#x4E2A;&#x65B9;&#x6CD5;&#x5BF9;&#x5E94;&#x7684;&#x5C31;&#x662F;&#x521D;&#x59CB;&#x5316;&#x4E8B;&#x52A1;&#x3001;&#x63D0;&#x4EA4;&#x4E8B;&#x52A1;&#x3001;&#x56DE;&#x6EDA;&#x4E8B;&#x52A1;&#xFF0C;&#xFF0C;&#x7136;&#x540E;AbstractPlatformTransactionManager&#x62BD;&#x8C61;&#x7C7B;&#xFF08;&#x4F5C;&#x4E3A;&#x6A21;&#x677F;&#xFF09;&#x7ED9;&#x51FA;&#x4E86;&#x4E09;&#x4E2A;&#x6B65;&#x9AA4;&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x3002;</li>
</ul>
<ul>
<li><strong>&#x4F46;&#x5BF9;&#x8BF8;&#x5982;doGetTransaction()&#x4E4B;&#x7C7B;&#x7684;&#x548C;doBegin&#x7B49;&#x8FD8;&#x662F;&#x5F04;&#x6210;&#x4E86;&#x62BD;&#x8C61;&#x65B9;&#x6CD5;&#x7531;DataSourceTransactionManager&#x7B49;&#x5B9E;&#x73B0;&#xFF0C;&#x4EE5;&#x4FBF;&#x81EA;&#x5DF1;&#x51B3;&#x5B9A;&#x5BF9; TransactionSynchronization&#x63A5;&#x53E3;&#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#x8FDB;&#x884C;&#x8C03;&#x7528;&#xFF0C;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x3001;&#x83B7;&#x5F97;ConnectionHolder&#x548C;&#x521B;&#x5EFA;&#x65B0;&#x4E8B;&#x52A1;&#x65F6;&#x6309;&#x4F55;&#x79CD;&#x65B9;&#x5F0F;dobgin&#xFF0C;&#x8FDE;&#x63A5;&#x65B9;&#x5F0F;&#x548C;&#x6CE8;&#x5165;&#x5404;&#x79CD;&#x53C2;&#x6570;&#x3002;</strong></li>
</ul>
<blockquote>
<pre class="language-"><code>public abstract class AbstractPlatformTransactionManager implements PlatformTransactionManager, Serializable {

public final TransactionzhuangtStatus getTransaction(@Nullable TransactionDefinition definition) throws TransactionException {

//&#x5728;DataSourceTransactionManager&#x4E2D;&#x91CD;&#x5199;&#x4E86;&#x7684;&#x7C7B;&#xFF0C;&#x67E5;&#x8BE2;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4E2D;&#x662F;&#x5426;&#x6709;&#x4F20;&#x5165;&#x7684;datasource&#x5BF9;&#x5E94;&#x7684;ConnectionHolder&#xFF0C;&#x6709;&#x5219;&#x4F9D;&#x636E;&#x4ED6;&#x521B;&#x5EFA;transaction

Object transaction = this.doGetTransaction();
boolean debugEnabled = this.logger.isDebugEnabled();
if (definition == null) {
  definition = new DefaultTransactionDefinition();
}

if (this.isExistingTransaction(transaction)) {
  return this.handleExistingTransaction((TransactionDefinition)definition, transaction, debugEnabled);
}
&#xB7;&#xB7;&#xB7;
&#x5404;&#x79CD;&#x6761;&#x4EF6;&#x5224;&#x65AD;
&#xB7;&#xB7;&#xB7;
  try {
      boolean newSynchronization = this.getTransactionSynchronization() != 2;

      //&#x88AB;&#x521B;&#x5EFA;&#x7684;&#x4E8B;&#x52A1;&#x72B6;&#x6001;&#x5BF9;&#x8C61;&#x7C7B;&#x578B;&#x662F;DefaultTransactionStatus&#xFF0C;&#x5B83;&#x6301;&#x6709;&#x4E0A;&#x8FF0;&#x521B;&#x5EFA;&#x7684;&#x4E8B;&#x52A1;&#x5BF9;&#x8C61;&#x3002;&#x4E8B;&#x52A1;&#x72B6;&#x6001;&#x5BF9;&#x8C61;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x4E8B;&#x52A1;&#x5BF9;&#x8C61;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x6BD4;&#x5982;&#x4E8B;&#x52A1;&#x662F;&#x5426;&#x88AB;&#x6807;&#x8BB0;&#x4E86;&#x56DE;&#x6EDA;&#xFF0C;&#x662F;&#x5426;&#x662F;&#x4E00;&#x4E2A;&#x65B0;&#x4E8B;&#x52A1;&#x7B49;&#x7B49;&#x3002;
      DefaultTransactionStatus status = this.newTransactionStatus((TransactionDefinition)definition, transaction, true, newSynchronization, debugEnabled, suspendedResources);

      //&#x4E8B;&#x52A1;&#x5F00;&#x59CB;&#x5904;&#x7406;&#xFF0C;&#x8FDB;&#x884C;&#x4FC3;&#x4F7F;&#x5316;&#xFF0C;&#x8FDE;&#x63A5;&#x83B7;&#x53D6;
      this.doBegin(transaction, (TransactionDefinition)definition);

      //&#x5BF9;&#x8C61;&#x90FD;&#x4EA4;&#x7531;TransactionSynchronizationManager&#x7BA1;&#x7406;&#xFF0C;TransactionSynchronizationManager&#x628A;&#x8FD9;&#x4E9B;&#x5BF9;&#x8C61;&#x90FD;&#x4FDD;&#x5B58;&#x5728;ThreadLocal&#x4E2D;&#x3002;&#x5728;&#x8BE5;transaction&#x672A;commit/&#x5173;&#x95ED;&#x524D;&#xFF0C;&#x8BE5;&#x7EBF;&#x7A0B;&#x5C31;&#x4F1A;&#x4E0E;&#x8BE5;connection&#x4E00;&#x76F4;&#x7ED1;&#x5B9A;&#x5728;&#x4E00;&#x8D77;&#xFF0C;&#x901A;&#x8FC7;&#x53EA;&#x80FD;&#x540C;&#x65F6;&#x7ED1;&#x5B9A;&#x4E00;&#x4E2A;connection&#x7684;&#x539F;&#x7406;&#xFF0C;&#x5B9E;&#x73B0;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x3002;

      this.prepareSynchronization(status, (TransactionDefinition)definition);

      &#x8FD4;&#x56DE;&#x4E8B;&#x52A1;&#x72B6;&#x6001;&#x5BF9;&#x8C61;&#xFF1A;&#xFF08;&#x4E3B;&#x8981;&#x8FDB;&#x884C;&#xFF1A;&#x67E5;&#x8BE2;&#x4E8B;&#x52A1;&#x72B6;&#x6001;&#x3001;&#x901A;&#x8FC7;setRollbackOnly&#xFF08;&#xFF09;&#x65B9;&#x6CD5;&#x6807;&#x8BB0;&#x5F53;&#x524D;&#x4E8B;&#x52A1;&#x4F7F;&#x5176;&#x56DE;&#x6EDA;&#xFF0C;&#x6839;&#x636E;&#x4E8B;&#x52A1;&#x53C2;&#x6570;&#x521B;&#x5EFA;&#x5185;&#x5D4C;&#x4E8B;&#x52A1;&#xFF09;&#xFF0C;statu&#x7684;&#x610F;&#x601D;&#x662F;&#x65B9;&#x4FBF;&#x5148;&#x5BF9;&#x4E8B;&#x52A1;&#x8FDB;&#x884C;&#x5224;&#x65AD;&#x518D;&#x83B7;&#x53D6;transaction&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x3002;
      return status;
  } catch (Error | RuntimeException var7) {
      this.resume((Object)null, suspendedResources);
      throw var7;
  }
}
}
}
</code></pre></blockquote>
<ul>
<li>DataSourceTransactionManager&#xFF08;&#x7EE7;&#x627F;&#x4E86;AbstractPlatformTransactionManager&#xFF09;&#x7684;&#x4E3B;&#x8981;&#x4F5C;&#x7528;&#x662F;&#x521B;&#x5EFA;transaction&#x548C;&#x5BF9;transaction&#x7684;&#x521D;&#x59CB;&#x5316;</li>
</ul>
<blockquote>
<pre class="language-"><code>public class DataSourceTransactionManager extends AbstractPlatformTransactionManager
        implements ResourceTransactionManager, InitializingBean {

@Override//&#x4E3B;&#x8981;&#x589E;&#x52A0;&#x4E86;&#x5BF9;TransactionSynchronizationManager&#x4E2D;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x662F;&#x5426;&#x6709;connectionHolder
    protected Object doGetTransaction() {

        // &#x521B;&#x5EFA;&#x4E8B;&#x52A1;&#x5BF9;&#x8C61;

        DataSourceTransactionObject txObject = new DataSourceTransactionObject();
        txObject.setSavepointAllowed(isNestedTransactionAllowed());
        ConnectionHolder conHolder =
                (ConnectionHolder) TransactionSynchronizationManager.getResource(obtainDataSource());
        //ConnectionHolder&#x8D4B;&#x503C;&#x7ED9;&#x4E8B;&#x52A1;&#x5BF9;&#x8C61;txObject
        txObject.setConnectionHolder(conHolder, false);
        return txObject;        
        }
}

//&#x5904;&#x7406;&#x4E8B;&#x52A1;&#x5F00;&#x59CB;&#x7684;&#x65B9;&#x6CD5;  
    protected void doBegin(Object transaction, TransactionDefinition definition) {  
        DataSourceTransactionObject txObject = (DataSourceTransactionObject) transaction;  
        Connection con = null;  
        try {  
            //&#x5982;&#x679C;&#x6570;&#x636E;&#x6E90;&#x4E8B;&#x52A1;&#x5BF9;&#x8C61;&#x7684;ConnectionHolder&#x4E3A;null&#x6216;&#x8005;&#x662F;&#x4E8B;&#x52A1;&#x540C;&#x6B65;&#x7684;  
            if (txObject.getConnectionHolder() == null ||  
        txObject.getConnectionHolder().isSynchronizedWithTransaction()) {  
                //&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x6570;&#x636E;&#x6E90;&#x7684;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;  
                Connection newCon = this.dataSource.getConnection();  
                if (logger.isDebugEnabled()) {  
                    logger.debug(&quot;Acquired Connection [&quot; + newCon + &quot;] for JDBC transaction&quot;);  
                }  
                //&#x4E3A;&#x6570;&#x636E;&#x6E90;&#x4E8B;&#x52A1;&#x5BF9;&#x8C61;&#x8BBE;&#x7F6E;ConnectionHolder  
                txObject.setConnectionHolder(new ConnectionHolder(newCon), true);  
            }  
    //&#x8BBE;&#x7F6E;&#x6570;&#x636E;&#x6E90;&#x4E8B;&#x52A1;&#x5BF9;&#x8C61;&#x7684;&#x4E8B;&#x52A1;&#x540C;&#x6B65;    txObject.getConnectionHolder().setSynchronizedWithTransaction(true);  
            //&#x83B7;&#x53D6;&#x6570;&#x636E;&#x6E90;&#x4E8B;&#x52A1;&#x5BF9;&#x8C61;&#x7684;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;  
            con = txObject.getConnectionHolder().getConnection();  
            //&#x6839;&#x636E;&#x6570;&#x636E;&#x8FDE;&#x63A5;&#x548C;&#x4E8B;&#x52A1;&#x5C5E;&#x6027;&#xFF0C;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x7684;&#x4E8B;&#x52A1;&#x9694;&#x79BB;&#x7EA7;&#x522B;  
            Integer previousIsolationLevel = DataSourceUtils.prepareConnectionForTransaction(con, definition);  
    //&#x4E3A;&#x6570;&#x636E;&#x6E90;&#x4E8B;&#x52A1;&#x5BF9;&#x8C61;&#x8BBE;&#x7F6E;&#x4E8B;&#x52A1;&#x9694;&#x79BB;&#x7EA7;&#x522B;  
    txObject.setPreviousIsolationLevel(previousIsolationLevel);  
            //&#x5982;&#x679C;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x8BBE;&#x7F6E;&#x4E86;&#x81EA;&#x52A8;&#x4E8B;&#x52A1;&#x63D0;&#x4EA4;&#x5C5E;&#x6027;&#xFF0C;&#x5219;&#x5173;&#x95ED;&#x81EA;&#x52A8;&#x63D0;&#x4EA4;  
            if (con.getAutoCommit()) {  
                //&#x4FDD;&#x5B58;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x8BBE;&#x7F6E;&#x7684;&#x81EA;&#x52A8;&#x8FDE;&#x63A5;&#x5230;&#x6570;&#x636E;&#x6E90;&#x4E8B;&#x52A1;&#x5BF9;&#x8C61;&#x4E2D;  
                txObject.setMustRestoreAutoCommit(true);  
                if (logger.isDebugEnabled()) {  
                    logger.debug(&quot;Switching JDBC Connection [&quot; + con + &quot;] to manual commit&quot;);  
                }  
                //&#x8BBE;&#x7F6E;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x81EA;&#x52A8;&#x4E8B;&#x52A1;&#x63D0;&#x4EA4;&#x5C5E;&#x6027;&#x4E3A;false&#xFF0C;&#x5373;&#x7981;&#x6B62;&#x81EA;&#x52A8;&#x4E8B;&#x52A1;&#x63D0;&#x4EA4;  
                con.setAutoCommit(false);  
            }  
            //&#x6FC0;&#x6D3B;&#x5F53;&#x524D;&#x6570;&#x636E;&#x6E90;&#x4E8B;&#x52A1;&#x5BF9;&#x8C61;&#x7684;&#x4E8B;&#x52A1;&#x914D;&#x7F6E;  
            txObject.getConnectionHolder().setTransactionActive(true);  
            //&#x83B7;&#x53D6;&#x4E8B;&#x52A1;&#x914D;&#x7F6E;&#x7684;&#x8D85;&#x65F6;&#x65F6;&#x957F;  
int timeout = determineTimeout(definition);  
//&#x5982;&#x679C;&#x4E8B;&#x52A1;&#x914D;&#x7F6E;&#x7684;&#x8D85;&#x65F6;&#x65F6;&#x957F;&#x4E0D;&#x7B49;&#x4E8E;&#x4E8B;&#x52A1;&#x7684;&#x9ED8;&#x8BA4;&#x8D85;&#x65F6;&#x65F6;&#x957F;  
            if (timeout != TransactionDefinition.TIMEOUT_DEFAULT) {  
        //&#x6570;&#x636E;&#x6E90;&#x4E8B;&#x52A1;&#x5BF9;&#x8C61;&#x8BBE;&#x7F6E;&#x8D85;&#x65F6;&#x65F6;&#x957F;  
        txObject.getConnectionHolder().setTimeoutInSeconds(timeout);  
            }  
            //&#x628A;&#x5F53;&#x524D;&#x6570;&#x636E;&#x5E93;Connection&#x548C;&#x7EBF;&#x7A0B;ThreadLocal&#x7ED1;&#x5B9A;&#xFF08;key&#x4E3A;DataSource&#xFF0C;value&#x4E3A;getConnectionHolder&#xFF09;spring&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x7684;&#x5173;&#x952E;&#x4E00;&#x6B65;
            if (txObject.isNewConnectionHolder()) {  
        TransactionSynchronizationManager.bindResource(getDataSource(), txObject.getConnectionHolder());  
            }  
        }  
        catch (Exception ex) {  
            DataSourceUtils.releaseConnection(con, this.dataSource);  
            throw new CannotCreateTransactionException(&quot;Could not open JDBC Connection for transaction&quot;, ex);  
        }  
    }
</code></pre></blockquote>
<h6 id="transactionsynchronizationmanager"><a name="transactionsynchronizationmanager" class="anchor-navigation-ex-anchor" href="#transactionsynchronizationmanager"><i class="fa fa-link" aria-hidden="true"></i></a>TransactionSynchronizationManager</h6>
<ul>
<li>&#x4E3B;&#x8981;&#x4ECE;&#x7EBF;&#x7A0B;&#x4E2D;&#x6839;&#x636E;&#x952E;&#x503C;&#x83B7;&#x53D6;&#x8D44;&#x6E90;</li>
</ul>
<pre class="language-"><code>public abstract class TransactionSynchronizationManager {
    private static final Log logger = LogFactory.getLog(TransactionSynchronizationManager.class);
    private static final ThreadLocal&lt;Map<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Object,</span> <span class="token attr-name">Object</span><span class="token punctuation">&gt;</span></span>&gt; resources = new NamedThreadLocal(&quot;Transactional resources&quot;);
    private static final ThreadLocal&lt;Set<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TransactionSynchronization</span><span class="token punctuation">&gt;</span></span>&gt; synchronizations = new NamedThreadLocal(&quot;Transaction synchronizations&quot;);
    private static final ThreadLocal<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>String</span><span class="token punctuation">&gt;</span></span> currentTransactionName = new NamedThreadLocal(&quot;Current transaction name&quot;);
    private static final ThreadLocal<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Boolean</span><span class="token punctuation">&gt;</span></span> currentTransactionReadOnly = new NamedThreadLocal(&quot;Current transaction read-only status&quot;);
    private static final ThreadLocal<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Integer</span><span class="token punctuation">&gt;</span></span> currentTransactionIsolationLevel = new NamedThreadLocal(&quot;Current transaction isolation level&quot;);
    private static final ThreadLocal<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Boolean</span><span class="token punctuation">&gt;</span></span> actualTransactionActive = new NamedThreadLocal(&quot;Actual transaction active&quot;);

     //&#x83B7;&#x53D6;&#x76F8;&#x5E94;&#x7684;&#x8D44;&#x6E90;&#xFF0C;&#x952E;&#x503C;&#x5148;unwrapResourceIfNecessary&#x5904;&#x7406;&#xFF0C;&#x4EA4;&#x7531;doget&#x83B7;&#x53D6;
     public static Object getResource(Object key) {
        Object actualKey = TransactionSynchronizationUtils.unwrapResourceIfNecessary(key);
        Object value = doGetResource(actualKey);
        if (value != null &amp;&amp; logger.isTraceEnabled()) {
            logger.trace(&quot;Retrieved value [&quot; + value + &quot;] for key [&quot; + actualKey + &quot;] bound to thread [&quot; + Thread.currentThread().getName() + &quot;]&quot;);
        }

        return value;
    }

    //&#x4ECE;&#x4FDD;&#x5B58;&#x5728;&#x7EBF;&#x7A0B;&#x7684;resource&#x83B7;&#x53D6;
    @Nullable
    private static Object doGetResource(Object actualKey) {
        Map<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Object,</span> <span class="token attr-name">Object</span><span class="token punctuation">&gt;</span></span> map = (Map)resources.get();
        if (map == null) {
            return null;
        } else {
            Object value = map.get(actualKey);
            if (value instanceof ResourceHolder &amp;&amp; ((ResourceHolder)value).isVoid()) {
                map.remove(actualKey);
                if (map.isEmpty()) {
                    resources.remove();
                }

                value = null;
            }

            return value;
        }
    }

    public static void bindResource(Object key, Object value) throws IllegalStateException {
        Object actualKey = TransactionSynchronizationUtils.unwrapResourceIfNecessary(key);
        Assert.notNull(value, &quot;Value must not be null&quot;);
        Map<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Object,</span> <span class="token attr-name">Object</span><span class="token punctuation">&gt;</span></span> map = (Map)resources.get();
        if (map == null) {
            map = new HashMap();
            resources.set(map);
        }

        Object oldValue = ((Map)map).put(actualKey, value);
        if (oldValue instanceof ResourceHolder &amp;&amp; ((ResourceHolder)oldValue).isVoid()) {
            oldValue = null;
        }

        if (oldValue != null) {
            throw new IllegalStateException(&quot;Already value [&quot; + oldValue + &quot;] for key [&quot; + actualKey + &quot;] bound to thread [&quot; + Thread.currentThread().getName() + &quot;]&quot;);
        } else {
            if (logger.isTraceEnabled()) {
                logger.trace(&quot;Bound value [&quot; + value + &quot;] for key [&quot; + actualKey + &quot;] to thread [&quot; + Thread.currentThread().getName() + &quot;]&quot;);
            }

        }
    }
</code></pre><ul>
<li><strong>&#x6B64;&#x65F6;&#x82E5;&#x662F;&#x6CE8;&#x91CA;&#x8FD0;&#x884C;&#x7684;&#x4FBF;&#x9700;&#x8981;&#x628A;PlatformTransactionManager&#xFF0C;&#x4ED6;&#x751F;&#x6210;&#x7684;TransactionStatus&#x3001;TransactionAttribute&#x7B49;&#x5C01;&#x88C5;&#x5230;TransactionInfo&#x4E2D;&#x4EE5;&#x4FBF;&#x6CE8;&#x89E3;&#x80FD;&#x81EA;&#x5DF1;&#x8C03;&#x7528;</strong></li>
</ul>
<hr>
<h4 id="springmybatis"><a name="springmybatis" class="anchor-navigation-ex-anchor" href="#springmybatis"><i class="fa fa-link" aria-hidden="true"></i></a>Spring+mybatis</h4>
<ul>
<li><p>&#x5B8C;&#x6210;&#x4E86;&#x5BF9;&#x4E8B;&#x52A1;&#x7684;&#x521B;&#x5EFA;&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x7528;TransactionSynchronizationManager&#x7ED1;&#x5B9A;&#x5230;&#x4E86;thread local&#x4E0A;&#xFF0C;&#x63A5;&#x7740;&#x4FBF;&#x662F;&#x5BF9;sqlsessionTemplate&#x7684;&#x8C03;&#x7528;&#x4E86;&#x5373;&#x5BF9;mybatis&#x6846;&#x67B6;&#x7684;sqlsession&#x7684;&#x6574;&#x5408;&#x4E86;</p>
</li>
<li><p>Spring+mybatis&#x7684;&#x4E8B;&#x52A1;&#x63A7;&#x5236;&#x6D41;&#x7A0B;</p>
</li>
</ul>
<p><a href="http://static.oschina.net/uploads/space/2016/1110/143554_iORI_1452390.png" data-lightbox="1d075809-cf9a-47e3-aa66-e319785c2688" data-title="img" target="_blank"><img src="http://static.oschina.net/uploads/space/2016/1110/143554_iORI_1452390.png" alt="img"></a></p>
<h4 id="sqlsessiontemplate"><a name="sqlsessiontemplate" class="anchor-navigation-ex-anchor" href="#sqlsessiontemplate"><i class="fa fa-link" aria-hidden="true"></i></a>SqlsessionTemplate</h4>
<ul>
<li>SqlsessionTemplate&#x7684;&#x4F7F;&#x7528;&#x5E76;&#x4E0D;&#x662F;&#x76F4;&#x63A5;&#x7528;sqlsession&#x8FDB;&#x884C;&#x589E;&#x5220;&#x67E5;&#x6539;&#xFF08;&#x5B9E;&#x9645;&#x4E0A;&#x662F;sqlsession&#x7684;&#x4E00;&#x4E2A;&#x4EE3;&#x7406;&#x7C7B;&#xFF0C;&#x5176;&#x5B9E;&#x73B0;&#x4E86; <code>SqlSession</code> &#x63A5;&#x53E3;&#xFF0C;&#x5E76;&#x4E0D;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x5177;&#x4F53;&#x7684; <code>SqlSession</code> &#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x800C;&#x662F;&#x59D4;&#x6258;&#x7ED9;&#x4E00;&#x4E2A;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#xFF0C;&#x901A;&#x8FC7;&#x4EE3;&#x7406; <code>SqlSessionInterceptor</code> &#x5BF9;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x8FDB;&#x884C;&#x62E6;&#x622A;&#xFF0C;&#x7528;&#x8C03;&#x7528;&#x63A5;&#x53E3;&#x7684;&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x4F1A;&#x53BB;&#x5BFB;&#x627E;&#x662F;&#x5426;&#x6709;&#x4E86;&#x505C;&#x7559;&#x5728;resources&#x4E2D;&#x7684;&#x672A;&#x5173;&#x95ED;&#x7684;sqlsession&#xFF09;</li>
</ul>
<pre class="language-"><code>public class SqlSessionTemplate implements SqlSession, DisposableBean {
public SqlSessionTemplate(SqlSessionFactory sqlSessionFactory, ExecutorType executorType, PersistenceExceptionTranslator exceptionTranslator) {
    Assert.notNull(sqlSessionFactory, &quot;Property &apos;sqlSessionFactory&apos; is required&quot;);
    Assert.notNull(executorType, &quot;Property &apos;executorType&apos; is required&quot;);
    this.sqlSessionFactory = sqlSessionFactory;
    this.executorType = executorType;
    this.exceptionTranslator = exceptionTranslator;
    this.sqlSessionProxy = (SqlSession)Proxy.newProxyInstance(SqlSessionFactory.class.getClassLoader(), new Class[]{SqlSession.class}, new SqlSessionTemplate.SqlSessionInterceptor());
}



// &#x52A8;&#x6001;&#x4EE3;&#x7406;&#x4E2D;&#x7684; InvocationHandler&#x7C7B;&#xFF0C;&#x771F;&#x6B63;&#x5BF9;&#x65B9;&#x6CD5;&#x7684;&#x524D;&#x540E;&#x8FDB;&#x884C;&#x901A;&#x77E5;&#x7684;&#x7C7B;&#xFF0C;&#x4EE3;&#x7406;&#x7C7B;&#x5BF9;&#x8C61;&#x53EA;&#x662F;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x76EE;&#x6807;&#x5BF9;&#x8C61;&#x7684;&#x5C01;&#x88C5;&#x4EE5;&#x8C03;&#x7528;&#x800C;&#x5DF2;
 private class SqlSessionInterceptor implements InvocationHandler {
        private SqlSessionInterceptor() {
        }

        public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {

            //&#x67E5;&#x770B;&#x662F;&#x5426;&#x6709;&#x4E3A;&#x5173;&#x95ED;&#x7684;&#x95F2;&#x7F6E;&#x7684;&#x540C;&#x4E2A;&#x914D;&#x7F6E;&#x7684;sqlsession&#xFF0C;&#x6709;&#x5219;&#x8C03;&#x7528;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x4F60;&#x7528;sqlsessionTemplate&#x4EE3;&#x7406;&#x6267;&#x884C;&#x589E;&#x5220;&#x67E5;&#x6539;&#x4E00;&#x76F4;&#x662F;&#x540C;&#x4E00;&#x4E2A;sqlsession&#x5B8C;&#x6210;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x7684;&#x539F;&#x56E0;&#xFF0C;&#x6CA1;&#x6709;&#x5219;&#x751F;&#x6210;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x662F;&#x7531;SqlSessionUtils&#x5B9E;&#x73B0;&#x7684;

    SqlSession sqlSession = SqlSessionUtils.getSqlSession(SqlSessionTemplate.this.sqlSessionFactory, SqlSessionTemplate.this.executorType, SqlSessionTemplate.this.exceptionTranslator);

            Object unwrapped;
            try {
                Object result = method.invoke(sqlSession, args);
                if (!SqlSessionUtils.isSqlSessionTransactional(sqlSession, SqlSessionTemplate.this.sqlSessionFactory)) {
                //&#x67E5;&#x8BE2;&#x8BE5;sqlsession&#x662F;&#x5426;&#x5728;Spring&#x4E8B;&#x52A1;&#x4E2D;&#xFF0C;&#x82E5;&#x662F;&#x5219;&#x6B65;&#x4E0D;&#x81EA;&#x52A8;&#x63D0;&#x4EA4;
                //&#x82E5;&#x662F;&#x81EA;&#x52A8;&#x5219;&#x4E3A;&#x4E00;&#x6761;sql&#x4E00;&#x6B21;commit&#xFF0C;&#x662F;&#x4E3A;&#x65B0;&#x624B;&#x8BBE;&#x7F6E;&#x7684;&#xFF0C;&#x4E00;&#x822C;&#x624B;&#x52A8;&#x63D0;&#x4EA4;&#x3002;
                    sqlSession.commit(true);
                }

                unwrapped = result;
            } catch (Throwable var11) {
                unwrapped = ExceptionUtil.unwrapThrowable(var11);
                if (SqlSessionTemplate.this.exceptionTranslator != null &amp;&amp; unwrapped instanceof PersistenceException) {
                    SqlSessionUtils.closeSqlSession(sqlSession, SqlSessionTemplate.this.sqlSessionFactory);
                    sqlSession = null;
                    Throwable translated = SqlSessionTemplate.this.exceptionTranslator.translateExceptionIfPossible((PersistenceException)unwrapped);
                    if (translated != null) {
                        unwrapped = translated;
                    }
                }

                throw (Throwable)unwrapped;
            } finally {

            //&#x5173;&#x95ED;sqlsession&#xFF0C;&#x540C;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x53EF;&#x4EE5;&#x6709;&#x591A;&#x4E2A;sqlsession

                if (sqlSession != null) {
                    SqlSessionUtils.closeSqlSession(sqlSession, SqlSessionTemplate.this.sqlSessionFactory);
                }

            }

            return unwrapped;
        }
    }
}
</code></pre><h4 id="sqlsessionutils"><a name="sqlsessionutils" class="anchor-navigation-ex-anchor" href="#sqlsessionutils"><i class="fa fa-link" aria-hidden="true"></i></a>SqlSessionUtils</h4>
<ul>
<li>&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;SqlSessionUtils&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;sqlsession&#x7684;&#x521B;&#x5EFA;&#x9700;&#x8981;&#x6CE8;&#x610F;<strong>transactionFactory&#x662F;SpringManageTransactionFactory&#x3002;</strong></li>
</ul>
<pre class="language-"><code>public final class SqlSessionUtils {
        public static SqlSession getSqlSession(SqlSessionFactory sessionFactory, ExecutorType executorType, PersistenceExceptionTranslator exceptionTranslator) {
        Assert.notNull(sessionFactory, &quot;No SqlSessionFactory specified&quot;);
        Assert.notNull(executorType, &quot;No ExecutorType specified&quot;);

        //&#x6709;&#x76F8;&#x5E94;&#x7684;sqlsessionHolder&#x5219;&#x53D6;&#x51FA;&#x91CC;&#x9762;&#x7684;SqlSession

        SqlSessionHolder holder = (SqlSessionHolder)TransactionSynchronizationManager.getResource(sessionFactory);
        SqlSession session = sessionHolder(executorType, holder);
        if (session != null) {
            return session;
        } else {
            if (LOGGER.isDebugEnabled()) {
                LOGGER.debug(&quot;Creating a new SqlSession&quot;);
            }

            //&#x6CA1;&#x6709;&#x5219;&#x7528;&#x5DE5;&#x5382;&#x521B;&#x5EFA;sqlsession&#xFF0C;&#x6CE8;&#x610F;&#xFF1A;&#x6B64;&#x65F6;&#x7684;sqlsessionfactory&#x662F;sqlsessionfactoryBean&#x521B;&#x5EFA;&#x7684;&#xFF0C;&#x5373;&#x4ED6;&#x7684;configuration&#x4E2D;&#x7684;Enviroment&#x4E2D;&#x7684;transactionFactory&#x662F;SpringManageTransactionFactory&#x3002;

            session = sessionFactory.openSession(executorType);

           // &#x6CE8;&#x518C;sqlsession&#x5230;TransactionSyncronizedMager&#xFF0C;


            registerSessionHolder(sessionFactory, executorType, exceptionTranslator, session);
            return session;
        }
    }
}
</code></pre><ul>
<li><p>&#x5173;&#x4E8E;SqlSessionUtils&#x4E2D;&#x7684;registerSessionHolder&#x65B9;&#x6CD5;&#xFF0C;&#x6CE8;&#x518C;sqlsession&#x5230;TransactionSyncronizedMager&#x4E2D;&#xFF0C;</p>
</li>
<li><p><strong>&#x5305;&#x542B;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;</strong></p>
<blockquote>
<p><strong>bindResource(sessionFactory, holder);
 registerSynchronization(new SqlSessionUtils.SqlSessionSynchronization(holder, sessionFactory))&#xFF1B;</strong></p>
</blockquote>
</li>
</ul>
<pre class="language-"><code>private static void registerSessionHolder(SqlSessionFactory sessionFactory, ExecutorType executorType, PersistenceExceptionTranslator exceptionTranslator, SqlSession session) {
    if (TransactionSynchronizationManager.isSynchronizationActive()) {

        //&#x4ECE;sessionFactory&#x4E2D;&#x83B7;&#x53D6;Environment

        Environment environment = sessionFactory.getConfiguration().getEnvironment();

        //&#x5224;&#x65AD;environment&#x4E2D;&#x5C01;&#x88C5;&#x7684;TransactionFactorySpringManagedTransactionFactory&#xFF0C;&#x662F;&#x5426;&#x7528;&#x5230;&#x4E86;Spring&#x7684;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x670D;&#x52A1;&#xFF0C;sqlsession&#x4E2D;&#x5BF9;TransactionSyncronizedMager&#x7684;&#x5E94;&#x7528;&#x53EA;&#x6709;&#x4E0E;Spring&#x96C6;&#x6210;&#x65F6;&#x624D;&#x7528;&#x5230;&#xFF0C;mybatis&#x81EA;&#x8EAB;&#x7684;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x5E76;&#x4E0D;&#x4F1A;&#x7528;&#x5230;&#x3002;

        if (environment.getTransactionFactory() instanceof SpringManagedTransactionFactory) {
            if (LOGGER.isDebugEnabled()) {
                LOGGER.debug(&quot;Registering transaction synchronization for SqlSession [&quot; + session + &quot;]&quot;);
            }

            SqlSessionHolder holder = new SqlSessionHolder(session, executorType, exceptionTranslator);

            //&#x7ED1;&#x5B9A;&#x3001;&#x6CE8;&#x518C;&#x5230;TransactionSynchronizationManager
            TransactionSynchronizationManager.bindResource(sessionFactory, holder);
            TransactionSynchronizationManager.registerSynchronization(new SqlSessionUtils.SqlSessionSynchronization(holder, sessionFactory));

            holder.setSynchronizedWithTransaction(true);
            holder.requested();
        } else {
            if (TransactionSynchronizationManager.getResource(environment.getDataSource()) != null) {
                throw new TransientDataAccessResourceException(&quot;SqlSessionFactory must be using a SpringManagedTransactionFactory in order to use Spring transaction synchronization&quot;);
            }

            if (LOGGER.isDebugEnabled()) {
                LOGGER.debug(&quot;SqlSession [&quot; + session + &quot;] was not registered for synchronization because DataSource is not transactional&quot;);
            }
        }
    } else if (LOGGER.isDebugEnabled()) {
        LOGGER.debug(&quot;SqlSession [&quot; + session + &quot;] was not registered for synchronization because synchronization is not active&quot;);
    }

}
</code></pre><h4 id="sqlsessionsynchronization"><a name="sqlsessionsynchronization" class="anchor-navigation-ex-anchor" href="#sqlsessionsynchronization"><i class="fa fa-link" aria-hidden="true"></i></a>SqlSessionSynchronization</h4>
<ul>
<li><p>&#x5176;&#x4E2D;SqlSessionSynchronization&#x662F;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x751F;&#x547D;&#x5468;&#x671F;&#x7684;callback&#x63A5;&#x53E3;&#xFF0C;mybatis-spring&#x901A;&#x8FC7;SqlSessionSynchronization&#x5728;&#x4E8B;&#x52A1;&#x63D0;&#x4EA4;&#x548C;&#x56DE;&#x6EDA;&#x524D;&#x5206;&#x522B;&#x8C03;&#x7528;DefaultSqlSession.commit()&#x548C;DefaultSqlSession.rollback()</p>
<pre class="language-"><code>private static final class SqlSessionSynchronization extends TransactionSynchronizationAdapter {
public void beforeCommit(boolean readOnly) {
            if (TransactionSynchronizationManager.isActualTransactionActive()) {
                try {
                    if (SqlSessionUtils.LOGGER.isDebugEnabled()) {
                        SqlSessionUtils.LOGGER.debug(&quot;Transaction synchronization committing SqlSession [&quot; + this.holder.getSqlSession() + &quot;]&quot;);
                    }

                    this.holder.getSqlSession().commit();
                } catch (PersistenceException var4) {
                    if (this.holder.getPersistenceExceptionTranslator() != null) {
                        DataAccessException translated = this.holder.getPersistenceExceptionTranslator().translateExceptionIfPossible(var4);
                        if (translated != null) {
                            throw translated;
                        }
                    }
                    throw var4;
                }
            }

        }

        public void beforeCompletion() {
            if (!this.holder.isOpen()) {
                if (SqlSessionUtils.LOGGER.isDebugEnabled()) {
                    SqlSessionUtils.LOGGER.debug(&quot;Transaction synchronization deregistering SqlSession [&quot; + this.holder.getSqlSession() + &quot;]&quot;);
                }

                TransactionSynchronizationManager.unbindResource(this.sessionFactory);
                this.holderActive = false;
                if (SqlSessionUtils.LOGGER.isDebugEnabled()) {
                    SqlSessionUtils.LOGGER.debug(&quot;Transaction synchronization closing SqlSession [&quot; + this.holder.getSqlSession() + &quot;]&quot;);
                }

                this.holder.getSqlSession().close();
            }

        }

        public void afterCompletion(int status) {
            if (this.holderActive) {
                if (SqlSessionUtils.LOGGER.isDebugEnabled()) {
                    SqlSessionUtils.LOGGER.debug(&quot;Transaction synchronization deregistering SqlSession [&quot; + this.holder.getSqlSession() + &quot;]&quot;);
                }

                TransactionSynchronizationManager.unbindResourceIfPossible(this.sessionFactory);
                this.holderActive = false;
                if (SqlSessionUtils.LOGGER.isDebugEnabled()) {
                    SqlSessionUtils.LOGGER.debug(&quot;Transaction synchronization closing SqlSession [&quot; + this.holder.getSqlSession() + &quot;]&quot;);
                }

                this.holder.getSqlSession().close();
            }

            this.holder.reset();
        }
</code></pre></li>
</ul>
<h4 id="datasourceutils&#x548C;springmanagedtransaction"><a name="datasourceutils&#x548C;springmanagedtransaction" class="anchor-navigation-ex-anchor" href="#datasourceutils&#x548C;springmanagedtransaction"><i class="fa fa-link" aria-hidden="true"></i></a>datasourceUtils&#x548C;SpringManagedTransaction</h4>
<ul>
<li>&#x4E00;&#x756A;&#x5468;&#x6298;&#x7EC8;&#x4E8E;&#x62FF;&#x5230;&#x4E86;sqlsession&#x5230;&#x4E86;&#x4EE3;&#x7406;&#x7C7B;SqlsessionTemplate&#x4E2D;&#xFF0C;&#x63A5;&#x7740;&#x4FBF;&#x662F;&#x76EE;&#x6807;&#x4EE3;&#x7801;&#x672C;&#x8EAB;(sql&#x8BED;&#x53E5;)&#x7684;&#x6267;&#x884C;&#x4E86;</li>
<li>&#x5728;&#x6B64;&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x8C08;&#x53CA;&#x4E3A;&#x4F55;&#x8981;&#x4E13;&#x95E8;&#x7528;SpringManagedTransaction&#xFF0C;&#x73B0;&#x5728;&#x5C31;&#x8981;&#x63ED;&#x6653;&#x4E86;&#xFF0C;&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x4E86;sqlsession&#x5230;&#x4E86;SpringTemplate&#xFF0C;&#x4F46;&#x662F;&#x8FD8;&#x672A;&#x83B7;&#x53D6;connection&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x6267;&#x884C;&#x8BED;&#x53E5;&#x524D;&#x5C31;&#x8981;&#x83B7;&#x53D6;connection&#xFF0C;&#x6211;&#x4EEC;&#x7528;mybatis&#x7684;Executor&#x6267;&#x884C;&#x8BED;&#x53E5;&#xFF0C;&#x4F1A;&#x5728;prepareStatement&#x4E2D;&#x83B7;&#x5F97;connection</li>
</ul>
<pre class="language-"><code>protected Connection getConnection(Log statementLog) throws SQLException {
    Connection connection = this.transaction.getConnection();
    return statementLog.isDebugEnabled() ? ConnectionLogger.newInstance(connection, statementLog, this.queryStack) : connection;
}
</code></pre><ul>
<li>&#x770B;&#x5230;&#x4E0A;&#x9762;&#x7684;transsaction&#x4FBF;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E00;&#x4E2A;transaction&#x6765;&#x5B9E;&#x73B0;&#x8FDE;&#x63A5;&#x7684;&#x83B7;&#x53D6;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x7684;&#x8FDE;&#x63A5;&#x662F;&#x4E4B;&#x524D;&#x7ED1;&#x5B9A;&#x5230;&#x4E86;ThreadLocal&#x4E2D;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;Spring&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x7684;&#x5173;&#x952E;&#x8981;&#x8BA9;&#x6B64;&#x65F6;Thread&#x4E2D;&#x7684;connection&#x7528;&#x4E0A;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x5C31;&#x9700;&#x8981;&#x7528;&#x5230;DataSourceUtils&#x6765;&#x83B7;&#x53D6;&#x4E86;    </li>
</ul>
<ul>
<li><strong>datasourceUtils:&#x4E5F;&#x662F;&#x4ECE;TransactionSynchronizationManager&#x83B7;&#x53D6;connection</strong></li>
</ul>
<ul>
<li><p>SqlSessionUtils&#x4ECE;TransactionSynchronizationManager&#x83B7;&#x53D6;ConnectionHolder&#x4EA4;&#x7ED9;SpringManagedTransaction&#xFF0C;&#x5E76;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x5C01;&#x88C5;&#x8FDB;Executor&#xFF0C;&#x6700;&#x540E;&#x5C01;&#x88C5;&#x8FDB;DefaultSqlSession&#xFF0C;<strong>&#x5C06;Spring&#x7684;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x4E0E;&#x5B83;&#x7684;&#x6570;&#x636E;&#x8BBF;&#x95EE;&#x6846;&#x67B6;&#x662F;&#x7D27;&#x5BC6;&#x7ED3;&#x5408;&#x7684;</strong></p>
</li>
<li><p><strong>SpringManagedTransaction&#x4E2D;&#x4FDD;&#x7559;&#x7531;datasource&#x7B49;&#x4FE1;&#x606F;&#xFF0C;&#x800C;&#x4E14;&#x5B83;&#x7279;&#x522B;&#x5B9E;&#x73B0;&#x4E86;&#x5BF9;SqlSessionUtils&#x7684;&#x8C03;&#x7528;&#xFF08;&#x5176;&#x4ED6;&#x7684;jdbcTransaction&#x548C;managedTransaction&#x90FD;&#x6CA1;&#x6709;&#x5BF9;SqlSessionUtils&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x4E24;&#x8005;&#x53EA;&#x9002;&#x7528;&#x4E8E;mybaitis&#x81EA;&#x8EAB;&#x4E8B;&#x52A1;&#x60C5;&#x51B5;&#xFF0C;&#x4E0D;&#x9002;&#x7528;&#x4E8E;&#x96C6;&#x6210;&#xFF09;</strong></p>
</li>
<li><p><strong>&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x7ED9;datasourceUtils&#x63D0;&#x4F9B;&#x53C2;&#x6570;&#xFF0C;&#x8BA9;&#x5176;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4ECE;TransactionSynchronizationManager&#x4E2D;&#x8C03;&#x7528;&#x76F8;&#x5E94;&#x7684;connection&#xFF0C;&#x56E0;&#x4E3A;&#x662F;&#x540C;&#x4E00;&#x7EBF;&#x7A0B;&#x4E14;&#x4E8B;&#x52A1;&#x6CA1;&#x7ED3;&#x675F;&#x6240;&#x4EE5;&#x80FD;&#x4FDD;&#x8BC1;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x4E86;</strong></p>
</li>
</ul>
<ul>
<li>SpringManagedTransaction&#x7684;&#x610F;&#x4E49;&#x4FBF;&#x5728;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x95EE;&#x9898;&#x4E5F;&#x5C31;&#x89E3;&#x51B3;&#x4E86;&#xFF0C;&#x6700;&#x540E;&#x4FBF;&#x662F;jdbc.connection&#x7684;excute&#x64CD;&#x4F5C;&#x4E86;</li>
</ul>
<blockquote>
<pre class="language-"><code>public abstract class DataSourceUtils {
public static Connection doGetConnection(DataSource dataSource) throws SQLException {
Assert.notNull(dataSource, &quot;No DataSource specified&quot;);

ConnectionHolder conHolder = (ConnectionHolder) TransactionSynchronizationManager.getResource(dataSource);
if (conHolder != null &amp;&amp; (conHolder.hasConnection() || conHolder.isSynchronizedWithTransaction())) {
   conHolder.requested();
   if (!conHolder.hasConnection()) {
      logger.debug(&quot;Fetching resumed JDBC Connection from DataSource&quot;);
      conHolder.setConnection(fetchConnection(dataSource));
   }
   return conHolder.getConnection();
}
// Else we either got no holder or an empty thread-bound holder here.

logger.debug(&quot;Fetching JDBC Connection from DataSource&quot;);
Connection con = fetchConnection(dataSource);

if (TransactionSynchronizationManager.isSynchronizationActive()) {
   logger.debug(&quot;Registering transaction synchronization for JDBC Connection&quot;);
   // Use same Connection for further JDBC actions within the transaction.
   // Thread-bound object will get removed by synchronization at transaction completion.
   ConnectionHolder holderToUse = conHolder;
   if (holderToUse == null) {
      holderToUse = new ConnectionHolder(con);
   }
   else {
      holderToUse.setConnection(con);
   }
   holderToUse.requested();
   TransactionSynchronizationManager.registerSynchronization(
         new ConnectionSynchronization(holderToUse, dataSource));
   holderToUse.setSynchronizedWithTransaction(true);
   if (holderToUse != conHolder) {
      TransactionSynchronizationManager.bindResource(dataSource, holderToUse);
   }
}
return con;
}
</code></pre></blockquote>
<ul>
<li>&#x53EF;&#x4EE5;&#x770B;&#x5230;<strong>mybatis-spring&#x5904;&#x7406;&#x4E8B;&#x52A1;&#x7684;&#x4E3B;&#x8981;&#x6D41;&#x7A0B;&#x548C;spring jdbc&#x5904;&#x7406;&#x4E8B;&#x52A1;&#x5E76;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#xFF0C;</strong>&#x90FD;&#x662F;&#x901A;&#x8FC7;DataSourceTransactionManager&#x7684;getTransaction(), rollback(), commit()&#x5B8C;&#x6210;&#x4E8B;&#x52A1;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x7BA1;&#x7406;&#xFF0C;&#x800C;&#x4E14;jdbc connection&#x7684;&#x521B;&#x5EFA;&#x4E5F;&#x662F;&#x901A;&#x8FC7;DataSourceTransactionManager.getTransaction()&#x5B8C;&#x6210;&#xFF0C;mybatis&#x5E76;&#x6CA1;&#x6709;&#x53C2;&#x4E0E;&#x5176;&#x4E2D;&#xFF0C;mybatis&#x53EA;&#x662F;&#x5728;&#x6267;&#x884C;sql&#x65F6;&#x901A;&#x8FC7;DataSourceUtils.getConnection()&#x83B7;&#x5F97;&#x5F53;&#x524D;thread&#x7684;jdbc connection&#xFF0C;&#x7136;&#x540E;&#x5728;&#x5176;&#x4E0A;&#x6267;&#x884C;sql&#x3002;</li>
</ul>
<h4 id="commit"><a name="commit" class="anchor-navigation-ex-anchor" href="#commit"><i class="fa fa-link" aria-hidden="true"></i></a>commit</h4>
<ul>
<li><strong>&#x6700;&#x540E;&#x5199;&#x4E00;&#x4E0B;commit&#x7684;&#x6D41;&#x7A0B;</strong>&#xFF08;rollback&#x5B9E;&#x73B0;&#x5DEE;&#x4E0D;&#x591A;&#xFF0C;&#x56DE;&#x5230;&#x4FDD;&#x5B58;&#x7684;&#x56DE;&#x8C03;&#x70B9;&#x800C;&#x5DF2;&#xFF09;</li>
</ul>
<ul>
<li>&#x8C03;&#x7528;DataSourceTransactionManager&#x7684;&#x7236;&#x7C7B;AbstractPlatformTransactionManager&#x7684;commit</li>
</ul>
<pre class="language-"><code>public abstract class AbstractPlatformTransactionManager implements PlatformTransactionManager, Serializable {

 public final void commit(TransactionStatus status) throws TransactionException {
     &#xB7;&#xB7;&#xB7;
     status &#x662F;&#x5426;&#x5DF2;&#x5B8C;&#x6210;&#x6216;&#x662F;&#x5426;&#x9700;&#x8981;rollback
    &#xB7;&#xB7;&#xB7;    
        //&#x6B63;&#x5E38;&#x6D41;&#x7A0B;&#x4F1A;&#x8C03;&#x7528;processCommit         
            this.processCommit(defStatus);
        }   
        }
        }
  }
&#x200B;
</code></pre><pre class="language-"><code>

</code></pre><p>private void processCommit(DefaultTransactionStatus status) throws TransactionException {
    try {
        boolean beforeCompletionInvoked = false;</p>
<pre class="language-"><code>    try {
        boolean unexpectedRollback = false;         
        //commit&#x51C6;&#x5907;      
        this.prepareForCommit(status);

        //BeforeCommit&#xFF1A;commit&#x524D;&#x5BF9;springTransaciton&#x3001;sqlsession&#x7684;commit&#xFF0C;&#x5927;&#x90E8;&#x5206;&#x672A;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#x7684;&#x529F;&#x80FD;

        this.triggerBeforeCommit(status);

        //BeforeCompletion&#xFF1A;Complete&#x524D;&#x5BF9;springTransaciton&#x3001;sqlsession&#x7684;commit

        this.triggerBeforeCompletion(status);
        beforeCompletionInvoked = true;
        &#xB7;&#xB7;&#xB7;
        &#x662F;&#x5426;&#x6709;&#x8BB0;&#x5F55;&#x56DE;&#x8C03;&#x70B9;/&#x662F;&#x5426;&#x9700;&#x8981;&#x56DE;&#x8C03;
        &#xB7;&#xB7;&#xB7;
        // &#x5728;DataSourceTransactionManager&#x4E2D;&#x5B9E;&#x73B0;&#x5BF9;connection&#x7684;commit
        this.doCommit(status);

        &#xB7;&#xB7;&#xB7;          
       &#x5F02;&#x5E38;&#x5904;&#x7406;
        &#xB7;&#xB7;&#xB7;

    try {

        //&#x5BF9;TransactionSynchronizationManager&#x4E2D;&#x7684;synchronizations&#x7528;Iterator&#x8BA1;&#x6570;&#x5668;&#x904D;&#x5386;&#x5220;&#x9664;
        this.triggerAfterCommit(status);

    } finally {

    // &#x82E5;&#x4E0A;&#x4E00;&#x6B65;&#x6CA1;&#x6E05;&#x7406;&#x5B8C;&#x6210;&#xFF0C;&#x5219;&#x518D;&#x6B21;&#x6E05;&#x7406;&#x4E00;&#x6B21;&#xFF0C;&#x7528;synchronizations&#x7528;Iterator&#x8BA1;&#x6570;&#x5668;&#x904D;&#x5386;&#x5220;&#x9664;
        this.triggerAfterCompletion(status, 0);

    }
} finally {

    // &#x6E05;&#x7A7A;TransactionSynchronizationManager&#xFF0C;&#x82E5;&#x6709;&#x6302;&#x8D77;&#x7684;&#x4E8B;&#x52A1;&#xFF0C;&#x5219;&#x6062;&#x590D;&#x6267;&#x884C;
    this.cleanupAfterCompletion(status);
}
</code></pre><p>}</p>
<pre class="language-"><code>

</code></pre><p>// &#x6E05;&#x7A7A;TransactionSynchronizationManager&#xFF0C;&#x82E5;&#x6709;&#x6302;&#x8D77;&#x7684;&#x4E8B;&#x52A1;&#xFF0C;&#x5219;&#x6062;&#x590D;&#x6267;&#x884C;&#xFF0C;&#x8FD9;&#x548C;definiton&#x8BBE;&#x7F6E;&#x7684;&#x4E8B;&#x52A1;&#x7EA7;&#x522B;&#x6709;&#x5173;
private void cleanupAfterCompletion(DefaultTransactionStatus status) {
        status.setCompleted();
        if (status.isNewSynchronization()) {
            TransactionSynchronizationManager.clear();
        }</p>
<pre class="language-"><code>    if (status.isNewTransaction()) {
        this.doCleanupAfterCompletion(status.getTransaction());
    }

    if (status.getSuspendedResources() != null) {
        if (status.isDebug()) {
            this.logger.debug(&quot;Resuming suspended transaction after completion of inner transaction&quot;);
        }

        Object transaction = status.hasTransaction() ? status.getTransaction() : null;

        //SuspendedResourcesHolder&#x7528;&#x9759;&#x6001;&#x65B9;&#x6CD5;&#x653E;&#x7F6E;&#x5728;JVM&#x7684;&#x65B9;&#x6CD5;&#x533A;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8C03;&#x7528;

        this.resume(transaction, (AbstractPlatformTransactionManager.SuspendedResourcesHolder)status.getSuspendedResources());
    }
</code></pre><p>```</p>
<ul>
<li>&#x8FD9;&#x4FBF;&#x662F;&#x6574;&#x4E2A;spring&#x4E0E;mybatis&#x96C6;&#x6210;&#x7684;&#x4E8B;&#x52A1;&#x63A7;&#x5236;&#x4E86;&#x3002; </li>
</ul>
<footer class="page-footer"><span class="copyright">powered by Gitbook</span><span class="footer-modification">&#x8BE5;&#x6587;&#x4EF6;&#x6700;&#x540E;&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;
2021-04-21 00:29:42
</span></footer></user></user></user></user></role></role></role></account></account></account></e></e></e></e>
<script>console.log("plugin-popup....");document.onclick = function(e){ e.target.tagName === "IMG" && window.open(e.target.src,e.target.src)}</script><style>img{cursor:pointer}</style>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Mybatis","level":"4.5","depth":1,"next":{"title":"MybatisPlus.Assets","level":"4.6","depth":1,"ref":"","articles":[]},"previous":{"title":"Mybatis.Assets","level":"4.4","depth":1,"ref":"","articles":[]},"dir":"ltr"},"config":{"plugins":["summary","splitter","chapter-fold","expandable-chapters","-lunr","-search","search-pro","github","prism","-highlight","tbfed-pagefooter","accordion","popup","hide-element","lightbox","edit-link","theme-default","livereload","back-to-top-button","favicon","anchor-navigation-ex","mermaid-gb3","copy-code-button"],"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"","modify_label":"该文件最后修改时间：","modify_format":"YYYY-MM-DD HH:mm:ss"},"page-treeview":{"copyright":"Copyright &#169; aleen42","minHeaderCount":"2","minHeaderDeep":"3"},"chapter-fold":{},"prism":{"css":["prismjs/themes/prism-okaidia.css"]},"github":{"url":"https://github.com/eternal-heathens?tab=repositories"},"livereload":{},"summary":{},"splitter":{},"search-pro":{},"accordion":{},"popup":{},"hide-element":{"elements":[".gitbook-link"]},"fontsettings":{"theme":"white","family":"sans","size":2},"mermaid-gb3":{},"anchor-navigation-ex":{"associatedWithSummary":true,"float":{"floatIcon":"fa fa-navicon","level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"mode":"float","multipleH1":true,"pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"printLog":false,"showGoTop":false,"showLevel":false},"favicon":{"shortcut":"asset/img/favicon.ico","bookmark":"asset/img/favicon.ico","appleTouch":"asset/img/favicon.ico","appleTouchMore":{"120x120":"asset/img/favicon.ico","180x180":"asset/img/favicon.ico"}},"lightbox":{"jquery":true,"sameUuid":false},"back-to-top-button":{},"copy-code-button":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"edit-link":{"label":"编辑此页面","base":"//github.com/yulilong/book/edit/master"},"theme-default":{"showLevel":true,"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"}},"expandable-chapters":{}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"eternal-heathens个人文档","gitbook":"*"},"file":{"path":"数据库/mybatis.md","mtime":"2021-04-20T16:29:42.126Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-11-30T13:18:23.809Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-accordion/accordionSelector.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-hide-element/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lightbox/js/lightbox.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-mermaid-gb3/book/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    <script src="../gitbook/gitbook-plugin-mermaid-gb3/mermaid/mermaid.min.js"></script>

    </body>
</html>

